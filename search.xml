<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Java设计模式+适配器模式</title>
    <url>/2020/02/05/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><ul>
<li>基本介绍</li>
<li>1.适配器模式(Adapter Pattern)将某个类的接口转换成客户端期望的另一个接口表示，主要目的是兼容性，让原本因接口不匹配不能一起工作的两个类可以协调工作。其别名为包装器(Wrapper).</li>
<li>2.适配器模式属于结构型模式</li>
<li>3.主要分为3类：类适配器模式，对象适配器模式，接口适配器模式<h4 id="适配器模式工作原理"><a href="#适配器模式工作原理" class="headerlink" title="适配器模式工作原理"></a>适配器模式工作原理</h4></li>
<li>1.适配器模式：将一个类的接口转换成另一个接口，让原本的接口不兼容的类可以兼容</li>
<li>2.从用户的角度看不到被适配器，是解耦的</li>
<li>3.用户调用适配器转化出来的目的接口方法，适配器再调用被适配者的相关接口方法</li>
<li>4.用户收到反馈结果，感觉只是和目标接口交互<br>目标最终需要的输出，dst(destination 即Target)===》适配器称为Adapter===》被适配者需要适配的类，接口，对象简称src(source) <h4 id="类适配器模式"><a href="#类适配器模式" class="headerlink" title="类适配器模式"></a>类适配器模式</h4></li>
<li>应用案例<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//被适配的类</span></span><br><span class="line"><span class="comment">//输出220伏的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Voltage220V</span>&#123;</span><br><span class="line">    <span class="built_in">int</span> src = <span class="number">220</span>;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"电压"</span>+src+<span class="string">"伏"</span>);</span><br><span class="line">    <span class="keyword">return</span> src;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//适配接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">Voltage5V</span>()&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> ouput5V();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//适配器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">voltageAdapter</span> <span class="symbol">extends</span> <span class="symbol">Voltage220V</span> <span class="symbol">implement</span> <span class="symbol">Voltage5V</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> output5V()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得220伏电压</span></span><br><span class="line">        <span class="built_in">int</span> srcV = output220V();</span><br><span class="line">        <span class="built_in">int</span> dstV = srcV/<span class="number">44</span>;</span><br><span class="line">        <span class="keyword">return</span> dstV;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//手机</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Phone</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//充电</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> charging(Voltage5V voltage5V)&#123;</span><br><span class="line">        <span class="keyword">if</span>(voltage5V.output5V() == <span class="number">5</span>)&#123;</span><br><span class="line">            Sytem.<span class="keyword">out</span>.println(<span class="string">"电压为5可以充电"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(voltage5V.output5V() &gt; <span class="number">5</span>)&#123;</span><br><span class="line">             Sytem.<span class="keyword">out</span>.println(<span class="string">"电压大于5伏，不能充电"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Cilent</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> static  <span class="built_in">void</span> main(String[] args)&#123;</span><br><span class="line">        System.oout.println(<span class="string">"类适配器模式"</span>);</span><br><span class="line">        Phone phone = new Phone();</span><br><span class="line">        phone.charing(new VoltageAdapter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>小结</li>
<li>1.Java是单继承机制，所以类适配器需要继承src类这一点算是一个缺点，因为这要求dst必须是接口，有一定的局限性</li>
<li>2.src类的方法在Adapter中都会暴露，也增加了使用成本。</li>
<li>3.由于其继承了src类，所以它可以根据需求重写src类方法，使得Adapter的灵活性增强了。<h4 id="对象适配器模式"><a href="#对象适配器模式" class="headerlink" title="对象适配器模式"></a>对象适配器模式</h4></li>
<li>基本思路和类适配器模式相同，只是将Adapter类做修改，不是继承src类，而是特有的是src类的实例，以解决兼容性的问题。即：持有src类，实现dst类的接口，完成src-&gt;dst的适配</li>
<li>根据“合成复用原则”，在系统中尽量使用关联关系来代替继承关系。</li>
<li>对象适配器模式是适配器模式常用的一种</li>
<li>类图<br><img src="images%5Capadter_object.png" alt="" title="对象适配器类图"></li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//被适配的类</span></span><br><span class="line"><span class="comment">//输出220伏的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Voltage220V</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> src = <span class="number">220</span>;</span><br><span class="line">    System.out.<span class="built_in">println</span>(<span class="string">"电压"</span>+src+<span class="string">"伏"</span>);</span><br><span class="line">    <span class="keyword">return</span> src;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//适配接口</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Voltage5V</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ouput5V</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//适配器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">voltageAdapter</span> <span class="title">extends</span> <span class="title">implement</span> <span class="title">Voltage5V</span>&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Voltage220V voltage220V;<span class="comment">//持有Voltage220V对象，不是继承; 关联关系中的聚合关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器传值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">voltageAdapter</span><span class="params">(Voltage220V voltage220V)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.votage220V = voltage220V;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">output5V</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> dstV = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(null != voltage220V)&#123;</span><br><span class="line">            <span class="keyword">int</span> src = voltage220.output220V();获取对象<span class="number">220</span>V电压</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"适用对象适配器，进行适配配"</span>);</span><br><span class="line">            dstV = srcV/<span class="number">44</span>;</span><br><span class="line">            SYstem.out.<span class="built_in">println</span>(<span class="string">"适配完成输出电压......="</span> + dstV);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dstV;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//手机</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Phone</span>&#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//充电</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charging</span><span class="params">(Voltage5V voltage5V)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(voltage5V.output5V() == <span class="number">5</span>)&#123;</span><br><span class="line">            Sytem.out.<span class="built_in">println</span>(<span class="string">"电压为5可以充电"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(voltage5V.output5V() &gt; <span class="number">5</span>)&#123;</span><br><span class="line">             Sytem.out.<span class="built_in">println</span>(<span class="string">"电压大于5伏，不能充电"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cilent</span>&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span></span>&#123;</span><br><span class="line">        System.oout.<span class="built_in">println</span>(<span class="string">"===对象适配器模式==="</span>);</span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        <span class="comment">//接口指向实现类</span></span><br><span class="line">        phone.charing(<span class="keyword">new</span> VoltageAdapter(<span class="keyword">new</span> Voltage220V()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="对象适配器小结："><a href="#对象适配器小结：" class="headerlink" title="对象适配器小结："></a>对象适配器小结：</h5></li>
<li>1.对象适配器和类适配器其实算是同一种思想，只不过实现方式不同。</li>
<li>2.根据合成复用原则，使用组合替代继承，所以解决了类适配器必须继承src的局限性问题，也不再要求dst必须是接口</li>
<li>3.使用成本低。<h4 id="接口适配器模式"><a href="#接口适配器模式" class="headerlink" title="接口适配器模式"></a>接口适配器模式</h4></li>
<li>基本介绍<ul>
<li>1.一些书籍称为：适配器模式(Default Adapter Pattern)或缺省适配器模式；</li>
<li>2.当不需要全部实现接口提供的方法时，可以先设计一个抽象类实现接口，并为该接口中每一个方法提供一个默认实现(空方法)，那么该抽象类的子类可有选择的覆盖父类的某些方法来实现需求</li>
<li>3.适用于一个接口不想用其所有的方法的情况。</li>
<li>类图<br><img src="images%5CAdapter_interface.png" alt="" title="接口适配器类图"></li>
</ul>
</li>
<li>应用案例<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Interface Inter0&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在AbsAdapter我们将Interface4的方法进行默认实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsAdapter</span> <span class="keyword">implements</span> <span class="title">Inter0</span></span>&#123;</span><br><span class="line">    <span class="comment">//默认实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say2</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say3</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say4</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        AbsAdapter absAdapter = <span class="keyword">new</span> AbsAdapter()&#123;</span><br><span class="line">            <span class="comment">//只需要覆盖我们需要使用接口方法</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say1</span><span class="params">()</span></span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"使用那个say1方法...."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        absAdapter.say1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="适配器模式-SpringMVC–》Dispatcher源码分析"><a href="#适配器模式-SpringMVC–》Dispatcher源码分析" class="headerlink" title="适配器模式 SpringMVC–》Dispatcher源码分析"></a>适配器模式 SpringMVC–》Dispatcher源码分析</h4></li>
<li>SpringMVC中的HandAdapter，就是用适配器模式</li>
<li>SpringMVC处理器求的流程<br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1580552227491&di=b44e07bb360f98b3ef8a1b045531c649&imgtype=0&src=http%3A%2F%2Faliyunzixunbucket.oss-cn-beijing.aliyuncs.com%2Fpng%2F09278ec2b41470b39a0374cdeb45ed5c.png%3Fx-oss-process%3Dimage%2Fresize%2Cp_100%2Fauto-orient%2C1%2Fquality%2Cq_90%2Fformat%2Cjpg%2Fwatermark%2Cimage_eXVuY2VzaGk%3D%2Ct_100" alt=""></li>
<li>使用HandAdapter的原因分析：<br>可以看到处理器类型不同，有多重实现方法，那么调用方式就不是确定的，如果需要直接调用Controller方法，需要调用的时候就不断使用if else来进行判断是哪一种子类然后执行。那么如果后面要扩展Controller，就得修改原来的代码，这样违背了OCP原则。<h3 id="适配器模式小结："><a href="#适配器模式小结：" class="headerlink" title="适配器模式小结："></a>适配器模式小结：</h3></li>
<li>1.三种命名方式：是根据src(被适配的类)以则样的形式给Adapter(在Adapter里的形式)来命名的。</li>
<li>2.类适配器：以类给到，在Adapter里就是将src当作类，继承<br>对象适配器:以对象给到，在Adapter里，将src作为一个对象，持有<br>接口适配器:以接口给到，在Adapter里将src作为一个接口，实现</li>
<li>3.Adapter模式最大的作用还是将原本不兼容的接口融合到一起工作。</li>
<li>4.实际开发中，实现起来不拘泥于我们讲过的三种经典形式</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+装饰者模式</title>
    <url>/2020/02/05/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h3><ul>
<li>案例</li>
<li>星巴克咖啡订单项目</li>
<li>1.咖啡种类/单品咖啡：Espresso(意大利咖啡)，ShprtBlack，LongBlack(美式咖啡)，Decaf(无因咖啡)</li>
<li>2.调料：Milk,Soy(豆浆)，Chocolate</li>
<li>3.要求在扩展咖啡种类时具有良好的扩展性，改进方便，维护方便</li>
<li>4.使用OO的来计算不同种类咖啡的费用：客户可以点单品咖啡，也可以单品咖啡+调料组合</li>
<li>传统方案会出现类爆炸<h4 id="装饰者模式基本概念："><a href="#装饰者模式基本概念：" class="headerlink" title="装饰者模式基本概念："></a>装饰者模式基本概念：</h4></li>
<li>1.装饰者模式:动态地将新功能附加到对象上。在对象功能扩展方面，他比继承更有弹性，装饰者模式也体现了开闭原则(ocp)</li>
<li>2.这里提到的动态的将新功能附加到对象和ocp原则，在后面的应用实例上会以代码的形式体现<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4></li>
<li>类图<br><img src="images%5CDecorator.png" alt=""></li>
<li>说明</li>
</ul>
<ol>
<li>Dirck类就是抽象类</li>
<li>ShortBlack就是单品咖啡</li>
<li>Decorator是一个装饰类，含有一个被装饰的对象(Drink obj)</li>
<li>Decorator的cost方法 进行一个费用的叠加计算，递归地计算价格<h5 id="装饰者模式解决星巴克咖啡订单"><a href="#装饰者模式解决星巴克咖啡订单" class="headerlink" title="装饰者模式解决星巴克咖啡订单"></a>装饰者模式解决星巴克咖啡订单</h5></li>
</ol>
<ul>
<li>下单：2份巧克力+一份牛奶的longBlack<br><img src="images%5CDel001.png" alt=""></li>
<li>说明:</li>
</ul>
<ol>
<li>Milk包含LongBlack</li>
<li>一份Chocolate包含了(Milk+LongBlack)</li>
<li>一份Chocolate包含(Chocolate+Milk+LongBlack)</li>
<li>这样不管是什么形式的单品咖啡+调料组合，通过递归方式可以方便的组合和维护</li>
</ol>
<ul>
<li>代码</li>
<li>被装饰者<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//抽象类  饮料</span></span><br><span class="line"><span class="keyword">public</span> abstract <span class="class"><span class="keyword">class</span> <span class="title">Drink</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> des;<span class="comment">//描述</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> price = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getDes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> des;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDes</span><span class="params">(<span class="keyword">String</span> des)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.des = des;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算价格/费用的抽象方法</span></span><br><span class="line">    <span class="comment">//子类来实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> abstract <span class="keyword">float</span> <span class="title">cost</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>抽象类饮料继承类 咖啡  实现抽象方法<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">coffee</span> <span class="keyword">extends</span> <span class="title">Drink</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public float cost() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getPrice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>咖啡的子类<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Espresso</span> <span class="keyword">extends</span> <span class="title">coffee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="type">Espresso</span>()&#123;</span><br><span class="line">        setDes(<span class="string">"意大利咖啡"</span>);</span><br><span class="line">        setPrice(<span class="number">6.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LongBlack</span> <span class="keyword">extends</span> <span class="title">coffee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="type">LongBlack</span>()&#123;</span><br><span class="line">        setDes(<span class="string">"美式咖啡"</span>);</span><br><span class="line">        setPrice(<span class="number">10.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Espresso</span> <span class="keyword">extends</span> <span class="title">coffee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="type">Espresso</span>()&#123;</span><br><span class="line">        setDes(<span class="string">"意大利咖啡"</span>);</span><br><span class="line">        setPrice(<span class="number">6.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>装饰者 继承Drink(饮料)类 组合Drink(饮料)类<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">extends</span> <span class="title">Drink</span> </span>&#123;</span><br><span class="line">    <span class="comment">//组合关联关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Drink</span> obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造方法传值</span></span><br><span class="line">    public <span class="type">Decorator</span>(<span class="type">Drink</span> obj)&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写父类的 计算价格方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public float cost() &#123;</span><br><span class="line">        <span class="comment">//价格</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getPrice() + obj.cost();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写父类 描述方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">String</span> getDes() &#123;</span><br><span class="line">        <span class="comment">//obj.getDes()输出被装饰者的信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.des + <span class="string">" "</span> + <span class="keyword">super</span>.getPrice() + <span class="string">"&amp;&amp;"</span> + obj.getDes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>装饰者子类<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Milk</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="type">Milk</span>(<span class="type">Drink</span> obj) &#123;</span><br><span class="line">        <span class="keyword">super</span>(obj);</span><br><span class="line">        setDes(<span class="string">"牛奶"</span>);</span><br><span class="line">        setPrice(<span class="number">8.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ShoreBlack</span> <span class="keyword">extends</span> <span class="title">coffee</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="type">ShoreBlack</span>()&#123;</span><br><span class="line">        setDes(<span class="string">"拿铁咖啡"</span>);</span><br><span class="line">        setPrice(<span class="number">20.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Soy</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    public <span class="type">Soy</span>(<span class="type">Drink</span> obj) &#123;</span><br><span class="line">        <span class="keyword">super</span>(obj);</span><br><span class="line">        setDes(<span class="string">"豆浆"</span>);</span><br><span class="line">        setPrice(<span class="number">4.0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">//装饰者模式下单</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> CoffeeBar &#123;</span><br><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;</span><br><span class="line">        //装饰者模式下单:<span class="number">2</span>份巧克力+一份牛奶的LongBlack</span><br><span class="line"></span><br><span class="line">        //<span class="number">1.</span> 点一份LongBlack</span><br><span class="line">        Drink <span class="keyword">order</span> = <span class="built_in">new</span> LongBlack();</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("费用=" +<span class="keyword">order</span>.<span class="keyword">cost</span>());</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("描述=" +<span class="keyword">order</span>.getDes());</span><br><span class="line"></span><br><span class="line">        //<span class="number">2.</span> 加入一份牛奶</span><br><span class="line">        <span class="keyword">order</span> = <span class="built_in">new</span> Milk(<span class="keyword">order</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入 一份牛奶费用=" +<span class="keyword">order</span>.<span class="keyword">cost</span>());</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入一份牛奶描述=" +<span class="keyword">order</span>.getDes());</span><br><span class="line"></span><br><span class="line">        //<span class="number">3.</span> 加入一份巧克力</span><br><span class="line">        <span class="keyword">order</span> = <span class="built_in">new</span> Chocolate(<span class="keyword">order</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入一份牛奶一份巧克力费用=" +<span class="keyword">order</span>.<span class="keyword">cost</span>());</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入一份牛奶一份巧克力描述=" +<span class="keyword">order</span>.getDes());</span><br><span class="line"></span><br><span class="line">        //<span class="number">4.</span> 加入两份巧克力</span><br><span class="line">        <span class="keyword">order</span> = <span class="built_in">new</span> Chocolate(<span class="keyword">order</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入一份牛奶加入两份巧克力费用=" +<span class="keyword">order</span>.<span class="keyword">cost</span>());</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("加入一份牛奶加入两份巧克力描述=" +<span class="keyword">order</span>.getDes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>运行结果<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">费用=<span class="number">10.0</span></span><br><span class="line">描述=美式咖啡</span><br><span class="line">加入一份牛奶费用=<span class="number">18.0</span></span><br><span class="line">加入一份牛奶描述=牛奶 <span class="number">8.0</span>&amp;&amp;美式咖啡</span><br><span class="line">加入一份牛奶一份巧克力费用=<span class="number">21.0</span></span><br><span class="line">加入一份牛奶一份巧克力描述=巧克力 <span class="number">3.0</span>&amp;&amp;牛奶 <span class="number">8.0</span>&amp;&amp;美式咖啡</span><br><span class="line">加入一份牛奶加入两份巧克力费用=<span class="number">24.0</span></span><br><span class="line">加入一份牛奶加入两份巧克力描述=巧克力 <span class="number">3.0</span>&amp;&amp;巧克力 <span class="number">3.0</span>&amp;&amp;牛奶 <span class="number">8.0</span>&amp;&amp;美式咖啡</span><br></pre></td></tr></table></figure>
<h3 id="装饰者模式在JDK应用的源码分析"><a href="#装饰者模式在JDK应用的源码分析" class="headerlink" title="装饰者模式在JDK应用的源码分析"></a>装饰者模式在JDK应用的源码分析</h3></li>
<li>volatile是一个特征修饰符（type specifier）.volatile的作用是作为指令关键字，确保本条指令不会因编译器的优化而省略，且要求每次直接读值。</li>
<li>java的IO结构，FilterInputStream就是一个装饰者</li>
<li>源代码<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">//装饰者</span></span><br><span class="line">public</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span> </span>&#123;</span><br><span class="line">    <span class="comment">//含被装饰者，组合关联关系</span></span><br><span class="line">    <span class="keyword">protected</span> volatile <span class="type">InputStream</span> in;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">FilterInputStream</span>(<span class="type">InputStream</span> in) &#123;</span><br><span class="line">        <span class="keyword">this</span>.in = in;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被装饰者子类</span></span><br><span class="line">public</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span></span></span><br><span class="line"><span class="class"></span>&#123;   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">FileDescriptor</span> fd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> path;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FileChannel</span> channel = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> closeLock = <span class="keyword">new</span> <span class="type">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> volatile boolean closed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="type">FileInputStream</span>(<span class="type">String</span> name) <span class="keyword">throws</span> <span class="type">FileNotFoundException</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>(name != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="type">File</span>(name) : <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//被装饰者</span></span><br><span class="line">public <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">InputStream</span> <span class="title">implements</span> <span class="title">Closeable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰者子类，具体的修饰者</span></span><br><span class="line">public</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> <span class="title">implements</span> <span class="title">DataInput</span> </span>&#123;</span><br><span class="line">    public <span class="type">DataInputStream</span>(<span class="type">InputStream</span> in) &#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li>分析得出JDK的IO流运用了装饰者模式</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+桥接模式</title>
    <url>/2020/02/05/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><ul>
<li>基本介绍：</li>
<li>1.桥接模式(Bridge模式)是指：将实现与抽象放在两个不同的类层次，使两个层次可以独立改变。</li>
<li>2.是一种结构型设计模式</li>
<li>3.Bridge模式基于类的最小设计原则，通过使用封装，聚合及继承等行为让不同的类承担不同的职责。他的主要特点是把抽象(Abstraction)与行为实现(Implememtation)分离开来，从而可以保持各部分的独立性以及应对他们的功能扩展</li>
<li>类图<br><img src="images%5Cbridge.png" alt="" title="桥接模式类图"><ul>
<li>远离类图说明：</li>
</ul>
<ol>
<li>Client类：桥接模式的调用者</li>
<li>抽象类(Abstraction):维护了Implemention/即他的实现子类，而这时聚合关系，Abstraction充当了桥接类。</li>
<li>RefinedAbstraction：是Abstraction抽象类的子类</li>
<li>Implemention：行为实现类的接口</li>
<li>ConcreationImpA/B：行为的具体实现类</li>
<li>从UML类图：可以看出这里的抽象类和接口是聚合的关系，其实就是调用和被调用的关系<h4 id="应用案例—-手机"><a href="#应用案例—-手机" class="headerlink" title="应用案例—-手机"></a>应用案例—-手机</h4></li>
</ol>
</li>
<li>类图<br><img src="images%5Cbeidge001.png" alt="" title="手机桥接模式"></li>
<li>代码实现<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Brand</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vivo</span> <span class="keyword">implements</span> <span class="title">Brand</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"vivo手机开机了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"vivo手机关机了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"vivo手机打电话"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XiaoMI</span> <span class="keyword">implements</span> <span class="title">Brand</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米手机开机了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米手机关机了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米手机打电话"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Phone相当于桥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//组合品牌</span></span><br><span class="line">    <span class="keyword">private</span> Brand brand;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">(Brand brand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand.open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand.call();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpRegistPhone</span> <span class="keyword">extends</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UpRegistPhone</span><span class="params">(Brand brand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.open();</span><br><span class="line">        System.out.println(<span class="string">"平板手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.close();</span><br><span class="line">        System.out.println(<span class="string">"平板手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.call();</span><br><span class="line">        System.out.println(<span class="string">"平板手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//折叠式手机类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FolendPhone</span> <span class="keyword">extends</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FolendPhone</span><span class="params">(Brand brand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.open();</span><br><span class="line">        System.out.println(<span class="string">"折叠样式手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.close();</span><br><span class="line">        System.out.println(<span class="string">"折叠样式手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.call();</span><br><span class="line">        System.out.println(<span class="string">"折叠样式手机"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取折叠式手机(样式加品牌)</span></span><br><span class="line">        Phone folendPhone = <span class="keyword">new</span> FolendPhone(<span class="keyword">new</span> XiaoMI());</span><br><span class="line"></span><br><span class="line">        folendPhone.open();</span><br><span class="line">        folendPhone.close();</span><br><span class="line">        folendPhone.call();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"================="</span>);</span><br><span class="line">        Phone VPhone = <span class="keyword">new</span> FolendPhone(<span class="keyword">new</span> Vivo());</span><br><span class="line"></span><br><span class="line">        VPhone.open();</span><br><span class="line">        VPhone.close();</span><br><span class="line">        VPhone.call();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"================="</span>);</span><br><span class="line">        <span class="comment">//获得平板手机</span></span><br><span class="line">        Phone upRegistPhone = <span class="keyword">new</span> UpRegistPhone(<span class="keyword">new</span> XiaoMI());</span><br><span class="line"></span><br><span class="line">        upRegistPhone.open();</span><br><span class="line">        upRegistPhone.call();</span><br><span class="line">        upRegistPhone.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"================="</span>);</span><br><span class="line">        Phone VuPhone = <span class="keyword">new</span> UpRegistPhone(<span class="keyword">new</span> Vivo());</span><br><span class="line"></span><br><span class="line">        VuPhone.open();</span><br><span class="line">        VuPhone.call();</span><br><span class="line">        VuPhone.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="桥接模式在JDBC的源码分析"><a href="#桥接模式在JDBC的源码分析" class="headerlink" title="桥接模式在JDBC的源码分析"></a>桥接模式在JDBC的源码分析</h3></li>
<li>1.JDBC的Driver接口，如果从桥接模式来看，Driver就是一个接口，下面可以有MySQL的Driver，Oracle的驱动，这些就可以当作实现接口类<h4 id="桥接模式小结："><a href="#桥接模式小结：" class="headerlink" title="桥接模式小结："></a>桥接模式小结：</h4></li>
<li>1.实现抽象和实现部分的分离，从而极大的提供了系统的灵活性，让抽象部分和实现部分独立开来，这有助于系统分层设计，从而产生更好的结构化系统。</li>
<li>2.对于系统的高层部分，只需要知道抽象部分和实现部分的接口就可以了，其他的部分有具体的业务来完成</li>
<li>3.桥接模式替代多层继承方案，可以以减少子类的个数，降低系统的管理和维护成本。</li>
<li>4.桥接模式的引入增加了系统的理解和设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计和编程。</li>
<li>5.桥接模式要求正常识别出系统中两个独立变化的维度，因此其使用范围有一定的局限性，即需要有这样的应用场景。<h4 id="桥接模式的应用场景"><a href="#桥接模式的应用场景" class="headerlink" title="桥接模式的应用场景"></a>桥接模式的应用场景</h4></li>
<li>1.对于我们那些不希望使用继承或因为多层次继承导致系统类的个数急剧增加的系统，桥接模式尤为适用。</li>
<li>2.常见的应用场景：<br>JDBC驱动程序<br>银行转账系统<br>转账分类：网上转账，柜台转帐，AMT转帐<br>转账用户类型：普通用户，银行用户，金卡用户<br>消息管理<br>消息类型：即时消息，延时消息<br>消息分类：手机短信，邮件消息，QQ消息。。。。</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java消息中间件+ActiveMQ传输协议(四)</title>
    <url>/2020/02/05/Java%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6-ActiveMQ%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-%E5%9B%9B/</url>
    <content><![CDATA[<h3 id="ActiveMQ的传输协议"><a href="#ActiveMQ的传输协议" class="headerlink" title="ActiveMQ的传输协议"></a>ActiveMQ的传输协议</h3><ul>
<li><p>简介</p>
</li>
<li><p>activemq.xml<br><img src="images%5CActivemq%E5%8D%8F%E8%AE%AE.png" alt=""></p>
</li>
<li><p>Supports pluggable transport protocols such as in-VM, TCP, SSL, NIO, UDP, multicast, JGroups and JXTA transports  即 支持可插拔的传输协议，例如VM，TCP，SSL，NIO，UDP，多播，JGroups和JXTA传输</p>
</li>
<li><p>ActiveMQ默认的协议是tcp/ip协议==&gt;openwrie</p>
</li>
<li><p>其默认的Broker配置，TCP的Client监听端口61616</p>
</li>
<li><p>在网络传输数据前，必须要序列化数据，消息是通过一个叫wire protocol的来序列化成字节流。默认情况下ActiveMQ把wire protocol叫做openWrie，它的目的是促使网络上的效率和数据快速交互。</p>
</li>
<li><p>TCP连接的URL形式如：tcp://hostname:port?key=value&amp;key=value,后面参数可选</p>
</li>
<li><p>TCP传输的优点：</p>
<ul>
<li>TCP协议传输可靠性高，稳定性强</li>
<li>高效性：字节流方式传递，效率很高</li>
<li>有效性，可用性:应用广泛，支持任何平台<h4 id="ActiveMQ传输协议之NIO"><a href="#ActiveMQ传输协议之NIO" class="headerlink" title="ActiveMQ传输协议之NIO"></a>ActiveMQ传输协议之NIO</h4></li>
</ul>
</li>
<li><p>修改activemq.xml配置</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">&lt;transportConnectors&gt;</span><br><span class="line">    &lt;transportConnector name=<span class="string">"nio"</span> uri=<span class="string">"nio://0.0.0.0:61618?trace=true"</span>/&gt;</span><br><span class="line">&lt;/transportConnectors&gt;</span><br><span class="line">```    </span><br><span class="line"><span class="comment">* 如果不特别指定ActiveMQ的网络的监听器，那么这些端口都将使用BIO网络IO模型。(OpenWire ,stopmp,amqp...)</span></span><br><span class="line"><span class="comment">* 所以为了首先提高单节点的网络吞吐性能，我们需要明确指定ActiveMQ的网络IO模型</span></span><br><span class="line"><span class="comment">* 如上：URL格式头以"nio"开头。表示这个端口使用以TCP协议为基础的NIO网络IO模型</span></span><br><span class="line">#### NIO增强</span><br><span class="line"><span class="comment">* 我们怎样既让这个端口支持NIO网络协议，又让它支持多个协议？？？？？</span></span><br><span class="line"><span class="comment">* 解决：</span></span><br><span class="line"><span class="comment">  * 使用auto关键字</span></span><br><span class="line"><span class="comment">  * 使用"+"符号来为端口设置多种特性</span></span><br><span class="line"><span class="comment">  * 如果我们即需要某一个端口支持NIO网络IO模型，有需要它支持多个协议</span></span><br></pre></td></tr></table></figure>
<p>  在TCP上启用AUTO<br>  要通过TCP连接配置ActiveMQ自动线路格式检测，请使用  auto 传输前缀。例如，在您的XML文件中添加以下传输配置：</p>
  <transportConnector name="auto" uri="auto://localhost:5671"/>
  通过SSL启用自动
  要通过SSL连接配置ActiveMQ自动线路格式检测，请使用  auto+ssl 传输前缀。例如，在您的XML文件中添加以下传输配置：

  <transportConnector name="auto+ssl" uri="auto+ssl://localhost:5671"/>
  有关将SSL与ActiveMQ一起使用的更多详细信息，请参见以下文章（如何使用SSL）。
  在NIO上启用AUTO
  要通过NIO TCP连接配置ActiveMQ自动线路格式检测，请使用  auto+nio传输前缀。例如，在您的XML文件中添加以下传输配置：

  <transportConnector name="auto+nio" uri="auto+nio://localhost:5671"/>
  在NIO SSL上启用自动
  要通过NIO SSL连接配置ActiveMQ自动线路格式检测，请使用  auto+nio+ssl 传输前缀。例如，在您的XML文件中添加以下传输配置：

  <transportConnector name="auto+nio+ssl" uri="auto+nio+ssl://localhost:5671"/>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>例如：修改activemq.xml配置</span><br></pre></td></tr></table></figure>
<transportConnector name="auto+nio" uri="auto+nio://localhost:61608"?maxmumConnections=1000&amp:wireFormat.maxFrameSize=104857600&amp:org.apache.activemq.transport.nio.SelectorManager.corePoolSize=20&amp:org.apache.activemq.transport.nio.SelectorManager.maximumPoolSize=50"/>
```
</li>
</ul>
]]></content>
      <tags>
        <tag>Java消息中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>Java消息中间件+Spring整合ActiveMQ</title>
    <url>/2020/02/05/Java%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6-Spring%E6%95%B4%E5%90%88ActiveMQ/</url>
    <content><![CDATA[<h3 id="Spring整合ActiveMQ"><a href="#Spring整合ActiveMQ" class="headerlink" title="Spring整合ActiveMQ"></a>Spring整合ActiveMQ</h3><ul>
<li>1.Maven修改，需要添加Spring支持JMS的包<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhao<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Spring_ActiveMQ<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring_ActiveMQ Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- FIXME change it to the project's website --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--zctiveMQ所需要的jar包配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.activemq/activemq-all --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.15.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.xbean/xbean-spring --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ActiveMQ整合Spring--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.xbean<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xbean-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--JSON数据绑定包--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--ActiveMQ对JMS的支持，整合Spring和ActiveMQ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-jms --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ActiveMQ所需要的pool包配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.activemq/activemq-pool --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.15.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Spring——Aop等相关配置--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Spring依赖注入--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Spring切面编程--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/springframework/spring-orm --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Aop联盟的jar包--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjrt --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--cglib字节码增强--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>Spring_ActiveMQ<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.22.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-install-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="队列Queue"><a href="#队列Queue" class="headerlink" title="队列Queue"></a>队列Queue</h4></li>
<li>Spring配置文件 applicationContext.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http:///www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启包的自动扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.zhao.activemq"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置生产者--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.pool.PooledConnectionFactory"</span> <span class="attr">destroy-method</span>=<span class="string">"stop"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--真正可以产生Connection的ConnectionFactor,由对应的JMS服务厂商提供--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brokerURL"</span> <span class="attr">value</span>=<span class="string">"tcp://192.168.1.110:61616"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxConnections"</span> <span class="attr">value</span>=<span class="string">"100"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--这个队列目的地，点对点的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"destainationQueue"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构造注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"spring-active-queue"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Spring提供的JMS工具包，它可以进行消息发送，接受等--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"jmsFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultDestination"</span> <span class="attr">ref</span>=<span class="string">"destainationQueue"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--消息转换--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.support.converter.SimpleMessageConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>消息生产者<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消息生产者  业务逻辑层</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMQ_Produce</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//织入JMS模板</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        <span class="comment">//Spring控制反转  相当于 new SpringMQ_Produce();</span></span><br><span class="line">        SpringMQ_Produce produce = (SpringMQ_Produce)ctx.getBean(<span class="string">"springMQ_Produce"</span>);</span><br><span class="line">        produce.jmsTemplate.send(<span class="keyword">new</span> MessageCreator() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Message <span class="title">createMessage</span><span class="params">(Session session)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line"></span><br><span class="line">                TextMessage textMessage = session.createTextMessage(<span class="string">"Spring和ActiveMQ的整合配置消息。。。。。。"</span>);</span><br><span class="line">                <span class="keyword">return</span> textMessage;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*此处技术点Java8特性之一 lambda表达式 只有一个参数，其参数类型也可以省略 (session)-&gt;&#123;&#125;</span></span><br><span class="line"><span class="comment">        produce.jmsTemplate.send((Session session)-&gt;&#123;</span></span><br><span class="line"><span class="comment">            TextMessage textMessage = session.createTextMessage("Spring和ActiveMQ的整合配置消息。。。。。。");</span></span><br><span class="line"><span class="comment">            return textMessage;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********send 方法运行了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>消费者<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">@Service</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMQ_Consumer</span> &#123;</span></span><br><span class="line">    <span class="comment">//织入JMS模板</span></span><br><span class="line">    @Autowired</span><br><span class="line">    <span class="keyword">private</span> JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        <span class="comment">//Spring控制反转  相当于 new SpringMQ_Produce();</span></span><br><span class="line">        SpringMQ_Consumer consumer = (SpringMQ_Consumer) ctx.getBean(<span class="string">"springMQ_Consumer"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> textMessage = (<span class="keyword">String</span>) consumer.jmsTemplate.receiveAndConvert();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"消费者收到的消息。。。。。"</span>+textMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="主题Topic"><a href="#主题Topic" class="headerlink" title="主题Topic"></a>主题Topic</h4></li>
<li>Spring核心配置 ：applicationContext.xml文件做以下修改即可<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--主题目的地，发布订阅模式--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"destainationTopic"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQTopic"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"spring-active-topic"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--Spring提供的JMS工具包，它可以进行消息发送，接受等 JmsTemplate消息模板--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"jmsFactory"</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;property name="defaultDestination" ref="destainationQueue"/&gt;--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultDestination"</span> <span class="attr">ref</span>=<span class="string">"destainationTopic"</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--消息转换--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverter"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.support.converter.SimpleMessageConverter"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>注意：生产者，消费者 代码与队列代码一样，不变<h4 id="在Spring里面实现消费者不启动，直接通过配置监听完成"><a href="#在Spring里面实现消费者不启动，直接通过配置监听完成" class="headerlink" title="在Spring里面实现消费者不启动，直接通过配置监听完成"></a>在Spring里面实现消费者不启动，直接通过配置监听完成</h4></li>
<li>在Spring配置文件中添加，监听器配置<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置监听程序--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"jmsFactory"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"destainationTopic"</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--public class MYMessageListener implements MessageListener--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"myMessageListener"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置的方法将监听器添加到容器中--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--&lt;bean id="myMessageListener" class="com.zhao.activemq.spring.MyMessageListener"/&gt;--&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>写一个类实现消息监听<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过注解方式，添加到容器 注意：要配置扫描组件</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != message &amp;&amp; message <span class="keyword">instanceof</span> TextMessage)&#123;</span><br><span class="line">            TextMessage textMessage = (TextMessage) message;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(textMessage.getText());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Java消息中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>Java消息中间件ActiveMQ+JMS(二)</title>
    <url>/2020/02/05/Java%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6ActiveMQ-JMS-%E4%BA%8C/</url>
    <content><![CDATA[<h3 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h3><ul>
<li>知识补充：<ul>
<li>JavaEE–？？</li>
<li>JavaEE是一套使用Java进行企业级应用开发的大家一致遵循的13个核心规范工业标准。JavaEE平台提供了一个基于组件的方式来加快设计，开发，装配及部署企业应用程序</li>
<li>1.JDBC(Java Database)数据库连接。</li>
<li>2.JNDI(Java Naming and Directory Interfaces)Java的命名和目录接口</li>
<li>3.EJB(Enterprise JavaBean)</li>
<li>4.RML(Remote Method Invoke)远程方法调用</li>
<li>5.Java IDL(Interface Description Language)/CORBA(Common Object Broker Architecture)接口定义语言/公用对象请求代理程序体系结构</li>
<li>6.JSP(Java Server Pages)</li>
<li>7.Servlet</li>
<li>8.XML(Extensible Markup Langage)可扩展白标记语言</li>
<li>9.JMS(Java Message Service)Java消息服务</li>
<li>10.JTA(Java Transation API)Java事务API</li>
<li>11.JTS(Java Transation Service)Java事务服务</li>
<li>12.JavaMail</li>
<li>13.JAF(JavaBean Activation Framework)</li>
</ul>
</li>
<li>Java消息服务–？？<ul>
<li>Java消息服务指的是两个应用程序之间进行异步通信的API，他为标准消息服务提供了一组接口，包括创建，发送，读取消息，等，用于支持Java应用程序开发。在JavaEE中，当两个应用程序使用JMS进行通信时，他们之间并不是直接相连的，而是通过一个共同的消息收发服务组件关联起来以达到解耦/异步/削峰的效果。<h4 id="JMS的组成和特点"><a href="#JMS的组成和特点" class="headerlink" title="JMS的组成和特点"></a>JMS的组成和特点</h4></li>
</ul>
</li>
<li>JMS provider<br>  实现JMS接口和规范的消息中间件，也就是我们的MQ服务器</li>
<li>JMS producer<br>  消息的生产者，创建和发送JMS消息的客户端应用</li>
<li>JMS consumer<br>  消息的消费者，接受和处理JMS消息的客户端应用程序</li>
<li>JMS message<ul>
<li>消息头(消息调用)<ol>
<li>JMSDestination<ul>
<li>消息发送的目的地，主要是指Queue队列和主题topic</li>
</ul>
</li>
<li>JMSDeliveryMode<ul>
<li>持久模式和非持久模式。</li>
<li>一条持久性的消息：应该被传送”一次仅仅一次”，这意味着如果JMS提供者出现故障，该消息并不会丢失，他会在服务器恢复之后再次传递。</li>
<li>一条非持久的消息：最多会传递一次，这意味着服务器出现故障，该消息将永远丢失。</li>
</ul>
</li>
<li>JMSExpiration<ul>
<li>可以设置消息在一定时间后过期，默认是永不过期</li>
<li>消息过期时间，等于Destination的send方法中的timeToLive值加上发送时刻的GMT时间</li>
<li>如果timeTolive值等于零，则JMSExpiration被设置为零，表示该消息永不过期</li>
<li>如果发送消息后，在消息过期时间之后消息还没有被发送到目的地，则该消息被清除。</li>
</ul>
</li>
<li>JMSPriority<ul>
<li>消息优先级，从0-9十个级别，0到4是普通消息，5到9是加急消息</li>
<li>JMS不要求MQyange按照这十个优先级发送消息，但必须保证加急消息要先与普通消息到达。默认是4级</li>
</ul>
</li>
<li>JMS MessageID<ul>
<li>唯一标识每个消息的标识由MQ产生。</li>
</ul>
</li>
</ol>
</li>
<li>消息属性<ul>
<li>如果需要出消息头字段之外的值，那么可以使用消息属性</li>
<li>作用：识别/去重/重点/标注等操作非常有用的方法</li>
<li>他们是以属性名和属性值对的形式制定的，可以将属性是为消息头的的扩展，属性指定一些消息头没有的包括的附加信息，比如可以在属性里指定消息选择器。</li>
<li>消息的属性就像可以分配给一条消息的附加消息头一样，他们允许开发者添加有关消息的不透明附加消息。</li>
<li>他们还用于暴露消息选择器在消息过滤时使用的数据<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">TextMessage mwessage = session.create<span class="constructor">TextMessage()</span>;</span><br><span class="line">message.get<span class="constructor">Text(<span class="params">text</span>)</span>;</span><br><span class="line">message.set<span class="constructor">StringProperty(<span class="string">"username"</span>,<span class="string">"z3"</span>)</span>;<span class="comment">//自定义属性</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>消息体<ul>
<li>封装具体的消息数据</li>
<li>发送和接受的消息体类型必须一直对应</li>
<li>5中消息体格式(session调用)<ol>
<li>TextMessage<ul>
<li>普通字符串消息，包含一个string</li>
</ul>
</li>
<li>MapMessage<ul>
<li>一个Map类型的消息，key为string类型，而值为Java的基本类型</li>
</ul>
</li>
<li>Bytesmessage<ul>
<li>二进制数组消息，包含一个byte[]</li>
</ul>
</li>
<li>StreamMessage<ul>
<li>Java数据流消息，用标准流操作来顺序的填充和读取。</li>
</ul>
</li>
<li>ObjectMessage<ul>
<li>对象消息，包含一个可序列化的Java对象<h3 id="JMS的可靠性"><a href="#JMS的可靠性" class="headerlink" title="JMS的可靠性"></a>JMS的可靠性</h3><h4 id="MQ挂了，那么消息的持久化和丢失情况分别如何—"><a href="#MQ挂了，那么消息的持久化和丢失情况分别如何—" class="headerlink" title="MQ挂了，那么消息的持久化和丢失情况分别如何—????"></a>MQ挂了，那么消息的持久化和丢失情况分别如何—????</h4></li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>persistent：持久性  PERSISTENT表示持久<br>redis的持久化方式：rdb aof<ul>
<li>Queue队列的持久性<ul>
<li>非持久：messageProducer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);<br>但服务器宕(死)机，消息不存在</li>
<li>持久：messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT);<br>持久化：当服务器宕机，消息依然存在</li>
<li>队列(Queue)持久化消息：<br>这是队列的默认传递模式，此模式保证这些消息只被传递一次和成功使用一次。对于这些消息，可靠性是优先考虑的因素。<br>可靠性的另一个重要方面是确保持久性消息传送至目标后，消息服务在向消费者传送它们之前不会丢失这些消息。</li>
</ul>
</li>
<li>主题Topic的持久化消息：<ul>
<li>特点：先启动订阅在启动生产</li>
<li>一定要先运行一次消费者，等于向MQ注册，类似我订阅了这个主题。</li>
<li>然后在运行生产者发送消息，此时:</li>
<li>无论消费者是否在线，都会接受到，不在线的话，下次链接的时候，会把没有收到的消息都接受下来。</li>
<li>应用案例<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">//消费者</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> JmsConsumer &#123;</span><br><span class="line"><span class="built_in">public</span> static final String ACTIVEMQ_URL = "tcp://192.168.1.7:61616";</span><br><span class="line"><span class="built_in">public</span> static final String TOPIC_NAME = "topic-zhao";</span><br><span class="line"><span class="built_in">public</span> static <span class="type">void</span> main(String[] args) throws JMSException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println("********z3消费者********");</span><br><span class="line"></span><br><span class="line">    // <span class="number">1.</span>创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span><br><span class="line">    ActiveMQConnectionFactory activeMQConnectionFactory = <span class="built_in">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">    //<span class="number">2.</span>通过连接工厂，获取连接<span class="keyword">connection</span>并启动</span><br><span class="line">    <span class="keyword">Connection</span> <span class="keyword">connection</span> = activeMQConnectionFactory.createConnection();</span><br><span class="line">    //<span class="keyword">connection</span>.<span class="keyword">start</span>();</span><br><span class="line">    <span class="keyword">connection</span>.setClientID("z3");</span><br><span class="line">    //<span class="number">3.</span>创建会话</span><br><span class="line">    //有两个参数，第一个叫事务/第二个叫签收</span><br><span class="line">    <span class="keyword">Session</span> <span class="keyword">session</span> = <span class="keyword">connection</span>.createSession(<span class="keyword">false</span>, <span class="keyword">Session</span>.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">    //<span class="number">4.</span>创建目的地(具体是队列还是主题) 接口</span><br><span class="line">    Topic topic = <span class="keyword">session</span>.createTopic(TOPIC_NAME);</span><br><span class="line">    // TopicSubscriber 主题的订阅者    DurableSubscriber表示持久化订阅者</span><br><span class="line">    TopicSubscriber topicSubscriber = <span class="keyword">session</span>.createDurableSubscriber(topic,"remark.......");</span><br><span class="line">    <span class="keyword">connection</span>.<span class="keyword">start</span>();</span><br><span class="line"></span><br><span class="line">    Message message = topicSubscriber.receive();</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">null</span> != message)&#123;</span><br><span class="line">        TextMessage textMessage = (TextMessage) message;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("收到的持久化Topic："+textMessage.getText());</span><br><span class="line">        message = topicSubscriber.receive(<span class="number">5000</span>L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*//5.创建消费者</span></span><br><span class="line"><span class="comment">    MessageConsumer consumer = session.createConsumer(topic);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//通过监听的方式(旧式写法)</span></span><br><span class="line"><span class="comment"> */</span><span class="comment">/*   consumer.setMessageListener(new MessageListener() &#123;</span></span><br><span class="line"><span class="comment">        @Override</span></span><br><span class="line"><span class="comment">        public void onMessage(Message message) &#123;</span></span><br><span class="line"><span class="comment">        if (null != message &amp;&amp; message instanceof TextMessage)&#123;</span></span><br><span class="line"><span class="comment">            TextMessage textMessage = (TextMessage) message;</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                System.out.println("******消费者接收到消息："+textMessage.getText());</span></span><br><span class="line"><span class="comment">            &#125; catch (JMSException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;);*/</span><span class="comment">/*</span></span><br><span class="line"><span class="comment"> //此处技术点Java8特性之一 lambda表达式</span></span><br><span class="line"><span class="comment">    consumer.setMessageListener((Message message)-&gt;&#123;</span></span><br><span class="line"><span class="comment">        if (null != message &amp;&amp; message instanceof TextMessage)&#123;</span></span><br><span class="line"><span class="comment">            TextMessage textMessage = (TextMessage) message;</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                System.out.println("******消费者接收到消息："+textMessage.getText());</span></span><br><span class="line"><span class="comment">            &#125; catch (JMSException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;);*/</span></span><br><span class="line">    //保证控制台不灭</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">in</span>.<span class="keyword">read</span>();</span><br><span class="line">    //<span class="number">6.</span>关闭资源</span><br><span class="line">    <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">    <span class="keyword">connection</span>.<span class="keyword">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li>生产者<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package activemq.topic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主题生产者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsProduce</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.7:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> TOPIC_NAME = <span class="string">"topic-zhao"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws JMSException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        <span class="comment">//connection.start();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消息生产者</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(topic);</span><br><span class="line">        <span class="comment">//主题持久化</span></span><br><span class="line">        messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT);</span><br><span class="line">        connection.start();<span class="comment">//主题持久化启动位置</span></span><br><span class="line">        <span class="comment">//6.通过消息的生产者messageProdecer生产3条消息发送到MQ的队列里面</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">3</span> ; i++) &#123;</span><br><span class="line">            <span class="comment">//7.创建消息 ， 一定格式的消息</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"topic---msg------"</span> + i);<span class="comment">//理解为一个字符串</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//8.通过messagerProducer发送给MQ</span></span><br><span class="line">            messageProducer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.关闭资源</span></span><br><span class="line">        messageProducer.<span class="built_in">close</span>();</span><br><span class="line">        session.<span class="built_in">close</span>();</span><br><span class="line">        connection.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"*****主题消息发送到MQ完成******"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>事务<ol>
<li>producer提交时的事务<ul>
<li>false<br>只执行send，就进入到队列中。<br>关闭事务，那第2个签收参数的设置需要有效</li>
<li>true<br>先执行，send在执行commit，消息才真正的提交到队列中。<br>消息需要批量发送，需要换冲区处理<br>关闭session之前，需提交事务session.commit();<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">  //ok <span class="keyword">session</span>.<span class="keyword">commit</span>();</span><br><span class="line">&#125;catch(<span class="keyword">exception</span> e)&#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;finally&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">null</span> != <span class="keyword">session</span>)&#123;</span><br><span class="line">    <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意消费者也需，进行事务提交，session.commit() *  2. 事务偏生产者/签收偏消费者</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>Acknowledge：签收<ul>
<li>非事务</li>
<li>自动签收：session.AUTO_ACKNOWLEDGE</li>
<li>手动签收<br>session.CLIENT_ACKNOWLEDGE<br>客户端调用acknowledge方法手动签收<br>textMessage.acknowledge();</li>
<li>允许重复消息<br>session.DUPS_OK_ACKNOWLEDGE</li>
<li>事务：<ul>
<li>生产事务开启，只有commit后才能将全部消息变为以消费</li>
</ul>
</li>
</ul>
</li>
<li>签收和事务的关系:<ul>
<li>在事务性会话中，当一个事务被成功提交则消息被自动签收。<br>如果事务回滚，则消息会被再次传递。</li>
<li>非事务性会话中，消息何时被确任取决于创建会话时的应答模式(acknowledgement mode)<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3></li>
</ul>
</li>
</ul>
<ol>
<li>点对点模式Queue<ul>
<li>点对点模式是基于队列的，生产者发消息到队列，消费者从队列接收消息，队列的存在在使得消息的异步传输，成为可能，和我们平时给朋友发短信类似。</li>
<li>如果在Session关闭时有部分消息已被收到但是还没有被签收(acknowledged),那当消费者，下次连接到相同的队列时，这些消息还会被再次接收。</li>
<li>队列可以长久的保存消息直到消费者收到消息，消费者不需要因为担心消息会丢失而时刻和队列保持激活的连接状态，充分体现了异步传输模式的优势。 </li>
</ul>
</li>
<li>发布订阅模式<ul>
<li>JMS Pub/Sub模型定义了如何向一个内容节点发布和订阅消息，这些节点被称为topic</li>
<li>主题可被认为是消息的传输中介，发布者(publisher)发布消息到主题，订阅者(subscribe)从主题订阅消息</li>
<li>主题使得消息订阅这和消息发布者保持互相独立，不需要接触即可保证消息的传递<h3 id="按照不同的conf配置文件来启动ActiveMQ"><a href="#按照不同的conf配置文件来启动ActiveMQ" class="headerlink" title="按照不同的conf配置文件来启动ActiveMQ"></a>按照不同的conf配置文件来启动ActiveMQ</h3></li>
</ul>
</li>
</ol>
<ul>
<li><p>相当于一个ActiveMQ服务实例</p>
</li>
<li><p>Broker其实就是实现用代码的形式启动ActiveMQ将MQ嵌套到Java代码中，以便随时用随时启动，<br>作用：在用的时候在去启动这样节省了资源，也保证了可靠性。<br>命令：cp activemq.xml activemq02.xml<br>启动：./activemq start xbean:file:/apache-activemq-5.15.9/conf/activemq02 启动指定容器<br>命令：lsof -i:61616</p>
</li>
<li><p>二、按照不同配置文件启动ActiveMQ<br>1、 先将ActiveMQ根目录下conf文件夹中的activemq.xml复制一份并重命名为activemq02</p>
<pre><code>命令（cp activemq.cml activemq02.xml）</code></pre><p>2、启动activemq02，默认启动的是activemq</p>
<pre><code>命令（./activemq start xbean:file:/apache-activemq-5.15.11/conf/activemq02.xml）</code></pre><h3 id="Broker嵌入式"><a href="#Broker嵌入式" class="headerlink" title="Broker嵌入式"></a>Broker嵌入式</h3></li>
<li><p>用ActiveMQ  Broker作为独立的消息服务来构建JAVA应用。</p>
</li>
<li><p>ActiveMQ也支持在vm中通信基于嵌套shidebroker,能够无缝集成其他Java应用</p>
</li>
<li><p>嵌入式Broker</p>
<h4 id="知识补充：Jackson介绍（JSON处理库）"><a href="#知识补充：Jackson介绍（JSON处理库）" class="headerlink" title="知识补充：Jackson介绍（JSON处理库）"></a>知识补充：Jackson介绍（JSON处理库）</h4></li>
<li><p>Jackson作为一个知名，并且经典的Java平台的JSON库，有人说它是最好的JSON解析工具，或者只是一个简单的还行的JSON解析库，不管如何Jackson都是一个值得一学，值得一用的JSON处理库。</p>
</li>
<li><p>Jackson不仅支持流式处理json，还支持数据绑定（POJO和JSON之间的相互转化），甚至还拓展了很多其他第三方库所支持的数据格式（如：Avro, BSON, CBOR, CSV, Smile, (Java) Properties, Protobuf, XML和YAML，Guava, Joda, PCollections）。</p>
</li>
<li><p>Jackson的三个核心模块：</p>
<ul>
<li>jackson-core:定义了低级的流式API，包括了JSON处理细节。</li>
<li>jackson-annotations:包含了Jackson的注解。</li>
<li>jackson-databind:实现了对象和JSON之间的转换，这个包依赖上面两个包。</li>
</ul>
</li>
<li><p>如何解析JSON:</p>
</li>
<li><p>尽管有很多种拆分JSON并解析的方法，但是可以归纳成3种:</p>
<ul>
<li>迭代：对事件流（Jackson称之为Token流）的迭代</li>
<li>数据绑定：将Json数据绑定到对象</li>
<li>遍历树：构建一个树结构并使用合适的方法遍历它</li>
</ul>
</li>
<li><p>对应的Java的API:</p>
<ul>
<li>SAX和Stax。这个提供了一些基本的API来遍历事件流。其中，SAX是主动把event推给你(push)，Stax是让你可以主动遍历这个事件流(pull)。一个是push，一个是pull，但是事件流都是一样的，只是表现方式不同。提供事件callback的SAX，主动遍历event的Stax，还有一个是Stax Cursor API（游标）。</li>
<li>JAXB是数据绑定的标准; 虽然有n + 1个替代品（Jibx，XMLBeans，Castor等等），但它们都是这样做的：将（Java）对象转换为xml，反之亦然，其中一些方便而有效，另一些则不如此。</li>
<li>DOM是“最标准的”API，它定义了树结构; 但是与数据绑定一样，还有多种（更好的）替代方案（XOM，JDOM，DOM4j）。您可以逐节点遍历它，也可以使用XPath。<br>虽然上面说的都是XML的，但是我们讨论的是JSON啊！事实证明，格式不重要，重要的是这种解析的思想。</li>
</ul>
</li>
<li><p>对应了Jackson提供的三个类:</p>
</li>
<li><p>核心包（jackson-core）包含JsonParser和JsonGenerator，它们允许迭代令牌(Jackson喜欢说成令牌token，而不是事件event)。</p>
</li>
<li><p>ObjectMapper实现了数据绑定功能：JSON和Object之间的相互转换。</p>
</li>
<li><p>TreeMapper是把JSON字符串构造成一个树，其中包含了节点(JsonNode)和子节点(JsonNode)。<br>和Jackson 1.x的区别:</p>
</li>
</ul>
<p>使用Maven作为构建工具，而不是Ant<br>注释划分到一个单独的包<br>包改成了com.fasterxml.jackson.core(原来是 org.codehaus.jackson)</p>
<ul>
<li>POM.xml文件<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实现了对象和JSON之间的转换</span></span><br><span class="line"><span class="params">&lt;dependency&gt;</span></span><br><span class="line">    <span class="params">&lt;groundId&gt;</span>com.fasterxml.jackson.core<span class="params">&lt;/groundId&gt;</span></span><br><span class="line">    <span class="params">&lt;artifactId&gt;</span>jackson-databind<span class="params">&lt;artifactId&gt;</span></span><br><span class="line">    <span class="params">&lt;version&gt;</span><span class="number">2.9</span><span class="number">.5</span><span class="params">&lt;version&gt;</span></span><br><span class="line"><span class="params">&lt;decependcy&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>测试服务   EmbedBroker<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbedBroker</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//AAAAACtiveMQ也支持在vm中通信基于嵌入式的broker</span></span><br><span class="line">        BrokerService brokerService = <span class="keyword">new</span> BrokerService();</span><br><span class="line">        brokerService.setUseJmx(<span class="literal">true</span>);</span><br><span class="line">        brokerService.addConnector(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line">        brokerService.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>查看服务 队列验证<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">G</span>:\<span class="selector-tag">IDEA</span>\<span class="selector-tag">Maven_ActiveMQ</span>&gt;<span class="selector-tag">jps</span> <span class="selector-tag">-l</span></span><br><span class="line">  10720 <span class="selector-tag">embedborker</span><span class="selector-class">.EmbedBroker</span></span><br><span class="line">  12224 <span class="selector-tag">org</span><span class="selector-class">.jetbrains</span><span class="selector-class">.jps</span><span class="selector-class">.cmdline</span><span class="selector-class">.Launcher</span></span><br><span class="line">  12180 <span class="selector-tag">org</span><span class="selector-class">.jetbrains</span><span class="selector-class">.idea</span><span class="selector-class">.maven</span><span class="selector-class">.server</span><span class="selector-class">.RemoteMavenServer36</span></span><br><span class="line">  4084 <span class="selector-tag">sun</span><span class="selector-class">.tools</span><span class="selector-class">.jps</span><span class="selector-class">.Jps</span></span><br><span class="line">  11160</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>Java消息中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+建造者模式</title>
    <url>/2020/01/26/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h3><ul>
<li>传统方式</li>
<li>类图<br><img src="images%5Cbuilder.png" alt="传统方式" title="传统方式"><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">AbstractHost</span> &#123;</span><br><span class="line">    <span class="comment">//打地基</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">bulidBasic</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//砌墙</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildwall</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封顶</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">roofed</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        bulidBasic();</span><br><span class="line">        buildwall();</span><br><span class="line">        roofed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>子类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonHost</span> <span class="keyword">extends</span> <span class="title">AbstractHost</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bulidBasic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子打地基"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildwall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子砌墙"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">roofed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子封顶"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试类(客户端)<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">public class<span class="built_in"> Client </span>&#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CommonHost commonHost = new CommonHost();</span><br><span class="line">        commonHost.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>传统方式分析：</li>
<li>1.优点是比较好理解，简单易操作。</li>
<li>2.设计的程序，过于简单，没有设计缓存层的对象，程序的扩展和维护不好，也就是说这种设计方案，把产品(即：房子)和创建产品的过程(即：建房子的流程)封装在一起，耦合性增强了。</li>
<li>3.解决放方案：将产品和产品建造过程解耦 =》建造者模式<h3 id="建造这模式基本介绍："><a href="#建造这模式基本介绍：" class="headerlink" title="建造这模式基本介绍："></a>建造这模式基本介绍：</h3></li>
<li>1.建造者模式(Build Pattern)又叫生成器模式，是一种对象的构建模式。它可以将复杂对象的建造过程抽象出来(抽象类别)，使这个抽象过程的不同实现方法可以构造出不同表现(属性)的对象。</li>
<li>2.建造者模式是一步一步创建一个复杂对象，它允许用户只通过指定复杂对象的内容就可以构建他们，用户不需要知道内部的具体构建细节。</li>
<li>建造者模式的四个角色：</li>
<li>Product(产品角色)：一个具体的产品对象；</li>
<li>Builder(抽象建造者)：创建一个Product对象的各个部件指定的接口/抽象类。</li>
<li>ConcreteBuilder(具体建造者)：实现接口,构建和装配各个部件。</li>
<li>Director(指挥者)：构建一个使用Builder接口的对象。它主要是用于创建一个复杂的对象。它主要由两个作用，一是：隔离了客户于对象的生产过程，二是：负责控制产品对象的生产过程。</li>
<li>类图<br><img src="images%5Cbuilder1.png" alt="建造者模式" title="建造者模式"></li>
<li>应用案例</li>
<li>House —&gt;Product(产品角色)<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">House</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> basic;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> wall;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> rootfed;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getBasic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBasic</span><span class="params">(<span class="keyword">String</span> basic)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.basic = basic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getWall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> wall;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWall</span><span class="params">(<span class="keyword">String</span> wall)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.wall = wall;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getRootfed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rootfed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRootfed</span><span class="params">(<span class="keyword">String</span> rootfed)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rootfed = rootfed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>HouseBuilder—-&gt;Builder(抽象建造者)<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">//抽象的建造者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">HouseBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>  House house = <span class="keyword">new</span> House();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将建造的流程...,抽象的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildBasic</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildwalls</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">rootfed</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建造房子</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> House <span class="title">buildHose</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> house;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>HightBuilder和CommonHost—》ConcreteBuilder(具体建造者)<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HightBuilder</span> <span class="keyword">extends</span> <span class="title">HouseBuilder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBasic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"高楼的地基"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildwalls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"高楼砌墙"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rootfed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"高楼封顶"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonHost</span> <span class="keyword">extends</span> <span class="title">HouseBuilder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBasic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子打地基"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildwalls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子砌墙"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rootfed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"普通房子封顶"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>HouseDirector —&gt;Director(指挥者)<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指挥者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HouseDirector</span> </span>&#123;</span><br><span class="line">    HouseBuilder houseBuilder = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器传入houseBuilder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HouseDirector</span><span class="params">(HouseBuilder houseBuilder)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.houseBuilder = houseBuilder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过setter方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setHouseBuilder</span><span class="params">(HouseBuilder houseBuilder)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.houseBuilder = houseBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//具体的建造流程在这里指挥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">House <span class="title">contructHouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        houseBuilder.buildBasic();</span><br><span class="line">        houseBuilder.buildwalls();</span><br><span class="line">        houseBuilder.rootfed();</span><br><span class="line">        <span class="function"><span class="keyword">return</span> houseBuilder.<span class="title">buildHose</span><span class="params">()</span></span>;  <span class="comment">//返回具体产品</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="建造者模式在JDK的应用源码分析："><a href="#建造者模式在JDK的应用源码分析：" class="headerlink" title="建造者模式在JDK的应用源码分析："></a>建造者模式在JDK的应用源码分析：</h3></li>
<li>java.lang.StringBuider中的建造这模式(StringBuilder是一个可变的字符序列。此类提供一个与 StringBuffer 兼容的 API，但不保证同步。该类被设计用作 StringBuffer 的一个简易替换，用在字符串缓冲区被单个线程使用的时候（这种情况很普遍）。)</li>
<li>源码中建造者模式角色分析：<ul>
<li>Appendable接口定义了多个Appendable为抽象建造者，定义了抽象方法。</li>
<li>AbstrStringBuilder实现Applentable接口方法，这里的AbstractStringBuilder已经是建造者，只是不能实例化</li>
<li>StringBuilder即充当了指挥者角色，同时充当了具体的建造者，建造方法的是现实是由AbstractStringBuilder完成，而StringBuilder继承了AbstracterStrignBuilder<h3 id="建造者模式的注意事项："><a href="#建造者模式的注意事项：" class="headerlink" title="建造者模式的注意事项："></a>建造者模式的注意事项：</h3></li>
</ul>
</li>
<li>1.客户端(使用程序)不必知道产品的内部组成的细节 ，将产品本身于产品创建过程解耦，使得相同的创建过程可以创建不同的产品对象</li>
<li>2.每一个具体的建造者都是相对独立的，，而与其他具体建造者无关，因此可以很方便的替换具体建造者或者增加新的具体创建者，用户使用不同的具体创建者即可得到不同的产品对象</li>
<li>3.可以更加精细的控制产品的创建过程，见复杂产品的创建步骤分解在不同的方法中，是的创建过程更加清晰，也更方便使用程序来控制创建过程</li>
<li>4.增加新的具体建造者无需修改原有的类库的代码，指挥者类针对抽象创建者类编程，系统扩展方便。符合ocp(开闭)原则</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+工厂模式</title>
    <url>/2020/01/26/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><ul>
<li>传统方式 应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//将Pizze类做成抽象的</span></span><br><span class="line"><span class="keyword">public</span> abstract <span class="class"><span class="keyword">class</span> <span class="title">pizze</span> &#123;</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> abstract <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"baking"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"cut"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">box</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"boxing"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheesePizze</span> <span class="title">extends</span> <span class="title">pizze</span>&#123;</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"制作奶酪披萨 准备原材料"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreekPizze</span> <span class="title">extends</span> <span class="title">pizze</span> &#123;</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"希腊披萨准备原材料"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//订单类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPizze</span> &#123;</span></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderPizze</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pizze pizze = null;</span><br><span class="line">        <span class="keyword">String</span> orderType;<span class="comment">//订购披萨的类型</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line"></span><br><span class="line">            orderType = getType();</span><br><span class="line">            <span class="keyword">if</span>(orderType.equals(<span class="string">"greek"</span>))&#123;</span><br><span class="line">                pizze = <span class="keyword">new</span> GreekPizze();</span><br><span class="line">                pizze.setName(<span class="string">"希腊"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (orderType.equals(<span class="string">"cheese"</span>))&#123;</span><br><span class="line">                pizze = <span class="keyword">new</span> CheesePizze();</span><br><span class="line">                pizze.setName(<span class="string">"奶昔"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//输出pizze，的制作过程</span></span><br><span class="line">            pizze.<span class="built_in">prepare</span>();</span><br><span class="line">            pizze.bake();</span><br><span class="line">            pizze.cut();</span><br><span class="line">            pizze.box();</span><br><span class="line">        &#125;<span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写一个方法，可以动态的使用，获取客户希望订购的披萨</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">String</span> <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader strin = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"input pizza 种类："</span>);</span><br><span class="line">            <span class="keyword">String</span> str = strin.readLine();</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//相当于一个客户端，发出订购</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> OrderPizze();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图<br><img src="images%5Cpizzastore.png" alt=""><h5 id="传统方式的优缺点："><a href="#传统方式的优缺点：" class="headerlink" title="传统方式的优缺点："></a>传统方式的优缺点：</h5></li>
<li>1.优点是比较好理解，简单易操作。</li>
<li>2.缺点是违反了设计模式的ocp原则，即对扩展开放，对修改关闭。即但我们该类增加新的功能是，尽量不修改代码，或者尽可能少修改代码。</li>
<li>3.比如我们这时要增加一个Pizze的种类(Pepper披萨)，我们需要做如下修改：<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">pepperPizze</span> <span class="keyword">extends</span> <span class="title">pizze</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void prepare() &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"给胡椒披萨准配原材料"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>订单代码修改<br><img src="images%5C180000.png" alt="订单代码截图" title="订单代码截图"></li>
</ul>
<h5 id="改进代码思路分析"><a href="#改进代码思路分析" class="headerlink" title="改进代码思路分析"></a>改进代码思路分析</h5><ul>
<li>分析：<ul>
<li>修改代码可以接受，但是如果我们在其他的地方也有创建Pizze的代码，就意味着，也需要修改，而创建Pizza的代码，往往有多处</li>
</ul>
</li>
<li>思路：把创建Pizze的对象封装到一个类中，这样我们有新的Pizze种类是，只需要修改该类就可，其他创建到Pizze对象的代码就不需要修改了 —》简单工厂模式</li>
<li>改进类图：<br><img src="images%5Cpizzastore1.png" alt=""><h3 id="简单-静态-工厂模式-–概述："><a href="#简单-静态-工厂模式-–概述：" class="headerlink" title="简单(静态)工厂模式 –概述："></a>简单(静态)工厂模式 –概述：</h3></li>
<li>1.简单工厂模式是属于创建型模式，是工厂模式的一种。简单工厂模式是由决定创建出哪一一个工厂对象种产品类的实例。简单工厂模式是工厂模式家族中最简单使用的模式</li>
<li>2.简单工厂模式：定义了一个创建对象的类,由这个类来封装实例化对象的行为(代码)</li>
<li>3.在软件开发中，当我们会用到大量的创建某种，某类或者某批对象时，就会使用到工厂模式</li>
<li>订单类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPizze</span> &#123;</span></span><br><span class="line">    <span class="comment">//定义一个简单工厂对象</span></span><br><span class="line">    SimpleFactory simpleFactory;</span><br><span class="line">    pizze pizze = null;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderPizze</span><span class="params">(SimpleFactory simpleFactory)</span></span>&#123;</span><br><span class="line">        setFactory(simpleFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFactory</span><span class="params">(SimpleFactory simpleFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">String</span> orderType = <span class="string">""</span>;<span class="comment">//用户输入的</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.simpleFactory = simpleFactory;<span class="comment">//设置简单工厂对象</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            orderType = getType();</span><br><span class="line">            pizze = <span class="keyword">this</span>.simpleFactory.createPizze(orderType);</span><br><span class="line">            <span class="comment">//输出pizze</span></span><br><span class="line">            <span class="keyword">if</span>(pizze != null)&#123;<span class="comment">//订购成功</span></span><br><span class="line">                pizze.<span class="built_in">prepare</span>();</span><br><span class="line">                pizze.bake();</span><br><span class="line">                pizze.cut();</span><br><span class="line">                pizze.box();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(<span class="string">"订购披萨失败！"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写一个方法，可以动态的使用，获取客户希望订购的披萨</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">String</span> <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader strin = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"input pizza 种类："</span>);</span><br><span class="line">            <span class="keyword">String</span> str = strin.readLine();</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>简单工厂类(定义一个可以实例化pizze对象的类，封装创建对象的代码<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">//简单工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SimpleFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据orderType，返回对应的pizze对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> pizze <span class="title">createPizze</span>(<span class="params">String orderType</span>)</span> &#123;</span><br><span class="line">        pizze pizze = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"使用简单工厂模式"</span>);</span><br><span class="line">        <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"greek"</span>)) &#123;</span><br><span class="line">            pizze = <span class="keyword">new</span> GreekPizze();</span><br><span class="line">            pizze.setName(<span class="string">"希腊"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">            pizze = <span class="keyword">new</span> CheesePizze();</span><br><span class="line">            pizze.setName(<span class="string">"奶昔"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"pepper"</span>)) &#123;</span><br><span class="line">            pizze = <span class="keyword">new</span> pepperPizze();</span><br><span class="line">            pizze.setName(<span class="string">"胡椒"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizze;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//相当于一个客户端，发出订购</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//使用简单工厂模式</span></span><br><span class="line">        <span class="keyword">new</span> OrderPizze(<span class="keyword">new</span> SimpleFactory());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"----退出程序-----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3></li>
<li>使用简单工厂模式，创建不同的简单工厂类，但是考虑到项目的规模以及软件的可维护性，可扩展性并不是特别好。</li>
<li>工厂方法模式基本概念：<ul>
<li>工厂方法模式：定义一个创建对象的抽象方法，由子类决定要实例化的类。工厂方法模式将对象的实例化推迟到子类。</li>
</ul>
</li>
<li>类图<br><img src="images%5Cfactorymethod.png" alt="工厂方法模式" title="工厂方法模式"></li>
<li>应用案例<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">paizeeStore</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// new BJorderPizze();</span></span><br><span class="line">        <span class="keyword">new</span> LDorderPizze();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LDorderPizze</span> <span class="title">extends</span> <span class="title">OrderPizze</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function">pizze <span class="title">createPizze</span>(<span class="params">String orderType</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">        pizze pizze1 =<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"cheese"</span>))&#123;</span><br><span class="line">            pizze1 = <span class="keyword">new</span> LDCheesePizze();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"pepper"</span>))&#123;</span><br><span class="line">            pizze1 = <span class="keyword">new</span> LDGreekPizze();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizze1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BJorderPizze</span> <span class="title">extends</span> <span class="title">OrderPizze</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function">pizze <span class="title">createPizze</span>(<span class="params">String orderType</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">        pizze pizze1 =<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"cheese"</span>))&#123;</span><br><span class="line">            pizze1 = <span class="keyword">new</span> BJCheesePizze();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (orderType.<span class="keyword">equals</span>(<span class="string">"pepper"</span>))&#123;</span><br><span class="line">            pizze1 = <span class="keyword">new</span> BJGreekPizze();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizze1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">OrderPizze</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个抽象方法，createPizze，让各个工厂子类自己实现</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> pizze <span class="title">createPizze</span>(<span class="params">String orderType</span>)</span>;  <span class="comment">//抽象方法由工厂子类实现</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderPizze</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        pizze pizze = <span class="literal">null</span>;</span><br><span class="line">        String orderType;<span class="comment">//订购披萨的类型</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line"></span><br><span class="line">            orderType = getType();</span><br><span class="line">            pizze pizze1 = createPizze(orderType); <span class="comment">//抽象方法由工厂子类实现</span></span><br><span class="line">            <span class="comment">//输出pizze，的制作过程</span></span><br><span class="line">            pizze1.prepare();</span><br><span class="line">            pizze1.bake();</span><br><span class="line">            pizze1.cut();</span><br><span class="line">            pizze1.box();</span><br><span class="line">        &#125;<span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//写一个方法，可以动态的使用，获取客户希望订购的披萨</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader strin = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.<span class="keyword">in</span>));</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">"input pizza 种类："</span>);</span><br><span class="line">            String str = strin.readLine();</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将Pizze类做成抽象的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">pizze</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">prepare</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(name+<span class="string">"baking"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(name+<span class="string">"cut"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">box</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(name+<span class="string">"boxing"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">setName</span>(<span class="params">String name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BJCheesePizze</span> <span class="title">extends</span> <span class="title">pizze</span> &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        setName(<span class="string">"北京。。。。。。"</span>);</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"北京，制作奶酪披萨 准备原材料"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">其他<span class="number">3</span>个类与BJCheesePizze相似省略....</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><ul>
<li>基本接受</li>
<li>1.抽象工厂模式：定义了一个interface用于创建相关或有依赖关系的对象簇，而无需指明具体的类</li>
<li>2.抽象工厂模式可以将简单工厂模式和工厂方法模式进行整合。</li>
<li>3.从设计层面看，抽象工厂模式就是对简单工厂模式的改进(或者称为进一步的抽象)。</li>
<li>4.将工厂抽象成两层，AbsFactory(抽象工厂)和具体实现的工厂子类。程序员可以更具创建的对象类型使用对应的工厂子类。这样就将单个的简单工厂类变成工厂簇，更利用代码的维护和扩展。</li>
<li>类图<br><img src="images%5CabsFactory.png" alt="抽象工厂模式" title="抽象工厂模式"></li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将Pizze类做成抽象的</span></span><br><span class="line"><span class="keyword">public</span> abstract <span class="class"><span class="keyword">class</span> <span class="title">pizze</span> &#123;</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> abstract <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"baking"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"cut"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">box</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(name+<span class="string">"boxing"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BJCheesePizze</span> <span class="title">extends</span> <span class="title">pizze</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setName(<span class="string">"北京。。。。。。"</span>);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"北京，制作奶酪披萨 准备原材料"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">其他<span class="number">3</span>个类与BJCheesePizze相似省略....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象工厂模式的抽象层 接口</span></span><br><span class="line"><span class="keyword">public</span> interface absFactory&lt;Pizze&gt; &#123;</span><br><span class="line">    <span class="comment">//让下面的工厂子类来 具体实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> pizze <span class="title">createPizze</span><span class="params">(<span class="keyword">String</span> orderType)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//工厂子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BJFactory</span> <span class="title">implements</span> <span class="title">absFactory</span> &#123;</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> pizze <span class="title">createPizze</span><span class="params">(<span class="keyword">String</span> orderType)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"使用的是抽象工厂模式...."</span>);</span><br><span class="line">        pizze pizze = null;</span><br><span class="line">        <span class="keyword">if</span> (orderType.equals(<span class="string">"cheese"</span>))&#123;</span><br><span class="line">            pizze = <span class="keyword">new</span> BJCheesePizze();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(orderType.equals(<span class="string">"geek"</span>))&#123;</span><br><span class="line">            pizze = <span class="keyword">new</span> BJGreekPizze();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizze;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">LDFactory于BJFactory同理此处省略......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//OrderPizze聚合 absFactory工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPizze</span> &#123;</span></span><br><span class="line">    absFactory Factory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderPizze</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderPizze</span><span class="params">(absFactory factory)</span> </span>&#123;</span><br><span class="line">       setFactory(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//set方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setFactory</span><span class="params">(absFactory Factory)</span></span>&#123;</span><br><span class="line">        pizze pizze = null;</span><br><span class="line">        <span class="keyword">String</span> orderType=<span class="string">""</span>;<span class="comment">//用户输入</span></span><br><span class="line">        <span class="keyword">this</span>.Factory = Factory;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            orderType = getType();</span><br><span class="line">            <span class="comment">//Factory可能是BJ的工厂子类也可能是LD</span></span><br><span class="line">            pizze = Factory.createPizze(orderType);</span><br><span class="line">            <span class="keyword">if</span>(pizze != null)&#123;<span class="comment">//订购成功</span></span><br><span class="line">                pizze.<span class="built_in">prepare</span>();</span><br><span class="line">                pizze.bake();</span><br><span class="line">                pizze.cut();</span><br><span class="line">                pizze.box();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(<span class="string">"订购失败！"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写一个方法，可以动态的使用，获取客户希望订购的披萨</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">String</span> <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader strin = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"input pizza 种类："</span>);</span><br><span class="line">            <span class="keyword">String</span> str = strin.readLine();</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">pizzeStore</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> OrderPizze(<span class="keyword">new</span> BJFactory());</span><br><span class="line">        <span class="comment">//new OrderPizze(new LDFactory());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂模式在JDK-Calendar-日历类-应用源码分析"><a href="#工厂模式在JDK-Calendar-日历类-应用源码分析" class="headerlink" title="工厂模式在JDK-Calendar(日历类)应用源码分析"></a>工厂模式在JDK-Calendar(日历类)应用源码分析</h3></li>
<li>源码 java.util包下Calendar使用简单工厂模式<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Calendar getInstance(TimeZone zone,</span><br><span class="line">                                     Locale aLocale)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">return</span> createCalendar(zone, aLocale);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Calendar createCalendar(TimeZone zone,</span><br><span class="line">                                         Locale aLocale)</span><br><span class="line">  &#123;</span><br><span class="line">      CalendarProvider provider =</span><br><span class="line">          LocaleProviderAdapter.getAdapter(CalendarProvider.class, aLocale)</span><br><span class="line">                               .getCalendarProvider();</span><br><span class="line">      <span class="keyword">if</span> (provider != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> provider.getInstance(zone, aLocale);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IllegalArgumentException iae) &#123;</span><br><span class="line">              <span class="comment">// fall back to the default instantiation</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      Calendar cal = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (aLocale.hasExtensions()) &#123;</span><br><span class="line">          <span class="keyword">String</span> caltype = aLocale.getUnicodeLocaleType(<span class="string">"ca"</span>);</span><br><span class="line">          <span class="keyword">if</span> (caltype != <span class="literal">null</span>) &#123;</span><br><span class="line">              <span class="keyword">switch</span> (caltype) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">"buddhist"</span>:<span class="type"></span></span><br><span class="line"><span class="type">              cal </span>= <span class="keyword">new</span> <span class="type">BuddhistCalendar</span>(zone, aLocale);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">"japanese"</span>:<span class="type"></span></span><br><span class="line"><span class="type">                  cal </span>= <span class="keyword">new</span> <span class="type">JapaneseImperialCalendar</span>(zone, aLocale);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">"gregory"</span>:<span class="type"></span></span><br><span class="line"><span class="type">                  cal </span>= <span class="keyword">new</span> <span class="type">GregorianCalendar</span>(zone, aLocale);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (cal == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="comment">// If no known calendar type is explicitly specified,</span></span><br><span class="line">          <span class="comment">// perform the traditional way to create a Calendar:</span></span><br><span class="line">          <span class="comment">// create a BuddhistCalendar for th_TH locale,</span></span><br><span class="line">          <span class="comment">// a JapaneseImperialCalendar for ja_JP_JP locale, or</span></span><br><span class="line">          <span class="comment">// a GregorianCalendar for any other locales.</span></span><br><span class="line">          <span class="comment">// <span class="doctag">NOTE:</span> The language, country and variant strings are interned.</span></span><br><span class="line">          <span class="keyword">if</span> (aLocale.getLanguage() == <span class="string">"th"</span> &amp;&amp; aLocale.getCountry() == <span class="string">"TH"</span>) &#123;</span><br><span class="line">              cal = <span class="keyword">new</span> <span class="type">BuddhistCalendar</span>(zone, aLocale);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (aLocale.getVariant() == <span class="string">"JP"</span> &amp;&amp; aLocale.getLanguage() == <span class="string">"ja"</span></span><br><span class="line">                     &amp;&amp; aLocale.getCountry() == <span class="string">"JP"</span>) &#123;</span><br><span class="line">              cal = <span class="keyword">new</span> <span class="type">JapaneseImperialCalendar</span>(zone, aLocale);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              cal = <span class="keyword">new</span> <span class="type">GregorianCalendar</span>(zone, aLocale);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> cal;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂模式小结："><a href="#工厂模式小结：" class="headerlink" title="工厂模式小结："></a>工厂模式小结：</h3></li>
<li>工厂模式意义：<br>将实例化对象的代码提取出来，放到一个类中统一管理和维护，达到和主项目的依赖关系的解耦，从而提高项目的扩展和维护性。</li>
<li>三种工厂模式 简单(静态)工厂模式，工厂方法模式，抽象工厂模式</li>
<li>设计模式的依赖原则：<ol>
<li>创建对象实例时，不要直接new类，而是把这个new的动作放在一个工厂的方法中，并返回。有的书上说，变量不要直接持有具体类的引用。</li>
<li>不要让类继承具体的类，而是继承抽象的类或者是实现interface(接口)</li>
<li>不要覆盖基类中已经实现的方法。</li>
</ol>
</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+原型模式</title>
    <url>/2020/01/26/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="原型模式-Prototype"><a href="#原型模式-Prototype" class="headerlink" title="原型模式(Prototype)"></a>原型模式(Prototype)</h3><ul>
<li><p>传统方法</p>
</li>
<li><p>类图<br><img src="images%5Csheep.png" alt="原型模式传统方法" title="原型模式传统方法"></p>
</li>
<li><p>应用代码</p>
</li>
<li><p>sheep实体类</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sheep</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">sheep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">sheep</span><span class="params">(<span class="keyword">String</span> name, <span class="keyword">int</span> age, <span class="keyword">String</span> color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(<span class="keyword">String</span> color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"sheep&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", color='"</span> + color + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Client &#123;</span><br><span class="line">    public static void main(String<span class="literal">[]</span> args) &#123;</span><br><span class="line">        <span class="comment">//传统方法</span></span><br><span class="line">        sheep sheep = <span class="keyword">new</span> sheep(<span class="string">"tom"</span>, <span class="number">1</span>, <span class="string">"白色"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        sheep sheep1 = <span class="keyword">new</span> sheep(sheep.get<span class="constructor">Name()</span>, sheep.get<span class="constructor">Age()</span>, sheep.get<span class="constructor">Color()</span>);</span><br><span class="line">        sheep sheep2 = <span class="keyword">new</span> sheep(sheep.get<span class="constructor">Name()</span>, sheep.get<span class="constructor">Age()</span>, sheep.get<span class="constructor">Color()</span>);</span><br><span class="line">        sheep sheep3 = <span class="keyword">new</span> sheep(sheep.get<span class="constructor">Name()</span>, sheep.get<span class="constructor">Age()</span>, sheep.get<span class="constructor">Color()</span>);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(sheep);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(sheep1+<span class="string">"++++++"</span>+sheep2+<span class="string">"+++++++"</span>+sheep3+<span class="string">"++++++++"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>传统方法的优缺点：</p>
</li>
<li><p>1.优点是比较好理解,简单易操作。</p>
</li>
<li><p>2.在创建新的对象时，总是需要重新获取原始对象的属性，如果创建的对象比较复杂时，效率较低</p>
</li>
<li><p>3.总是需要重新初始化对象，而不是动态地获得对象运行时的状态，不够灵活</p>
</li>
<li><p>改进思路：<br>Java中Object类是所有类的根类，Object类提供了一个clone()方法，该方法可以将一个Java对象复制一份，但是需要实现clone的Java类必须要实现一个接口Cloneable，该接口表示该类能够复制且具有复制的能力 ==&gt;原型模式</p>
<h4 id="原型模式基本介绍"><a href="#原型模式基本介绍" class="headerlink" title="原型模式基本介绍"></a>原型模式基本介绍</h4></li>
<li><p>1.原型模式(Prototype模式)是指：用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
</li>
<li><p>2.原型模式是一种创建性设计模式，允许一个对象创建另一个可定制的对象，无需知道如何创建的细节</p>
</li>
<li><p>3.工作原理是：通过将一个原型对象传给那个要发动创建的对象通过请求原型对象拷贝他们自己来实施创建，即 对象.clone()</p>
</li>
<li><p>原型类</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pattern.pyototype.update;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建原型类实现Cloneable</span></span><br><span class="line"><span class="keyword">public</span> class sheep  implements Cloneable&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> <span class="built_in">color</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> sheep() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> sheep(<span class="keyword">String</span> name, <span class="built_in">int</span> age, <span class="keyword">String</span> <span class="built_in">color</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">color</span> = <span class="built_in">color</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setName(<span class="keyword">String</span> name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> getAge() &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setAge(<span class="built_in">int</span> age) &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getColor() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">color</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setColor(<span class="keyword">String</span> <span class="built_in">color</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">color</span> = <span class="built_in">color</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"sheep&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", color='"</span> + <span class="built_in">color</span> + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//克隆该实例，使用默认的clone方法来完成</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">Object</span> clone()&#123;</span><br><span class="line">        sheep sheep = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sheep = (sheep) <span class="keyword">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sheep;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//传统方法</span></span><br><span class="line">        sheep sheep = <span class="keyword">new</span> sheep(<span class="string">"tom"</span>, <span class="number">1</span>, <span class="string">"白色"</span>);</span><br><span class="line">        sheep sheep1 = (sheep) sheep.clone();<span class="comment">//克隆</span></span><br><span class="line">        sheep sheep2 = (sheep) sheep.clone();</span><br><span class="line">        sheep sheep4 = (sheep) sheep.clone();</span><br><span class="line">        sheep sheep3 = (sheep) sheep.clone();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(sheep);</span><br><span class="line">        System.out.<span class="built_in">println</span>(sheep1+<span class="string">"+++++"</span>+sheep2+<span class="string">"+++++++"</span>+sheep3+<span class="string">"++++++"</span>+sheep4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用原型模式改进程序，让程序具有更高的效率和扩展型<br>比如添加一个默认属性private String address=”新疆羊”; sheep = (sheep) super.clone(); 重写克隆方法的时候会克隆其类的所有属性封装到Sheep对象中；无需修给客户端，同样可以打印。所以具有更高的效率和扩展型</p>
<h3 id="原型模式在Spring框架中的应用源码分析"><a href="#原型模式在Spring框架中的应用源码分析" class="headerlink" title="原型模式在Spring框架中的应用源码分析"></a>原型模式在Spring框架中的应用源码分析</h3></li>
<li><p>Spring中源码原型bean的创建，就是原型模式的应用。</p>
</li>
<li><p>代码分析 AbstractBeanFactory类中doGetBean()的createBean()方法中</p>
<h3 id="浅拷贝介绍："><a href="#浅拷贝介绍：" class="headerlink" title="浅拷贝介绍："></a>浅拷贝介绍：</h3></li>
<li><p>对于数据类型是基本数据的成员变量，浅拷贝会直接进行值传递，也就是将该属性的值复制一份给性的对象。</p>
</li>
<li><p>对于数据类型是引用数据类型的成员变量，比如说成员变量的某个数组，某个类的对象等，那么浅拷贝会进行应用传递，也就是只是将该成员变量的引用值(内村地址)复制一份给新的对象。应为实际上两个对象的该成员变量都指向同一个实例，在这种情况下，在一个对象中修改该成员变量会影响到另一个对象的该成员变量值。</p>
</li>
<li><p>上面案例就是浅拷贝</p>
</li>
<li><p>浅拷贝是使用默认的clone()方法来实现的 sheep = (sheep) super.clone();</p>
<h3 id="深拷贝介绍："><a href="#深拷贝介绍：" class="headerlink" title="深拷贝介绍："></a>深拷贝介绍：</h3></li>
<li><p>复制对象的所有基本数据类型的成员变量值</p>
</li>
<li><p>为所有引用数据类型的成员变量中申请存储空间，并复制每个引用数据类型成员变量所引用的对象，直到该对象可达的所有对象，也就是说，对象进行深考贝要对整个对象进行拷贝。</p>
</li>
<li><p>深拷贝实现方式1：重写clone方法来实现深拷贝</p>
</li>
<li><p>深拷贝实现方式2：通过对象序列化实现深拷贝</p>
</li>
<li><p>引用案例</p>
</li>
<li><p>实体类</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实现两个接口 Serializable(序列化)，Cloneable(克隆)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepCloneableTarget</span> <span class="keyword">implements</span> <span class="title">Serializable</span>,<span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1</span>L;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String clonename;</span><br><span class="line">    <span class="keyword">private</span> String cloneClass;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeepCloneableTarget</span><span class="params">(String clonename, String cloneClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clonename = clonename;</span><br><span class="line">        <span class="keyword">this</span>.cloneClass = cloneClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为给类的属性，都是String，因此我们这里使用默认的clone完成即可</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function">Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">clone</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepPrototype</span>  <span class="keyword">implements</span> <span class="title">Serializable</span>,<span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> DeepCloneableTarget  deepCloneableTarget;  <span class="comment">//引用类型</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeepPrototype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//完成深拷贝</span></span><br><span class="line">    <span class="comment">//方式1：使用克隆的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object deep = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//这里完成对基本数据类型和String的克隆</span></span><br><span class="line">        deep = <span class="keyword">super</span>.clone();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理引用数据类型</span></span><br><span class="line">        DeepPrototype deepPrototype = (DeepPrototype)deep;</span><br><span class="line">        deepPrototype.deepCloneableTarget = (DeepCloneableTarget) deepCloneableTarget.clone();</span><br><span class="line">        <span class="keyword">return</span> deepPrototype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方式2：通过对象的序列化（推荐）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">deepClone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建流对象</span></span><br><span class="line">        <span class="comment">//输出流</span></span><br><span class="line">        ByteArrayOutputStream bos = <span class="keyword">null</span>;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输入流</span></span><br><span class="line">        ByteArrayInputStream bis = <span class="keyword">null</span>;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//序列化操作</span></span><br><span class="line">            bos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            oos = <span class="keyword">new</span> ObjectOutputStream(bos);</span><br><span class="line">            oos.writeObject(<span class="keyword">this</span>); <span class="comment">//当前这个对象以对象流的方式输出及序列化</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//反序列化</span></span><br><span class="line">            bis = <span class="keyword">new</span> ByteArrayInputStream(bos.toByteArray());<span class="comment">//把输出的对象 读进来 相当于 == 克隆</span></span><br><span class="line">            ois = <span class="keyword">new</span> ObjectInputStream(bis);</span><br><span class="line">            DeepPrototype copeobj = (DeepPrototype) ois.readObject();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> copeobj;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭流</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bos.close();</span><br><span class="line">                oos.close();</span><br><span class="line">                bis.close();</span><br><span class="line">                ois.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试类</p>
<pre><code>public class Client {
  public static void main(String[] args) throws Exception {
      DeepPrototype deepPrototype = new DeepPrototype();
      deepPrototype.name = &quot;阿尔萨斯&quot;;
      deepPrototype.deepCloneableTarget = new DeepCloneableTarget(&quot;沐沐&quot;,&quot;DeepPrototype&quot;);

      //方式一：进行深拷贝 --重写clone方法

/*           DeepPrototype  d = (DeepPrototype) deepPrototype.clone();

</code></pre></li>
</ul>
<pre><code>System.out.println(&quot;deeprototype.name=&quot;+deepPrototype.name +&quot;deepPrototype.deepCloneableTarget=&quot;+deepPrototype.deepCloneableTarget.hashCode());

System.out.println(&quot;d.name=&quot;+deepPrototype.name +&quot;d.deepCloneableTarget=&quot;+ d.deepCloneableTarget.hashCode());*/</code></pre><p>//        方式二：进行深拷贝 序列化<br>        DeepPrototype  d = (DeepPrototype) deepPrototype.deepClone();</p>
<pre><code>    System.out.println(&quot;deeprototype.name=&quot;+deepPrototype.name +&quot;deepPrototype.deepCloneableTarget=&quot;+deepPrototype.deepCloneableTarget.hashCode());

    System.out.println(&quot;d.name=&quot;+deepPrototype.name +&quot;d.deepCloneableTarget=&quot;+ d.deepCloneableTarget.hashCode());
}</code></pre><p>}</p>
<p>``` </p>
<h4 id="原型模式总结："><a href="#原型模式总结：" class="headerlink" title="原型模式总结："></a>原型模式总结：</h4><ul>
<li>1.创建新的对象比较复杂时，可以利用原型模式简化对象的创建过程，同时也能够提高效率。</li>
<li><ol start="2">
<li>不用重新初始化对象，而是动态的获得对象运行时的状态</li>
</ol>
</li>
<li>3.如果原始对象发生变化(增加或者减少属性)，其他克隆对象的也会发生相应的变化，无需修改代码</li>
<li>4.在实现深克隆的时候可能需要比较复杂的代码</li>
<li>5.缺点：需要为每一个类配置一个克隆方法，这对全新的类来说不是很难，但对已有的类进行改造时，需要修改其源码，违背了ocp(开闭原则)原则，注意。</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot微服务框架+缓存(六)</title>
    <url>/2020/01/26/SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-%E7%BC%93%E5%AD%98-%E5%85%AD/</url>
    <content><![CDATA[<h3 id="JSR-107"><a href="#JSR-107" class="headerlink" title="JSR-107"></a>JSR-107</h3><h4 id="Java-Cacheing定义了5个核心接口，分别是CachingProvider，CacheManager，Cache，Entry和Expiry。"><a href="#Java-Cacheing定义了5个核心接口，分别是CachingProvider，CacheManager，Cache，Entry和Expiry。" class="headerlink" title="Java Cacheing定义了5个核心接口，分别是CachingProvider，CacheManager，Cache，Entry和Expiry。"></a>Java Cacheing定义了5个核心接口，分别是CachingProvider，CacheManager，Cache，Entry和Expiry。</h4><ul>
<li><p>CacheProvider(缓存提供者) ：定义了创建，配置，获取，管理，和控制多个CacheManager。一个应用可以在运行期访问多个CachingProvider。</p>
</li>
<li><p>CacheManager(缓存管理器) ：定义创建，配置，获取，管理，和控制多个唯一命名的Cache，这些Cache存于CacheManager的上下文中。一个CacheManager仅被一个CachingProvider所拥有。</p>
</li>
<li><p>Cache是一个类似Map的数据结构并临时存储以Key为索引的值。一个Cache仅被一个CacheManager所拥有</p>
</li>
<li><p>Entry是一个存储在Cache中的Key-value对。</p>
</li>
<li><p>Expiry每一个存储在Cache中的条目有一个定义的有效期。一旦超过这个时间，条目为过期的状态。一但过期，条目将不可访问，更新和删除。缓存有效期可以通过ExpriyPolicy设置</p>
<h3 id="Spring缓存抽象"><a href="#Spring缓存抽象" class="headerlink" title="Spring缓存抽象"></a>Spring缓存抽象</h3></li>
<li><p>org.springframeork.cache.Cache和org.springframework.cache.CacheManager接口来统一不同的缓存技术并且支持使用JCache(JSR-107)注解简化我们的开发；</p>
</li>
<li><p>Cache接口为缓存的组件规范定义，包含缓存的各种操作集合</p>
</li>
<li><p>Cache接口下Spring提供了各种xxxCache的实现;如RedisCache，EhCacheCache，ConcurrentMapCache等</p>
</li>
<li><p>每次调用需要缓存功能的方法时，spring会检查指定参数的指定方法是否已经被调用过，如果有就直接从缓存中获取方法调用后后的结果，如果没有就调用方法并缓存结果后返回给客户。下次调用直接从缓存中获取。</p>
</li>
<li><p>使用spring缓存抽象时我们需要关注以下两点</p>
<ul>
<li>1.确定方法需要被缓存以及他们的缓存策略</li>
<li>2.从缓存中读取之前缓存存储的数据</li>
</ul>
</li>
<li><p>几个重要概念和缓存注解</p>
<p>  名称|概念<br>  —|:–:|—:<br>  cache|缓存接口，定义缓存操作。实现有：RedisCache，EhCacheCache，ConcurrentMapCache等<br>  CacheManager|缓存管理器，管理各种缓存(Cache)组件<br>  @Cacheable|主要针对方法配置，能够根据方法的请求参数对其结过进行缓存<br>  @CachePut|保证方法被调用，有希望结果被缓存<br>  @CacheEvict|清空缓存<br>  @EnableCaching|开启基于注解的缓存<br>  @keyGenerator|缓存数据时Key的生成策略<br>  serialize|缓存数据时value序列化策略</p>
</li>
</ul>
<h3 id="整合Redis"><a href="#整合Redis" class="headerlink" title="整合Redis"></a>整合Redis</h3><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><ul>
<li><p>1.</p>
<ul>
<li>@Cacheable 将方法的运行结果进行缓存；以后再要相同的数据，直接从缓存中获取，不用调用方法；</li>
</ul>
</li>
<li><p>@CacheManager管理多个Cache组件的，对缓存的真正CRUD操作在Cache组件中，每一个缓存组件有自己唯一名字</p>
</li>
<li><p>@Cacheable几个属性：</p>
</li>
<li><p>cacheNames/value；指定缓存组件名字</p>
<ul>
<li><p>key：缓存数据使用的的key；可以用它来指定。默认使用方法参数的的值  1-方法的缓存值</p>
<ul>
<li>编写Spel表达式 #id;参数id的值 #a0，#p0，#root.args[0]</li>
<li>Cache SpEL available metadata</li>
</ul>
<table>
<thead>
<tr>
<th>名字</th>
<th align="center">位置</th>
<th align="right">描述</th>
<th align="right">示例</th>
</tr>
</thead>
<tbody><tr>
<td>methodName</td>
<td align="center">root object</td>
<td align="right">当前被调用的方法名</td>
<td align="right">#root. methodName</td>
</tr>
<tr>
<td>argumentname</td>
<td align="center">evaluation context</td>
<td align="right">方法参数的名字.可以直接 #参数名，也可以使用 #p0或#a0 的形式，0表示参数的索引</td>
<td align="right">#iban，#a0，#p0</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>案例</p>
</li>
<li><p>启动类</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 搭建基本环境</span></span><br><span class="line"><span class="comment">* 1.导入数据库文件，创建出department和emploee表</span></span><br><span class="line"><span class="comment">* 2.创建JavaBean封装数据</span></span><br><span class="line"><span class="comment">* 3.整合Mybatis操作数据库</span></span><br><span class="line"><span class="comment">*    a.设置数据源信息</span></span><br><span class="line"><span class="comment">*    b.使用注解版的MyBatis</span></span><br><span class="line"><span class="comment">*       1.@MapperScan指定需要扫描的mapper接口所在的包</span></span><br><span class="line"><span class="comment">* 4.快速体验缓存</span></span><br><span class="line"><span class="comment">*   步骤：</span></span><br><span class="line"><span class="comment">*      1.开启基于注解的缓存 @EnableCaching</span></span><br><span class="line"><span class="comment">*      2.标注缓存注解即可</span></span><br><span class="line"><span class="comment">*         @Cacheable，@CacheEvict，@CachePut</span></span><br><span class="line"><span class="comment">* 	   3.</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="variable">@MapperScan</span>(<span class="string">"com.zhao.democache.mapper"</span>)</span><br><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line"><span class="variable">@EnableCaching</span></span><br><span class="line">public class DemoCacheApplication &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(DemoCacheApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>实体类</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> Integer gender; <span class="comment">//性别 1男  0女</span></span><br><span class="line">	<span class="keyword">private</span> Integer dId;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Employee() &#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Employee(Integer id, String lastName, String email, Integer gender, Integer dId) &#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">		<span class="keyword">this</span>.dId = dId;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//getter,setter,toString方法......略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>整合Mybatis操作数据库<br>*设置数据源信息</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置数据源信息</span></span><br><span class="line"><span class="attr">spring.datasource.url</span> = jdbc:mysql://localhost:<span class="number">3306</span>/spring_cache</span><br><span class="line"><span class="attr">spring.datasource.username</span>=root</span><br><span class="line"><span class="attr">spring.datasource.password</span>=zhao1314520</span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启驼峰命名法</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#打印日志</span></span><br><span class="line"><span class="attr">logging.level.com.zhao.democache.mapper</span>=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意配置数据源时，datasource.username</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用注解版的MyBatis(和EmployeeMapper.xml一样只是实现方式不同)<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from employee where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update employee set lastName = #&#123;lastName&#125;,email = #&#123;email&#125;,gender = #&#123;gender&#125;,d_id=#&#123;dId&#125; where id = #&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateEmp</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from employee where id = #&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteEmp</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into employee(lastName,email,gender,d_id)values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;dId&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEmp</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>业务类(重点Cache)</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Service</span><br><span class="line">public <span class="keyword">class</span> EmployeeService &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="constructor">Autowired(<span class="params">required</span> = <span class="params">false</span>)</span></span><br><span class="line">    EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *  @Cacheable 将方法的运行结果进行缓存；以后再要相同的数据，直接从缓存中获取，不用调用方法；</span></span><br><span class="line"><span class="comment">    *  @CacheManager管理多个Cache组件的，对缓存的真正CRUD操作在Cache组件中，每一个缓存组件有自己唯一名字</span></span><br><span class="line"><span class="comment">    *  @Cacheable几个属性：</span></span><br><span class="line"><span class="comment">    *  cacheNames/value；指定缓存组件名字；将方法的返回值结果放在那个缓存中，是数组的方式</span></span><br><span class="line"><span class="comment">    *  key：缓存数据使用的的key；可以用它来指定。默认使用方法参数的的值  1-方法的缓存值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    *   编写Spel表达式 #id;参数id的值 #a0，#p0，#root.args[0]</span></span><br><span class="line"><span class="comment">    *  keyGenerator:key的生成器；可以自己指定key的生成器组件id</span></span><br><span class="line"><span class="comment">    *  注意：key和keygenerator之间二选一使用</span></span><br><span class="line"><span class="comment">    *  CacheManager:指定缓存管理器或者指定缓存解析器CacheResolver指定获取解析器</span></span><br><span class="line"><span class="comment">    *  condition：自己定符合的条件下才缓存 condition = "#id&gt;0"</span></span><br><span class="line"><span class="comment">    *  unless:否定缓存;当unless指定条件为true，方法的返回值就不会被缓存； unless="#result == null"</span></span><br><span class="line"><span class="comment">    *  sysn:是否使用异步模式</span></span><br><span class="line"><span class="comment">    *  运行时机：</span></span><br><span class="line"><span class="comment">    *     1.先检查有没有缓存，没有缓存在执行目标方法</span></span><br><span class="line"><span class="comment">    *     2.将目标方法的结果缓存起来</span></span><br><span class="line"><span class="comment">    *  */</span></span><br><span class="line">    @<span class="constructor">Cacheable(<span class="params">cacheNames</span> = <span class="string">"emp"</span>,<span class="params">key</span> = <span class="string">"#id"</span>)</span></span><br><span class="line">    public Employee get<span class="constructor">EmpById(Integer <span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"查询"</span>+id+<span class="string">"员工"</span>);</span><br><span class="line">        Employee emp = employeeMapper.get<span class="constructor">EmpById(<span class="params">id</span>)</span>;</span><br><span class="line">        return emp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>控制类</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"emp/&#123;id&#125;"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Employee getEmployee(<span class="meta">@PathVariable(<span class="meta-string">"id"</span>)</span> Integer id)&#123;</span><br><span class="line">        Employee emp = employeeService.getEmpById(id);</span><br><span class="line">        <span class="keyword">return</span> emp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="缓存原理"><a href="#缓存原理" class="headerlink" title="缓存原理"></a>缓存原理</h4><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">/<span class="strong">*</span></span><br><span class="line"><span class="strong">*</span> 原理</span><br><span class="line"><span class="bullet">* </span>1.自动配置类 CacheAutoConfiguration</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span> 2.缓存配置类</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.GenericCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.JCacheCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.EhCacheCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.HazelcastCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.InfinispanCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.CouchbaseCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.CaffeineCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.SimpleCacheConfiguration</span><br><span class="line"><span class="bullet">* </span>org.springframework.boot.autoconfigure.cache.NoOpCacheConfiguration</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span> 3.那个配置类默认生效</span><br><span class="line"><span class="bullet">* </span>SimpleCacheConfiguration</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span> 4.该容器中注册了一个CacheManager(缓存管理器) ；  ConcurrentMapCacheManager</span><br><span class="line"><span class="bullet">* </span>5.可以获取和创建 ConcurrentMapCacheManager类型的缓存组件，他的作用就是将数据保存ConcurrentMap；</span><br><span class="line"><span class="bullet">* </span>运行流程：</span><br><span class="line"><span class="bullet">*  </span>1.方法运行之前，先去查询Cache(缓存组件)，按照cacheName指定的名称获取；</span><br><span class="line"><span class="bullet">* </span>即CacheManager获取相应的缓存；第一次获取缓存如果没有cache组件会自动创建出来</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span>   2.去Cache中查找缓存的内容使用一个key，默认方法的参数</span><br><span class="line"><span class="bullet">*   </span>key是按照某种策略生成的，默认是使用keGenerator生成的 默认使用SimpleKeyGenerator生成key</span><br><span class="line"><span class="bullet">* 		</span>SimpleKeyGenerator生成key的策略：</span><br><span class="line"><span class="bullet">* 			</span>如果没有参数：key = new SimpleKey();</span><br><span class="line"><span class="bullet">*   		</span>如果有一个参数，key = 参数值</span><br><span class="line"><span class="bullet">* 			</span>如果有多个参数，key = new SimpleKey(params)</span><br><span class="line"><span class="bullet">*   </span>3.如果没有查到缓存就i调用目标方法</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span>   4.将目标方法返回的结果，放到缓存中</span><br><span class="line"><span class="bullet">*   </span>@Cacheable标注的方法执行之前先来检查缓存中有没有这个数据，默认参数的值做为key去查询缓存如果没有就运行方法并将结果放入缓存；</span><br><span class="line"><span class="bullet">*	</span></span><br><span class="line"><span class="bullet">* 	</span>核心：</span><br><span class="line"><span class="bullet">*     </span>1.使用CacheManager【ConcurrentMapCacheManager】按照名字得到Cache【ConcurrentMapCache】组件</span><br><span class="line"><span class="bullet">* 	  </span>2.key使用KeyGenerator生成的，默认是SimpleKeyGenerator</span><br><span class="line"><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span> <span class="strong">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义缓存key的生成策略"><a href="#自定义缓存key的生成策略" class="headerlink" title="自定义缓存key的生成策略"></a>自定义缓存key的生成策略</h3><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义key的生成策略</span></span><br><span class="line">@Configuration</span><br><span class="line">public <span class="keyword">class</span> MyCacheConfig &#123;</span><br><span class="line"></span><br><span class="line">   @<span class="constructor">Bean(<span class="string">"myKeyGenerator"</span>)</span></span><br><span class="line">   public KeyGenerator key<span class="constructor">Generator()</span>&#123;</span><br><span class="line"></span><br><span class="line">        return <span class="keyword">new</span> <span class="constructor">KeyGenerator()</span>&#123;</span><br><span class="line">            @Override <span class="comment">//生成key</span></span><br><span class="line">            public Object generate(Object o, Method <span class="keyword">method</span>, Object... objects) &#123;</span><br><span class="line">                return <span class="keyword">method</span>.get<span class="constructor">Name()</span>+<span class="string">"["</span>+ <span class="module-access"><span class="module"><span class="identifier">Arrays</span>.</span></span><span class="keyword">as</span><span class="constructor">List(<span class="params">objects</span>)</span>.<span class="keyword">to</span><span class="constructor">String()</span>+<span class="string">"]"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service层 </span><br><span class="line">@<span class="constructor">Cacheable(<span class="params">value</span> =&#123;<span class="string">"emp"</span>&#125;,<span class="params">keyGenerator</span>=<span class="string">"myKeyGenerator"</span>)</span></span><br></pre></td></tr></table></figure>
<h5 id="CachePut，即调用方法，有更新缓存数据"><a href="#CachePut，即调用方法，有更新缓存数据" class="headerlink" title="@CachePut，即调用方法，有更新缓存数据"></a>@CachePut，即调用方法，有更新缓存数据</h5></li>
<li><p>修改了数据库的某个数据，同时更新缓存</p>
</li>
<li><p>应用案例</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"><span class="bullet">    * </span>@CachePut；即调用方法有缓存数据</span><br><span class="line"><span class="bullet">    * </span>常见 ： 修改了数据库的某个数据。同时更新缓存</span><br><span class="line"><span class="bullet">    * </span>运行时机：</span><br><span class="line"><span class="bullet">    *       </span>1.先调用目标方法</span><br><span class="line"><span class="bullet">    *       </span>2.将目标方法的结果缓存起来</span><br><span class="line"><span class="bullet">    * </span>测试步骤：</span><br><span class="line"><span class="bullet">    *  </span>1.查询1号员工，查询的结果会放到缓存中</span><br><span class="line"><span class="bullet">    *      </span>key:1 value:;astname：zhangdan</span><br><span class="line"><span class="bullet">    *  </span>2.以后查询还是之前的结果</span><br><span class="line"><span class="code">    *</span></span><br><span class="line"><span class="bullet">    *  </span>3.更新1号员工【lastName：zhangdan，gender：0】</span><br><span class="line"><span class="bullet">    *       </span>将方法的返回值而放到缓存中了</span><br><span class="line"><span class="bullet">    *       </span>key;传入的employee对象  值就是返回的employee对象</span><br><span class="line"><span class="bullet">    *  </span>4.查询1号员工</span><br><span class="line"><span class="bullet">    *       </span>应该是更新后的员工</span><br><span class="line"><span class="bullet">    *       </span>key ="#employee.id" == key ="#result.id" 使用传入的参数的员工ID  此处增删改查要同一个缓存名</span><br><span class="line"><span class="bullet">    *       </span>注意：@Cacheable 不能用 key ="#result.id"返回值的形式</span><br><span class="line"><span class="bullet">    *       </span>为什么是没有更新前的？？？【1号员工没有在缓存中更新，也就是更新了用的名字不一样】</span><br><span class="line"><span class="code">    *</span></span><br><span class="line"><span class="bullet">    * </span>*/</span><br><span class="line"><span class="code">    @CachePut(value = "emp",key ="#employee.id")</span></span><br><span class="line"><span class="code">    public Employee updateEmp(Employee employee)&#123;</span></span><br><span class="line"><span class="code">        System.out.println("updateEmp:"+employee);</span></span><br><span class="line"><span class="code">        employeeMapper.updateEmp(employee);</span></span><br><span class="line"><span class="code">        return employee;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CacheEvict-缓存清除"><a href="#CacheEvict-缓存清除" class="headerlink" title="@CacheEvict:缓存清除"></a>@CacheEvict:缓存清除</h5></li>
<li><p>应用案例</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   * @CacheEvict:清除缓存</span></span><br><span class="line"><span class="comment">   * key:指定清除的数据</span></span><br><span class="line"><span class="comment">   * allEntries = true 指定清除的缓存中的所有数据 默认false</span></span><br><span class="line"><span class="comment">   * beforeInvocation = false;缓存的清除是否在方法之前执行 </span></span><br><span class="line"><span class="comment">   *    默认false 在方法执行之后执行的</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">   @<span class="constructor">CacheEvict(<span class="params">value</span> = <span class="string">"emp"</span>,<span class="params">key</span> = <span class="string">"#id"</span>)</span></span><br><span class="line">   public void delete<span class="constructor">Emp(Integer <span class="params">id</span>)</span>&#123;</span><br><span class="line">       <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"deleteEmp:"</span>+id);</span><br><span class="line">       employeeMapper.delete<span class="constructor">Emp(<span class="params">id</span>)</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="Caching-是以上三个的组合注解-Cacheable-CachePut-CacheEvict"><a href="#Caching-是以上三个的组合注解-Cacheable-CachePut-CacheEvict" class="headerlink" title="@Caching 是以上三个的组合注解 @Cacheable  @CachePut  @CacheEvict"></a>@Caching 是以上三个的组合注解 @Cacheable  @CachePut  @CacheEvict</h5></li>
<li><p>组合注解：用来定义复杂的缓存规则</p>
</li>
<li><p>应用案例</p>
<figure class="highlight julia"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">* <span class="meta">@Caching</span> 是以上三个的组合注解 <span class="meta">@Cacheable</span>  <span class="meta">@CachePut</span>  <span class="meta">@CacheEvict</span></span><br><span class="line">* */</span><br><span class="line"><span class="meta">@Caching</span>(</span><br><span class="line">        cacheable = &#123;</span><br><span class="line">                <span class="meta">@Cacheable</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#lastName"</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        put = &#123;</span><br><span class="line">            <span class="meta">@CachePut</span>(value = <span class="string">"emp"</span> ,key = <span class="string">"#result.id"</span>),</span><br><span class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"emp"</span>,key = <span class="string">"#result.email"</span>)</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">public Employee getEmpByLastName(<span class="built_in">String</span> lastName)&#123;</span><br><span class="line"></span><br><span class="line">    Employee empByLastName = employeeMapper.getEmpByLastName(lastName);</span><br><span class="line">    <span class="keyword">return</span> empByLastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CacheConfig-由于在每个方法上写value-“emp”-太复杂从而引进-CacheConfig-可以指定公共缓存属性"><a href="#CacheConfig-由于在每个方法上写value-“emp”-太复杂从而引进-CacheConfig-可以指定公共缓存属性" class="headerlink" title="@CacheConfig  由于在每个方法上写value = “emp” 太复杂从而引进 @CacheConfig 可以指定公共缓存属性"></a>@CacheConfig  由于在每个方法上写value = “emp” 太复杂从而引进 @CacheConfig 可以指定公共缓存属性</h5></li>
<li><p>也可以说是抽取缓存中的公共配置</p>
</li>
<li><p>源码</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CacheConfig &#123;</span><br><span class="line">    <span class="built_in">String</span>[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> keyGenerator() <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> cacheManager() <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> cacheResolver() <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@CacheConfig(cacheNames = “emp”)</p>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5></li>
<li><p>缓存默认使用的是ConcurrentMapCacheManager==ConcurrentMapCache；将消息保存在ConcurrentMap&lt;Object,Object&gt;中的；</p>
</li>
<li><p>实际开发中，使用缓存中间件：redis，memcached，Ehcache</p>
<h4 id="整合redis作为缓存及redisTermpleate序列化机制"><a href="#整合redis作为缓存及redisTermpleate序列化机制" class="headerlink" title="整合redis作为缓存及redisTermpleate序列化机制"></a>整合redis作为缓存及redisTermpleate序列化机制</h4></li>
<li><p>安装redis； 使用docker  sudo yum install Docker</p>
</li>
<li><p>项目中引入redis的starter</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置redis application.properties</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">spring.redis.host=<span class="number">192.168</span><span class="number">.1</span><span class="number">.6</span></span><br></pre></td></tr></table></figure></li>
<li><p>测试类</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoCacheApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired(required = false)</span></span><br><span class="line">	EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	StringRedisTemplate stringRedisTemplate; <span class="comment">//操作K-v都是字符串的模板</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	RedisTemplate redisTemplate;<span class="comment">//操作K-v都是对象的</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	RedisTemplate&lt;Object, Employee&gt; employeeRedisTemplate;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* redis常见5大数据类型</span></span><br><span class="line"><span class="comment">	* String(字符串):List（列表）;set（集合）;hash（散列），zset（有序集合）</span></span><br><span class="line"><span class="comment">	* stringRedisTemplate.opsForValue();[String(字符串)]</span></span><br><span class="line"><span class="comment">	* stringRedisTemplate.opsForList();</span></span><br><span class="line"><span class="comment">	* stringRedisTemplate.opsForSet();</span></span><br><span class="line"><span class="comment">	* stringRedisTemplate.opsForHash();</span></span><br><span class="line"><span class="comment">	* .......</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> void test01()&#123;</span><br><span class="line">		<span class="comment">//该redis数据库中保存数据</span></span><br><span class="line">		<span class="comment">//stringRedisTemplate.opsForValue().append("msg","hello");</span></span><br><span class="line">		String msg = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(<span class="string">"msg"</span>);</span><br><span class="line">		System.<span class="keyword">out</span>.println(msg);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> void test02()&#123;</span><br><span class="line">		Employee empById = employeeMapper.getEmpById(<span class="number">3</span>);</span><br><span class="line">		<span class="comment">//保存对象</span></span><br><span class="line">		<span class="comment">//默认保存对象，使用JDK序列化机制，然后序列化后的数据保存到redis中</span></span><br><span class="line">		<span class="comment">//redisTemplate.opsForValue().set("myset",empById);</span></span><br><span class="line">		<span class="comment">//1.将数据已json的方式保存</span></span><br><span class="line">		   <span class="comment">//方式一：自己将数据转换为json</span></span><br><span class="line">		   <span class="comment">//方式二：redisTemplate有自己的转换规则</span></span><br><span class="line">		employeeRedisTemplate.opsForValue().<span class="keyword">set</span>(<span class="string">"myset"</span>,empById);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>配置类，保存数据序列化，json格式 改变默认的序列化器</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">Configuration</span></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> myRedisConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    <span class="built_in">public</span> RedisTemplate&lt;<span class="keyword">Object</span>, Employee&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;<span class="keyword">Object</span>, Employee&gt; template = <span class="built_in">new</span> RedisTemplate();</span><br><span class="line">        <span class="keyword">template</span>.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="built_in">new</span> Jackson2JsonRedisSerializer&lt;Employee&gt;(Employee.<span class="keyword">class</span>);</span><br><span class="line">        <span class="keyword">template</span>.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">template</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="测试原理"><a href="#测试原理" class="headerlink" title="测试原理"></a>测试原理</h4></li>
<li><p>原理：</p>
<ul>
<li>1.CacheManager===Cache  缓存组件来实际该缓存中CRUD操作(存取数据)</li>
<li>2.引入redis的starter，容器保存的是 RedisCacheManager</li>
<li>3.RedisCacheManager 帮我们创建 RedisCache 来作为缓存组件；RedisCahe通过操作redis缓存数据</li>
<li>4.RedisTempleate&lt;Objec，Object&gt;是默认使用jdk的序列化机制<h5 id="自定义CacheManager"><a href="#自定义CacheManager" class="headerlink" title="自定义CacheManager"></a>自定义CacheManager</h5></li>
</ul>
</li>
<li><p>注意：知识点残留</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*自定义缓存规则*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存管理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Primay  <span class="comment">//将某个缓存管理器作为默认的</span></span><br><span class="line">@Bean</span><br><span class="line">public CacheManager cache<span class="constructor">Manager(RedisConnectionFactory <span class="params">redisConnectionFactory</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//初始化一个RedisCacheWriter</span></span><br><span class="line">    RedisCacheWriter redisCacheWriter = <span class="module-access"><span class="module"><span class="identifier">RedisCacheWriter</span>.</span></span>non<span class="constructor">LockingRedisCacheWriter(<span class="params">redisConnectionFactory</span>)</span>;</span><br><span class="line">    <span class="comment">//设置CacheManager的值序列化方式为json序列化</span></span><br><span class="line">    RedisSerializer&lt;Object&gt; jsonSerializer = <span class="keyword">new</span> <span class="constructor">GenericJackson2JsonRedisSerializer()</span>;</span><br><span class="line">    RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair</span><br><span class="line">            .from<span class="constructor">Serializer(<span class="params">jsonSerializer</span>)</span>;</span><br><span class="line">    RedisCacheConfiguration defaultCacheConfig=<span class="module-access"><span class="module"><span class="identifier">RedisCacheConfiguration</span>.</span></span>default<span class="constructor">CacheConfig()</span></span><br><span class="line">            .serialize<span class="constructor">ValuesWith(<span class="params">pair</span>)</span>;</span><br><span class="line">    <span class="comment">//设置默认超过期时间是30秒</span></span><br><span class="line">    defaultCacheConfig.entry<span class="constructor">Ttl(Duration.<span class="params">ofSeconds</span>(30)</span>);</span><br><span class="line">    <span class="comment">//初始化RedisCacheManager</span></span><br><span class="line">    return <span class="keyword">new</span> <span class="constructor">RedisCacheManager(<span class="params">redisCacheWriter</span>, <span class="params">defaultCacheConfig</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Java消息中间件+AceiveMQ+主题队列(-)</title>
    <url>/2020/01/20/Java%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6-AceiveMQ-%E4%B8%BB%E9%A2%98%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<h3 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h3><ul>
<li><p>MQ 规范，约束，理念</p>
</li>
<li><p>实现：</p>
<ul>
<li>ActiveMQ ：java/scala</li>
<li>Kafka :大数据</li>
<li>RebbitMQ ：arlang</li>
<li>RockerMQ ：阿里/java<h3 id="ActiveMQ消息中间件"><a href="#ActiveMQ消息中间件" class="headerlink" title="ActiveMQ消息中间件"></a>ActiveMQ消息中间件</h3></li>
</ul>
</li>
<li><p>api发送和接受</p>
</li>
<li><p>MQ的高可用性</p>
</li>
<li><p>MQ的集群和容错配置</p>
</li>
<li><p>MQ的持久化</p>
</li>
<li><p>延时发送/定是投递</p>
</li>
<li><p>签收机制</p>
</li>
<li><p>Spring整合</p>
</li>
<li><p>……</p>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3></li>
<li><p>在何种场景下使用了消息中间件？？？</p>
</li>
<li><p>为什么要在系统中引入消息中间件？？？</p>
</li>
<li><p>MQ能干嘛？？？</p>
<ul>
<li>解耦：要做到系统解耦，当新的模块接进来时，可以做到代码改动最小；能够解耦</li>
<li>削峰：设置流量缓冲池，可以让后端系统按照自身吞吐能力进行消费，不被冲垮；能够削峰</li>
<li>异步：强弱以来梳理能将非关键调用链路的操作异步化并提高整体系统的吞吐能力；能够异步 <h3 id="举个例子电商秒杀业务："><a href="#举个例子电商秒杀业务：" class="headerlink" title="举个例子电商秒杀业务："></a>举个例子电商秒杀业务：</h3>上游系统发起下单购买操作，我就是一个下单操作</li>
</ul>
</li>
</ul>
<p>下游系统完成秒杀业务逻辑<br>(读取订单，库存检查，库存冻结，余额检查，余额冻结，订单生成，余额扣减，库存扣减，生成流水，余额冻结，库存解冻)</p>
<h3 id="官网下载"><a href="#官网下载" class="headerlink" title="官网下载"></a>官网下载</h3><ul>
<li>ActiveMQ   http：//activemq.apache.org/</li>
<li>MQ最主要的功能<br>实现高可用，高性能，可伸缩，易用和安全的企业级开发</li>
<li>异步消息的消息和处理</li>
<li>控制消息的消费顺序和处理</li>
<li>可以和spring/springboot整合简化编程</li>
<li>配置叫集群容错的MQ集群<h4 id="安装ActiveMQ-–-CentOS8系统"><a href="#安装ActiveMQ-–-CentOS8系统" class="headerlink" title="安装ActiveMQ  – CentOS8系统"></a>安装ActiveMQ  – CentOS8系统</h4></li>
<li>1.安装java JDK 命令： <ul>
<li>检查 yum 中有没有 java1.8 包<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">yum <span class="type">list</span> java<span class="number">-1.8</span>*</span><br></pre></td></tr></table></figure>
<ul>
<li>开始安装   CentOS8系统自动配置环境变量<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">yum install java<span class="number">-1.8</span><span class="number">.0</span>-openjdk* -y</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>2.安装ActiveMQ <ul>
<li>1.本地下载好上传到虚拟机</li>
<li>2.解压压缩包<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xzf</span> <span class="selector-tag">apache-activemq-5</span><span class="selector-class">.15</span><span class="selector-class">.11-bin</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure></li>
<li>3.进入到apache-activemq-5.15.11的bin目录<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">cd apache-activemq<span class="number">-5.15</span><span class="number">.11</span>/bin</span><br></pre></td></tr></table></figure></li>
<li>启动ActiveMQ<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">./activemq <span class="literal">start</span>（执行两次，第一次:生成配置信息，第二次：启动）</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>关闭防火墙<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">一、防火墙服务</span><br><span class="line"><span class="number">1</span>、启动、关闭、重启防火墙服务。</span><br><span class="line">systemctl start  firewalld.service</span><br><span class="line">systemctl stop  firewalld.service</span><br><span class="line">systemctl restart  firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>显示防火墙的状态。</span><br><span class="line">systemctl status firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、开机启动防火墙。</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、开机时禁用防火墙。</span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、查看防火墙是否开机启动。</span><br><span class="line">systemctl  is-enabled  firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、查看已启动的服务列表。</span><br><span class="line">systemctl <span class="type">list</span>-unit-files|grep enabled</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>、查看启动失败的服务列表。</span><br><span class="line">systemctl  --failed</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>、启动、停止、重启httpd服务。</span><br><span class="line">systemctl   start    httpd</span><br><span class="line">systemctl   stop     httpd</span><br><span class="line">systemctl   restart  httpd</span><br><span class="line"></span><br><span class="line">二、配置防火墙</span><br><span class="line"><span class="number">1</span>、查看版本。</span><br><span class="line">firewall-cmd --version</span><br><span class="line"><span class="number">2</span>、查看帮助。</span><br><span class="line">firewall-cmd  --help</span><br><span class="line"><span class="number">3</span>、显示状态。</span><br><span class="line">firewall-cmd --<span class="section">state</span></span><br><span class="line"><span class="number">4</span>、查看所有打开的端口。</span><br><span class="line">firewall-cmd --zone=public --<span class="type">list</span>-ports</span><br><span class="line"><span class="number">5</span>、重新载入，更新防火墙规则。</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="number">6</span>、查看区域信息。</span><br><span class="line">firewall-cmd --get-active-zones</span><br><span class="line"><span class="number">7</span>、查看指定接口所属区域。</span><br><span class="line">firewall-cmd --get-zone-of-interface=eth0</span><br><span class="line"><span class="number">8</span>、拒绝所有包。</span><br><span class="line">firewall-cmd --panic-on</span><br><span class="line"><span class="number">9</span>、取消拒绝状态。</span><br><span class="line">firewall-cmd --panic-off</span><br><span class="line"><span class="number">10</span>、查看是否拒绝。</span><br><span class="line">firewall-cmd --query-panic</span><br><span class="line"><span class="number">11</span>、开启<span class="number">80</span>端口，–permanent永久生效，没有此参数重启后失效。</span><br><span class="line">firewall-cmd --zone=public --add-port=<span class="number">80</span>/tcp --permanent   </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">12</span>、查看<span class="number">80</span>端口是否开放。</span><br><span class="line">firewall-cmd --zone=public --query-port=<span class="number">80</span>/tcp </span><br><span class="line"><span class="number">13</span>、删除<span class="number">80</span>端口配置。</span><br><span class="line">firewall-cmd --zone=public --remove-port=<span class="number">80</span>/tcp --permanent</span><br></pre></td></tr></table></figure>
<h4 id="访问ActiveMQ"><a href="#访问ActiveMQ" class="headerlink" title="访问ActiveMQ"></a>访问ActiveMQ</h4><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">页面控制台： <span class="string">http:</span><span class="comment">//ip:8161(监控)</span></span><br><span class="line">请求地址：  tcp：<span class="comment">//ip：61616 (java代码访问消息中间件)</span></span><br></pre></td></tr></table></figure>
<h4 id="linux查看服务-ps-ef-grep-activemq"><a href="#linux查看服务-ps-ef-grep-activemq" class="headerlink" title="linux查看服务 ps -ef|grep activemq"></a>linux查看服务 ps -ef|grep activemq</h4></li>
<li>ps -ef|grep activemq|grep -v grep<h4 id="带日志启动方式"><a href="#带日志启动方式" class="headerlink" title="带日志启动方式"></a>带日志启动方式</h4><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./activemq</span> start &gt; <span class="string">/run_acivemq.log</span></span><br></pre></td></tr></table></figure>
<h3 id="JMS编码总体架构"><a href="#JMS编码总体架构" class="headerlink" title="JMS编码总体架构"></a>JMS编码总体架构</h3><img src="https://img-blog.csdnimg.cn/20190921140028573.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODA1MjU1,size_16,color_FFFFFF,t_70" alt=""></li>
<li>通过ConnectionFactory创建一个Connection</li>
<li>由Connection创建一个Session</li>
<li>由Session创建消息Msg，创建消息的生产者Message Producer和消息消费者Message Consumer</li>
<li>消息的生产者将消息发送到Destination，消息的消费者从Destination(目的地 队列 主题)接收消息</li>
<li>创建消息msg，将其(send)发送Destination(目的地)中</li>
<li>Destination(目的地 —》队列Queue 一对一，主题Topic 一对多</li>
</ul>
<h4 id="JMS基本开发步骤"><a href="#JMS基本开发步骤" class="headerlink" title="JMS基本开发步骤"></a>JMS基本开发步骤</h4><ul>
<li>1.创建一个connection factory</li>
<li>2.通过connection factory来JMS connection</li>
<li>3.启动JMS connection</li>
<li>4.通过connection创建JMS session</li>
<li>5.创建JMS destination</li>
<li>6.创建JMS producer(生产者)或者创建JMS message并设置destination</li>
<li>7.创建JMS consumer或者是注册一个JMS message listener</li>
<li>8.发送或者接受JMS message(s)</li>
<li>9.关闭所有的JMS资源（connection，session,producer,consumer等） <h4 id="队列Queue-一对一-点对点-关系"><a href="#队列Queue-一对一-点对点-关系" class="headerlink" title="队列Queue 一对一(点对点)关系"></a>队列Queue 一对一(点对点)关系</h4></li>
<li>在点对点的消息传递域中，目的地被称之为队列<br><img src="https://img-blog.csdnimg.cn/20190921155027383.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODA1MjU1,size_16,color_FFFFFF,t_70" alt=""></li>
</ul>
<table>
<thead>
<tr>
<th align="right">英文</th>
<th align="right">中文</th>
<th align="right">详解</th>
</tr>
</thead>
<tbody><tr>
<td align="right">NUmber Of Pending Messages</td>
<td align="right">等待消费的消息</td>
<td align="right">这个是当前未出对的消息数量；公式=总接受数-总出对数</td>
</tr>
<tr>
<td align="right">Namber Of Consumers</td>
<td align="right">消费者数量</td>
<td align="right">消费者端消费的数量</td>
</tr>
<tr>
<td align="right">Message Enqueued</td>
<td align="right">进对消息数</td>
<td align="right">进入队列的总数量，包括出队列的。这个数量只增不减</td>
</tr>
<tr>
<td align="right">Messages Dequeued</td>
<td align="right">出对消息数</td>
<td align="right">可以理解为是消费者消费掉的数量</td>
</tr>
<tr>
<td align="right">* 应用案例</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 生产者</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right"><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsProduce</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.6:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> QUEUE_NAME = <span class="string">"tqueue01"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws JMSException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Queue <span class="built_in">queue</span> = session.createQueue(QUEUE_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消息生产者</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(<span class="built_in">queue</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.通过消息的生产者messageProdecer生产3条消息发送到MQ的队列里面</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">3</span> ; i++) &#123;</span><br><span class="line">            <span class="comment">//7.创建消息 ， 一定格式的消息</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"msg------"</span> + i);<span class="comment">//理解为一个字符串</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//8.通过messagerProducer发送给MQ</span></span><br><span class="line">            messageProducer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.关闭资源</span></span><br><span class="line">        messageProducer.<span class="built_in">close</span>();</span><br><span class="line">        session.<span class="built_in">close</span>();</span><br><span class="line">        connection.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"*****消息发送到MQ完成******"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* pom文件</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right"><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhao<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--activemq所需的包--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.activemq/activemq-all --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.15.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--整合Spring --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.xbean/xbean-spring --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.xbean<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xbean-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0-alpha1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0-alpha5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 总结：</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 1.当有一个消息进入这个队列时，等待消费的消息时1，进入队列的消息也是1</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 2.当消息消费后，等待消费的消息是0，进入队列的消息是1，出对的消息是1.</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 3.再来一条消息时，等待消费的消息是1，进入队列的消息就是2</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 消费者—–方式一：同步阻塞方式</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right"><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConsumer</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.6:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> QUEUE_NAME = <span class="string">"tqueue01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Queue <span class="built_in">queue</span> = session.createQueue(QUEUE_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消费者</span></span><br><span class="line">        MessageConsumer consumer = session.createConsumer(<span class="built_in">queue</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//注意：生产者的消息类型与消费者对应</span></span><br><span class="line">    <span class="comment">//  TextMessage textMessage = (TextMessage)consumer.receive();//这里一直等待</span></span><br><span class="line">    <span class="comment">/* 上面 同步阻塞方式</span></span><br><span class="line"><span class="comment">     * 消息消费者代码实现的第一种方法：同步阻塞方式</span></span><br><span class="line"><span class="comment">     *  订阅者或接收者MessageConsumer的receive()方法来接收消息，</span></span><br><span class="line"><span class="comment">     * receive方法在能够接收到消息之前（超时之前）将一直阻塞</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//消费者将会等待4s后自动退出receive方法，不进行阻塞</span></span><br><span class="line">            TextMessage textMessage = (TextMessage)consumer.receive(<span class="number">4000</span>);<span class="comment">//这里有时间限制4秒</span></span><br><span class="line">            <span class="keyword">if</span> (null != textMessage)&#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(<span class="string">"******消费者接收到消息："</span>+textMessage.getText());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.关闭资源</span></span><br><span class="line">        consumer.<span class="built_in">close</span>();</span><br><span class="line">        session.<span class="built_in">close</span>();</span><br><span class="line">        connection.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 消费者—–方式二：异步非同步阻塞方式(监听器 onMessage())</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">订阅者或者接收者通过MessageConsumer的setMessageListener(MessageListener listener)注册一个监听器</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">* 但消息到达之后，系统自动调用监听器MessageListener的onMessage(Message message)方法</td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.6:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"tqueue01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消费者</span></span><br><span class="line">        MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*        while(true)&#123;</span></span><br><span class="line"><span class="comment">            //注意：生产者的消息类型与消费者对应</span></span><br><span class="line"><span class="comment">//            TextMessage textMessage = (TextMessage)consumer.receive();//这里一直等待</span></span><br><span class="line"><span class="comment">            TextMessage textMessage = (TextMessage)consumer.receive(4000);//这里有时间限制4秒</span></span><br><span class="line"><span class="comment">            if (null != textMessage)&#123;</span></span><br><span class="line"><span class="comment">                System.out.println("******消费者接收到消息："+textMessage.getText());</span></span><br><span class="line"><span class="comment">            &#125;else&#123;</span></span><br><span class="line"><span class="comment">            break;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            //6.关闭资源</span></span><br><span class="line"><span class="comment">            consumer.close();</span></span><br><span class="line"><span class="comment">            session.close();</span></span><br><span class="line"><span class="comment">            connection.close();</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">    <span class="comment">//通过监听的方式</span></span><br><span class="line">        consumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != message &amp;&amp; message <span class="keyword">instanceof</span> TextMessage)&#123;</span><br><span class="line">                TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"******消费者接收到消息："</span>+textMessage.getText());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//保证控制台不灭</span></span><br><span class="line">        System.in.read();</span><br><span class="line">        <span class="comment">//6.关闭资源</span></span><br><span class="line">        consumer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>注意：</p>
<ol>
<li>先生产，只启动1号消费者 问题：1号消费者还能消费消息吗？？？<br>YES</li>
<li>先生产，先启动1号消费者，在启动2号消费者，问题：2号消费者还能消费消息吗？？？<br>2.1 1号消费者可以消费？？  YES<br>2.2 2好消费者可以消费？？  NO</li>
<li>先启动两个消费者，在生产6条消息，请问消费情况如何？？<br>3.1 2个消费者都有6消息  NO<br>3.2 先到先得，6条全给一个 NO<br>3.3 一人一半  YES<br>#####小结：</li>
</ol>
</li>
<li><p>点对点消息传递域的特点如下：</p>
<ul>
<li>1.每个消息只能有一个消费者，类似于1对1的的关系 。好比个人快递自己领取自己的。</li>
<li>2.消息的生产者和消息的消费者之间没有时间上的相关性。无论消费者在生产者发送消息的时候是否处于运动状态消费者都可以提取消息。</li>
<li>3.消息被消费之后队列中不会在存储，所以消费者不会消费到已经被消费掉的消息。<h4 id="主题Topic，一对多（发布订阅）关系"><a href="#主题Topic，一对多（发布订阅）关系" class="headerlink" title="主题Topic，一对多（发布订阅）关系"></a>主题Topic，一对多（发布订阅）关系</h4></li>
</ul>
</li>
<li><p>再发布订阅消息传递域中，目的地称为主题</p>
</li>
<li><p>特点如下:</p>
</li>
<li><p>1.生产者将消息发布到topic中，每个消息可以有多个消费者，属于1：N的关系</p>
</li>
<li><p>2.生产者和消费者之间有时间上的相关性，订阅某一个主题的消费者只能消费自它订阅之后发布的消息。</p>
</li>
<li><p>3.生产者生产时，topic不保存消息他是无状态的不落地，加入无人订阅就去生产，那就是一条费消息，所以，一般先启动消费者在启动生产者。(重点)</p>
</li>
<li><p>JMS规范允许客户创建持久订阅，这在一定程度上放松了时间上的相关性要求。持久订阅允许消费者消费他在未处于激活状态是发送的消息。好比我们微信公众好订阅<br>####应用案例</p>
</li>
<li><p>发布消息的生产者</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//主题生产者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsProduce</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.6:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> TOPIC_NAME = <span class="string">"topic-zhao"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws JMSException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消息生产者</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(topic);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.通过消息的生产者messageProdecer生产3条消息发送到MQ的队列里面</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">3</span> ; i++) &#123;</span><br><span class="line">            <span class="comment">//7.创建消息 ， 一定格式的消息</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"topic---msg------"</span> + i);<span class="comment">//理解为一个字符串</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//8.通过messagerProducer发送给MQ</span></span><br><span class="line">            messageProducer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.关闭资源</span></span><br><span class="line">        messageProducer.<span class="built_in">close</span>();</span><br><span class="line">        session.<span class="built_in">close</span>();</span><br><span class="line">        connection.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"*****主题消息发送到MQ完成******"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>主题消费者</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> JmsConsumer &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.1.6:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">"topic-zhao"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> JMSException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.<span class="keyword">println</span>(<span class="string">"********我是1号消费者********"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建连接工厂,按照给定的URL地址，采用默认用户名和密码</span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.通过连接工厂，获取连接connection并启动</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话</span></span><br><span class="line">        <span class="comment">//有两个参数，第一个叫事务/第二个叫签收</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建目的地(具体是队列还是主题) 接口</span></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.创建消费者</span></span><br><span class="line">        MessageConsumer consumer = session.createConsumer(topic);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过监听的方式(旧式写法)</span></span><br><span class="line">     <span class="comment">/*   consumer.setMessageListener(new MessageListener() &#123;</span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void onMessage(Message message) &#123;</span></span><br><span class="line"><span class="comment">            if (null != message &amp;&amp; message instanceof TextMessage)&#123;</span></span><br><span class="line"><span class="comment">                TextMessage textMessage = (TextMessage) message;</span></span><br><span class="line"><span class="comment">                try &#123;</span></span><br><span class="line"><span class="comment">                    System.out.println("******消费者接收到消息："+textMessage.getText());</span></span><br><span class="line"><span class="comment">                &#125; catch (JMSException e) &#123;</span></span><br><span class="line"><span class="comment">                    e.printStackTrace();</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line">     <span class="comment">//此处技术点Java8特性之一 lambda表达式</span></span><br><span class="line">        consumer.setMessageListener((Message message)-&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != message &amp;&amp; message <span class="keyword">instanceof</span> TextMessage)&#123;</span><br><span class="line">                TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.<span class="keyword">println</span>(<span class="string">"******消费者接收到消息："</span>+textMessage.<span class="keyword">getText</span>());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//保证控制台不灭</span></span><br><span class="line">        System.in.<span class="keyword">read</span>();</span><br><span class="line">        <span class="comment">//6.关闭资源</span></span><br><span class="line">        consumer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="注意先启动消费者，—生产者"><a href="#注意先启动消费者，—生产者" class="headerlink" title="注意先启动消费者，—生产者"></a>注意先启动消费者，—生产者</h6><h6 id="补充知识点-Java8的特性之一-lambda表达式"><a href="#补充知识点-Java8的特性之一-lambda表达式" class="headerlink" title="补充知识点 Java8的特性之一 lambda表达式"></a>补充知识点 Java8的特性之一 lambda表达式</h6></li>
<li><p>lambda表达式， 是Java8中的一个新特性。可以理解为一个匿名函数。</p>
</li>
<li><p>lambda表达式可以理解为将一个函数浓缩为一行代码，使代码更加简洁紧凑。</p>
</li>
<li><p>lambda表达式语法：</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="params">(parameters)</span> -&gt;</span> statement;</span><br><span class="line">或</span><br><span class="line"><span class="function"><span class="params">(parameters)</span> -&gt;</span> &#123;statements;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>参数如下：<br>  parameters：参数， 可以指定或不指定参数类型， 当只有一个参数时可以不要圆括号<br>  statement：函数返回值，直接返回该值，无需大括号<br>  statements：函数体，当使用大括号时需要指明表达式返回的值</p>
</li>
<li><p>lambda表达式实例：</p>
<figure class="highlight gml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 无参，返回5</span></span><br><span class="line">() -&gt; <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 接收参数x，返回2*x</span></span><br><span class="line"><span class="symbol">x</span> -&gt; <span class="number">2</span> * <span class="symbol">x</span>;</span><br><span class="line"><span class="comment">// 接收参数x y, 返回x+y</span></span><br><span class="line">(<span class="symbol">x</span>, <span class="symbol">y</span>) -&gt; <span class="symbol">x</span> + <span class="symbol">y</span>;</span><br><span class="line"><span class="comment">// 指明接收参数类型</span></span><br><span class="line">(int <span class="symbol">x</span>, int <span class="symbol">y</span>) -&gt; <span class="symbol">x</span> + <span class="symbol">y</span>;</span><br><span class="line"><span class="comment">// 接收字符串并打印，无返回值</span></span><br><span class="line">(String s) -&gt; System.out.print(s);</span><br><span class="line"><span class="comment">// 包括函数体</span></span><br><span class="line">(String s) -&gt; &#123;</span><br><span class="line"> System.out.print(s);</span><br><span class="line"> <span class="keywords">return</span> s; </span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="两大模式比较"><a href="#两大模式比较" class="headerlink" title="两大模式比较"></a>两大模式比较</h4><p>比较|topic(主题模式)|queue（队列模式）</p>
</li>
</ul>
<p>–|:–|:–<br>工作模式|”订阅发布”模式，如果当前没有订阅者，消息将被丢弃，如果有多个订阅者，那麽这些订阅者都会收到消息|”负载均衡”模式如果当前没有消费者消息也不回丢弃，如果有多个消费者，那么一条消息也会发送到其中一个消费者，并且要求消费者ack信息<br>有无状态|无状态|Queue数据默认会在mq服务器上以文件的形式保存，比如ActiveMQ一般保存在$AMQ_HOME\data\kr-store\data下面。也可以配置成DB存储<br>传递完整性|如果没有订阅者，消息将被丢弃|消息不会丢弃<br>处理效率|由于消息要按照订阅者的数量进行复制，所以处理性能会随着订阅者的增加而明显降低，并且还要结合不同消息协议自身的性能差异|由于一条消息只发送给一个消费者所以消费者，在多，性能额不会明显降低，当然不同的消息协议的具体性能也是有差异的 </p>
<h3 id="回顾-Java中-new-实例化-一个对象将其放在堆内存中新生区"><a href="#回顾-Java中-new-实例化-一个对象将其放在堆内存中新生区" class="headerlink" title="回顾 Java中 new(实例化)一个对象将其放在堆内存中新生区"></a>回顾 Java中 new(实例化)一个对象将其放在堆内存中新生区</h3><ul>
<li>堆内存 –》新生区，养老区</li>
</ul>
]]></content>
      <tags>
        <tag>Java消息中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+单例模式</title>
    <url>/2020/01/20/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="java设计模式概述"><a href="#java设计模式概述" class="headerlink" title="java设计模式概述"></a>java设计模式概述</h3><ul>
<li>模式不是代码,而是某类问题的通用解决方案</li>
<li>设计模式的本质提高软件的维护性，通用性和扩展性，并降低软件的复杂度。</li>
<li>设计模式分为三种类型，共23种</li>
<li>1.创建型模式：单例模式，抽象工厂模式，原型模式，建造者模式，工厂模式。</li>
<li>2.结构型模式：适配器模式，桥接模式，装饰模式，组合模式，外观模式，享元模式，代理模式</li>
<li>3.行为型模式：模板方式模式，命令模式，访问者模式，迭代器模式，观察者模式，中介模式，备忘录模式，解析器模式(Interperter模式)，<br>状态模式，策略模式，职责链模式(责任链模式)。<h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4></li>
<li>所谓类的单例设计模式，就是采用一定的方法保证在整个的软件系统中，对某个类只能存在一个对象的实例，并且该类只提供一个取得其对象实例的方法(静态方法)</li>
<li>例如：Hibernate的SessionFactory，它充当数据存储的代理，并负责创建Session对象，SessionFactory并不都是轻量级的，一般情况下，一个项目只需要一个SessionFactory就够，这样就会使用到单例模式。<h5 id="单例设计模式八种方式"><a href="#单例设计模式八种方式" class="headerlink" title="单例设计模式八种方式"></a>单例设计模式八种方式</h5></li>
<li>1.饿汉式（静态常量）</li>
<li>2.饿汉式（静态代码块static）</li>
<li>3.懒汉式(线程不安全)</li>
<li>4.懒汉式（线程安全，同步方法）</li>
<li>5.懒汉式(线程不安全，同步代码块)</li>
<li>6.双重检查</li>
<li>7.静态内部类</li>
<li>8.枚举<h6 id="饿汉式-静态常量"><a href="#饿汉式-静态常量" class="headerlink" title="饿汉式(静态常量)"></a>饿汉式(静态常量)</h6></li>
<li>应用实例</li>
<li>步骤实例</li>
<li>1.构造器私有化(防止 new)</li>
<li>2.类的内部创建对象</li>
<li>3.向外暴露一个静态的公共方法。getInstance</li>
<li>代码实现<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package pattern.singleton;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">type1</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        Singleton singleton = Singleton.getInstance();</span><br><span class="line">        Singleton singleton2 = Singleton.getInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(singleton == singleton2); <span class="comment">//true</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton.hashCode="</span>+singleton.hashCode());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton2.hashCode="</span>+singleton2.hashCode());</span><br><span class="line">        <span class="comment">/*singleton.hashCode=460141958</span></span><br><span class="line"><span class="comment">        singleton2.hashCode=460141958*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//饿汉式(静态常量)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Singleton</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    1.添加 构造器私有化 防止new实例化 ，外部不能new</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    2.本类内部创建对象实例</span></span><br><span class="line">    <span class="keyword">private</span> final <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line"><span class="comment">//    3.提供一个公有的静态方法，返回实例对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.优点：这种写法比较简单，就是在类加载的时候就完全实例化。避免了线程同步的问题。</li>
<li>2.缺点：在类装载的时候就完成实例化，没有达到Lazy Loding(懒加载)的效果。如果从开始至终从未有使用过这个实例，则会造成内存的浪费</li>
<li>3.这种方式基于classloder(类装载)机制避免了多线程的同步问题，不过，instance在类装载时就实例化，在单例模式中大多数都是调用getInstance方法，但是导致类装载的原因有很多种，因此不能确定有其他的方式(或者其他的静态方法)导致类装载，在这时候初始化instance就没有达到lazy loding(懒加载)的效果</li>
<li>4.结论：这种单例模式可用，可能造成内存浪费<h6 id="饿汉式-静态代码块"><a href="#饿汉式-静态代码块" class="headerlink" title="饿汉式(静态代码块)"></a>饿汉式(静态代码块)</h6></li>
</ul>
</li>
<li>应用实例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">type2</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        Singleton singleton = Singleton.getInstance();</span><br><span class="line">        Singleton singleton2 = Singleton.getInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(singleton == singleton2); <span class="comment">//true</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton.hashCode="</span>+singleton.hashCode());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton2.hashCode="</span>+singleton2.hashCode());</span><br><span class="line">        <span class="comment">/*singleton.hashCode=460141958</span></span><br><span class="line"><span class="comment">          singleton2.hashCode=460141958*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//饿汉式(静态代码块)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Singleton</span> &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    1.添加 构造器私有化 防止new实例化 ，外部不能new</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    2.本类内部创建对象实例</span></span><br><span class="line">    <span class="keyword">private</span> final <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">static</span>&#123;<span class="comment">//在静态代码块中，创建单例对象</span></span><br><span class="line">        instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    3.提供一个公有的静态方法，返回实例对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.这种方式和上面的方式其实类似，只不过将类实例化的过程放在了静态代码块中，也就是在类装载的时候，就执行静态代码块的中的代码，初始化类的实例。优缺点和上面是一样的。</li>
<li>2.结论：这种单例模式可用，但是可能造成内存浪费<h6 id="懒汉式-线程不安全"><a href="#懒汉式-线程不安全" class="headerlink" title="懒汉式(线程不安全)"></a>懒汉式(线程不安全)</h6></li>
</ul>
</li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//懒汉式(线程不安全)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        SingletonText singleton = SingletonText.getInstance();</span><br><span class="line">        SingletonText singleton2 = SingletonText.getInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(singleton == singleton2); <span class="comment">//true</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton.hashCode="</span>+singleton.hashCode());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton2.hashCode="</span>+singleton2.hashCode());</span><br><span class="line">        <span class="comment">/*singleton.hashCode=460141958</span></span><br><span class="line"><span class="comment">          singleton2.hashCode=460141958*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonText</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonText instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonText</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个静态的公有方法，当使用到方法时，才会创建instance</span></span><br><span class="line">    <span class="comment">//懒汉式（线程不安全）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> final <span class="keyword">static</span> SingletonText <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance == null)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingletonText();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.起到了Lazy Loding的效果，但是只能在单线程下使用</li>
<li>2.如果在多线程下，一个线程进入了if(instance == null)判断语句块，还未来得及往下执行，另一个线程也通过了这个判断语句，这是便会产生多个实例。所以在多线程环境下不可使用这种方式</li>
<li>3.在实际开发中，不要使用这种方式<h6 id="懒汉式（线程安全，同步方法）"><a href="#懒汉式（线程安全，同步方法）" class="headerlink" title="懒汉式（线程安全，同步方法）"></a>懒汉式（线程安全，同步方法）</h6></li>
</ul>
</li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//懒汉式(线程安全，同步方法)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        SingletonText singleton = SingletonText.getInstance();</span><br><span class="line">        SingletonText singleton2 = SingletonText.getInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(singleton == singleton2); <span class="comment">//true</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton.hashCode="</span>+singleton.hashCode());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"singleton2.hashCode="</span>+singleton2.hashCode());</span><br><span class="line">        <span class="comment">/*singleton.hashCode=460141958</span></span><br><span class="line"><span class="comment">          singleton2.hashCode=460141958*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonText</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonText instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonText</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个静态的公有方法，加入同步处理的代码，解决线程安全问题，当使用到方法时，才会创建instance</span></span><br><span class="line">    <span class="comment">//懒汉式（线程安全，同步方法）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> final <span class="keyword">static</span> synchronized SingletonText <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance == null)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingletonText();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.解决了线程不安全的问题</li>
<li>2.效率太低了，每个线程在想获得类的实例时候，执行getInstance()方法都要进行同步。而其实这个方法只执行一次实例化代码就够了，后面想获取该代码实例，直接return就行了，方法进行同步效率太低</li>
<li>3.结论：在实际开发中，不推荐使用<h6 id="懒汉式-线程不安全，同步代码块"><a href="#懒汉式-线程不安全，同步代码块" class="headerlink" title="懒汉式(线程不安全，同步代码块)"></a>懒汉式(线程不安全，同步代码块)</h6></li>
</ul>
</li>
<li>应用案例<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton  singleton;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleton == <span class="keyword">null</span>)&#123;</span><br><span class="line">           <span class="keyword">synchronized</span>(Singleton<span class="class">.<span class="keyword">class</span>)</span>&#123;</span><br><span class="line">               singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">           &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.这种方式，本意是相对上面方式的改进，因其同步方法效率太低，改进同步产生实例化的代码块</li>
<li>2.但是这种同步并不能起到线程同步的作用，与上面实现方式遇到的情况一致，假如一个线程进入了if(singleton == null)判断语句块还未来得及往下执行，另一个线程也通过了这种判断语句，这是便会产生多个实例</li>
<li>3.结论：在实际开发中，不能使用这种方式<h6 id="双重检查—推荐使用"><a href="#双重检查—推荐使用" class="headerlink" title="双重检查—推荐使用"></a>双重检查—推荐使用</h6></li>
</ul>
</li>
<li>应用实例</li>
<li>补充知识点：<ul>
<li>1.volatile是一个特征修饰符（type specifier）.volatile的作用是作为指令关键字，确保本条指令不会因编译器的优化而省略，且要求每次直接读值。<br>volatile的变量是说这变量可能会被意想不到地改变，这样，编译器就不会去假设这个变量的值了。</li>
<li>2.简单地说就是防止编译器对代码进行优化。</li>
<li>3.精确地说就是，编译器在用到这个变量时必须每次都小心地重新读取这个变量的值，而不是使用保存在寄存器里的备份。</li>
<li>4.保证了线程间的可见性，和一定程度的顺序性(不能保证原子性)，更好的方式就是用一个Boolean变量标识对象是否创建过(原子性)</li>
<li>5.volation可以立即从主内存中获取值，更新工作内存的值，还可以防止指令重排</li>
<li>6.只能修饰是变量，轻量级<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton  singleton;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">//加入了双重检查的代码，解决线程安全问题，同时解决懒加载问题</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//双重检查针对的是第一次加载的时候，后面每次多个线程的调用会直接返回值；</span></span><br><span class="line">        <span class="keyword">if</span>(singleton == <span class="keyword">null</span>)&#123;</span><br><span class="line">           <span class="keyword">synchronized</span>(Singleton<span class="class">.<span class="keyword">class</span>)</span>&#123;</span><br><span class="line">               <span class="keyword">if</span>(singgleton == <span class="keyword">null</span>)&#123;</span><br><span class="line">                singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>优缺点说明：<ul>
<li>1.Double-Check概念是同步开发中常使用的，如代码中所示我们进行两次if(sinfleton == null)检查，这样就可以保证线程安全了</li>
<li>2.这样，实例代码只执行一次，后面再进行访问时判断if(singleton == null)直接return实例化对象，也避免的反复进行方法的同步，</li>
<li>3.线程安全:延迟加载，效率较高</li>
<li>4.结论：在实际开发中，推荐使用这种单例模式<h6 id="静态内部类-–-推荐使用"><a href="#静态内部类-–-推荐使用" class="headerlink" title="静态内部类 – 推荐使用"></a>静态内部类 – 推荐使用</h6></li>
</ul>
</li>
<li>应用案例<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">//写一个静态内部类，该类中有一个静态属性Singleton</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonInstance</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提供一个静态的公有方法，直接返回SingletonINstance.INSTANCE</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonInstance.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>优缺点说明：<ul>
<li>1.这种方式采用了类装载的机制来保证初始化实例时只有一个线程。</li>
<li>2.静态内部类方式在Singleton类被装载时并不会立即实例化，而是在需要实例化时，调用getInstance方法，才会装载Singleton Instance类，从而完成SingLeton的实例化</li>
<li>3.类的静态属性只会在第一次加载类时侯初始化，所以在这里，JVM帮助我们保证了线程的安全性，在类进行初始化时，别的线程是无法进入的</li>
<li><ol start="4">
<li>优点：避免了线程不安全，利用静态内部类特点实现延迟加载，效率高<h6 id="枚举—推荐使用"><a href="#枚举—推荐使用" class="headerlink" title="枚举—推荐使用"></a>枚举—推荐使用</h6></li>
</ol>
</li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package pattern.singleton.Enums;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//枚举</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletTest</span> &#123;</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">         Singleton singleton = Singleton.INSTANCE;</span><br><span class="line">         Singleton singleton1 = Singleton.INSTANCE;</span><br><span class="line">         System.out.<span class="built_in">println</span>(singleton == singleton1);</span><br><span class="line">         System.out.<span class="built_in">println</span>(singleton.hashCode());</span><br><span class="line">         System.out.<span class="built_in">println</span>(singleton1.hashCode());</span><br><span class="line"></span><br><span class="line">         singleton.sayOK();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//使用枚举可以实现单例，推荐使用</span></span><br><span class="line"> <span class="keyword">enum</span> Singleton&#123;   </span><br><span class="line">     INSTANCE;<span class="comment">//属性  保证单例</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayOK</span><span class="params">()</span></span>&#123;</span><br><span class="line">         System.out.<span class="built_in">println</span>(<span class="string">"ok~~"</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>优缺点说明：<ul>
<li>1.这借助JDK1.5中添加的枚举来实现单例模式，不仅能避免多线程同步问题，而且还能防止反序列化重新创建新的对象<h6 id="单例模式在JDK应用的源码分析"><a href="#单例模式在JDK应用的源码分析" class="headerlink" title="单例模式在JDK应用的源码分析"></a>单例模式在JDK应用的源码分析</h6></li>
</ul>
</li>
<li>1.在JDK中，Java.lang.Runtime就是经典的单例模式</li>
<li>2.代码分析+Debug源码+代码说明<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="comment">//满足单例模式饿汉式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="keyword">Runtime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">Runtime</span> currentRuntime = <span class="keyword">new</span> <span class="keyword">Runtime</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the runtime object associated with the current Java application.</span></span><br><span class="line"><span class="comment">     * Most of the methods of class &lt;code&gt;Runtime&lt;/code&gt; are instance</span></span><br><span class="line"><span class="comment">     * methods and must be invoked with respect to the current runtime object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return  the &lt;code&gt;Runtime&lt;/code&gt; object associated with the current</span></span><br><span class="line"><span class="comment">     *          Java application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">Runtime</span> getRuntime() &#123;</span><br><span class="line">        <span class="keyword">return</span> currentRuntime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Don't let anyone else instantiate this class */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Runtime</span>() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="单例模式注意事项和细节说明"><a href="#单例模式注意事项和细节说明" class="headerlink" title="单例模式注意事项和细节说明"></a>单例模式注意事项和细节说明</h6></li>
<li>1.单例模式保证了系统内存中该类只存在一个对象，节省了系统资源，对于一些需求频繁创建销毁的对象，使用单例模式可以提高系统性能</li>
<li>2.当想实例化一个单例类的时候，必须要记住使用相应的获取对象的方法，而不是使用new</li>
<li>3.单例模式使用的场景；需要频繁的进行创建和销毁的对象，创建对象时耗时过多或耗费资源过多(即：重量级对象)，但又经常用到的对象，工具类对象，频繁访问数据库或者文件对象(比如数据源，session工厂等)</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java设计模式+UML类图</title>
    <url>/2020/01/20/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-UML%E7%B1%BB%E5%9B%BE/</url>
    <content><![CDATA[<h3 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h3><ul>
<li>基本介绍</li>
<li>UML(统一建模语言)，是一种用于软件系统分析和设计的语言工具，它用于帮助软件开发人员进行思考和记录思路的结果</li>
<li>UML本身就是一套符号的规定，就像数学符号和化学符号一样，这些符号用于描述软件模型中的各个元素和他们之间的关系，比如类，接口，实现，泛化(继承)，依赖，组合，聚合，等</li>
<li>使用UNL来建模，常用的工具Rational Rose，也可以使用一些插件来建模<h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4></li>
<li>有个A类，其中有个B类型成员变量，B类通过set方法传递的，那么就是A类聚合了B类<h4 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h4></li>
<li>有个A类，其中有个实例化了A类（A a = new A()）;这样的方式称之为组合<h4 id="UML类图分类"><a href="#UML类图分类" class="headerlink" title="UML类图分类"></a>UML类图分类</h4></li>
<li>1.用例图(use case)+</li>
<li>2.静态结构图：类图，对象图，包图，组件图，部署图</li>
<li>3.动态行位图：交互图(时序图与协调图)，状态图，活动图</li>
<li>说明：<ul>
<li>1.类图是描述类与类之间的关系的，是UML图中最核心的</li>
</ul>
</li>
<li>详解：<ul>
<li>1.用于描述系统中的类(对象)本身的组成和类(对象)之间的各种静态关系</li>
<li>2.类之间的关系：依赖，泛化(继承)，实现，关联，组合和聚合</li>
<li>3.类图的简单举例：<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>&#123;</span><span class="comment">//代码形式</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IDEA安装插件–PlantUML"><a href="#IDEA安装插件–PlantUML" class="headerlink" title="IDEA安装插件–PlantUML"></a>IDEA安装插件–PlantUML</h3></li>
</ul>
</li>
<li>在idea中Preferences -&gt; plugins -&gt;  Browse repositories -&gt; 搜索 plantUML -&gt; 安装即可</li>
<li>注意：安装PlantUML后需安装(本地)Graphviz<br>目的：安装此软件的原因是可以在画图的时候看到图的内容，不然只是一堆编码</li>
<li>使用：<a href="https://plantuml.com/zh/class-diagram" target="_blank" rel="noopener">https://plantuml.com/zh/class-diagram</a> 查看官网教程<h3 id="类之间六大关系"><a href="#类之间六大关系" class="headerlink" title="类之间六大关系"></a>类之间六大关系</h3><h4 id="依赖关系-Dependence"><a href="#依赖关系-Dependence" class="headerlink" title="依赖关系(Dependence)"></a>依赖关系(Dependence)</h4></li>
<li>只要是在类中用到对方，那么他们之间就存在依赖关系，如果没有对方法，连编译都通过不了。</li>
<li>应用案例<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> dependence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> personDao personDao;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Person person)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IDCard <span class="title">getIDCard</span><span class="params">(Integer personId)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">()</span></span>&#123;</span><br><span class="line">        department department = <span class="keyword">new</span> department(); <span class="comment">//注意此处违背了迪米特法则 局部变量不能是陌生的类</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图：<br><img src="images%5Cdependence.png" alt="" title="依赖关系图"></li>
</ul>
<ul>
<li>类图代码<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line"></span><br><span class="line">PersonServiceBean ..&gt; department</span><br><span class="line">PersonServiceBean ..&gt; IDCard</span><br><span class="line"></span><br><span class="line">PersonServiceBean ..&gt; Person</span><br><span class="line">PersonServiceBean ..&gt; PersonDao</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">department</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">IDCard</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">PersonDao</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">PersonServiceBean</span> &#123;</span><br><span class="line">-personDao：PersonDao</span><br><span class="line">+save(person Person):<span class="built_in">void</span></span><br><span class="line">+getIDCard(personId Integer):IDCard</span><br><span class="line">+modify():<span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>小结：满足以来的条件<ul>
<li>1.类中用到了对方</li>
<li>2.如果是类的成员属性</li>
<li>3.如果是方法的返回类型</li>
<li>4.是方法接收的参数类型</li>
<li>5.在方法中使用到<h4 id="泛化关系（generalizaation）"><a href="#泛化关系（generalizaation）" class="headerlink" title="泛化关系（generalizaation）"></a>泛化关系（generalizaation）</h4></li>
</ul>
</li>
<li>泛化关系实际上就是继承关系，他是依赖关系的特例</li>
<li>应用案例<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> generalizaation;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoSupport</span> </span>&#123;</span><br><span class="line">    public void save(<span class="type">Object</span> entity)&#123;&#125;</span><br><span class="line">    public void delete(<span class="type">Object</span> id)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> <span class="keyword">extends</span> <span class="title">DaoSupport</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图–泛化（继承）关系图<br><img src="images%5Cgeneralizaation.png" alt="" title="泛化关系图"></li>
<li>类图代码<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="meta">@startuml</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoSupper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">+save(entity <span class="built_in">Object</span>):<span class="keyword">void</span></span><br><span class="line">+delete(id <span class="built_in">Object</span>):<span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line">DaoSupper&lt;|-- PersonServiceBean</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@enduml</span></span><br></pre></td></tr></table></figure></li>
<li>小结：<ul>
<li>泛化关系就是继承关系</li>
<li>如果A类继承B类，我们就说A和B之间存在泛化关系<h4 id="实现关系-Implementation"><a href="#实现关系-Implementation" class="headerlink" title="实现关系(Implementation)"></a>实现关系(Implementation)</h4></li>
</ul>
</li>
<li>实现关系实际上就i是A类实现B类，他是依赖关系的特例</li>
<li>应用案例<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Implementation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> <span class="keyword">implements</span> <span class="title">PersonService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图–实现关系图<br><img src="images%5CImplementation.png" alt="" title="实现关系图"></li>
<li>类图代码<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@startuml</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> personService&#123;</span><br><span class="line"><span class="keyword">delete</span>(id Integer):<span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line">personService &lt;|.. personServiceBean</span><br><span class="line"><span class="keyword">class</span> personServiceBean &#123;</span><br><span class="line"><span class="keyword">delete</span>(id Integer):<span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@enduml</span></span><br></pre></td></tr></table></figure>
<h4 id="关联关系-Association"><a href="#关联关系-Association" class="headerlink" title="关联关系(Association)"></a>关联关系(Association)</h4></li>
<li>关联关系实际上就是类与类之间的联系，他是依赖关系的的特例</li>
<li>关联具有导航性；及双向关系或单项关系</li>
<li>关系具有多重性：<br>如：<br>“1”（表示有且仅有一个），<br>“0….”(表示0个或多个)，<br>“0，1”（表示0个或者一个），<br>“n…m”（表示n到m个都可以），<br>“m…*”(表示至少m个)</li>
<li>小结：成员属性的依赖关系<h4 id="聚合关系（Aggregation）"><a href="#聚合关系（Aggregation）" class="headerlink" title="聚合关系（Aggregation）"></a>聚合关系（Aggregation）</h4></li>
<li>聚合关系表示的整体和部分的关系，整体与部分可以分开。聚合关系是关联关系的特例，所以它具有关联的导航性与多重性。</li>
<li>应用案例<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package Aggregation;</span><br><span class="line"><span class="comment">//聚合</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">aggreation</span> &#123;</span></span><br><span class="line">    <span class="comment">//属性彼此可以分离</span></span><br><span class="line">    <span class="keyword">private</span>  Moniter moniter;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Mouse</span> mouse;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoniter</span><span class="params">(Moniter moniter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.moniter = moniter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMouse</span><span class="params">(<span class="built_in">Mouse</span> mouse)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mouse = mouse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moniter</span>&#123;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span>&#123;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图–聚合关系图<br><img src="images%5CAggregation.png" alt="" title="聚合关系图"></li>
<li>类图代码<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="meta">@startuml</span></span><br><span class="line"></span><br><span class="line">computer o-- Mouse</span><br><span class="line">computer o-- Moniter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">computer</span> &#123;</span>  </span><br><span class="line">- <span class="string">mouse:</span>Mouse</span><br><span class="line">- <span class="string">montiner:</span>Moniter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@enduml</span></span><br></pre></td></tr></table></figure></li>
<li>小结：整体与部分可以分开<h4 id="组合关系-Composition"><a href="#组合关系-Composition" class="headerlink" title="组合关系(Composition)"></a>组合关系(Composition)</h4></li>
<li>组合关系：也是整体与部分的关系，但是整体与部分不可分离。组合关系关联关系的特例</li>
<li>应用案例<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> composition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">composition</span> </span>&#123;</span><br><span class="line">    <span class="comment">//成员属性和类不可分离，composition实例成员属性也实例，composition销毁成员属性也销毁</span></span><br><span class="line">    <span class="keyword">private</span> Mouse mouse = <span class="keyword">new</span> <span class="type">Mouse</span>();</span><br><span class="line">    <span class="keyword">private</span> Monitor monitor = <span class="keyword">new</span> <span class="type">Monitor</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monitor</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li>类图–组合关系图<br><img src="images%5Ccomposition.png" alt="" title="组合关系图"></li>
<li>类图代码<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="meta">@startuml</span></span><br><span class="line">computer *-- Mouse</span><br><span class="line">computer *-- Moniter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">computer</span> &#123;</span></span><br><span class="line">- <span class="string">mouse:</span>Mouse = <span class="keyword">new</span> Mouse()</span><br><span class="line">- <span class="string">montiner:</span>Moniter = <span class="keyword">new</span> Moniter()</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@enduml</span></span><br></pre></td></tr></table></figure></li>
<li>案例2</li>
<li>在程序中我们定义实体.Person与IDCard，Head，那么Head和Person就是组合，IDCard和Person就是聚合。<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">package composition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IDCard card;<span class="comment">//聚合</span></span><br><span class="line">    <span class="keyword">private</span> Head head = new Head();<span class="comment">//组合</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">IDCard</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Head</span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li>注意：如果在程序中Person实体中定义了对IDCard进行级联删除，即删除Person时连同IDCard一起删除，那么IDCard和Person就是组合了</li>
<li>类图–组合+聚合关系图<br><img src="images%5CAggco.png" alt="" title="组合+聚合关系图"></li>
<li>类图代码<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="meta">@startuml</span></span><br><span class="line">Person o-- IDCard</span><br><span class="line">Person *-- Head</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></span><br><span class="line">- <span class="string">card:</span>IDCard</span><br><span class="line">- <span class="string">head:</span>Head = <span class="keyword">new</span> Head()</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@enduml</span></span><br></pre></td></tr></table></figure></li>
<li>小结：整体与部分不可分离—组合（同生共死）</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 设计模式+七大原则</title>
    <url>/2020/01/16/Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%83%E5%A4%A7%E5%8E%9F%E5%88%99/</url>
    <content><![CDATA[<h3 id="设计模式-design-pattern"><a href="#设计模式-design-pattern" class="headerlink" title="设计模式(design pattern)"></a>设计模式(design pattern)</h3><h4 id="设计模式常用到的七大原则"><a href="#设计模式常用到的七大原则" class="headerlink" title="设计模式常用到的七大原则"></a>设计模式常用到的七大原则</h4><ul>
<li><p>单一职责原则</p>
</li>
<li><p>接口隔离原名则</p>
</li>
<li><p>依赖倒转(倒置)原则</p>
</li>
<li><p>里氏替换原则</p>
</li>
<li><p>开闭原则 ocp原则</p>
</li>
<li><p>迪米特法则</p>
</li>
<li><p>合成复用原则</p>
<h4 id="设计模式出现在软件中哪里？？？"><a href="#设计模式出现在软件中哪里？？？" class="headerlink" title="设计模式出现在软件中哪里？？？"></a>设计模式出现在软件中哪里？？？</h4></li>
<li><p>面向对象(oo)==&gt;功能模块[设计模式+算法(数据结构)]==&gt;框架[多种设计模式]==&gt;架构[服务器集群]</p>
</li>
<li><p>代码重用性(相同功能的代码不用读此编写）</p>
</li>
<li><p>可读性(编程的规范性,便于其他程序员的阅读和理解)</p>
</li>
<li><p>可扩展性(但需要添加新的功能时非常的方便,成本低，也称为可维护性)</p>
</li>
<li><p>可靠性(当我们增加新的功能后，对原有的功能没有影响)</p>
</li>
<li><p>程序高内聚，低偶合的特性</p>
<h4 id="金句分享："><a href="#金句分享：" class="headerlink" title="金句分享："></a>金句分享：</h4></li>
<li><p>设计模式包含了面向对象的精髓，“懂了设计模式，你就懂了面向对象分析和设计(OOA/D)的精髓”；</p>
<h3 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h3></li>
<li><p>对类来说，即一个类应该只负责一项职则，如果A类负责两个不同的职责：职责1，职责2，但职责1需求变更而改变A类时，可能造成职责B执行错误，所以需要将类A的粒度分为解为A1，A2</p>
</li>
<li><p>应用案例</p>
<ul>
<li>方式一<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单一职责原则</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">singleResponsibility01</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        Vehile v = <span class="keyword">new</span> Vehile();</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"摩托"</span>);</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"汽车"</span>);</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"飞机"</span>);<span class="comment">//飞机在公路上跑.... 违反了单一职责原则</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//交通工具类</span></span><br><span class="line"><span class="comment">/*方式一</span></span><br><span class="line"><span class="comment">* 1.在方式一run()方法中违反了单一职责原则</span></span><br><span class="line"><span class="comment">* 2.解决方案：根据交通工具运行的方法不同，分解成不同的类即可</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehile</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在公路上跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>方式二:在类级别处理严格遵守单一原则职责<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单一职责原则</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">singleResponsibility2</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        RoadVehile v = <span class="keyword">new</span> RoadVehile();</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"摩托"</span>);</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"汽车"</span>);</span><br><span class="line">        AirVehile v1= <span class="keyword">new</span> AirVehile();</span><br><span class="line">        v1.<span class="built_in">run</span>(<span class="string">"飞机"</span>);</span><br><span class="line">        WaterVehile v2 =<span class="keyword">new</span> WaterVehile();</span><br><span class="line">        v2.<span class="built_in">run</span>(<span class="string">"航母"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//交通工具类</span></span><br><span class="line"><span class="comment">/*方式二</span></span><br><span class="line"><span class="comment">* 1.遵守了单一职责原则</span></span><br><span class="line"><span class="comment">* 2.但是这样他的改动很大，即将类分解，还要修改客户端</span></span><br><span class="line"><span class="comment">* 3.直接修改Vehile这个类，改动的代码比较少==&gt;方案三</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoadVehile</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在公路上跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirVehile</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在天空中跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaterVehile</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在水上跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>方式三：在方法级别处理在方法级遵守单一原则职责<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单一职责原则</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">singleResponsibility3</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        Vehile2 v = <span class="keyword">new</span> Vehile2();</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"摩托"</span>);</span><br><span class="line">        v.<span class="built_in">run</span>(<span class="string">"汽车"</span>);</span><br><span class="line">        v.runAri(<span class="string">"飞机"</span>);</span><br><span class="line">        v.runWater(<span class="string">"游艇"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//交通工具类</span></span><br><span class="line"><span class="comment">/*方式三</span></span><br><span class="line"><span class="comment">* 1.没有对原来的类做大的修改只是增加了方法</span></span><br><span class="line"><span class="comment">* 2.这里虽然再类这个级别上没有遵守单一职责原则，但在方法级别上遵守单一职责原则</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehile2</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在公路上跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runAri</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在天空上跑....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runWater</span><span class="params">(<span class="keyword">String</span> vehile)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(vehile + <span class="string">"在水上跑....."</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>总结：</p>
<ul>
<li>1.降低类的复杂度，一个类负责一线职责</li>
<li>2.提高 可读性，可维护性</li>
<li>3.降低变更引起的风险</li>
<li>4.通常情况下，我们应当遵守单一职责原则，只要逻辑足够简单，才可以在代码级别违反单一职责原则；只要类中方法数量足够少，可以在方法级别保持单一职责原则<h3 id="接口隔离原则-interface-Segregation-Principle"><a href="#接口隔离原则-interface-Segregation-Principle" class="headerlink" title="接口隔离原则(interface Segregation Principle)"></a>接口隔离原则(interface Segregation Principle)</h3></li>
</ul>
</li>
<li><p>客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上</p>
</li>
<li><p>应用案例</p>
</li>
<li><p>原始: 不遵守接口隔离原则(不是最小接口)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.principle.Segregation;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//接口隔离级别</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Segregation01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            A a = <span class="keyword">new</span> A();</span><br><span class="line">            a.depend1(<span class="keyword">new</span> B()); <span class="comment">//A类通过接口去依赖B</span></span><br><span class="line">            a.depend2(<span class="keyword">new</span> B());</span><br><span class="line">            a.depend3(<span class="keyword">new</span> B());</span><br><span class="line">            </span><br><span class="line">            C c = <span class="keyword">new</span> C();</span><br><span class="line">            c.depend1(<span class="keyword">new</span> D());</span><br><span class="line">            c.depend5(<span class="keyword">new</span> D());</span><br><span class="line">            c.depend6(<span class="keyword">new</span> D());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation6</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Interface1</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation1"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation4"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation5"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation6"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">D</span> <span class="keyword">implements</span> <span class="title">Interface1</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation1"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation4"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation5"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation6"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;<span class="comment">//A类通过接口interface1 依赖(使用)B类，但是只会用到1，2，3方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend3</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="comment">//A类通过接口interface1 依赖(使用)B类，但是只会用到1，2，3方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend6</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation6();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend5</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>改进：遵守接口隔离原则(处理：将接口拆封成独立的接口，类与类之间分别与他们需要的接口建立依赖关系)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.principle.Segregation.improve;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接口隔离级别</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Segregation02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        a.depend1(<span class="keyword">new</span> B()); <span class="comment">//A类通过接口去依赖B</span></span><br><span class="line">        a.depend2(<span class="keyword">new</span> B());</span><br><span class="line">        a.depend3(<span class="keyword">new</span> B());</span><br><span class="line">        </span><br><span class="line">        C c = <span class="keyword">new</span> C();</span><br><span class="line">        c.depend1(<span class="keyword">new</span> D());</span><br><span class="line">        c.depend5(<span class="keyword">new</span> D());</span><br><span class="line">        c.depend6(<span class="keyword">new</span> D());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface2</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface3</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation6</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Interface1</span>,<span class="title">Interface2</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"B 实现了 operation1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">D</span> <span class="keyword">implements</span> <span class="title">Interface1</span>,<span class="title">Interface3</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation5"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation6"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"D 实现了 operation1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;<span class="comment">//A类通过接口interface1，Interface2， 依赖(使用)B类，但是只会用到1，2，3方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span><span class="params">(Interface2 i)</span> </span>&#123;</span><br><span class="line">        i.operation2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend3</span><span class="params">(Interface2 i)</span> </span>&#123;</span><br><span class="line">        i.operation3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="comment">//A类通过接口interface1，Interface3 依赖(使用)B类，但是只会用到1，2，3方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span> </span>&#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend6</span><span class="params">(Interface3 i)</span> </span>&#123;</span><br><span class="line">        i.operation6();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend5</span><span class="params">(Interface3 i)</span> </span>&#123;</span><br><span class="line">        i.operation5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="依赖倒转原则（Dependence-Inversion-Principle）"><a href="#依赖倒转原则（Dependence-Inversion-Principle）" class="headerlink" title="依赖倒转原则（Dependence Inversion Principle）"></a>依赖倒转原则（Dependence Inversion Principle）</h3></li>
<li><p>1.高层模块不应该依赖底层模块，二者都应该依赖抽象</p>
</li>
<li><p>2.抽象不应该依赖细节，细节应该依赖抽象</p>
</li>
<li><p>3.依赖倒转(倒置)的中心思想是面向接口编程</p>
</li>
<li><p>4.依赖倒转是基于这样的的设计模式：</p>
<ul>
<li>相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建的架构比以细节为基础搭建的架构要稳定得多。在Java中抽象指的是接口或抽象类，细节就是具体的实现类</li>
</ul>
</li>
<li><p>5.使用接口或者抽象类的目的是制定好规范，而不涉及任何具体操作，把展示细节的任务交给他们的实现类去完成。</p>
</li>
<li><p>应用案例</p>
</li>
<li><p>方式1:普通方式</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.principle.inversion;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependecyInversion</span> &#123;</span></span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">         Person p = <span class="keyword">new</span> Person();</span><br><span class="line">         p.receive(<span class="keyword">new</span> Email());</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//完成Person接收消息的功能</span></span><br><span class="line"> <span class="comment">//方式一</span></span><br><span class="line"> <span class="comment">/* 简单，比较容易实现</span></span><br><span class="line"><span class="comment"> * 如果我们获取的对象是 微信，短信等等，则新增类，同时Person也要完成增加相应的接受方法</span></span><br><span class="line"><span class="comment"> * 解决思路：引入一个抽象的类的接口IReceover,表示接收者，这样Person类与接口IReceiver发生依赖</span></span><br><span class="line"><span class="comment"> * 因为Email，微信，等等属于接受的范围，他们各自实现IReceiver接口就ok。</span></span><br><span class="line"><span class="comment"> * 这样就遵守依赖倒转原则。</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>&#123;</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Email email)</span> </span>&#123;</span><br><span class="line">         System.out.<span class="built_in">println</span>(email.getInfo());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Email</span>&#123;</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"电子邮件信息：Hello World"</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方式2:遵守依赖倒转原则</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.principle.inversion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependecyInversion2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        Person1 p = <span class="keyword">new</span> <span class="type">Person1</span>();</span><br><span class="line">        p.receive(<span class="keyword">new</span> <span class="type">Email1</span>());</span><br><span class="line">        p.receive(<span class="keyword">new</span> <span class="type">qq</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//完成Person接收消息的功能</span></span><br><span class="line"><span class="comment">//方式一</span></span><br><span class="line"><span class="comment">/* 简单，比较容易实现</span></span><br><span class="line"><span class="comment">* 如果我们获取的对象是 微信，短信等等，则新增类，同时Person也要完成增加相应的接受方法</span></span><br><span class="line"><span class="comment">* 解决思路：引入一个抽象的类的接口IReceover,表示接收者，这样Person类与接口IReceiver发生依赖</span></span><br><span class="line"><span class="comment">* 因为Email，微信，等等属于接受的范围，他们各自实现IReceiver接口就ok。</span></span><br><span class="line"><span class="comment">* 这样就遵守依赖倒转原则。</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person1</span></span>&#123;</span><br><span class="line">    <span class="comment">//这里是我们是对接口的依赖</span></span><br><span class="line">    <span class="keyword">public</span> void receive(IReceiver ireceiver) &#123;</span><br><span class="line">        System.out.println(ireceiver.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email1</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">IReceiver</span></span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getInfo() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"电子邮件信息：Hello World"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//增加功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">qq</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">IReceiver</span></span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getInfo() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"QQ信息：你好你好！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IReceiver</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>依赖关系传递的三种方式</p>
<ul>
<li>接口传递<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DendencyPass</span></span>&#123;</span><br><span class="line">      ChangHong changHong =  <span class="keyword">new</span> ChangHong();</span><br><span class="line">      OpenAndClose openAndClose = <span class="keyword">new</span> OpenAndClose();</span><br><span class="line">      openAndClose.open(changHong);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;<span class="comment">//抽象方法</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">interface</span> <span class="title">ITV</span></span>&#123;<span class="comment">//ITV接口</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClass</span></span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(ITV tv)</span></span>&#123;</span><br><span class="line">         tv.play();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChangHong</span> <span class="keyword">implements</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line">         System.out.println(<span class="string">"长虹电视机，打开"</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li>构造方法传递<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DendencyPass</span></span>&#123;</span><br><span class="line">     ChangHong changHong =  <span class="keyword">new</span> ChangHong();</span><br><span class="line">     <span class="comment">//通过构造器进行依赖的传递</span></span><br><span class="line">     OpenAndClose openAndClose = <span class="keyword">new</span> OpenAndClose(changHong);</span><br><span class="line">     opebAndClose.open();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> <span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;<span class="comment">//抽象方法</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">interface</span> <span class="title">ITV</span></span>&#123;<span class="comment">//ITV接口</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClass</span></span>&#123;</span><br><span class="line">     <span class="keyword">public</span> ITV tv;<span class="comment">//成员</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">OpenAndClose</span><span class="params">(ITV tv)</span></span>&#123;<span class="comment">//构造器</span></span><br><span class="line">         <span class="keyword">this</span>.tv =tv;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.tv.play();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li>setter方法依赖传递<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DendencyPass</span></span>&#123;</span><br><span class="line">    ChangHong changHong =  <span class="keyword">new</span> ChangHong();</span><br><span class="line">    <span class="comment">//通过setter方法传递</span></span><br><span class="line">    OpenAndClose openAndClose = <span class="keyword">new</span> OpenAndClose();</span><br><span class="line">    opebAndClose.setTv(changHong);</span><br><span class="line">    opebAndClose.open();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;<span class="comment">//抽象方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(ITV tv)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">interface ITV</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ITV tv;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIv</span><span class="params">(ITV tv)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChangHong</span> <span class="keyword">implements</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"长虹电视机，打开"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li>总结:<ul>
<li>1.低层模块尽量都要有抽象类或接口，或者两者都有，程序的稳定性会更好</li>
<li>2.变量的声明类型尽量是抽象类或者接口，这样我们的变量引用和实际对象间，就存在一个缓存层，利于程序扩展和优化</li>
<li>3.继承时遵守里氏替换原则<h3 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h3></li>
</ul>
</li>
</ul>
<ul>
<li>就是告诉我们继承要遵守什么规则，注意什么问题</li>
<li>OO编程中的继承性的思考和说明<ul>
<li>1.继承包含这样一层含义：父类中凡是已经实现的方法，实际上是在设定规范和契约，虽然他不强制要求所有子类必须遵守这些契约，但是如果子类对这些已经实现的方法任意修改，就会对整个继承体系造成破坏</li>
<li>2.集成在程序设计带来便利的同时，也得来了弊端，比如使用继承会给程序带来侵入性，程序的可移植性降低，增加对象间的偶合性，如果一个类被其他的类所继承，则当这个类需要修改时，必须考虑到所有子类，并且父类修改后，所有涉及到子类的功能都有可能产生故障；</li>
<li>问题提出；在编程中，如何正确的使用继承？ == 里氏替换原则</li>
</ul>
</li>
<li>里式替换原则基本介绍：<ul>
<li>1.里氏替换原则(Lidkow Substitution Principle)在1988年，由麻省理工学院一位姓里的女士提出；</li>
<li>2.如果对每一个类型为T1的对象o1,都有类型T2的对象o2，使得以T1定义的所有的程序p在所有的对象o1,都代换成o2时，程序P的行为没有发生变化，那么类型T2是类型T1的子类型.换句话说，所有引用基类的地方必须能透明的使用其子类对象</li>
<li>3.在使用继承时，遵守里式替换原则，在子类中尽量不要重写父类的方法</li>
<li><ol start="4">
<li>里式替换原则告诉我们，继承实际上让两个类偶合性增强，在适当的情况下，可以通过聚合，组合，依赖来解决问题<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">package com.zhao.principle.Liskov;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Principle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> static <span class="built_in">void</span> main(String[] args) &#123;</span><br><span class="line">        A a = new A();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11-3="</span> + a.fun1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"1-8="</span> + a.fun1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"-----------"</span>);</span><br><span class="line">        B b = new B();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11-3="</span> + b.fun1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"1-8="</span> + b.fun1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11+3+9="</span> + b.fun1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//A类</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">A</span> &#123;</span><br><span class="line"><span class="comment">//	返回两个数的差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun1(<span class="built_in">int</span> num1, <span class="built_in">int</span> num2) </span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//B继承A</span></span><br><span class="line"><span class="comment">//增加了一个新的功能:完成两个数相加然后和9求和</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">B</span> <span class="symbol">extends</span> <span class="symbol">A</span> &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun1(<span class="built_in">int</span> a, <span class="built_in">int</span> b) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun2(<span class="built_in">int</span> a, <span class="built_in">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> fun1(a, b) + <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li>注意：上面我们发现原来运行的减法功能发生错误。原因就是类B无意中重写了父类的方法，造成原有功能出现错误，在实际编程中，在实际编程中，我们常常通过重写父类的方法完成新的功能，这样写起来虽然简单，但整个继承体系的复用会比较差，特别是运行多态比较频繁的时候</li>
<li>解决方法：原来的父类和子类都继承一个更通俗的基类，原有的继承关系去掉，采用依赖，聚合，组合等关系代替<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Principle2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> static <span class="built_in">void</span> main(String[] args) &#123;</span><br><span class="line">        A a = new A();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11-3="</span> + a.fun1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"1-8="</span> + a.fun1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"-----------"</span>);</span><br><span class="line"></span><br><span class="line">        B b = new B();</span><br><span class="line">        <span class="comment">// 因为B类不在继承A类，因此调用者，不会再fun1是求减法</span></span><br><span class="line">        <span class="comment">//调用的功能就会明确</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11+3="</span> + b.fun1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"1+8="</span> + b.fun1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11+3+9="</span> + b.fun2(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//任然可以使用到A类的相关方法</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11-3="</span>+b.fun3(<span class="number">11</span>,<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个更加基础的基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Base</span>&#123;</span><br><span class="line"><span class="comment">//	把更加基础的方法和成员写到Basic类中</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//A类</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">A</span> <span class="symbol">extends</span> <span class="symbol">Base</span>&#123;</span><br><span class="line"><span class="comment">//	返回两个数的差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun1(<span class="built_in">int</span> num1, <span class="built_in">int</span> num2) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//B继承A</span></span><br><span class="line"><span class="comment">//增加了一个新的功能:完成两个数相加然后和9求和</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">B</span> <span class="symbol">extends</span> <span class="symbol">Base</span> &#123;</span><br><span class="line">    <span class="comment">//如果B类需要使用A类的方法，使用组合关系</span></span><br><span class="line">    <span class="keyword">private</span> A a = new A();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun1(<span class="built_in">int</span> a, <span class="built_in">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun2(<span class="built_in">int</span> a, <span class="built_in">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> fun1(a, b) + <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果我仍然想使用A的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> fun3(<span class="built_in">int</span> a,<span class="built_in">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.a.fun1(a,b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="开闭原则-Open-Closed-Principle"><a href="#开闭原则-Open-Closed-Principle" class="headerlink" title="开闭原则(Open Closed Principle)"></a>开闭原则(Open Closed Principle)</h3></li>
<li>1.开闭原则是编程中最基础的，最重要的设计原则</li>
<li>2.一个软件实体类，模块和函数应该对扩展开放(对提供方)，对修改关闭(对使用方)，用抽象构建框架，用实现扩展细节</li>
<li>3.但软件需要变化时，尽量扩展软件实体的行为来实现变化，而不是通过修改已有的代码来实现变化。</li>
<li>4.编程中遵守其他原则，以及使用设计模式的目的就是 遵守开闭原则</li>
<li>应用案例<br>*方式一：<ul>
<li>1.优点是好理解，简单易操作</li>
<li>2.缺点是违反了设计模式的ocp原则，即对扩展开放发，对修改关闭。即当我们给类增加新功能的时候，尽量不修改代码，或者尽可能少修改代码，</li>
<li>3.比如我们则时要增加一个图形类，我们需要做以下修改，修改的地方比较多 <figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.principle.ocp;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ocp</span> </span>&#123;</span><br><span class="line">    public static void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">        <span class="type">GraphicEditor</span> g = <span class="keyword">new</span> <span class="type">GraphicEditor</span>();</span><br><span class="line">        g.drawShape(<span class="keyword">new</span> <span class="type">Rectangle</span>());</span><br><span class="line">        g.drawShape(<span class="keyword">new</span> <span class="type">Circle</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是一个绘制图形的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span></span>&#123;</span><br><span class="line">    <span class="comment">//接受Shape对象，然后根据type绘制不同的图形</span></span><br><span class="line">    public void drawShape(<span class="type">Shape</span> s) &#123;</span><br><span class="line">        <span class="keyword">if</span>(s.m_type == <span class="number">1</span>) &#123;</span><br><span class="line">            drawRectangle(s);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.m_type == <span class="number">2</span>) &#123;</span><br><span class="line">            drawCircle(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public  void drawRectangle(<span class="type">Shape</span> r) &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"矩形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    public void drawCircle(<span class="type">Shape</span> r) &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"圆形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">        int m_type;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">        <span class="type">Rectangle</span>()&#123;</span><br><span class="line">            <span class="keyword">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">        <span class="type">Circle</span>()&#123;</span><br><span class="line">            <span class="keyword">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二：满足ocp原则</li>
<li>改进思路分析：</li>
<li>思路：把创建Shape类做成抽象类，并提供一个抽象的draw方法，让子类去实现即可，这样就满足开闭原则“对扩展开放(对提供方)，对修改关闭(使用方)”<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.principle.ocp.update;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ocp</span> </span>&#123;</span><br><span class="line">    public static void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">        <span class="type">GraphicEditor</span> g = <span class="keyword">new</span> <span class="type">GraphicEditor</span>();</span><br><span class="line">        g.drawShape(<span class="keyword">new</span> <span class="type">Rectangle</span>());</span><br><span class="line">        g.drawShape(<span class="keyword">new</span> <span class="type">Circle</span>());</span><br><span class="line">        g.drawShape(<span class="keyword">new</span> <span class="type">Other</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是一个绘制图形的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span></span>&#123;</span><br><span class="line">    <span class="comment">//接受Shape对象，然后根据type绘制不同的图形</span></span><br><span class="line">    public void drawShape(<span class="type">Shape</span> s) &#123;</span><br><span class="line">        s.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//基类 抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">        int m_type;</span><br><span class="line">        public <span class="keyword">abstract</span> void draw();<span class="comment">//抽象方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">        <span class="type">Rectangle</span>()&#123;</span><br><span class="line">            <span class="keyword">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        public void draw() &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">            <span class="type">System</span>.out.println(<span class="string">"绘制矩形"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">        <span class="type">Circle</span>()&#123;</span><br><span class="line">            <span class="keyword">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        public void draw() &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">            <span class="type">System</span>.out.println(<span class="string">"绘制三角形"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//新增图形</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Other</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="type">Other</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void draw() &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"绘制立方体"</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="迪米特法则-Demeter-Principle"><a href="#迪米特法则-Demeter-Principle" class="headerlink" title="迪米特法则(Demeter Principle)"></a>迪米特法则(Demeter Principle)</h3></li>
</ul>
</li>
</ul>
</li>
<li>基本介绍：</li>
<li>1.一个对象应该对其他对象保持最小的了解</li>
<li>2.类与类关系越密切，耦合度越大</li>
<li>3.迪米特法则又叫最小知道法则，即一个类对自己依赖的类知道越少越好。也就是说，对于被依赖的类不管多麽复杂，都尽量见逻辑封装在类内部。对外除了提供的public方法，  不对外泄露任何消息</li>
<li>4.迪米特法则还有个更简单的定义：只与直接的朋友通信；</li>
<li>5.直接的朋友：每个对象都会与其他对象有偶合关系，只要两个对象之间有偶合关系，我们就说这两个对象之间是朋友关系。耦合的方式很多，依赖，关联，组合，聚合，等。<br>其中，我们称出现成员变量，方法参数，方法返回值中的类为直接的朋友，而出现在局部变量中的类不是直接朋友。也就是说，陌生的类最好不要以局部变量的形式出现在类的内部。</li>
<li>应用案例</li>
<li>方式一：不满足迪米特法则<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.principle.demeter.update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demeter1</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建了一个SchoolManager对象</span></span><br><span class="line">        SchoolManager schoolMansger =  <span class="keyword">new</span> SchoolManager();</span><br><span class="line">        <span class="comment">//输出学院的id和学校的Id</span></span><br><span class="line">        schoolMansger.printAllEmployee(<span class="keyword">new</span> CollegeManager());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学校员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">String</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学院员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeEmployee</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">String</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//管理学院员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeManager</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CollegeEmployee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;CollegeEmployee&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;CollegeEmployee&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++) &#123;</span><br><span class="line">            CollegeEmployee emp = <span class="keyword">new</span> CollegeEmployee();</span><br><span class="line">            emp.setId(<span class="string">"学院员工id="</span>+i);</span><br><span class="line">            <span class="built_in">list</span>.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学院管理类</span></span><br><span class="line"><span class="comment">//分析直接朋友 Employee CollegeManager</span></span><br><span class="line"><span class="comment">//这个不是直接朋友 CollegeEmployee 而是陌生类,这样就违背了迪米特原则</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolManager</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;Employee&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;Employee&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++) &#123;</span><br><span class="line">            Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">            emp.setId(<span class="string">"学校员工Id="</span>+i);</span><br><span class="line">            <span class="built_in">list</span>.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//该方法完成输出学校总部和学院员工信息的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAllEmployee</span><span class="params">(CollegeManager sub)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//分析问题</span></span><br><span class="line">        <span class="comment">//1.这里的CollegeEmployee不是SchoolManager的直接朋友</span></span><br><span class="line">        <span class="comment">//2.CollegeEmployee是以局部变量方式出现在SchoolManager</span></span><br><span class="line">        <span class="comment">//3.违反了迪米特法则</span></span><br><span class="line">        List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"------学院员工------"</span>);</span><br><span class="line">        <span class="keyword">for</span>(CollegeEmployee e : list1) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Employee&gt; list2 = <span class="keyword">this</span>.getAllEmployee();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"-------学校总部员工--------"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Employee e : list2) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(e.getId());</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>方式二：满足迪米特法则<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.principle.demeter.update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demeter1</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"使用迪米特法则的改进"</span>);</span><br><span class="line">        <span class="comment">//创建了一个SchoolManager对象</span></span><br><span class="line">        SchoolManager schoolMansger =  <span class="keyword">new</span> SchoolManager();</span><br><span class="line">        <span class="comment">//输出学院的id和学校的Id</span></span><br><span class="line">        schoolMansger.printAllEmployee(<span class="keyword">new</span> CollegeManager());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学校员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">String</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学院员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeEmployee</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">String</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//管理学院员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeManager</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CollegeEmployee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;CollegeEmployee&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;CollegeEmployee&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++) &#123;</span><br><span class="line">            CollegeEmployee emp = <span class="keyword">new</span> CollegeEmployee();</span><br><span class="line">            emp.setId(<span class="string">"学院员工id="</span>+i);</span><br><span class="line">            <span class="built_in">list</span>.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//输出学院员工的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">printEmployee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将输出学院员工方法，封装到CollegeManager</span></span><br><span class="line">            List&lt;CollegeEmployee&gt; list1 = <span class="keyword">this</span>.getAllEmployee();</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"------学院员工------"</span>);</span><br><span class="line">            <span class="keyword">for</span>(CollegeEmployee e : list1) &#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(e.getId());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//学院管理类</span></span><br><span class="line"><span class="comment">//分析直接朋友 Employee CollegeManager</span></span><br><span class="line"><span class="comment">//这个不是直接朋友 CollegeEmployee 而是陌生类,这样就违背了迪米特原则</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolManager</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;Employee&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;Employee&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++) &#123;</span><br><span class="line">            Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">            emp.setId(<span class="string">"学校员工Id="</span>+i);</span><br><span class="line">            <span class="built_in">list</span>.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//该方法完成输出学校总部和学院员工信息的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAllEmployee</span><span class="params">(CollegeManager sub)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//分析问题</span></span><br><span class="line">        <span class="comment">//将输出学院员工方法，封装到CollegeManager</span></span><br><span class="line">        sub.printEmployee();</span><br><span class="line">        List&lt;Employee&gt; list2 = <span class="keyword">this</span>.getAllEmployee();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"-------学校总部员工--------"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Employee e : list2) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(e.getId());</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>总结：<ul>
<li>1.迪米特法则的核心是降低类之间的耦合</li>
<li>2.但是注意：由于每个类都是减少了不必要的依赖，因此迪米特法则只是要求降低类之间(对象间)耦合关系，并不是要求完全没有依赖关系<h3 id="合成复用原则-Composite-Reuse-Principle"><a href="#合成复用原则-Composite-Reuse-Principle" class="headerlink" title="合成复用原则(Composite Reuse Principle)"></a>合成复用原则(Composite Reuse Principle)</h3></li>
</ul>
</li>
<li>基本介绍：<br>原则是尽量使用合成/聚合的方式，而不是使用继承</li>
</ul>
<h3 id="设计原则的核心思想"><a href="#设计原则的核心思想" class="headerlink" title="设计原则的核心思想"></a>设计原则的核心思想</h3><ul>
<li>1.找出应用中可能需要变化之处，把他们独立出来，不要和那些不需要变化的代码混合在一起</li>
<li>2.针对接口编程，而不是针对实现编程</li>
<li>3.为了交互对象之间的松耦合设计而努力</li>
</ul>
]]></content>
      <tags>
        <tag>Java设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot微服务框架+Docker+数据访问整合(五)</title>
    <url>/2020/01/16/SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-Docker-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E6%95%B4%E5%90%88-%E4%BA%94/</url>
    <content><![CDATA[<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li>Docker是一个开源的应用容器引擎；</li>
<li>Docker支持将软件编译成一个镜像；然后 在镜像中各种软件做好配置，<br>将镜像发布 出去，其他使用者可以直接使用这个镜像。 运行中的这个镜像称为容器，容器启动是 非常快速的<h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4></li>
<li>docker主机：安装了Docker程序的机器(Docker直接安装在系统上面)</li>
<li>docker客户端(Client):连接Docker主机进行操作 API与Docker守护进程通行</li>
<li>docker仓库(Regjistries):Docker仓库用来保存镜像，可以理解为代码控制中的代码仓库。</li>
<li>docker镜像(Images):软件打包好的镜像；放在docker仓库中；</li>
<li>dovker容器(Container):镜像启动后的实例称为一个容器:容器时独立运行的 一个人或一组应用；</li>
</ul>
<ul>
<li>使用Daocker步骤：<ul>
<li>安装Docker</li>
<li>去Docker仓库找到这个软件的镜像</li>
<li>直接使用Docker运行这个镜像，这个镜像就会生成一个Docker容器</li>
<li>对容器的启动停止就是对软件的启动停止<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3></li>
</ul>
</li>
</ul>
<ul>
<li><p>虚拟机manajor</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>安装命令：sudo pacman -S docker</span><br><span class="line"><span class="bullet">* </span>注意：出现报错：必须删除 /var/pacman/...</span><br><span class="line"><span class="bullet">* </span>删除命令：sudo pacman rm -rf /var/pacman/...</span><br><span class="line"><span class="bullet">* </span>启动docker服务:sudo systemctl start docker </span><br><span class="line"><span class="bullet">* </span>查看docker服务的状态:sudo systemctl status docker</span><br><span class="line"><span class="bullet">* </span>设置docker开机启动服务:sudo systemctl enable docker </span><br><span class="line"><span class="bullet">* </span>停止docker：systemctl stop  docker</span><br><span class="line"><span class="bullet">* </span>查找所有镜像命令：sudo docker search mysql</span><br><span class="line"><span class="bullet">* </span>拉取或下载镜像：sudo docker pull mysql   (latest之默认最新版本)</span><br><span class="line"><span class="bullet">* </span>查看所有本地镜像：sudo docker images</span><br><span class="line"><span class="bullet">* </span>删除指定的本地镜像：sudo docker rmi image-id （image-id镜像id）</span><br></pre></td></tr></table></figure>
<h4 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h4></li>
<li><p>软件操作—》运行镜像–产生一个容器（正在运行的软件）；</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">* 运行镜像命令：sudo docker <span class="builtin-name">run</span> --name mytomcat(自定义的名字) -d(表示后台运行) tomcat：latest(镜像名，latest就是tag，是默认的可省略)</span><br><span class="line">* 查看运行中的容器：sudo docker ps</span><br><span class="line">* 停止运行中的容器：sudo docker stop mytomcat/id（名字或者容器Id）</span><br><span class="line">* 查看所有容器：sudo docker ps -a</span><br><span class="line">* 删除指定容器：sudo rm container-id（容器Id ）</span><br><span class="line">* 启动指定容器：sudo docker start 容器Id</span><br><span class="line">* 端口映射：-p   把当前主机的端口(映射到)容器内部的端口</span><br><span class="line">* 启动一个做了端口映射的Tomcat</span><br><span class="line">    命令：sudo docker <span class="builtin-name">run</span> -d -p 8888:8080</span><br><span class="line">    -d:后台运行</span><br><span class="line">    -p：将主机端口映射到容器中的一个端口     格式： 8888:8080(主机端口：容器端口)</span><br><span class="line">*manjaro中自带的查看网络的命令是:<span class="built_in"> ip </span>addr<span class="built_in">/ip </span>address</span><br><span class="line">* window访问 虚拟机ip地址：8888</span><br><span class="line">    注意：要关闭linux的防火墙</span><br><span class="line">    1.查看防火墙状态</span><br><span class="line">     查看防火墙状态 systemctl status firewalld</span><br><span class="line">     开启防火墙 systemctl start firewalld  </span><br><span class="line">     关闭防火墙 systemctl stop firewalld</span><br><span class="line">     若遇到无法开启</span><br><span class="line">     先用：systemctl unmask firewalld.service </span><br><span class="line">     然后：systemctl start firewalld.service</span><br><span class="line">*查看容器日志：sudo docker logs 容器名/容器Id</span><br><span class="line">*更多命令查看官方文档：https:docs.docker.com/engine/reference/commandline/docker/</span><br></pre></td></tr></table></figure>
<h4 id="数据访问JDBC自动配置"><a href="#数据访问JDBC自动配置" class="headerlink" title="数据访问JDBC自动配置"></a>数据访问JDBC自动配置</h4></li>
<li><p>pom.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>application.yml文件</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="attribute">spring</span>:</span><br><span class="line"><span class="attribute">datasource</span>:</span><br><span class="line">    <span class="attribute">username</span>: root</span><br><span class="line">    <span class="attribute">password</span>: zhao1314520</span><br><span class="line">    <span class="attribute">url</span>: <span class="attribute">jdbc</span>:<span class="attribute">mysql</span>:<span class="comment">//localhost:3306/jdbc</span></span><br><span class="line">    <span class="attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></table></figure></li>
<li><p>默认数据源：com.zaxxer.hikari.HikariDataSource</p>
</li>
<li><p>数据源的相关配置都在： DataSourceProperties里面</p>
</li>
<li><p>自动配置原理:spring-boot-autoconfigure-2.2.2.RELEASE.jar!\org\springframework\boot\autoconfigure\jdbc</p>
<ul>
<li><p>1.参考DataSourceConfiguration，根据配置创建数据源</p>
</li>
<li><p>2.可使用spring.datasource.type指定自定义的数据源类</p>
</li>
<li><p>3.SpringBoot默认支持</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">org</span><span class="selector-class">.apache</span><span class="selector-class">.commons</span><span class="selector-class">.dbcp2</span><span class="selector-class">.BasicDataSource</span></span><br><span class="line"><span class="selector-tag">com</span><span class="selector-class">.zaxxer</span><span class="selector-class">.hikari</span><span class="selector-class">.HikariDataSource</span></span><br><span class="line"><span class="selector-tag">org</span><span class="selector-class">.apache</span><span class="selector-class">.tomcat</span><span class="selector-class">.jdbc</span><span class="selector-class">.pool</span><span class="selector-class">.DataSource</span></span><br></pre></td></tr></table></figure></li>
<li><p>4.自定义数据源类型</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Configuration</span>(</span><br><span class="line">    proxyBeanMethods = false</span><br><span class="line">)</span><br><span class="line"><span class="variable">@ConditionalOnMissingBean</span>(&#123;DataSource.class&#125;)</span><br><span class="line"><span class="variable">@ConditionalOnProperty</span>(</span><br><span class="line">    name = &#123;<span class="string">"spring.datasource.type"</span>&#125;</span><br><span class="line">)</span><br><span class="line">static class Generic &#123;</span><br><span class="line">    <span class="selector-tag">Generic</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Bean</span></span><br><span class="line">    DataSource dataSource(DataSourceProperties properties) &#123;</span><br><span class="line">        <span class="comment">//使用DataSourceBuilder（建造者模式）创建数据源 ，利用反射创建响应type的数据源，并且绑定相关属性</span></span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">properties</span><span class="selector-class">.initializeDataSourceBuilder</span>()<span class="selector-class">.build</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>5.DataSourceInitializer<ul>
<li>runScripts() 运行建表语句；插入数据的sql语句</li>
<li>默认只需要将文件命名为：schema-<em>sql， data-</em>sql<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"> private <span class="built_in">List</span>&lt;Resource&gt; getScripts(<span class="built_in">String</span> propertyName, <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; resources, <span class="built_in">String</span> fallback) &#123;</span><br><span class="line">    <span class="keyword">if</span> (resources != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResources(propertyName, resources, <span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">String</span> platform = <span class="keyword">this</span>.properties.getPlatform();</span><br><span class="line">        <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; fallbackResources = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">"-"</span> + platform + <span class="string">".sql"</span>);</span><br><span class="line">        fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">".sql"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResources(propertyName, fallbackResources, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>自动建表application.yml配置(注意表明命名： schema=classpath: schema.sql)</p>
<ul>
<li>第一种方式：<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">zhao1314520</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="comment">#必须加上下面两个</span></span><br><span class="line">        <span class="attr">initialization-mode:</span> <span class="string">always</span></span><br><span class="line">        <span class="string">schema=classpath:</span> <span class="string">schema.sql</span></span><br></pre></td></tr></table></figure></li>
<li>第二种方式：指定位置<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="meta">#此处schma为list 可以多个表</span></span><br><span class="line"><span class="symbol">schema:</span></span><br><span class="line">    - classpath:department.sql</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>6.操作数据库：自动配置了jdbcTemplate操作数据库</p>
  <figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">jdbcTemlater</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/query"</span>)</span><br><span class="line">    public <span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&gt; map()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">List</span>&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;&gt; list = jdbcTemplate.queryForList(<span class="string">"select * from department"</span>);</span><br><span class="line">        <span class="keyword">return</span> list.<span class="keyword">get</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>7.注意测试和SpringBoot主程序运是两回事</p>
<h3 id="阿里数据源druid"><a href="#阿里数据源druid" class="headerlink" title="阿里数据源druid"></a>阿里数据源druid</h3></li>
<li><p>1.引入druid</p>
<ul>
<li>在maven仓库(mvnrepository.com)中找到druid  <!--引入自定义的数据源阿里 druid-->
<!-- https://mvnrepository.com/artifact/com.alibaba/druid -->
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid</artifactId>
  <version>1.1.20</version>
</dependency></li>
</ul>
</li>
<li><p>2.配置属性</p>
<ul>
<li>application.yml<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># 引入自定义数据源</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#详细配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">datasource:</span></span><br><span class="line">   <span class="comment">#   数据源基本配置</span></span><br><span class="line">       <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">       <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">       <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">       <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_crud</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">   <span class="comment">#   数据源其他配置</span></span><br><span class="line">       <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">       <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">       <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">       <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">       <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">       <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">       <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">       <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">       <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">       <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">       <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">   <span class="comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙  </span></span><br><span class="line">       <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">       <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">       <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span>  </span><br><span class="line">       <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class="line">   <span class="comment">#   注意上面 数据源其他配置  配置监控统计拦截的filters SpringBoot解析不到需要自己配置</span></span><br></pre></td></tr></table></figure></li>
<li>config 配置类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   将配置属性绑定  已spring.datasource开始的...</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DruidDataSource druidDataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>3.配置druid数据源监控</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">    </span><br><span class="line">@Configuration</span><br><span class="line">public <span class="keyword">class</span> DruidConfig &#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = <span class="module-access"><span class="module"><span class="identifier">LoggerFactory</span>.</span></span>get<span class="constructor">Logger(DruidConfig.<span class="params">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//   将配置属性绑定  已spring.datasource开始的...</span></span><br><span class="line">    @<span class="constructor">ConfigurationProperties(<span class="params">prefix</span> = <span class="string">"spring.datasource"</span>)</span></span><br><span class="line">    @Bean</span><br><span class="line">    public DataSource druid<span class="constructor">DataSource()</span>&#123;</span><br><span class="line">        return <span class="keyword">new</span> <span class="constructor">DruidDataSource()</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1。配置一个管理后台的Servlet</span></span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean start<span class="constructor">ViewServlet()</span>&#123;</span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> <span class="constructor">ServletRegistrationBean(<span class="params">new</span> StatViewServlet()</span>, <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="constructor">HashMap()</span>;</span><br><span class="line">    initParams.put(<span class="string">"jmxUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"jmxPasswordd"</span>,<span class="string">"123456"</span>);</span><br><span class="line"><span class="comment">/*        initParams.put("allow",""); //默认就是允许所有访问</span></span><br><span class="line"><span class="comment">        initParams.put("deny","192.168.15.21");  //拒绝IP地址访问*/</span></span><br><span class="line"></span><br><span class="line">        bean.set<span class="constructor">InitParameters(<span class="params">initParams</span>)</span>;</span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.配置一个web监控的filter</span></span><br><span class="line">    @Bean</span><br><span class="line">    public FilterRegistrationBean  web<span class="constructor">StatFilter()</span>&#123;</span><br><span class="line">        FilterRegistrationBean bean = <span class="keyword">new</span> <span class="constructor">FilterRegistrationBean()</span>;</span><br><span class="line">        bean.set<span class="constructor">Filter(<span class="params">new</span> WebStatFilter()</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span>);</span><br><span class="line">        bean.set<span class="constructor">InitParameters(<span class="params">initParams</span>)</span>;</span><br><span class="line">        bean.set<span class="constructor">UrlPatterns(Arrays.<span class="params">asList</span>(<span class="string">"/*"</span>)</span>);</span><br><span class="line"></span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="整合MyBatis"><a href="#整合MyBatis" class="headerlink" title="整合MyBatis"></a>整合MyBatis</h3></li>
<li><p>1.添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="comment">&lt;!--mybatis整合Springboot依赖  由mybatis出的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>2.数据库建表(自动application.yml文件配置)</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">initialization-<span class="string">mode:</span> always</span><br><span class="line"><span class="string">schema:</span></span><br><span class="line">- <span class="string">classpath:</span>sql/employee.sql</span><br><span class="line">- <span class="string">classpath:</span>sql/department.sql</span><br></pre></td></tr></table></figure></li>
<li><p>3.创建javaBean(实体类)</p>
</li>
<li><p>4.mybatis注解版</p>
<ol>
<li>mapper<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptId</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>,keyProperty = <span class="string">"id"</span>)  <span class="comment">//是不是使用自动生成的主键 ,Department 里面id是封装主键的</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Controller<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired(required = false)</span></span><br><span class="line">        DepartmentMapper departmentMapper;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@GetMapping(<span class="meta-string">"/dept/&#123;id&#125;"</span>)</span></span><br><span class="line">        <span class="keyword">public</span> Department getDept(<span class="meta">@PathVariable(<span class="meta-string">"id"</span>)</span> Integer id)&#123;</span><br><span class="line">            <span class="keyword">return</span> departmentMapper.getDeptId(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@GetMapping(<span class="meta-string">"/dept"</span>)</span></span><br><span class="line">        <span class="keyword">public</span> Department insertDept(Department department) &#123;</span><br><span class="line">            departmentMapper.insertDept(department);</span><br><span class="line">            <span class="keyword">return</span> department;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<ul>
<li><p>1.在遇到表中字段与实体类字段不统一即Xml配置中的<resultMap>;<br>解决方法：在不写配置Xml文件基础上，添加配置类Config</p>
<ul>
<li>自定义Mybatis的配置规则,即给容器中添加一个ConfigurationCustomizer；<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">@org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Configuration</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    /<span class="regexp">/配置定制器</span></span><br><span class="line"><span class="regexp">    @Bean</span></span><br><span class="line"><span class="regexp">    public ConfigurationCustomizer configurationCustomizer()&#123;</span></span><br><span class="line"><span class="regexp">        return new ConfigurationCustomizer()&#123;</span></span><br><span class="line"><span class="regexp">            @Override</span></span><br><span class="line"><span class="regexp">            public void customize(Configuration configuration) &#123;</span></span><br><span class="line"><span class="regexp">                configuration.setMapUnderscoreToCamelCase(true);</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.注意：在通过@GetMapping注解是通过路径添加数据会报以下错<br>javax.servlet.ServletException: Circular view path [url]: would dispatch back to the current handler URL [/url] again. Check your ViewResolver setup! (Hint: This may be the result of an unspecified view, due to default view name generation.)</p>
<ul>
<li>大概意思就是没得视图可跳转</li>
</ul>
</li>
<li><p>解决方法：将@Controller注解改为@RestController</p>
</li>
<li><p>@Controller和@RestController的区别？</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">            知识点：<span class="meta">@RestController</span>注解相当于<span class="meta">@ResponseBody</span> ＋ <span class="meta">@Controller</span>合在一起的作用。</span><br><span class="line"></span><br><span class="line">            <span class="number">1</span>) 如果只是使用<span class="meta">@RestController</span>注解Controller，则Controller中的方法无法返回jsp页面，或者html，配置的视图解析器 InternalResourceViewResolver不起作用，返回的内容就是Return 里的内容。</span><br><span class="line">            <span class="number">2</span>) 如果需要返回到指定页面，则需要用 <span class="meta">@Controller</span>配合视图解析器InternalResourceViewResolver才行。</span><br><span class="line">                如果需要返回JSON，XML或自定义mediaType内容到页面，则需要在对应的方法上加上<span class="meta">@ResponseBody</span>注解。</span><br><span class="line"></span><br><span class="line">            例如：</span><br><span class="line"></span><br><span class="line">            <span class="number">1</span>.使用<span class="meta">@Controller</span> 注解，在对应的方法上，视图解析器可以解析<span class="keyword">return</span> 的jsp,html页面，并且跳转到相应页面</span><br><span class="line">            若返回json等内容到页面，则需要加<span class="meta">@ResponseBody</span>注解</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="meta">@CrossOrigin</span></span><br><span class="line">            <span class="meta">@Controller</span></span><br><span class="line">            <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//跳转到上传文件的页面</span></span><br><span class="line">            <span class="meta">@RequestMapping(value=<span class="meta-string">"/gouploadimg"</span>, method = RequestMethod.GET)</span></span><br><span class="line">            <span class="keyword">public</span> String goUploadImg() &#123;</span><br><span class="line">            <span class="comment">//跳转到 templates 目录下的 uploadimg.html</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"uploadimg"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//处理文件上传</span></span><br><span class="line">            <span class="meta">@RequestMapping(value=<span class="meta-string">"/testuploadimg"</span>, method = RequestMethod.POST)</span></span><br><span class="line">            <span class="keyword">public</span> <span class="meta">@ResponseBody</span> String uploadImg(<span class="meta">@RequestParam(<span class="meta-string">"file"</span>)</span> MultipartFile file,</span><br><span class="line">            HttpServletRequest request) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">"调用文件上传方法"</span>);</span><br><span class="line">            String contentType = file.getContentType();</span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">            <span class="number">2</span>.<span class="meta">@RestController</span>注解，相当于<span class="meta">@Controller</span>+<span class="meta">@ResponseBody</span>两个注解的结合，返回json数据不需要在方法前面加<span class="meta">@ResponseBody</span>注解了，但使用<span class="meta">@RestController</span>这个注解，就不能返回jsp,html页面，视图解析器无法解析jsp,html页面</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="meta">@CrossOrigin</span></span><br><span class="line">            <span class="meta">@RestController</span> <span class="comment">/* @Controller + @ResponseBody*/</span></span><br><span class="line">            <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HospitalController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//注入Service服务对象</span></span><br><span class="line">                <span class="meta">@Autowired</span></span><br><span class="line">                <span class="keyword">private</span> HospitalService hospitalService;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                * 查询所有医院信息（未分页）</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line"></span><br><span class="line">                <span class="meta">@RequestMapping(value = <span class="meta-string">"findAllHospital"</span>,method = RequestMethod.GET)</span></span><br><span class="line">                <span class="keyword">public</span>  List&lt;Hospital&gt; findAllHospital()&#123;</span><br><span class="line">                    List&lt;Hospital&gt; hospitalList= hospitalService.findAllHospital();</span><br><span class="line">                    <span class="keyword">return</span> hospitalList;</span><br><span class="line">                &#125;</span><br><span class="line">        ```  </span><br><span class="line">* 可以在启动类上配置批量扫描<span class="meta">@MapperScan</span></span><br></pre></td></tr></table></figure>
<p>//配置映射扫描器<br>@MapperScan(value = “com.zhao.demomybatis.mapper”)</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">#### 配置文件版</span><br><span class="line">* application.yml文件中添加配置</span><br></pre></td></tr></table></figure>
<p>mybatis:<br>config-location: classpath:mybatis/mybatis-config.xml<br>mapper-locations: classpath:mybatis/mapper/*.xml</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>核心配置类</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
 PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
 <settings>
<!--            //开启驼峰命名法-->
     <setting name="mapUnderscoreToCamelCase" value="true"/>
 </settings>
</configuration>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>映射文件</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhao.demomybatis.mapper.EmployeementMapper">
<select id="getEmp" resultType="com.zhao.demomybatis.entiry.Employee">
select * from employee where id = #{id}
</select>
<insert id="insertEmp">
 insert into employee(lastName,email,gender,d_id) values(#{lastName},#{email},#{gender},#{did})
</insert>
</mapper>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">### SpringBoot数据访问整合JPA</span><br><span class="line">* JPA基于ORM思想(Object, Relational, mapping)</span><br><span class="line">    * <span class="number">1.</span>编写一个实体类(bean)和数据表进行映射，并且配置好映射关系；</span><br></pre></td></tr></table></figure>
//使用JPA注解配置映射关系
@Entity //告诉JPA这是一个 实体类(和数据表映射的类)
@Table(name = "tb1_user") //@Table来指定和那个数据表对应，如果省略默认表明就是user；
public class User {

<p> @Id //这是一个主键<br> @GeneratedValue(strategy = GenerationType.IDENTITY) //自增<br> private Integer id;</p>
<p> @Column(name = “last_name”,length = 50)//这是和数据表对应的一个列<br> private String lastName;</p>
<p> @Column //省略默认列名就是属性名<br> private String email;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">* <span class="number">2.</span>编写一个Dao接口来操作实体类对应的数据表(Reposiyory)</span><br></pre></td></tr></table></figure>
<p>//Dao层<br>import com.zhao.demojpa.entity.User;<br>import org.springframework.data.jpa.repository.JpaRepository;</p>
<p>//继承JpaRepository&lt;User,Integer&gt; 参数表示实体类，主键类型<br>public interface UserRepository extends JpaRepository&lt;User,Integer&gt; {</p>
<p>}</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">* <span class="number">3.</span>基本配置(application.yml) 源码参考JpaProperties类</span><br></pre></td></tr></table></figure>
<p>spring:<br>jpa:<br> hibernate:</p>
<h1 id="更新或者创建数据表-数据表的生成策略"><a href="#更新或者创建数据表-数据表的生成策略" class="headerlink" title="更新或者创建数据表(数据表的生成策略)"></a>更新或者创建数据表(数据表的生成策略)</h1><pre><code>ddl-auto: update</code></pre><h1 id="控制台显示sql语句"><a href="#控制台显示sql语句" class="headerlink" title="控制台显示sql语句"></a>控制台显示sql语句</h1><p> show-sql: true</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>Controller</span><br></pre></td></tr></table></figure>
<p>@RestController<br>public class UserController {</p>
<p> @Autowired<br> UserRepository userRepository;</p>
<p> @GetMapping(“/user/{id}”)<br> public User getUser(@PathVariable(“id”) Integer id){</p>
<pre><code>User user = userRepository.findById(id).orElse(null);
return user;</code></pre><p> }</p>
<p> @GetMapping(“/user”)<br> public User insertUser(User user){</p>
<pre><code>User user1 = userRepository.save(user);
return user1;</code></pre><p> }<br>}<br>如果出现json报错 在实体类上加上@JsonlgnoreProperties({“handler”,”hibernateLazyInitiaLizer”})</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">### SpringBoot启动原理</span></span><br><span class="line"><span class="bullet">- </span>run()</span><br><span class="line"><span class="bullet">  * </span>准备环境</span><br><span class="line"><span class="bullet">    - </span>执行ApplicationContextIniaializer.initialize()</span><br><span class="line"><span class="bullet">    - </span>监听器SpringApplicationRunListener回调contextPrepared</span><br><span class="line"><span class="bullet">    - </span>加载主配置类定义信息</span><br><span class="line"><span class="bullet">    - </span>监听器SpringApplicationRunListener回调contextLoaded</span><br><span class="line"><span class="bullet">  * </span>刷新启动IOC容器；</span><br><span class="line"><span class="bullet">    - </span>扫描加载所有容器中的组件</span><br><span class="line"><span class="bullet">    - </span>包括从META-INF/sping.factories中获取的所有EnableAutoConfiguration组件</span><br><span class="line"><span class="bullet">  * </span>回调容器中所有的ApplicationRunner，CommandLineRunner的run方法</span><br><span class="line"><span class="bullet">  * </span>监听器SpringApplicationRunListener回调finished </span><br><span class="line"><span class="section">#### 事件监听机制</span></span><br><span class="line"><span class="section">#### 自定义场景启动器(starters)</span></span><br><span class="line"><span class="bullet">* </span>starters原理</span><br><span class="line"><span class="bullet">    * </span>1.场景启动器使用的依赖？？？</span><br><span class="line"><span class="bullet">    * </span>2.如何自动配置</span><br></pre></td></tr></table></figure>
<p>@Configuration //指定配置类<br>@CodeitionalOnxxx  //在指定条件成立的情况下自动配置生效<br>@AutoConfigOrder  //指定排序顺序<br>@AutoConfigureAfter //指定自动配置类的顺序<br>@Bean  //该容器中添加组件<br>@ConfigurationProperties 结合相关xxxProperties类来绑定相关配置<br>@EnableConfigurationProperties  //让XXXProperties文件生效加入到容器中</p>
<p>自动配置类要能加载<br>必须在calsspath下META-INF/spring.factories文件中配置</p>
<h1 id="Auto-Configure"><a href="#Auto-Configure" class="headerlink" title="Auto Configure"></a>Auto Configure</h1><p>org.springframework.boot.autoconfigure.EnableAutoConfiguration=<br>org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,<br>org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,<br>```</p>
</li>
</ul>
</li>
<li><p>自定义starters</p>
<ul>
<li>自动装配Bean；<ul>
<li>自动装配使用配置类(@Configuration)结合Spring4提供的条件判断注解@Codeitional及SpringBoot的派注解如@CodeitionOnClass完成</li>
</ul>
</li>
</ul>
</li>
<li><p>配置自动装配Bean</p>
<ul>
<li>将标注@Configuration的自动配置类，放在Classpath  下META-INF/spring.factories文件中配置</li>
</ul>
</li>
<li><p>模式：</p>
<ul>
<li>启动器(starter)</li>
</ul>
<ul>
<li>启动器模块是一个空的JAR文件，仅提供辅助性依赖管理，这些依赖可能用于自动装配或者其他类库</li>
<li>命名规范：<br>推荐以下命名规则：<br>xxx-starter —》xxxx-starter-autoconfigurer<ul>
<li>官方命名空间<ul>
<li>前缀：“Spring-boot-starter-”</li>
<li>模式：“Spring-boot-starter-模块名”</li>
<li>举例：spring-boot-starter-web,spring-boot-starter-actuator,spring-boot-starter-jdbc,</li>
</ul>
</li>
<li>自定义命名空间：<ul>
<li>后缀；“-spring-boot-starter”</li>
<li>模式：模块-spring-boot-starter</li>
<li>举例：mybatis-spring-boot-starter</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot微服务框架(四)</title>
    <url>/2020/01/08/SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-%E5%9B%9B/</url>
    <content><![CDATA[<h3 id="如何修改SpringBoot的默认配置"><a href="#如何修改SpringBoot的默认配置" class="headerlink" title="如何修改SpringBoot的默认配置"></a>如何修改SpringBoot的默认配置</h3><ul>
<li><p>模式：</p>
<ul>
<li>1.SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean ， @Component），如果有就用用户配置的，如果没有，才自动配置；<br>如果有些组件偶多个(viewResolver)将用户配置的和默认的组合起来；</li>
<li>2.SpringBoot中会有非常多的XXXConfigurer帮助我们进行扩展配置;</li>
<li>3.在SpringBoot中会有很多的XXXCustomizer帮助我们进行定制配置;<h3 id="SpringBoot默认使用（Tomcat）作为嵌入式的Servlet容器："><a href="#SpringBoot默认使用（Tomcat）作为嵌入式的Servlet容器：" class="headerlink" title="SpringBoot默认使用（Tomcat）作为嵌入式的Servlet容器："></a>SpringBoot默认使用（Tomcat）作为嵌入式的Servlet容器：</h3></li>
</ul>
</li>
<li><p>1.如何定制和修改Tomcat容器的相关配置</p>
<ul>
<li>a.第一种方式：修改和server有关的配置(ServerProperties)<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">server<span class="selector-class">.servlet</span>.context-path=/crud</span><br><span class="line"></span><br><span class="line"><span class="comment">//通用的Servlet容器设置</span></span><br><span class="line">server.xxx</span><br><span class="line"><span class="comment">//Tomcat的设置</span></span><br><span class="line">server<span class="selector-class">.tomcat</span>.xxx</span><br><span class="line">server<span class="selector-class">.tomcat</span>.uri-encoding=UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure></li>
<li>b.第二种方式：编写一个 WebServerFactoryCustomizer<TomcatServletWebServerFactory>：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//编写一个 WebServerFactoryCustomizer：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置</span></span><br><span class="line">  <span class="comment">// 向IoC容器中添加servlet容器工厂定制器 WebServerFactoryCustomizer</span></span><br><span class="line">  <span class="comment">//向IoC容器中添加servlet容器工厂定制器</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; <span class="title">myWebServerFactoryCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt;() &#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//定制嵌入式的Sevlet容器相关规则</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(TomcatServletWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">              <span class="comment">//设置相关配置</span></span><br><span class="line">              factory.setPort(<span class="number">8082</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>c.第三种方式：向IoC容器中添加可配置的servlet容器工厂 ConfigurableServletWebServerFactory<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyServerConfigurer</span> </span>&#123;</span><br><span class="line">  <span class="comment">//向IoC容器中添加servlet容器工厂</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  public ConfigurableServletWebServerFactory  myConfigurableServletWebServerFactory() &#123;</span><br><span class="line">    TomcatServletWebServerFactory <span class="keyword">factory</span> = <span class="keyword">new</span> TomcatServletWebServerFactory(); </span><br><span class="line">    <span class="keyword">factory</span>.setPort(<span class="number">8083</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">factory</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Web开发-注册Servlert三大组件"><a href="#Web开发-注册Servlert三大组件" class="headerlink" title="Web开发 注册Servlert三大组件"></a>Web开发 注册Servlert三大组件</h3></li>
</ul>
</li>
<li><p>注册Servlet，Filter，Listener</p>
</li>
<li><p>ServletRegisterationBear</p>
<ol>
<li>创建Servlet<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理Get请求</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void doGet(<span class="type">HttpServletRequest</span> req, <span class="type">HttpServletResponse</span> resp) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">      doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理Post请求</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void doPost(<span class="type">HttpServletRequest</span> req, <span class="type">HttpServletResponse</span> resp) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">"Hello MyServlet!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建配置类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyservletConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注册三大组件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">myServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(),<span class="string">"/myservletr"</span>);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>FilterRegisterationBean</p>
<ol>
<li>创建Filter过滤器实现javax.servlet.*;包下Filter接口<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//过滤</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyFilter process......"</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建配置类将其加载到容器中<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Bean</span><br><span class="line">  public FilterRegistrationBean my<span class="constructor">Filter()</span>&#123;</span><br><span class="line">      FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> <span class="constructor">FilterRegistrationBean()</span>;</span><br><span class="line">      filterRegistrationBean.set<span class="constructor">Filter(<span class="params">new</span> MyFilter()</span>);</span><br><span class="line">      filterRegistrationBean.set<span class="constructor">UrlPatterns(Arrays.<span class="params">asList</span>(<span class="string">"/hello"</span>,<span class="string">"/myservlet"</span>)</span>);</span><br><span class="line">      return filterRegistrationBean;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>ServletListenerRegisterationBean</p>
<ol>
<li>创建监听器<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//监听器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Servlet启动</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">" contextInitialized web应用启动了"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Servlet销毁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"contextDestroyed web应用销毁了"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在配置类中将其添加到容器中<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletListenerRegistrationBean listenerRegistrationBean = <span class="keyword">new</span> ServletListenerRegistrationBean(<span class="keyword">new</span> MyListener());</span><br><span class="line">        <span class="keyword">return</span> listenerRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot帮我们在自动配置SpringMvc的时候，自动的注册了SpringMvc的前端控制器；DispatcherServlet；-自动配置类DispatcherServletAutoConfiguration"><a href="#SpringBoot帮我们在自动配置SpringMvc的时候，自动的注册了SpringMvc的前端控制器；DispatcherServlet；-自动配置类DispatcherServletAutoConfiguration" class="headerlink" title="SpringBoot帮我们在自动配置SpringMvc的时候，自动的注册了SpringMvc的前端控制器；DispatcherServlet；(自动配置类DispatcherServletAutoConfiguration)"></a>SpringBoot帮我们在自动配置SpringMvc的时候，自动的注册了SpringMvc的前端控制器；DispatcherServlet；(自动配置类DispatcherServletAutoConfiguration)</h3><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(</span><br><span class="line">        proxyBeanMethods = <span class="literal">false</span></span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@Conditional</span>(&#123;<span class="type">DispatcherServletAutoConfiguration</span>.<span class="type">DispatcherServletRegistrationCondition</span><span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">@ConditionalOnClass</span>(<span class="params">&#123;<span class="type">ServletRegistration</span>.class&#125;</span>)</span></span><br><span class="line"><span class="class">    <span class="title">@EnableConfigurationProperties</span>(<span class="params">&#123;<span class="type">WebMvcProperties</span>.class&#125;</span>)</span></span><br><span class="line"><span class="class">    <span class="title">@Import</span>(<span class="params">&#123;<span class="type">DispatcherServletAutoConfiguration</span>.<span class="type">DispatcherServletConfiguration</span>.class&#125;</span>)</span></span><br><span class="line"><span class="class">    <span class="title">protected</span> <span class="title">static</span> <span class="title">class</span> <span class="title">DispatcherServletRegistrationConfiguration</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="type">DispatcherServletRegistrationConfiguration</span>() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span>(</span><br><span class="line">            name = &#123;<span class="string">"dispatcherServletRegistration"</span>&#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="meta">@ConditionalOnBean</span>(</span><br><span class="line">            value = &#123;<span class="type">DispatcherServlet</span><span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line"><span class="class">            <span class="title">name</span> </span>= &#123;<span class="string">"dispatcherServlet"</span>&#125;</span><br><span class="line">        )</span><br><span class="line">        public <span class="type">DispatcherServletRegistrationBean</span> dispatcherServletRegistration(<span class="type">DispatcherServlet</span> dispatcherServlet, <span class="type">WebMvcProperties</span> webMvcProperties, <span class="type">ObjectProvider</span>&lt;<span class="type">MultipartConfigElement</span>&gt; multipartConfig) &#123;</span><br><span class="line">            <span class="type">DispatcherServletRegistrationBean</span> registration = <span class="keyword">new</span> <span class="type">DispatcherServletRegistrationBean</span>(dispatcherServlet, webMvcProperties.getServlet().getPath());</span><br><span class="line">            <span class="comment">//确认拦截：/ 所有请求：包括静态资源文件，但不拦截jsp请求，以前/*拦截所有包括jsp请求</span></span><br><span class="line">            <span class="comment">//可通过server.servletPath来修改SpringMvc前端控制器默认拦截的请求</span></span><br><span class="line">            registration.setName(<span class="string">"dispatcherServlet"</span>);</span><br><span class="line">            registration.setLoadOnStartup(webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">            multipartConfig.ifAvailable(registration::setMultipartConfig);</span><br><span class="line">            <span class="keyword">return</span> registration;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot切换其他Servlet容器"><a href="#SpringBoot切换其他Servlet容器" class="headerlink" title="SpringBoot切换其他Servlet容器"></a>SpringBoot切换其他Servlet容器</h3></li>
</ol>
</li>
<li><p>2.SpringBoot能不能支持其他的Servlet容器；</p>
</li>
<li><p>SpringBoot默认支持：</p>
<ul>
<li>Tomcat（默认使用）<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--引入web模块--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     //引入web模块默认使用嵌入式的Tomcat做为Servlet容器；</span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Jetty（长连接）</li>
<li>Undertow(不支持JSP)特点：高性能非阻塞,并发性能高<br>案例切换Jetty（Undertow一样的方式）<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入web模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--排除Tomcat容器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--引入其他Servlet容器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="快捷键-ctrl-h-打开继承树"><a href="#快捷键-ctrl-h-打开继承树" class="headerlink" title="快捷键 ctrl+h 打开继承树"></a>快捷键 ctrl+h 打开继承树</h3><h3 id="嵌入式Servlet容器自动配置原理"><a href="#嵌入式Servlet容器自动配置原理" class="headerlink" title="嵌入式Servlet容器自动配置原理;"></a>嵌入式Servlet容器自动配置原理;</h3></li>
</ul>
</li>
<li><p>在Spring Boot的自动配置包下，找到web模块中的servlet文件夹下的ServletWebServerFactoryConfiguration类* </p>
</li>
<li><p>ServletWebServerFactoryConfiguration:嵌入式的servlet容器自动配置</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">@<span class="type">Configuration</span>(</span><br><span class="line">    proxyBeanMethods = false</span><br><span class="line">)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">ServletWebServerFactoryConfiguration</span> &#123;</span></span><br><span class="line"><span class="class">    <span class="type">ServletWebServerFactoryConfiguration</span>() &#123;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    @<span class="type">Configuration</span>(</span></span><br><span class="line"><span class="class">        <span class="title">proxyBeanMethods</span> = <span class="title">false</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnClass</span>(&#123;<span class="type">Servlet</span>.<span class="title">class</span>, <span class="type">Undertow</span>.<span class="title">class</span>, <span class="type">SslClientAuthMode</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnMissingBean</span>(</span></span><br><span class="line"><span class="class">        <span class="title">value</span> = &#123;<span class="type">ServletWebServerFactory</span>.<span class="title">class</span>&#125;,</span></span><br><span class="line"><span class="class">        <span class="title">search</span> = <span class="type">SearchStrategy</span>.<span class="type">CURRENT</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    public static <span class="keyword">class</span> <span class="type">EmbeddedUndertow</span> &#123;</span></span><br><span class="line"><span class="class">        public <span class="type">EmbeddedUndertow</span>() &#123;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        @<span class="type">Bean</span></span></span><br><span class="line"><span class="class">        public <span class="type">UndertowServletWebServerFactory</span> undertowServletWebServerFactory(<span class="type">ObjectProvider</span>&lt;<span class="type">UndertowDeploymentInfoCustomizer</span>&gt; <span class="title">deploymentInfoCustomizers</span>, <span class="type">ObjectProvider</span>&lt;<span class="type">UndertowBuilderCustomizer</span>&gt; <span class="title">builderCustomizers</span>) &#123;</span></span><br><span class="line"><span class="class">            <span class="type">UndertowServletWebServerFactory</span> factory = new <span class="type">UndertowServletWebServerFactory</span>();</span></span><br><span class="line"><span class="class">            factory.getDeploymentInfoCustomizers().addAll((<span class="type">Collection</span>)deploymentInfoCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            factory.getBuilderCustomizers().addAll((<span class="type">Collection</span>)builderCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            return factory;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    @<span class="type">Configuration</span>(</span></span><br><span class="line"><span class="class">        <span class="title">proxyBeanMethods</span> = <span class="title">false</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnClass</span>(&#123;<span class="type">Servlet</span>.<span class="title">class</span>, <span class="type">Server</span>.<span class="title">class</span>, <span class="type">Loader</span>.<span class="title">class</span>, <span class="type">WebAppContext</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnMissingBean</span>(</span></span><br><span class="line"><span class="class">        <span class="title">value</span> = &#123;<span class="type">ServletWebServerFactory</span>.<span class="title">class</span>&#125;,</span></span><br><span class="line"><span class="class">        <span class="title">search</span> = <span class="type">SearchStrategy</span>.<span class="type">CURRENT</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    public static <span class="keyword">class</span> <span class="type">EmbeddedJetty</span> &#123;</span></span><br><span class="line"><span class="class">        public <span class="type">EmbeddedJetty</span>() &#123;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        @<span class="type">Bean</span></span></span><br><span class="line"><span class="class">        public <span class="type">JettyServletWebServerFactory</span> <span class="type">JettyServletWebServerFactory</span>(<span class="type">ObjectProvider</span>&lt;<span class="type">JettyServerCustomizer</span>&gt; <span class="title">serverCustomizers</span>) &#123;</span></span><br><span class="line"><span class="class">            <span class="type">JettyServletWebServerFactory</span> factory = new <span class="type">JettyServletWebServerFactory</span>();</span></span><br><span class="line"><span class="class">            factory.getServerCustomizers().addAll((<span class="type">Collection</span>)serverCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            return factory;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    @<span class="type">Configuration</span>(</span></span><br><span class="line"><span class="class">        <span class="title">proxyBeanMethods</span> = <span class="title">false</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnClass</span>(&#123;<span class="type">Servlet</span>.<span class="title">class</span>, <span class="type">Tomcat</span>.<span class="title">class</span>, <span class="type">UpgradeProtocol</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    //判断当前是否引入了<span class="type">Tomcat</span>依赖</span></span><br><span class="line"><span class="class">    @<span class="type">ConditionalOnMissingBean</span>(</span></span><br><span class="line"><span class="class">        <span class="title">value</span> = &#123;<span class="type">ServletWebServerFactory</span>.<span class="title">class</span>&#125;,</span></span><br><span class="line"><span class="class">        <span class="title">search</span> = <span class="type">SearchStrategy</span>.<span class="type">CURRENT</span></span></span><br><span class="line"><span class="class">    )</span></span><br><span class="line"><span class="class">    //判断当前容器没有用户自己定义<span class="type">ServletWebServerFactory</span>：嵌入式servlet容器工厂 作用：创建嵌入式的<span class="type">Servlet</span>容器</span></span><br><span class="line"><span class="class">    public static <span class="keyword">class</span> <span class="type">EmbeddedTomcat</span> &#123;</span></span><br><span class="line"><span class="class">        public <span class="type">EmbeddedTomcat</span>() &#123;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        //<span class="type">TomcatServletWebServerFactory</span> <span class="type">Tomcat</span>容器工厂</span></span><br><span class="line"><span class="class">        @<span class="type">Bean</span></span></span><br><span class="line"><span class="class">        public <span class="type">TomcatServletWebServerFactory</span> tomcatServletWebServerFactory(<span class="type">ObjectProvider</span>&lt;<span class="type">TomcatConnectorCustomizer</span>&gt; <span class="title">connectorCustomizers</span>, <span class="type">ObjectProvider</span>&lt;<span class="type">TomcatContextCustomizer</span>&gt; <span class="title">contextCustomizers</span>, <span class="type">ObjectProvider</span>&lt;<span class="type">TomcatProtocolHandlerCustomizer</span>&lt;?&gt;&gt; <span class="title">protocolHandlerCustomizers</span>) &#123;</span></span><br><span class="line"><span class="class">            <span class="type">TomcatServletWebServerFactory</span> factory = new <span class="type">TomcatServletWebServerFactory</span>();</span></span><br><span class="line"><span class="class">            factory.getTomcatConnectorCustomizers().addAll((<span class="type">Collection</span>)connectorCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            factory.getTomcatContextCustomizers().addAll((<span class="type">Collection</span>)contextCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            factory.getTomcatProtocolHandlerCustomizers().addAll((<span class="type">Collection</span>)protocolHandlerCustomizers.orderedStream().collect(<span class="type">Collectors</span>.<span class="title">toList</span>()));</span></span><br><span class="line"><span class="class">            return factory;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>一、嵌入式Servlet容器默认的配置原理<br>1、该类中有三个静态内部类（都是配置类）：<br>EmbeddedUndertow、EmbeddedJetty、EmbeddedTomcat<br>这里拿EmbeddedTomcat来举例说明<br>@ConditionalOnClass({Servlet.class, Tomcat.class, UpgradeProtocol.class})<br>判断classpath下有没有Servlet, Tomcat, UpgradeProtocol这三个类，也就是看maven有没有引入对应的依赖，如果引入了对应的依赖，下面的配置就生效。<br>2、@ConditionalOnMissingBean(<br>value = {ServletWebServerFactory.class},<br>search = SearchStrategy.CURRENT<br>)<br>如果容器中没有ServletWebServerFactory这个组件下面的配置就生效<br>点进ServletWebServerFactory看，该接口只有一个方法，前面只判断这个类型的组件有没有在容器中，而该类型又只有一个方法，说明最终Spring Boot会调用该接口实现类中的getWebServer方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取嵌入式Servlet工厂</span></span><br><span class="line">  <span class="meta">@FunctionalInterface</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ServletWebServerFactory</span> </span>&#123;</span><br><span class="line">      <span class="function">WebServer <span class="title">getWebServer</span><span class="params">(ServletContextInitializer... initializers)</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>tomcat</li>
<li>Jetty（长连接）</li>
<li>Undertow(不支持JSP)特点：高性能非阻塞,并发性能高 </li>
</ul>
<p>3、查看ServletWebServerFactory接口的实现，有三个很面熟的实现类，就是上面ServletWebServerFactoryConfiguration类中要往容器中添加的组件<br>4、进入TomcatServletWebServerFactory类中查看getWebServer方法。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public WebServer get<span class="constructor">WebServer(ServletContextInitializer<span class="operator">...</span> <span class="params">initializers</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (this.disableMBeanRegistry) &#123;</span><br><span class="line">          <span class="module-access"><span class="module"><span class="identifier">Registry</span>.</span></span>disable<span class="constructor">Registry()</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//创建一个Tomcat</span></span><br><span class="line">      Tomcat tomcat = <span class="keyword">new</span> <span class="constructor">Tomcat()</span>;</span><br><span class="line">      File baseDir = this.baseDirectory != null ? this.baseDirectory : this.create<span class="constructor">TempDir(<span class="string">"tomcat"</span>)</span>;</span><br><span class="line">      <span class="comment">//配置Tomcat环节</span></span><br><span class="line">      tomcat.set<span class="constructor">BaseDir(<span class="params">baseDir</span>.<span class="params">getAbsolutePath</span>()</span>);</span><br><span class="line">      Connector connector = <span class="keyword">new</span> <span class="constructor">Connector(<span class="params">this</span>.<span class="params">protocol</span>)</span>;</span><br><span class="line">      connector.set<span class="constructor">ThrowOnFailure(<span class="params">true</span>)</span>;</span><br><span class="line">      tomcat.get<span class="constructor">Service()</span>.add<span class="constructor">Connector(<span class="params">connector</span>)</span>;</span><br><span class="line">      this.customize<span class="constructor">Connector(<span class="params">connector</span>)</span>;</span><br><span class="line">      tomcat.set<span class="constructor">Connector(<span class="params">connector</span>)</span>;</span><br><span class="line">      tomcat.get<span class="constructor">Host()</span>.set<span class="constructor">AutoDeploy(<span class="params">false</span>)</span>;</span><br><span class="line">      this.configure<span class="constructor">Engine(<span class="params">tomcat</span>.<span class="params">getEngine</span>()</span>);</span><br><span class="line">      Iterator var5 = this.additionalTomcatConnectors.iterator<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span>(var5.has<span class="constructor">Next()</span>) &#123;</span><br><span class="line">          Connector additionalConnector = (Connector)var5.next<span class="literal">()</span>;</span><br><span class="line">          tomcat.get<span class="constructor">Service()</span>.add<span class="constructor">Connector(<span class="params">additionalConnector</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.prepare<span class="constructor">Context(<span class="params">tomcat</span>.<span class="params">getHost</span>()</span>, initializers);</span><br><span class="line">      <span class="comment">//将配置好的Tomcat传入进来,并且启动Tomcat服务器 返回TomcatWebServer</span></span><br><span class="line">      return this.get<span class="constructor">TomcatWebServer(<span class="params">tomcat</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>首先会创建一个Tomcat对象，给其设置连接器等一些配置<br>最终还会调用getTomcatWebServer方法<br>this.getTomcatWebServer(tomcat);<br>–&gt;return new TomcatWebServer(tomcat, this.getPort() &gt;= 0);<br>端口号默认是8080所以上面传过去的是true，进入TomcatWebServer的构造方法TomcatWebServer中，在构造方法中又调用了this.initialize();进入initialize方法，该方法就会启动tomcat。(所以这一切都是建立在创建好嵌入式Servlet容器之后)</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">  protected TomcatWebServer get<span class="constructor">TomcatWebServer(Tomcat <span class="params">tomcat</span>)</span> &#123;</span><br><span class="line">    return <span class="keyword">new</span> <span class="constructor">TomcatWebServer(<span class="params">tomcat</span>, <span class="params">this</span>.<span class="params">getPort</span>()</span> &gt;= <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>对嵌入式容器的修改</p>
<ul>
<li><p>方法1：修改application配置<br>从官方文档可以看出支持的配置有如下所示，所以要修改servlet容器配置，直接在application配置文件修改即可：</p>
<p>网络设置: 监听端口(server.port)、服务器地址(server.address)等等<br>Session设置: 会话是否持久 (server.servlet.session.persistent),会话超时(server.servlet.session.timeout), 会话数据的位置 (server.servlet.session.store-dir), 会话对应的cookie配置 (server.servlet.session.cookie.*) 等等<br>错误管理: 错误页面位置 (server.error.path)等等<br>SSL设置：具体参考Configure SSL<br>HTTP compression：具体参考Enable HTTP Response Compression<br>application文件</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ServerProperties</span> ， TomcatWebServer</span><br></pre></td></tr></table></figure></li>
<li><p>方法2：自定义WebServerFactoryCustomizer定制器类<br>从文档里还找到了通过新建自定义的WebServerFactoryCustomizer类来实现属性配置修改，WebServerFactoryCustomizer也就是一种定制器类：</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>ServerProperties也是定制器</li>
<li>注册后置处理器webServerFactoryCustomizerBeanPostProcessor<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(ServletRequest<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnWebApplication</span>(<span class="title">type</span> </span>= Type.SERVLET)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(ServerProperties<span class="class">.<span class="keyword">class</span>)//使<span class="title">ServerProperties</span>配置类起效</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">    <span class="title">ServletWebServerFactoryConfiguration</span>.<span class="title">EmbeddedTomcat</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">    <span class="title">ServletWebServerFactoryConfiguration</span>.<span class="title">EmbeddedJetty</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">    <span class="title">ServletWebServerFactoryConfiguration</span>.<span class="title">EmbeddedUndertow</span>.<span class="title">class</span> &#125;)//@<span class="title">Import</span>是<span class="title">Spring</span>框架的注解，作用是将对应组件加载到容器，这里关键的是<span class="title">BeanPostProcessorsRegistrar</span>，一个后置处理类</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ServletWebServerFactoryAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ServletWebServerFactoryCustomizer <span class="title">servletWebServerFactoryCustomizer</span><span class="params">(ServerProperties serverProperties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServletWebServerFactoryCustomizer(serverProperties);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Tomcat的定制器类，起作用的条件是有Tomcat对应jar有引入项目的情况，默认是引入的，所以会执行Tomcat的servletWeb工厂定制类</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnClass</span>(name = <span class="string">"org.apache.catalina.startup.Tomcat"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> TomcatServletWebServerFactoryCustomizer <span class="title">tomcatServletWebServerFactoryCustomizer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      ServerProperties serverProperties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TomcatServletWebServerFactoryCustomizer(serverProperties);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ....</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//注册重要的后置处理器类WebServerFactoryCustomizerBeanPostProcessor，在ioc容器启动的时候会调用后置处理器</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanPostProcessorsRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">BeanFactoryAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConfigurableListableBeanFactory beanFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置ConfigurableListableBeanFactory</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> ConfigurableListableBeanFactory) &#123;</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = (ConfigurableListableBeanFactory) beanFactory;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata,</span></span></span><br><span class="line"><span class="function"><span class="params">        BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      registerSyntheticBeanIfMissing(registry, <span class="string">"webServerFactoryCustomizerBeanPostProcessor"</span>,</span><br><span class="line">          WebServerFactoryCustomizerBeanPostProcessor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">      registerSyntheticBeanIfMissing(registry, <span class="string">"errorPageRegistrarBeanPostProcessor"</span>,</span><br><span class="line">          ErrorPageRegistrarBeanPostProcessor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerSyntheticBeanIfMissing</span><span class="params">(BeanDefinitionRegistry registry, String name, Class&lt;?&gt; beanClass)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (ObjectUtils.isEmpty(<span class="keyword">this</span>.beanFactory.getBeanNamesForType(beanClass, <span class="keyword">true</span>, <span class="keyword">false</span>))) &#123;</span><br><span class="line">        RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(beanClass);</span><br><span class="line">        beanDefinition.setSynthetic(<span class="keyword">true</span>);</span><br><span class="line">        registry.registerBeanDefinition(name, beanDefinition);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Springboot的ServletWebServerFactoryAutoConfiguration是嵌入式Servlet容器的自动配置类，这个类的主要作用是创建TomcatServletWebServerFactory工厂类，创建定制器类TomcatServletWebServerFactoryCustomizer，创建FilterRegistrationBean类，同时很关键的一步是注册后置处理器webServerFactoryCustomizerBeanPostProcessor，然后Springboot的Application类一启动，就会执行run方法，run经过一系列调用会通过ServletWebServerApplicationContext的onRefresh方法创建ioc容器，然后通过createWebServer方法，createWebServer方法会去ioc容器里扫描是否有对应的ServletWebServerFactory工厂类(TomcatServletWebServerFactory是其中一种)，扫描得到，就会触发webServerFactoryCustomizerBeanPostProcessor后置处理器类，这个处理器类会获取TomcatServletWebServerFactoryCustomizer定制器，并调用customize方法进行定制，这时候工厂类起作用，调用getWebServer方法进行Tomcat属性配置和引擎设置等等，再创建TomcatWebServer启动Tomcat容器</li>
</ul>
<ul>
<li>步骤：<ul>
<li>SpringBoot根据导入的后依赖情况该容器中添加相应的组件<br>ServletWebServerFactoryConfiguration【TomcatServletWebServerFactory】</li>
<li>容器中某个组件要创建对象就会惊动后处理器；(ServletWebServerFactoryAutoConfiguration类中)<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public static <span class="keyword">class</span> BeanPostProcessorsRegistrar implements ImportBeanDefinitionRegistrar, BeanFactoryAware &#123;</span><br><span class="line">    <span class="keyword">private</span> ConfigurableListableBeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">BeanPostProcessorsRegistrar()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void set<span class="constructor">BeanFactory(BeanFactory <span class="params">beanFactory</span>)</span> throws BeansException &#123;</span><br><span class="line">        <span class="keyword">if</span> (beanFactory instanceof ConfigurableListableBeanFactory) &#123;</span><br><span class="line">            this.beanFactory = (ConfigurableListableBeanFactory)beanFactory;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void register<span class="constructor">BeanDefinitions(AnnotationMetadata <span class="params">importingClassMetadata</span>, BeanDefinitionRegistry <span class="params">registry</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (this.beanFactory != null) &#123;</span><br><span class="line">            this.register<span class="constructor">SyntheticBeanIfMissing(<span class="params">registry</span>, <span class="string">"webServerFactoryCustomizerBeanPostProcessor"</span>, WebServerFactoryCustomizerBeanPostProcessor.<span class="params">class</span>)</span>;</span><br><span class="line">            this.register<span class="constructor">SyntheticBeanIfMissing(<span class="params">registry</span>, <span class="string">"errorPageRegistrarBeanPostProcessor"</span>, ErrorPageRegistrarBeanPostProcessor.<span class="params">class</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> void register<span class="constructor">SyntheticBeanIfMissing(BeanDefinitionRegistry <span class="params">registry</span>, String <span class="params">name</span>, Class&lt;?&gt; <span class="params">beanClass</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="module-access"><span class="module"><span class="identifier">ObjectUtils</span>.</span></span>is<span class="constructor">Empty(<span class="params">this</span>.<span class="params">beanFactory</span>.<span class="params">getBeanNamesForType</span>(<span class="params">beanClass</span>, <span class="params">true</span>, <span class="params">false</span>)</span>)) &#123;</span><br><span class="line">            RootBeanDefinition beanDefinition = <span class="keyword">new</span> <span class="constructor">RootBeanDefinition(<span class="params">beanClass</span>)</span>;</span><br><span class="line">            beanDefinition.set<span class="constructor">Synthetic(<span class="params">true</span>)</span>;</span><br><span class="line">            registry.register<span class="constructor">BeanDefinition(<span class="params">name</span>, <span class="params">beanDefinition</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>只要是嵌入式的Servlet容器工厂，后置处理器就工作</li>
<li>后置处理器，从容器中获取所有的定制器</li>
</ul>
</li>
</ul>
<h3 id="嵌入式Servlet启动原理；"><a href="#嵌入式Servlet启动原理；" class="headerlink" title="嵌入式Servlet启动原理；"></a>嵌入式Servlet启动原理；</h3><ul>
<li>什么时候创建嵌入式的servlet容器工厂？什么时候获取嵌入式的servlet容器并启动Tomcat;</li>
<li>获取嵌入式的Servlet容器工厂</li>
</ul>
<ol>
<li>SpringBoot应用启动运行run方法</li>
<li>refreshContext(context);SpringBoot刷新Ioc容器【创建IOC容器，并初始化容器，创建容器中的每一个组件】；如果是web应用创建  AnnotaionConfigEmbeddedWebApplicationContext;否则创建AnnotationConfigApplicationContext</li>
<li>refresh(context);刷新刚才创建好的IOC容器；</li>
<li>onRefresh();webIOC容器重写onRefresh()方法</li>
<li>webioc容器会创建嵌入式的Servlet容器；createServletContainer(); </li>
<li>获取嵌入式容器工厂    TomcatServletContainerFactory 创建对象，后置处理器一看是这个对象，就获取所有的的定制器来先定制servlet容器的相关配置</li>
<li>使用容器工厂获取嵌入式的Servlet容器 触发后处理器BeanPostProcessorsRegistrar</li>
<li>嵌入式的Servlet容器创建对象并启动Servlet容器<br>先启动嵌入式的Servlet容器，再将IOC容器中剩下没有创建出的对象获取出来；<br>Ioc容器启动创建嵌入式的Servlet容器<h3 id="使用外置的Servlet容器"><a href="#使用外置的Servlet容器" class="headerlink" title="使用外置的Servlet容器"></a>使用外置的Servlet容器</h3></li>
</ol>
<ul>
<li>外置的Servlet容器：外面安装的Tomcat–应用war包方式打包<ul>
<li>创建步骤：<ol>
<li>必须创建一个war项目(利用idea创建好目录结构)</li>
<li>在pom文件中将嵌入式的Tomcat指定为provided；<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>必须编写一个SpringBootServletInitializer的子类，并调用configure()方法<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">SpringApplicationBuilder</span> configure(<span class="type">SpringApplicationBuilder</span> application) &#123;</span><br><span class="line">    <span class="comment">//传入SpringBoot应用的主程序</span></span><br><span class="line">    <span class="keyword">return</span> application.sources(<span class="type">DemoWarApplication</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>启动服务器就可以使用<h4 id="使用SpringBoot创建向导快速创建（外置的Servlet容器）"><a href="#使用SpringBoot创建向导快速创建（外置的Servlet容器）" class="headerlink" title="使用SpringBoot创建向导快速创建（外置的Servlet容器）"></a>使用SpringBoot创建向导快速创建（外置的Servlet容器）</h4></li>
</ol>
</li>
</ul>
</li>
</ul>
<ol>
<li>File –》project–》Spring initializr</li>
<li>在packing中选择war包方式（默认jar）下一步创建项目</li>
<li>在Project structure下选择Models–》选中此项目–》web–》<ol start="4">
<li>在web Resource Directories下添加路径如“G:\IDEA\Maven-SpringBoot\demo-war\src\main\webapp” 自动创建此文件夹</li>
<li>创建web.xml文件 在Demployment Descriptors 下添加web.xml文件 路径“G:\IDEA\Maven-SpringBoot\demo-war\src\main\webapp\WEB-INF\web.xml”即可；</li>
</ol>
</li>
</ol>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>jar包:执行SpringBoot主类的main方法，启动IOC容器，创建嵌入式的Servlet容器；<br>war包；启动服务器，服务器启动SpringBoot应用【SpringBootServletinitializer】，启动IOC容器；</p>
<ul>
<li><p>规则</p>
<ul>
<li><p>1.服务器启动(web应用启动)会创建当前web应用里面每一个jar包里面ServletContainerIntialiservlet.Servletzer实例；</p>
</li>
<li><p>2.ServletContainitializer的实现类放在jar包的META-INF/services文件夹下，有一个名为javax.servlet.ServletContainitializer的文件，内容是ServletContainitializer的实现类全类名</p>
</li>
<li><p>3.还可以使用@HandlesTypes，在应用启动类的时候加载我们感兴趣的类；</p>
</li>
<li><p>流程：</p>
<ul>
<li>1.启动Tomcat</li>
<li>2.org\springframework\spring-web\5.2.2.RELEASE\spring-web-5.2.2.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializer<br>Spring的web模块里面有这个文件，其内容就是“org.springframework.web.SpringServletContainerInitializer”</li>
<li>3.SpringServletContainerInitializer将@HandlesTypes({WebApplicationInitializer.class})标注的所有这个类型的类都是传入到onStarup方法 Set&lt;Class&lt;?&gt;&gt;集合里面（不是接口类，不是抽象类），为WebApplicationInitializer这个类型的类创建实例<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@<span class="constructor">HandlesTypes(&#123;WebApplicationInitializer.<span class="params">class</span>&#125;)</span></span><br><span class="line">public <span class="keyword">class</span> SpringServletContainerInitializer implements ServletContainerInitializer &#123;</span><br><span class="line">    public <span class="constructor">SpringServletContainerInitializer()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void on<span class="constructor">Startup(@Nullable Set&lt;Class&lt;?&gt;&gt; <span class="params">webAppInitializerClasses</span>, ServletContext <span class="params">servletContext</span>)</span> throws ServletException &#123;</span><br><span class="line">        List&lt;WebApplicationInitializer&gt; initializers = <span class="keyword">new</span> <span class="constructor">LinkedList()</span>;</span><br><span class="line">        Iterator var4;</span><br><span class="line">        <span class="keyword">if</span> (webAppInitializerClasses != null) &#123;</span><br><span class="line">            var4 = webAppInitializerClasses.iterator<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var4.has<span class="constructor">Next()</span>) &#123;</span><br><span class="line">                Class&lt;?&gt; waiClass = (Class)var4.next<span class="literal">()</span>;</span><br><span class="line">                <span class="keyword">if</span> (!waiClass.is<span class="constructor">Interface()</span><span class="operator"> &amp;&amp; </span>!<span class="module-access"><span class="module"><span class="identifier">Modifier</span>.</span></span>is<span class="constructor">Abstract(<span class="params">waiClass</span>.<span class="params">getModifiers</span>()</span>)<span class="operator"> &amp;&amp; </span><span class="module-access"><span class="module"><span class="identifier">WebApplicationInitializer</span>.</span></span><span class="keyword">class</span>.is<span class="constructor">AssignableFrom(<span class="params">waiClass</span>)</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        initializers.add((WebApplicationInitializer)<span class="module-access"><span class="module"><span class="identifier">ReflectionUtils</span>.</span></span>accessible<span class="constructor">Constructor(<span class="params">waiClass</span>, <span class="params">new</span> Class[0])</span>.<span class="keyword">new</span><span class="constructor">Instance()</span>);</span><br><span class="line">                    &#125; catch (Throwable var7) &#123;</span><br><span class="line">                        throw <span class="keyword">new</span> <span class="constructor">ServletException(<span class="string">"Failed to instantiate WebApplicationInitializer class"</span>, <span class="params">var7</span>)</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (initializers.is<span class="constructor">Empty()</span>) &#123;</span><br><span class="line">            servletContext.log(<span class="string">"No Spring WebApplicationInitializer types detected on classpath"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            servletContext.log(initializers.size<span class="literal">()</span> + <span class="string">" Spring WebApplicationInitializers detected on classpath"</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">AnnotationAwareOrderComparator</span>.</span></span>sort(initializers);</span><br><span class="line">            var4 = initializers.iterator<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var4.has<span class="constructor">Next()</span>) &#123;</span><br><span class="line">                WebApplicationInitializer initializer = (WebApplicationInitializer)var4.next<span class="literal">()</span>;</span><br><span class="line">                initializer.on<span class="constructor">Startup(<span class="params">servletContext</span>)</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>4.每一个 WebApplicationInitializer都调用自己的onStartup()方法<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>WebApplicationInitializer &#123;</span><br><span class="line">    void onStartup(ServletContext var1) throws ServletException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>5.相当于我们的SpringBootServletInitializer(WebApplicationInitializer的实现类)的类会被创建对象，并执行onStartup方法 .</li>
<li>6.SpringBootServletInitializer实例 执行onStartup的时候会createRootApplicationContext；创建容器<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootServletInitializer</span> <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.logger = LogFactory.getLog(<span class="keyword">this</span>.getClass());</span><br><span class="line">    WebApplicationContext rootAppContext = <span class="keyword">this</span>.createRootApplicationContext(servletContext);</span><br><span class="line">    <span class="keyword">if</span> (rootAppContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">        servletContext.addListener(<span class="keyword">new</span> ContextLoaderListener(rootAppContext) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent event)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.debug(<span class="string">"No ContextLoaderListener registered, as createRootApplicationContext() did not return an application context"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>7.创建容器方法<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public abstract <span class="keyword">class</span> SpringBootServletInitializer implements WebApplicationInitializer &#123;</span><br><span class="line"></span><br><span class="line">  ......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> protected WebApplicationContext create<span class="constructor">RootApplicationContext(ServletContext <span class="params">servletContext</span>)</span> &#123;</span><br><span class="line">   <span class="comment">//创建SpringApplicationBuilder(Spring应用的构建器)</span></span><br><span class="line">     SpringApplicationBuilder builder = this.create<span class="constructor">SpringApplicationBuilder()</span>;</span><br><span class="line">     builder.main(this.get<span class="constructor">Class()</span>);</span><br><span class="line">     ApplicationContext parent = this.get<span class="constructor">ExistingRootWebApplicationContext(<span class="params">servletContext</span>)</span>;</span><br><span class="line">     <span class="keyword">if</span> (parent != null) &#123;</span><br><span class="line">         this.logger.info(<span class="string">"Root context already created (using as parent)."</span>);</span><br><span class="line">         servletContext.set<span class="constructor">Attribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, (Object)</span>null);</span><br><span class="line">         builder.initializers(<span class="keyword">new</span> ApplicationContextInitializer<span class="literal">[]</span>&#123;<span class="keyword">new</span> <span class="constructor">ParentContextApplicationContextInitializer(<span class="params">parent</span>)</span>&#125;);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     builder.initializers(<span class="keyword">new</span> ApplicationContextInitializer<span class="literal">[]</span>&#123;<span class="keyword">new</span> <span class="constructor">ServletContextApplicationContextInitializer(<span class="params">servletContext</span>)</span>&#125;);</span><br><span class="line">     builder.context<span class="constructor">Class(AnnotationConfigServletWebServerApplicationContext.<span class="params">class</span>)</span>;</span><br><span class="line">     <span class="comment">//调用configure方法，子类重写了这个方法，将springBoot的主程序类传了进来</span></span><br><span class="line">     builder = this.configure(builder);</span><br><span class="line">     builder.listeners(<span class="keyword">new</span> ApplicationListener<span class="literal">[]</span>&#123;<span class="keyword">new</span> SpringBootServletInitializer.<span class="constructor">WebEnvironmentPropertySourceInitializer(<span class="params">servletContext</span>)</span>&#125;);</span><br><span class="line">     <span class="comment">//使用builder创建一个Spring应用</span></span><br><span class="line">     SpringApplication application = builder.build<span class="literal">()</span>;</span><br><span class="line">     <span class="keyword">if</span> (application.get<span class="constructor">AllSources()</span>.is<span class="constructor">Empty()</span><span class="operator"> &amp;&amp; </span><span class="module-access"><span class="module"><span class="identifier">MergedAnnotations</span>.</span></span>from(this.get<span class="constructor">Class()</span>, SearchStrategy.TYPE_HIERARCHY).is<span class="constructor">Present(Configuration.<span class="params">class</span>)</span>) &#123;</span><br><span class="line">         application.add<span class="constructor">PrimarySources(Collections.<span class="params">singleton</span>(<span class="params">this</span>.<span class="params">getClass</span>()</span>));</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="module-access"><span class="module"><span class="identifier">Assert</span>.</span></span>state(!application.get<span class="constructor">AllSources()</span>.is<span class="constructor">Empty()</span>, <span class="string">"No SpringApplication sources have been defined. Either override the configure method or add an @Configuration annotation"</span>);</span><br><span class="line">     <span class="keyword">if</span> (this.registerErrorPageFilter) &#123;</span><br><span class="line">         application.add<span class="constructor">PrimarySources(Collections.<span class="params">singleton</span>(ErrorPageFilterConfiguration.<span class="params">class</span>)</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//启动Spring应用</span></span><br><span class="line">     return this.run(application);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) &#123;</span><br><span class="line">   return builder;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.<span class="type">SpringApplicationBuilder</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.support.<span class="type">SpringBootServletInitializer</span>;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//重写了Configure方法，把SpringBoot的主程序类加了进去</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">SpringApplicationBuilder</span> configure(<span class="type">SpringApplicationBuilder</span> application) &#123;</span><br><span class="line">    <span class="keyword">return</span> application.sources(<span class="type">DemoWarApplication</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>8.Spring的应用就启动并创建IOC容器<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public ConfigurableApplicationContext run(String... args) &#123;</span><br><span class="line">    StopWatch stopWatch = <span class="keyword">new</span> <span class="constructor">StopWatch()</span>;</span><br><span class="line">    stopWatch.start<span class="literal">()</span>;</span><br><span class="line">    ConfigurableApplicationContext context = null;</span><br><span class="line">    Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> <span class="constructor">ArrayList()</span>;</span><br><span class="line">    this.configure<span class="constructor">HeadlessProperty()</span>;</span><br><span class="line">    SpringApplicationRunListeners listeners = this.get<span class="constructor">RunListeners(<span class="params">args</span>)</span>;</span><br><span class="line">    listeners.starting<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">    Collection exceptionReporters;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ApplicationArguments applicationArguments = <span class="keyword">new</span> <span class="constructor">DefaultApplicationArguments(<span class="params">args</span>)</span>;</span><br><span class="line">        ConfigurableEnvironment environment = this.prepare<span class="constructor">Environment(<span class="params">listeners</span>, <span class="params">applicationArguments</span>)</span>;</span><br><span class="line">        this.configure<span class="constructor">IgnoreBeanInfo(<span class="params">environment</span>)</span>;</span><br><span class="line">        Banner printedBanner = this.print<span class="constructor">Banner(<span class="params">environment</span>)</span>;</span><br><span class="line">        context = this.create<span class="constructor">ApplicationContext()</span>;</span><br><span class="line">        exceptionReporters = this.get<span class="constructor">SpringFactoriesInstances(SpringBootExceptionReporter.<span class="params">class</span>, <span class="params">new</span> Class[]&#123;ConfigurableApplicationContext.<span class="params">class</span>&#125;, <span class="params">context</span>)</span>;</span><br><span class="line">        this.prepare<span class="constructor">Context(<span class="params">context</span>, <span class="params">environment</span>, <span class="params">listeners</span>, <span class="params">applicationArguments</span>, <span class="params">printedBanner</span>)</span>;</span><br><span class="line">        <span class="comment">//刷新IOC容器</span></span><br><span class="line">        this.refresh<span class="constructor">Context(<span class="params">context</span>)</span>;</span><br><span class="line">        this.after<span class="constructor">Refresh(<span class="params">context</span>, <span class="params">applicationArguments</span>)</span>;</span><br><span class="line">        stopWatch.stop<span class="literal">()</span>;</span><br><span class="line">        <span class="keyword">if</span> (this.logStartupInfo) &#123;</span><br><span class="line">            (<span class="keyword">new</span> <span class="constructor">StartupInfoLogger(<span class="params">this</span>.<span class="params">mainApplicationClass</span>)</span>).log<span class="constructor">Started(<span class="params">this</span>.<span class="params">getApplicationLog</span>()</span>, stopWatch);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        listeners.started(context);</span><br><span class="line">        this.call<span class="constructor">Runners(<span class="params">context</span>, <span class="params">applicationArguments</span>)</span>;</span><br><span class="line">    &#125; catch (Throwable var10) &#123;</span><br><span class="line">        this.handle<span class="constructor">RunFailure(<span class="params">context</span>, <span class="params">var10</span>, <span class="params">exceptionReporters</span>, <span class="params">listeners</span>)</span>;</span><br><span class="line">        throw <span class="keyword">new</span> <span class="constructor">IllegalStateException(<span class="params">var10</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        listeners.running(context);</span><br><span class="line">        return context;</span><br><span class="line">    &#125; catch (Throwable var9) &#123;</span><br><span class="line">        this.handle<span class="constructor">RunFailure(<span class="params">context</span>, <span class="params">var9</span>, <span class="params">exceptionReporters</span>, (SpringApplicationRunListeners)</span>null);</span><br><span class="line">        throw <span class="keyword">new</span> <span class="constructor">IllegalStateException(<span class="params">var9</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>先启动Sevlet容器，在启动SpringBoot应用(与之相反)</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot微服务框架(三)</title>
    <url>/2020/01/04/SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-%E4%B8%89/</url>
    <content><![CDATA[<h3 id="配置debug-true，控制台打印自动配置报告"><a href="#配置debug-true，控制台打印自动配置报告" class="headerlink" title="配置debug=true，控制台打印自动配置报告"></a>配置debug=true，控制台打印自动配置报告</h3><h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><h4 id="日志框架"><a href="#日志框架" class="headerlink" title="日志框架"></a>日志框架</h4><table>
<thead>
<tr>
<th>日志门面(日志的抽象层)</th>
<th align="center">日志实现</th>
</tr>
</thead>
<tbody><tr>
<td>slf4j</td>
<td align="center">Log4j jul(java.util.logging) log4j2 logback</td>
</tr>
</tbody></table>
<ul>
<li>springBoot底层是Spring框架，Spring默认的是JCL(commons-loggin.jar );</li>
<li>springBoot选用slf4j和logback</li>
</ul>
<h3 id="slf4j的使用"><a href="#slf4j的使用" class="headerlink" title="slf4j的使用"></a>slf4j的使用</h3><ul>
<li>开发的时候，日志方法的调用，不应该直接调用日志的实现类，<br>而是调用日志抽象层里面的方法;</li>
</ul>
<ol>
<li>导包slf4j的jar包和logback实现的jar包；<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Main &#123;</span><br><span class="line">   final Logger logger = <span class="module-access"><span class="module"><span class="identifier">LoggerFactory</span>.</span></span>get<span class="constructor">Logger(<span class="params">getClass</span>()</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 日志操作对象</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   Logger logger = <span class="module-access"><span class="module"><span class="identifier">LoggerFactory</span>.</span></span>get<span class="constructor">Logger(CommonController.<span class="params">class</span>)</span>;</span><br></pre></td></tr></table></figure>
图示:<br><img src="http://www.slf4j.org/images/concrete-bindings.png" alt="slf4j"></li>
</ol>
<ul>
<li>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，配置文件还是做成日志实现框架自己本身的配置文件；</li>
<li>遗留问题<ul>
<li>SpringBoot(slf4j+logback)</li>
<li>Spring(commons-logging)</li>
<li>Hibernate(jboss-logging).等</li>
</ul>
</li>
</ul>
<ul>
<li>统一日志记录，即使是别的框架和我一起使用slf4j+logback进行输出<br>图示:<br><img src="http://www.slf4j.org/images/legacy.png" alt="统一日志记录"><h5 id="如何在系统中所有的日志都统一到slf4j；"><a href="#如何在系统中所有的日志都统一到slf4j；" class="headerlink" title="如何在系统中所有的日志都统一到slf4j；"></a>如何在系统中所有的日志都统一到slf4j；</h5><ul>
<li>1.将系统中其他的日志框架先排除；</li>
<li>2.用中间包类替换原有的日志框架；</li>
<li>3.我们导入slf4j其他的实现<h3 id="springBoot日志关系"><a href="#springBoot日志关系" class="headerlink" title="springBoot日志关系"></a>springBoot日志关系</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li>springBoot使用他来做日志功能：<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>总结：<ul>
<li>1.SpringBoot底层也是使用slf4j+logback的方式记录日志</li>
<li>2.SpringBoot也把替他的日志都替换成了slf4j</li>
<li>3.中间替换包？<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jul-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>如果我们要引入其他框架？一定要把这个框架的默认依赖移除掉<br>Spring框架日志文件（commons-logging）<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>注意：SpringBoot能自动适配所有的日志，而且底层使用slfj+logback的方式记录日志，引入其他框架的时候，只需要把这个框架的依赖日志排除</li>
<li>加上Log4j2日志框架依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">package</span> com.zhao;</span><br><span class="line"> <span class="keyword">import</span> org.junit.jupiter.api.<span class="type">Test</span>;</span><br><span class="line"> <span class="keyword">import</span> org.junit.runner.<span class="type">RunWith</span>;</span><br><span class="line"> <span class="keyword">import</span> org.slf4j.<span class="type">Logger</span>;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.boot.test.context.<span class="type">SpringBootTest</span>;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.test.context.junit4.<span class="type">SpringRunner</span>;</span><br><span class="line"> <span class="keyword">import</span> org.slf4j.<span class="type">LoggerFactory</span>;</span><br><span class="line"> &lt;!-- 注意：</span><br><span class="line"> 添加注解：<span class="meta">@RunWith</span>(<span class="type">SpringRunner</span><span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"> <span class="title">导入的包：org</span>.<span class="title">springframework</span>.<span class="title">test</span>.<span class="title">context</span>.<span class="title">junit4</span>.<span class="title">SpringRunner</span></span>;</span><br><span class="line"> 添加记录器工厂  <span class="type">LoggerFactory</span> </span><br><span class="line"> 导入的包：org.slf4j.<span class="type">LoggerFactory</span>;--&gt;</span><br><span class="line"> <span class="meta">@RunWith</span>(<span class="type">SpringRunner</span><span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"> <span class="title">@SpringBootTest</span></span></span><br><span class="line"><span class="class"> <span class="title">class</span> <span class="title">DemoTest03ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//记录器</span></span><br><span class="line">	<span class="keyword">final</span> <span class="type">Logger</span> logger = <span class="type">LoggerFactory</span>.getLogger(getClass());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	void contextLoads() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//日志级别</span></span><br><span class="line">		<span class="comment">//由高到底 trace&lt;debug&lt;info&lt;wran&lt;error</span></span><br><span class="line"></span><br><span class="line">		logger.trace(<span class="string">"这是trace日志。。。。"</span>);</span><br><span class="line">		logger.debug(<span class="string">"这是debug调试日志。。。。"</span>);</span><br><span class="line">		logger.info(<span class="string">"这是info日志。。。。。"</span>);</span><br><span class="line">		logger.warn(<span class="string">"这是警告wran日志。。。。"</span>);</span><br><span class="line">		<span class="comment">//SpringBoot默认Info级别</span></span><br><span class="line">		<span class="comment">//可以调正输出的日志级别：日志就只会在这个级别以后的级别高级别生效</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 *trace：追踪，就是程序推进一下，可以写个trace输出</span></span><br><span class="line"><span class="comment">		 *debug：调试，一般作为最低级别，trace基本不用。</span></span><br><span class="line"><span class="comment">		 *info：输出重要的信息，使用较多</span></span><br><span class="line"><span class="comment">		 *warn：警告，有些信息不是错误信息，但也要给程序员一些提示。</span></span><br><span class="line"><span class="comment">		 *error：错误信息。用的也很多。</span></span><br><span class="line"><span class="comment">		 *fatal：致命错误。</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="指定日志的输出位置"><a href="#指定日志的输出位置" class="headerlink" title="指定日志的输出位置"></a>指定日志的输出位置</h3><ul>
<li>properties文件中配置<br>logging.level.com.atguigu=trace<br>第一种方式：<br>//在当前磁盘的根路径下创建spring文件夹和里面的log文件夹，默认生成spring.log日志文件<br>logging.path=/spring/log<br>第二种方式：<br>//当前项目下生成springboot.log日志文件<br>loging.file=springboot.log<br>第三种方式：<br>//指定路径下生成springboot.log日志文件<br>loging.file=G:/springboot.log<br>第四种方式：<br>//在控制台输出日志的格式<br>logging.pattern.console=%d{yyyy-MM-dd HH-mm-ss.SSS} [%thread] %-5level %logger{50} - %msg%n<br>// 指定文件中日志的输出格式<br>logging.pattern.file=<h3 id="日志的输出格式："><a href="#日志的输出格式：" class="headerlink" title="日志的输出格式："></a>日志的输出格式：</h3><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">d</span></span>表示日期时间</span><br><span class="line"><span class="tag">%<span class="selector-tag">thread</span></span>表示当前线程</span><br><span class="line"><span class="tag">%</span>-5level：级别从左显示5个字符宽度</span><br><span class="line"><span class="tag">%<span class="selector-tag">logger</span>&#123;50&#125;</span>：表示logger&#123;50&#125;名字最长50个字符，否则按照据点分割；</span><br><span class="line"><span class="tag">%<span class="selector-tag">msg</span></span>：日志消息</span><br><span class="line"><span class="tag">%<span class="selector-tag">n</span></span>：换行符</span><br><span class="line"><span class="tag">%<span class="selector-tag">d</span>&#123;yyyy-MM-dd HH-mm-ss.SSS&#125;</span> [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><br></pre></td></tr></table></figure></li>
<li>自定义日志</li>
</ul>
<table>
<thead>
<tr>
<th>logging System（日志框架)</th>
<th align="center">Customization</th>
</tr>
</thead>
<tbody><tr>
<td>logback</td>
<td align="center">logback-spring.xml , logback-spring.groovy , logback.xml or logback.groovy</td>
</tr>
<tr>
<td>Logf4j</td>
<td align="center">log4j-spring.xml or logf4j.xml</td>
</tr>
<tr>
<td>JDK(java util Logging)</td>
<td align="center">logging.properties</td>
</tr>
</tbody></table>
<ul>
<li>logback.xml:直接被日志框架识别了</li>
<li>ligback-spring.xml：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用高级Profile功能，否则会报错</li>
<li>高级功能<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">  可以直接指定某段配置只有某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下报错<br>  no applicable action for [springProfile 888]</li>
</ul>
<h3 id="切换日志框架"><a href="#切换日志框架" class="headerlink" title="切换日志框架"></a>切换日志框架</h3><ul>
<li><p>可以按照slf4j的日志适配图，进行相关的切换</p>
<h3 id="web开发"><a href="#web开发" class="headerlink" title="web开发"></a>web开发</h3></li>
<li><p>SpringBoot对静态资源的映射规则（WebMvcAutoConfiguration）</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//访问路径配置</span></span><br><span class="line"> public void add<span class="constructor">ResourceHandlers(ResourceHandlerRegistry <span class="params">registry</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!this.resourceProperties.is<span class="constructor">AddMappings()</span>) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Duration cachePeriod = this.resourceProperties.get<span class="constructor">Cache()</span>.get<span class="constructor">Period()</span>;</span><br><span class="line">                CacheControl cacheControl = this.resourceProperties.get<span class="constructor">Cache()</span>.get<span class="constructor">Cachecontrol()</span>.<span class="keyword">to</span><span class="constructor">HttpCacheControl()</span>;</span><br><span class="line">                <span class="keyword">if</span> (!registry.has<span class="constructor">MappingForPattern(<span class="string">"/webjars/**"</span>)</span>) &#123;</span><br><span class="line">                    this.customize<span class="constructor">ResourceHandlerRegistration(<span class="params">registry</span>.<span class="params">addResourceHandler</span>(<span class="params">new</span> String[]&#123;<span class="string">"/webjars/**"</span>&#125;)</span>.add<span class="constructor">ResourceLocations(<span class="params">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/webjars/"</span>&#125;)</span>.set<span class="constructor">CachePeriod(<span class="params">this</span>.<span class="params">getSeconds</span>(<span class="params">cachePeriod</span>)</span>).set<span class="constructor">CacheControl(<span class="params">cacheControl</span>)</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String staticPathPattern = this.mvcProperties.get<span class="constructor">StaticPathPattern()</span>;</span><br><span class="line">                <span class="keyword">if</span> (!registry.has<span class="constructor">MappingForPattern(<span class="params">staticPathPattern</span>)</span>) &#123;</span><br><span class="line">                    this.customize<span class="constructor">ResourceHandlerRegistration(<span class="params">registry</span>.<span class="params">addResourceHandler</span>(<span class="params">new</span> String[]&#123;<span class="params">staticPathPattern</span>&#125;)</span>.add<span class="constructor">ResourceLocations(WebMvcAutoConfiguration.<span class="params">getResourceLocations</span>(<span class="params">this</span>.<span class="params">resourceProperties</span>.<span class="params">getStaticLocations</span>()</span>)).set<span class="constructor">CachePeriod(<span class="params">this</span>.<span class="params">getSeconds</span>(<span class="params">cachePeriod</span>)</span>).set<span class="constructor">CacheControl(<span class="params">cacheControl</span>)</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//首页配置</span></span><br><span class="line">         @Bean</span><br><span class="line">        public WelcomePageHandlerMapping welcome<span class="constructor">PageHandlerMapping(ApplicationContext <span class="params">applicationContext</span>, FormattingConversionService <span class="params">mvcConversionService</span>, ResourceUrlProvider <span class="params">mvcResourceUrlProvider</span>)</span> &#123;</span><br><span class="line">            WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> <span class="constructor">WelcomePageHandlerMapping(<span class="params">new</span> TemplateAvailabilityProviders(<span class="params">applicationContext</span>)</span>, applicationContext, this.get<span class="constructor">WelcomePage()</span>, this.mvcProperties.get<span class="constructor">StaticPathPattern()</span>);</span><br><span class="line">            welcomePageHandlerMapping.set<span class="constructor">Interceptors(<span class="params">this</span>.<span class="params">getInterceptors</span>(<span class="params">mvcConversionService</span>, <span class="params">mvcResourceUrlProvider</span>)</span>);</span><br><span class="line">            return welcomePageHandlerMapping;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>1.所有/webjars/**，都去classpath:/META-INF/resources/webjars/这里找资源<br>webjars：以jar包的方式引入静态资源；<br>网站<a href="http://www.webjars.org" target="_blank" rel="noopener">www.webjars.org</a><br>在pom.xml文件中引入webjars依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">	<span class="comment">&lt;!--引入Jquery的Webjar--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问的时候只需要写webjars下面的资源名称即可<br>下面在<a href="http://localhost:8080/webjars/jquery/3.3.1/jquery.js就可访问的到" target="_blank" rel="noopener">http://localhost:8080/webjars/jquery/3.3.1/jquery.js就可访问的到</a></p>
</li>
<li><p>2.”/**”访问当前项目的任何资源(静态资源的文件夹)</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span></span><br><span class="line"> <span class="keyword">String</span>[] CLASSPATH_RESOURCE_LOCATIONS = <span class="keyword">new</span> <span class="keyword">String</span>[]&#123;</span><br><span class="line">   <span class="string">"classpath:/META-INF/resources/"</span>, </span><br><span class="line">   <span class="string">"classpath:/resources/"</span>, </span><br><span class="line">   <span class="string">"classpath:/static/"</span>, </span><br><span class="line">   <span class="string">"classpath:/public/"</span>&#125;;</span><br></pre></td></tr></table></figure></li>
<li><ol start="3">
<li>首页：静态资源文件夹下的所有index.html页面，被”/**”映射<br>localhost:8080/   找到index页面</li>
</ol>
</li>
<li><p>4.图标：所有**/favicon.ico都在静态资源文件夹下找；</p>
<h3 id="静态文件夹配置"><a href="#静态文件夹配置" class="headerlink" title="静态文件夹配置"></a>静态文件夹配置</h3></li>
<li><p>定义静态文件夹SpringBoot默认的静态文件夹不生效</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#数组</span><br><span class="line">spring.resources.<span class="keyword">static</span>-locations=<span class="keyword">classpath</span>:<span class="regexp">/webapp/</span>,<span class="keyword">classpath</span>:<span class="regexp">/page/</span></span><br></pre></td></tr></table></figure>
<h3 id="模板引擎Thymeleaf"><a href="#模板引擎Thymeleaf" class="headerlink" title="模板引擎Thymeleaf"></a>模板引擎Thymeleaf</h3></li>
<li><p>1.引入模板引擎thymeleaf：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--引入Thymeleaf模块引擎--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>2.Thymeleaf使用和语法</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line">@ConfigurationProperties(</span><br><span class="line">   prefix = <span class="string">"spring.thymeleaf"</span></span><br><span class="line">)</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> prefix = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">   <span class="comment">//只要我们把Html页面放在classparh：/templates/下就可以自动渲染渲染</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> suffix = <span class="string">".html"</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> mode = <span class="string">"HTML"</span>;</span><br><span class="line">   <span class="keyword">private</span> Charset encoding;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> cache;</span><br><span class="line">   <span class="keyword">private</span> Integer templateResolverOrder;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span>[] viewNames;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span>[] excludedViewNames;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> enableSpringElCompiler;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> renderHiddenMarkersBeforeCheckboxes;</span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">boolean</span> enabled;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ThymeleafProperties.Servlet servlet;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ThymeleafProperties.Reactive reactive;</span><br></pre></td></tr></table></figure>
<h3 id="Html文件位置在templates文件夹下"><a href="#Html文件位置在templates文件夹下" class="headerlink" title="Html文件位置在templates文件夹下"></a>Html文件位置在templates文件夹下</h3></li>
<li><p>1.导入Thymeleaf名称空间xmlns:th=”<a href="http://www.thymeleaf.org&quot;" target="_blank" rel="noopener">http://www.thymeleaf.org&quot;</a></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;html <span class="attribute">lang</span>=<span class="string">"en"</span> xmlns:<span class="attribute">th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>2.不经过控制层controller不显示数据，只显示前台页面有的数据</p>
</li>
<li><p>3.语法规则</p>
<ul>
<li>3.1 th:text;改变当前元素的文本内容<pre><code>th:任意html属性，来替换原生属性的值</code></pre></li>
</ul>
</li>
<li><p>4.表达式</p>
<ul>
<li>4.1 语法<figure class="highlight nimrod"><table><tr><td class="code"><pre><span class="line"><span class="type">Simple</span> expressions:(表达式语法)</span><br><span class="line">      <span class="type">Variable</span> <span class="type">Expressions</span>: $<span class="meta">&#123;...&#125;</span> 获取变量值：<span class="type">OGNL</span></span><br><span class="line">               <span class="number">1</span>. 获取对象的属性，调用方法</span><br><span class="line">               <span class="number">2</span>. 使用内置的基本对象</span><br><span class="line">                  <span class="comment">#ctx : the context object. 当前上下文文对象</span></span><br><span class="line">                  <span class="comment">#vars: the context variables.  当前上下文变量值</span></span><br><span class="line">                  <span class="comment">#locale : the context locale.  当前上下文区域信息</span></span><br><span class="line">                  <span class="comment">#request : (only in Web Contexts) the HttpServletRequest object. </span></span><br><span class="line">                  <span class="comment">#response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line">                  <span class="comment">#session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line">                  <span class="comment">#servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                <span class="number">3</span>. 内置工具对象</span><br><span class="line">                    <span class="comment">#execInfo : information about the template  being processed.</span></span><br><span class="line">                    <span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they</span></span><br><span class="line">                    would be obtained <span class="keyword">using</span> <span class="comment">#&#123;…&#125; syntax.</span></span><br><span class="line">                    <span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line">                    <span class="type">Page</span> <span class="number">20</span> <span class="keyword">of</span> <span class="number">106</span></span><br><span class="line">                    <span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line">                    <span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line">                    <span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line">                    <span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line">                    <span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line">                    <span class="comment">#objects : methods for objects in general.</span></span><br><span class="line">                    <span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line">                    <span class="comment">#arrays : methods for arrays.</span></span><br><span class="line">                    <span class="comment">#lists : methods for lists.</span></span><br><span class="line">                    <span class="comment">#sets : methods for sets.</span></span><br><span class="line">                    <span class="comment">#maps : methods for maps.</span></span><br><span class="line">                    <span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line">                    <span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">      <span class="type">Selection</span> <span class="type">Variable</span> <span class="type">Expressions</span>: *<span class="meta">&#123;...&#125;</span> 变量选择表达式</span><br><span class="line">      和$&#123;&#125;在功能上是一样的</span><br><span class="line">      补充：配合th:<span class="keyword">object</span>=<span class="string">"$&#123;session.user&#125;"</span> 使用 th:text=<span class="string">"*&#123;name&#125;"</span>  *相当于$&#123;session.user&#125;</span><br><span class="line">      &lt;<span class="keyword">div</span> th:<span class="keyword">object</span>=<span class="string">"$&#123;session.user&#125;"</span>&gt;</span><br><span class="line">          &lt;p&gt;<span class="type">Name</span>: &lt;span th:text=<span class="string">"*&#123;firstName&#125;"</span>&gt;<span class="type">Sebastian</span>&lt;/span&gt;.&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;<span class="type">Surname</span>: &lt;span th:text=<span class="string">"*&#123;lastName&#125;"</span>&gt;<span class="type">Pepper</span>&lt;/span&gt;.&lt;/p&gt;</span><br><span class="line">      &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">      <span class="type">Message</span> <span class="type">Expressions</span>: <span class="comment">#&#123;...&#125; 获取国际化内容</span></span><br><span class="line">      <span class="type">Link</span> <span class="type">URL</span> <span class="type">Expressions</span>: @<span class="meta">&#123;...&#125;</span> 定义url链接</span><br><span class="line">      <span class="type">Fragment</span> <span class="type">Expressions</span>: ~<span class="meta">&#123;...&#125;</span> 片段引用表达式</span><br><span class="line"><span class="type">Literals</span>：(字面量)</span><br><span class="line">    <span class="type">Text</span> literals: 'one text' , '<span class="type">Another</span> one!' ,…</span><br><span class="line">    <span class="type">Number</span> literals: <span class="number">0</span> , <span class="number">34</span> , <span class="number">3</span>.<span class="number">0</span> , <span class="number">12</span>.<span class="number">3</span> ,…</span><br><span class="line">    <span class="type">Boolean</span> literals: <span class="literal">true</span> , <span class="literal">false</span></span><br><span class="line">    <span class="type">Null</span> literal: null</span><br><span class="line">    <span class="type">Literal</span> tokens: one , sometext , main ,…</span><br><span class="line"><span class="type">Text</span> operations:(文本操作)</span><br><span class="line">    <span class="type">String</span> concatenation: +</span><br><span class="line">    <span class="type">Literal</span> substitutions: |<span class="type">The</span> name <span class="keyword">is</span> $&#123;name&#125;|</span><br><span class="line"><span class="type">Arithmetic</span> operations:</span><br><span class="line">    <span class="type">Binary</span> operators: + , - , * , / , %</span><br><span class="line">    <span class="type">Minus</span> sign (unary operator): -</span><br><span class="line"><span class="type">Boolean</span> operations:（布尔运算）</span><br><span class="line">    <span class="type">Binary</span> operators: <span class="keyword">and</span> , <span class="keyword">or</span></span><br><span class="line">    <span class="type">Boolean</span> negation (unary operator): ! , <span class="keyword">not</span></span><br><span class="line"><span class="type">Comparisons</span> <span class="keyword">and</span> equality:（比较运算）</span><br><span class="line">    <span class="type">Comparators</span>: &gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span><br><span class="line">    <span class="type">Equality</span> operators: == , != ( eq , ne )</span><br><span class="line"><span class="type">Conditional</span> operators:(条件运算)</span><br><span class="line">    <span class="type">If</span>-then: (<span class="keyword">if</span>) ? (then)</span><br><span class="line">    <span class="type">If</span>-then-<span class="keyword">else</span>: (<span class="keyword">if</span>) ? (then) : (<span class="keyword">else</span>)</span><br><span class="line">    <span class="type">Default</span>: (value) ?: (defaultvalue)</span><br><span class="line"><span class="type">Special</span> tokens:</span><br><span class="line">    <span class="type">Page</span> <span class="number">17</span> <span class="keyword">of</span> <span class="number">106</span></span><br><span class="line">    <span class="type">No</span>-<span class="type">Operation</span>: _</span><br></pre></td></tr></table></figure>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3></li>
<li>1.html代码<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!--导入thymelesf名称空间作用语法提示</span></span></span><br><span class="line"><span class="xml">  xmlns:th="http://www.thymeleaf.org"--&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>成佛那个！<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- th:text="$</span></span><span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment">" 件div里面的文件内容设置为指定的内容--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;hello&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;hello&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> //utext不会转移</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--th:each=""每次遍历都会生成当前这个标签 3个h4--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">th:text</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;user&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">th:each</span>=<span class="string">"user:$</span></span></span><span class="template-variable">&#123;users&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!----&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">"user:$</span></span></span><span class="template-variable">&#123;users&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>[[$</span><span class="template-variable">&#123;user&#125;</span><span class="xml">]]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>2.Controllor控制层<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">@Controller</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*    @RequestMapping(&#123;"/","/login.html"&#125;)</span></span><br><span class="line"><span class="comment">    public String index()&#123;</span></span><br><span class="line"><span class="comment">        return "login";</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    @ResponseBody</span><br><span class="line">    @RequestMapping(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查出一些数据在页面显示</span></span><br><span class="line">    @RequestMapping(<span class="string">"/success"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">success</span><span class="params">(Map&lt;<span class="keyword">String</span>,Object&gt; <span class="built_in">map</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"hello"</span>,<span class="string">"&lt;h1&gt;你好！&lt;/h1&gt;"</span>);</span><br><span class="line">        <span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"users"</span>,Arrays.asList(<span class="string">"沐沐"</span>,<span class="string">"离奇"</span>,<span class="string">"哈克"</span>));</span><br><span class="line">        <span class="comment">//classpath:/templates/success.html</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何修改SpringBoot的默认配置"><a href="#如何修改SpringBoot的默认配置" class="headerlink" title="如何修改SpringBoot的默认配置"></a>如何修改SpringBoot的默认配置</h3></li>
<li>模式：<ol>
<li>SpringBoot在容器中自动配置很多组件的时候，先看容器中有没有用户自己配（@bean，@Component），如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver，视图解析器）将用户配置的和SpringBoot默认配置的组合起来</li>
<li><h3 id="扩展SprinMVC"><a href="#扩展SprinMVC" class="headerlink" title="扩展SprinMVC"></a>扩展SprinMVC</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/hello"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/hello"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hean</span>&gt;</span><span class="tag">&lt;<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>编写一个配置类（@Configuration），是WebMvcConfigurer类型，不能标注@EnableWebMvc</li>
<li>如果标注了@EnableWebMvc表示SpringBoot所有的配置类都不要了，所有的都是我们自己的配置，全面接管SpringMvc</li>
<li>特点：既保留了所有的自动配置，也能用我们的扩展</li>
<li>在SpringBoot中会有很多xxxConfigurer(如webMvcConfigurer)</li>
<li>注意：快捷键ctrl+o 弹出父类的所有方法<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurer扩展SpringMvc的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span>   </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//浏览器发送/zhao请求 也来到success页面</span></span><br><span class="line">    registry.addViewController(<span class="string">"/zhao"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>原理：<ul>
<li>WebMvcAutoConfiguration是SpringMvc的自动配置类</li>
<li>在做其他配置时会导入：@import(EnablewebMvcConfiguration.class)<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Configuration</span>(</span><br><span class="line">  proxyBeanMethods = <span class="keyword">false</span></span><br><span class="line">   )</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span>    <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">EnableWebMvcConfiguration</span><span class="params">(ResourceProperties resourceProperties, ObjectProvider&lt;WebMvcProperties&gt; mvcPropertiesProvider, ObjectProvider&lt;WebMvcRegistrations&gt; mvcRegistrationsProvider, ListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">      <span class="keyword">this</span>.mvcProperties = (WebMvcProperties)mvcPropertiesProvider.getIfAvailable();</span><br><span class="line">      <span class="keyword">this</span>.mvcRegistrations = (WebMvcRegistrations)mvcRegistrationsProvider.getIfUnique();</span><br><span class="line">      <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//从容器中获取所有的WebMvcConfigurer</span></span><br><span class="line"> <span class="meta">@Autowired</span>(</span><br><span class="line">  required = <span class="keyword">false</span></span><br><span class="line">   )</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>容器中所有的WebmvcConfigurer都会自己其作用用</li>
<li>我们配置也会起作用</li>
<li>效果：SpringMVC的自己起作用和我们的配置也会起作用</li>
<li>@EnableWebMvcConfigurationSupport组件导入进来；</li>
<li>导入的WebMvcConfigurationSupport只是SpringMvc最基本的功能；<h3 id="加载首页方法"><a href="#加载首页方法" class="headerlink" title="加载首页方法"></a>加载首页方法</h3></li>
</ul>
</li>
</ul>
</li>
<li><p>1.Controller写的方法</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&#123;<span class="meta-string">"/"</span>,<span class="meta-string">"/login.html"</span>&#125;)</span></span><br><span class="line">   <span class="keyword">public</span> String index()&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>2.自己写配置类继承WebMvcConfigurer类</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//所有的WebMvcConfigurer组件都会起作用</span></span><br><span class="line">   <span class="meta">@Bean</span> <span class="comment">//把组件加入到容器中</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function">WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       WebMvcConfigurer config = <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">               registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">               registry.addViewController(<span class="string">"/login.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="keyword">return</span> config;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="通过Webjars方式加入boootstrap"><a href="#通过Webjars方式加入boootstrap" class="headerlink" title="通过Webjars方式加入boootstrap"></a>通过Webjars方式加入boootstrap</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">通过webjars官网找到bootstrap添加到Maven依赖</span><br><span class="line"><span class="comment">&lt;!--引入Bootstrop--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="通过模板引擎引入外部文件"><a href="#通过模板引擎引入外部文件" class="headerlink" title="通过模板引擎引入外部文件"></a>通过模板引擎引入外部文件</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!--Webjars方式引入bootstaap.css文件</span></span></span><br><span class="line"><span class="xml">	第一部导入Maven依赖--&gt;</span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!--引入CSS等外部文件 th:href="@</span></span><span class="template-tag">&#123;/<span class="name">webjars</span>/bootstrap/4.0.0/css/bootstrap.css&#125;</span><span class="xml"><span class="comment">"--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-tag">&#123;/<span class="name">webjars</span>/bootstrap/4.0.0/css/bootstrap.css&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span>  <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-variable">&#123;asserts/css/signin.css&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">th:src</span>=<span class="string">"@</span></span></span><span class="template-variable">&#123;asserts/img/bootstrap-solid.svg&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h4></li>
<li><p>SpringMvc使用过程</p>
<ul>
<li>1.编写国际化配置文件</li>
<li>2.使用ResourceBundleMessageSource管理国际化资源</li>
<li>3.在页面使用fmt:message去除国际化内容</li>
</ul>
</li>
<li><p>SpringBoot配置</p>
<ul>
<li><p>步骤：</p>
<ul>
<li>1.编写国际化配置文件，抽取页面需要显示的内容(创建i18n文件夹，创建默认显示文件login.properties,中文状态显示文件login_zh_CN.properties,英文状态下显示文件login_en_US.properties)在创建中文状态显示的文件，可以快捷方式创建(New –&gt;Add Property File)</li>
<li>2.显示内容通过页面Resource Bulid进行创建 属性=值的方式</li>
<li>3.SpringBoot已经自动配置好了管理国际化资源文件的组件</li>
<li>4.application.properties文件中配置spring.messages.basename=i18n.login<br>源码：<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">   prefix = <span class="string">"spring.messages"</span></span><br><span class="line">)</span><br><span class="line"> <span class="comment">//我们的配置文件可以直接放在类路径下加message.properties;</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">MessageSourceProperties <span class="title">messageSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> MessageSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">MessageSource <span class="title">messageSource</span><span class="params">(MessageSourceProperties properties)</span> </span>&#123;</span><br><span class="line">   ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.hasText(properties.getBasename())) &#123;</span><br><span class="line">     <span class="comment">//设置国际化资源文件的基础名（去掉语言国家的代码）</span></span><br><span class="line">       messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(properties.getBasename())));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (properties.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">       messageSource.setDefaultEncoding(properties.getEncoding().name());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li>去页面获取国际化的值th:text=”#{login.tip}”<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span> &gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--Webjars方式引入bootstaap.css文件</span></span></span><br><span class="line"><span class="xml">    第一部导入Maven依赖--&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--引入CSS等外部文件 th:href="@</span></span><span class="template-tag">&#123;/<span class="name">webjars</span>/bootstrap/4.0.0/css/bootstrap.css&#125;</span><span class="xml"><span class="comment">"--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-tag">&#123;/<span class="name">webjars</span>/bootstrap/4.0.0/css/bootstrap.css&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span>  <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-variable">&#123;asserts/css/signin.css&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">th:src</span>=<span class="string">"@</span></span></span><span class="template-variable">&#123;asserts/img/bootstrap-solid.svg&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.tip&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.username&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.username&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.password&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.password&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="comment">&lt;!-- 注意此处单选框 --&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>&gt;</span> [[#</span><span class="template-variable">&#123;login.Remember&#125;</span><span class="xml">]]</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;login.btn&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"mt-5 mb-3 text-muted"</span>&gt;</span>© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>效果：根据浏览器语言设置信息切换国际化</li>
</ul>
<ul>
<li>国际化Locale(区域信息对象)；LocaleResolver</li>
<li>源码<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//区域信息解析器</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">      prefix = <span class="meta-string">"spring.mvc"</span>,</span></span><br><span class="line"><span class="meta">      name = &#123;<span class="meta-string">"locale"</span>&#125;</span></span><br><span class="line"><span class="meta">  )</span></span><br><span class="line">  <span class="keyword">public</span> LocaleResolver localeResolver() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">          <span class="keyword">return</span> new FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          AcceptHeaderLocaleResolver localeResolver = new AcceptHeaderLocaleResolver();</span><br><span class="line">          localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">          <span class="keyword">return</span> localeResolver;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  默认的就是根据请求头带来的区域性息获取Locale进行国际化</span><br></pre></td></tr></table></figure></li>
<li>自定义区域信息解析器</li>
</ul>
<ul>
<li>1.html添加访问路径<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"> 	<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-tag">&#123;/<span class="name">login.html</span>(L='zh_CN')&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@</span></span></span><span class="template-tag">&#123;/<span class="name">login.html</span>(L='en_US')&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>2.创建MyLocaleResolver继承LocaleResolver  //区域信息解析器<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">  import org.springframework.util.StringUtils;</span><br><span class="line">  import org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"></span><br><span class="line">  import javax.servlet.http.HttpServletRequest;</span><br><span class="line">  import javax.servlet.http.HttpServletResponse;</span><br><span class="line">  import java.util.Locale;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 可以在链接上携带上区域信息</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> public <span class="keyword">class</span> MyLocaleResolver implements LocaleResolver &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*解析区域性息*/</span></span><br><span class="line">    @Override</span><br><span class="line">    public Locale resolve<span class="constructor">Locale(HttpServletRequest <span class="params">httpServletRequest</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String L = httpServletRequest.get<span class="constructor">Parameter(<span class="string">"L"</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(L);</span><br><span class="line"></span><br><span class="line">        Locale locale = <span class="module-access"><span class="module"><span class="identifier">Locale</span>.</span></span>get<span class="constructor">Default()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(locale);</span><br><span class="line">        <span class="comment">//注意此处判断条件！StringUtils.isEmplaty(L) 不为空</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="module-access"><span class="module"><span class="identifier">StringUtils</span>.</span></span>is<span class="constructor">Empty(L)</span>)&#123;</span><br><span class="line">          String<span class="literal">[]</span> split = <span class="module-access"><span class="module"><span class="identifier">L</span>.</span></span>split(<span class="string">"_"</span>);</span><br><span class="line">          <span class="comment">//注意此处为变量，不是字符串</span></span><br><span class="line">          locale = <span class="keyword">new</span> <span class="constructor">Locale(<span class="params">split</span>[0],<span class="params">split</span>[1])</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(locale);</span><br><span class="line">        return locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void set<span class="constructor">Locale(HttpServletRequest <span class="params">httpServletRequest</span>, HttpServletResponse <span class="params">httpServletResponse</span>, Locale <span class="params">locale</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>3.在配置类中将自定义的MyLocaleResolver加入Springboot容器中<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>5.效果：可根据页面链接转换语言信息，此时浏览器的语言选择 对其不起作用<h3 id="开发技巧ctrl-F9重新编译"><a href="#开发技巧ctrl-F9重新编译" class="headerlink" title="开发技巧ctrl+F9重新编译"></a>开发技巧ctrl+F9重新编译</h3></li>
</ul>
</li>
</ul>
</li>
<li><p>开发期间模板引擎页面修改之后，要实时生效</p>
<ul>
<li>1.application.properties禁用模板引擎的缓存<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#禁用模板引擎的缓存</span></span><br><span class="line"><span class="attr">pring.thymeleaf.cache</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
<li>2.页面修改后ctrl+F9重新编译<h4 id="错误消息显示及判断"><a href="#错误消息显示及判断" class="headerlink" title="错误消息显示及判断"></a>错误消息显示及判断</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!--判断msg是否为空，后执行text标签内容 此处if标签优先级高于text标签优先级  --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;msg&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">th:if</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;not #strings.isEmpty(msg)&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="拦截器机制进行登陆检查"><a href="#拦截器机制进行登陆检查" class="headerlink" title="拦截器机制进行登陆检查"></a>拦截器机制进行登陆检查</h3></li>
</ul>
</li>
<li><p>1.创建拦截器对象实现HandlerInterceptor接口</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 登陆检查,拦截器</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*目标方法执行之前*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object user = request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//未登录，返回登陆界面</span></span><br><span class="line">            request.setAttribute(<span class="string">"msg"</span>,<span class="string">"没有权限请先登录"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/login.html"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//已登录，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>2.将拦截器对象加载到配置类容器中</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注册拦截器</span></span><br><span class="line">          @Override</span><br><span class="line">          public void add<span class="constructor">Interceptors(InterceptorRegistry <span class="params">registry</span>)</span> &#123;</span><br><span class="line">              <span class="comment">//静态资源；*.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBoot已经做好了静态资源映射</span></span><br><span class="line">              registry.add<span class="constructor">Interceptor(<span class="params">new</span> LoginHandlerInterceptor()</span>).add<span class="constructor">PathPatterns(<span class="string">"/**"</span>)</span>.</span><br><span class="line">                      exclude<span class="constructor">PathPatterns(<span class="string">"/login.html"</span>,<span class="string">"/"</span>,<span class="string">"/user/login"</span>)</span>;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>
<h3 id="CRUD操作——员工列表"><a href="#CRUD操作——员工列表" class="headerlink" title="CRUD操作——员工列表"></a>CRUD操作——员工列表</h3></li>
</ul>
<h3 id="模板引擎Thymeleaf公共页面元素抽取"><a href="#模板引擎Thymeleaf公共页面元素抽取" class="headerlink" title="模板引擎Thymeleaf公共页面元素抽取"></a>模板引擎Thymeleaf公共页面元素抽取</h3><ul>
<li>1.抽取公共片段 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>     </span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span>     </span><br><span class="line">    &amp;copy; 2011 The Good Thymes Virtual Grocery   </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span>    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>2.引入公共模块<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"~</span></span></span><span class="template-variable">&#123;footer :: copy&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="xml">~</span><span class="template-variable">&#123;templatename::selector&#125;</span><span class="xml">:模块名：：片段名</span></span><br><span class="line"><span class="xml">~</span><span class="template-variable">&#123;templatename：：fragmentname&#125;</span><span class="xml">：模块名：：片段名</span></span><br></pre></td></tr></table></figure></li>
<li>3.默认效果 insert的功能片段在div标签里</li>
<li>4.注意：如果使用th:insert等属性进行引入，可以不用写<del>{};<br>行内写法必须写</del>{}方式 [[~{}]];<h3 id="三种引入功能片段的th-属性"><a href="#三种引入功能片段的th-属性" class="headerlink" title="三种引入功能片段的th:属性"></a>三种引入功能片段的th:属性</h3></li>
<li>1.th:insert   :将公共的片段整个插入到声明引入的元素里面</li>
<li>2.th:replace  ：将声明引入的元素替换为公共片段</li>
<li>3.th:include  ：将被引入的片段的内容包含进这个标签中<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line">  &amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>    </span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span>     </span><br><span class="line">    &amp;copy; 2011 The Good Thymes Virtual Grocery    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span>   </span><br><span class="line">    &amp;copy; 2011 The Good Thymes Virtual Grocery  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>   </span><br><span class="line">   &amp;copy; 2011 The Good Thymes Virtual Grocery  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="模板引擎使用的一些小技巧"><a href="#模板引擎使用的一些小技巧" class="headerlink" title="模板引擎使用的一些小技巧"></a>模板引擎使用的一些小技巧</h3></li>
<li>1.th:if=”” 通过三目运算的判断改变其样式<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!--引入侧边栏--&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"commons/bar::#sidebar(activeUri='emps')"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">  th:class="$</span><span class="template-variable">&#123;activeUri=='emps'?'nav-link active':'nav-link'&#125;</span><span class="xml">"</span></span><br></pre></td></tr></table></figure></li>
<li>2.Thymeleaf日期格式的转换<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&lt;td&gt;<span class="string">[[$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;]]</span>&lt;/td&gt;</span><br></pre></td></tr></table></figure></li>
<li>3.bootstrap前端框架button按钮样式小技巧<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">通过添加class选择器 <span class="keyword">btn </span><span class="keyword">btn-sm </span><span class="keyword">btn-颜色 </span> </span><br><span class="line"> eg： &lt;<span class="keyword">button </span>class=<span class="string">"btn btb-sm btn-danger"</span>&gt;删除&lt;/<span class="keyword">button&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>4.行内Teymeleaf表达式的写法[()]表示转义 [[]]不转义<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&lt;td&gt;<span class="string">[[$&#123;emp.department.departmentName&#125;]]</span>&lt;/td&gt;</span><br><span class="line">&lt;td&gt;<span class="string">[[$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;]]</span>&lt;/td&gt;</span><br></pre></td></tr></table></figure></li>
<li>5.Teymeleaf表达式做三目运算最好将其写在{}大括号外面<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;emp.gender&#125;</span><span class="xml"><span class="tag"><span class="string">==0?'女':'男'"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>6.遍历集合只需在标签内部加入th:each=””即可<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">tr</span> th:<span class="keyword">each</span>=<span class="string">"emp:<span class="subst">$&#123;emps&#125;</span>"</span>&gt;</span><br></pre></td></tr></table></figure></li>
<li>7.controller层操作<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EmployeeDao employeeDao;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//查询所偶员工列表页面</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/emps"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String list(Model model)&#123;</span><br><span class="line"></span><br><span class="line">        Collection&lt;Employee&gt; employees = employeeDao.getAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放在请求域中进行共享</span></span><br><span class="line">        model.addAttribute(<span class="string">"emps"</span>,employees);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//thymeleaf（模板引擎）默认就会拼串到类路径下classpath:/templates/...html</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"emp/list"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Controller层增删改查"><a href="#Controller层增删改查" class="headerlink" title="Controller层增删改查"></a>Controller层增删改查</h4><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   EmployeeDao employeeDao;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   DepartmentDao departmentDao;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//查询所偶员工列表页面</span></span><br><span class="line">   <span class="meta">@GetMapping(<span class="meta-string">"/emps"</span>)</span></span><br><span class="line">   <span class="keyword">public</span> String list(Model model)&#123;</span><br><span class="line"></span><br><span class="line">       Collection&lt;Employee&gt; employees = employeeDao.getAll();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//放在请求域中进行共享</span></span><br><span class="line">       model.addAttribute(<span class="string">"emps"</span>,employees);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//thymeleaf（模板引擎）默认就会拼串到类路径下classpath:/templates/...html</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"emp/list"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//来到与员工添加页面</span></span><br><span class="line">   <span class="meta">@GetMapping(<span class="meta-string">"/emp"</span>)</span></span><br><span class="line">   <span class="keyword">public</span> String toAddPage(Model model)&#123;</span><br><span class="line">       <span class="comment">//来到所有页面,查出所有的部门，在页面显示</span></span><br><span class="line">       Collection&lt;Department&gt; departments = departmentDao.getDepartments();</span><br><span class="line">       model.addAttribute(<span class="string">"depts"</span>,departments);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"emp/add"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//员工添加功能</span></span><br><span class="line">   <span class="comment">//SpringMvc自动将请求参数和入参的对象的属性进一一绑定；要求请求参数的名字和参数的名字和JavaBean入参的对象里面的属性名</span></span><br><span class="line">   <span class="meta">@PostMapping(<span class="meta-string">"/emp"</span>)</span></span><br><span class="line">   <span class="keyword">public</span> String addEmp(Employee employee01)&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//来到员工列表页面</span></span><br><span class="line">       System.<span class="keyword">out</span>.println(<span class="string">"保存员工信息："</span>+employee01);</span><br><span class="line">       <span class="comment">//保存员工</span></span><br><span class="line">       employeeDao.save(employee01);</span><br><span class="line">       <span class="comment">//redirect:表示重定向，到一个地址</span></span><br><span class="line">       <span class="comment">//forword：表示转发到一个地址</span></span><br><span class="line">       <span class="comment">//  /表示当前项目路径你</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//@PathVariable("id") 获取路径变量</span></span><br><span class="line">   <span class="comment">//来到修改页面，查出当前员工，在页面回显</span></span><br><span class="line">   <span class="meta">@GetMapping(<span class="meta-string">"/emp/&#123;id&#125;"</span>)</span></span><br><span class="line">   <span class="keyword">public</span> String toEditPage(<span class="meta">@PathVariable(<span class="meta-string">"id"</span>)</span> Integer id,Model model)&#123;</span><br><span class="line"></span><br><span class="line">       Employee employee = employeeDao.<span class="keyword">get</span>(id);</span><br><span class="line">       model.addAttribute(<span class="string">"emp"</span>,employee);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//来到所有页面,查出所有的部门，在页面显示</span></span><br><span class="line">       Collection&lt;Department&gt; departments = departmentDao.getDepartments();</span><br><span class="line">       model.addAttribute(<span class="string">"depts"</span>,departments);</span><br><span class="line">       <span class="comment">//回到修改页面</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"emp/add"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//员工修改,需要提交员工id</span></span><br><span class="line">   <span class="meta">@PutMapping(<span class="meta-string">"/emp"</span>)</span></span><br><span class="line">   <span class="keyword">public</span> String updateEmp(Employee employee)&#123;</span><br><span class="line">       System.<span class="keyword">out</span>.println(<span class="string">"修改数据:"</span>+employee);</span><br><span class="line">       employeeDao.save(employee);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//员工删除</span></span><br><span class="line">   <span class="meta">@DeleteMapping(<span class="meta-string">"/emp/&#123;id&#125;"</span>)</span> <span class="comment">//@PathVariable("id") 获取路径变量</span></span><br><span class="line">   <span class="keyword">public</span> String deleteEmp(<span class="meta">@PathVariable(<span class="meta-string">"id"</span>)</span> Integer id)&#123;</span><br><span class="line">       employeeDao.delete(id);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package com.zhao.democrud.config;</span><br><span class="line"></span><br><span class="line">import com.zhao.democrud.componennt.LoginHandlerInterceptor;</span><br><span class="line">import com.zhao.democrud.componennt.MyLocaleResolver;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Bean</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Configuration</span>;</span><br><span class="line">import org.springframework.web.servlet.LocaleResolver;</span><br><span class="line">import org.springframework.web.servlet.config.<span class="keyword">annotation</span>.<span class="title">InterceptorRegistry</span>;</span><br><span class="line">import org.springframework.web.servlet.config.<span class="keyword">annotation</span>.<span class="title">ViewControllerRegistry</span>;</span><br><span class="line">import org.springframework.web.servlet.config.<span class="keyword">annotation</span>.<span class="title">WebMvcConfigurer</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/<span class="regexp">/使用WebMvcConfigurer扩展SpringMvc的功能</span></span><br><span class="line"><span class="regexp">@Configuration</span></span><br><span class="line"><span class="regexp">public class MyMvcConfig implements WebMvcConfigurer &#123;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    @Override</span></span><br><span class="line"><span class="regexp">    public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/浏览器发送/zhao</span>请求 也来到success页面</span><br><span class="line">        registry.addViewController(<span class="string">"/zhao"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /<span class="regexp">/所有的WebMvcConfigurer组件都会起作用</span></span><br><span class="line"><span class="regexp">    @Bean /</span><span class="regexp">/把组件加入到容器中</span></span><br><span class="line"><span class="regexp">    public WebMvcConfigurer webMvcConfigurer()&#123;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        WebMvcConfigurer config = new WebMvcConfigurer() &#123;</span></span><br><span class="line"><span class="regexp">            @Override</span></span><br><span class="line"><span class="regexp">            public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line"><span class="regexp">                registry.addViewController("/</span><span class="string">").setViewName("</span>login<span class="string">");</span></span><br><span class="line"><span class="string">                registry.addViewController("</span>/login.html<span class="string">").setViewName("</span>login<span class="string">");</span></span><br><span class="line"><span class="string">                registry.addViewController("</span>/main.html<span class="string">").setViewName("</span>dashboard<span class="string">");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            //注册拦截器</span></span><br><span class="line"><span class="string">            @Override</span></span><br><span class="line"><span class="string">            public void addInterceptors(InterceptorRegistry registry) &#123;</span></span><br><span class="line"><span class="string">                //静态资源；*.css , *.js</span></span><br><span class="line"><span class="string">                //SpringBoot已经做好了静态资源映射</span></span><br><span class="line"><span class="string">                registry.addInterceptor(new LoginHandlerInterceptor()).addPathPatterns("</span>/**<span class="string">").</span></span><br><span class="line"><span class="string">                        excludePathPatterns("</span>/login.html<span class="string">","</span>/<span class="string">","</span>/user/login<span class="string">");</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">        return config;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @Bean</span></span><br><span class="line"><span class="string">    public LocaleResolver localeResolver()&#123;</span></span><br><span class="line"><span class="string">        return new MyLocaleResolver();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot微服务框架(二)--自动配置详解</title>
    <url>/2019/12/28/SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-%E4%BA%8C-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="SpringBoot-配置文件"><a href="#SpringBoot-配置文件" class="headerlink" title="SpringBoot 配置文件"></a>SpringBoot 配置文件</h3><h4 id="Spring-Boot使用一个全局的配置文件"><a href="#Spring-Boot使用一个全局的配置文件" class="headerlink" title="Spring Boot使用一个全局的配置文件"></a>Spring Boot使用一个全局的配置文件</h4><pre><code>- application.properties
- application.yml</code></pre><ul>
<li>配置文件放在src/main/resources目录或者类路径/config下</li>
<li>.yml是YAML(YUML Ain`t Markup Language)语言的文件，以数据为中心，比json,xml等更适合做配置文件</li>
<li>注意：.yml文件，以数据为中心</li>
<li>全局配置文件的可以对一些默认的值进行修改<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4></li>
<li>配置文件的作用：修改SpringBoot自动配置的默认值；<br>SpringBoot在底层都给我们配置好；<h3 id="yml语法"><a href="#yml语法" class="headerlink" title=".yml语法"></a>.yml语法</h3><h4 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h4></li>
<li>键值对： K:(空格)V  空格必须有</li>
<li>已空格的缩进来控制层级关系；<ul>
<li>只要左对齐的一列数据，都是同一个级别的数据</li>
<li>属性和值大小写敏感<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">   <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>值的写法<br>  字面量：普通的值（数字，字符串，布尔）<br>  k：v   v直接来写即可<br>  字符串默认不用加单引号或者双引号<br>  注意：单引号会转移特殊字符</li>
<li>对象,map(属性和值)；<br>  对象还是k：v的方式<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">friends：</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure></li>
<li>行内写法<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">friends:</span> ( <span class="string">name:</span> zhangsan,<span class="string">age:</span> <span class="number">20</span>)</span><br></pre></td></tr></table></figure></li>
<li>数组（list，set）:<br>用- 值表示数组中的一个元素<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">pets:</span><br><span class="line"><span class="bullet">  - </span>cat</span><br><span class="line"><span class="bullet">  - </span>dog</span><br><span class="line"><span class="bullet">  - </span>pig</span><br></pre></td></tr></table></figure></li>
<li>行内写法<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">pet<span class="variable">s:</span> [<span class="keyword">cat</span>,dog.pig]</span><br></pre></td></tr></table></figure>
<h3 id="pml属性配置文件"><a href="#pml属性配置文件" class="headerlink" title=".pml属性配置文件"></a>.pml属性配置文件</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/springboot-web</span></span><br><span class="line"></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">沐沐</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">brith:</span> <span class="number">2019</span><span class="string">/12/19</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">里斯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">天天</span></span><br><span class="line">  <span class="attr">maps:</span> <span class="string">&#123;k1:</span> <span class="string">v1,k2:</span> <span class="number">12</span><span class="string">&#125;</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">西西</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br></pre></td></tr></table></figure>
<h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-test02<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-test02<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--导入配置文件处理器，配置文件进行绑定--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h3><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 将文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * @ConfigurationProperties 告诉SpringBoot将本类中所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @Component 这个注解表示被加上这个注解的类成为容器中的一个组件</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器的组件，才能让容器提供@ConfigurationProperties(prefix = "person")的功能</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 此处要导入依赖,属性配置文件会有提示</span></span><br><span class="line"><span class="comment"> * &lt;!--导入配置文件处理器，配置文件进行绑定--&gt;</span></span><br><span class="line"><span class="comment"> *		&lt;dependency&gt;</span></span><br><span class="line"><span class="comment"> *			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment"> *			&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment"> *			&lt;optional&gt;true&lt;/optional&gt;</span></span><br><span class="line"><span class="comment"> *		&lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *@ConfigurationProperties(prefix = "person")默认从全局配置文件中获取值</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"> @Component</span><br><span class="line"> @ConfigurationProperties(prefix = <span class="string">"person"</span>)</span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>&lt;Int&gt; &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date brith;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; <span class="built_in">list</span>;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;<span class="keyword">String</span>,Object&gt; maps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", boss="</span> + boss +</span><br><span class="line">                <span class="string">", brith="</span> + brith +</span><br><span class="line">                <span class="string">", list="</span> + <span class="built_in">list</span> +</span><br><span class="line">                <span class="string">", maps="</span> + maps +</span><br><span class="line">                <span class="string">", dog="</span> + dog +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getBoss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> boss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBoss</span><span class="params">(Boolean boss)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.boss = boss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBrith</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> brith;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrith</span><span class="params">(Date brith)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brith = brith;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; getList() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;Object&gt; <span class="built_in">list</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">list</span> = <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;<span class="keyword">String</span>, Object&gt; getMaps() &#123;</span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaps</span><span class="params">(Map&lt;<span class="keyword">String</span>, Object&gt; maps)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maps = maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDog</span><span class="params">(Dog dog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">String</span> name, Integer age, Boolean boss, Date brith, List&lt;Object&gt; <span class="built_in">list</span>, Map&lt;<span class="keyword">String</span>, Object&gt; maps, Dog dog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.boss = boss;</span><br><span class="line">        <span class="keyword">this</span>.brith = brith;</span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">list</span> = <span class="built_in">list</span>;</span><br><span class="line">        <span class="keyword">this</span>.maps = maps;</span><br><span class="line">        <span class="keyword">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Dog&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SpringBoot启动类，启动Spring容器，启动内嵌tomcat</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoTest01Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	SpringApplication.run(DemoTest01Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入juint4 --&gt;</span></span><br><span class="line">@RunWith(SpringRunner.class)   //告诉他用spring驱动器运行</span><br><span class="line">@SpringBootTest</span><br><span class="line">class test &#123;</span><br><span class="line">    <span class="comment">&lt;!-- @Resource是J2EE的注解 @AutoWrited也可 自动注入 --&gt;</span></span><br><span class="line">@Resource</span><br><span class="line">private Person person;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void contextLoads() &#123;</span><br><span class="line">	System.out.println(person);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>自我评估：遇到报错，不要慌仔细阅读，看不懂英文百度。。。。<h3 id="properties文件配置"><a href="#properties文件配置" class="headerlink" title=".properties文件配置"></a>.properties文件配置</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置person的值</span></span><br><span class="line"><span class="attr">person.name</span>=米粒</span><br><span class="line"><span class="attr">person.age</span>=<span class="number">20</span></span><br><span class="line"><span class="attr">person.boss</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">person.brith</span>=<span class="number">2019</span>/<span class="number">12</span>/<span class="number">12</span></span><br><span class="line"><span class="attr">person.list</span>=a,bc,egf</span><br><span class="line"><span class="attr">person.maps.k1</span>=丽丽</span><br><span class="line"><span class="attr">person.maps.k2</span>=咪咪</span><br><span class="line"><span class="attr">person.dog.name</span>=小狗</span><br><span class="line"><span class="attr">person.dog.age</span>=<span class="number">12</span></span><br><span class="line"><span class="comment"># 注意会有乱码情况编码格式UTF-8</span></span><br></pre></td></tr></table></figure>
<h3 id="Value-“”-注解"><a href="#Value-“”-注解" class="headerlink" title="@Value(“”)注解"></a>@Value(“”)注解</h3><figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">* <span class="title">@value</span>(<span class="string">""</span>)注解</span><br><span class="line">* 相当于</span><br><span class="line">* &lt;bean class=<span class="string">"Person"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"name"</span> value=<span class="string">"字面量/$&#123;key&#125;从环境变量，配置文件中获取值/#&#123;SPEL&#125;"</span>&gt;&lt;/property&gt;</span><br><span class="line">* &lt;/bean&gt;</span><br><span class="line">* */</span><br><span class="line">//<span class="title">@Value</span>(<span class="string">"$&#123;person.name&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String name<span class="comment">;</span></span><br><span class="line"><span class="comment">//@Value("#&#123;11*2&#125;")</span></span><br><span class="line"><span class="comment">private Integer age;</span></span><br><span class="line"><span class="comment">//@Value("true")</span></span><br><span class="line"><span class="comment">private Boolean boss;</span></span><br></pre></td></tr></table></figure>
<h3 id="Value获取数据与-ConfigurationProperties获取比较"><a href="#Value获取数据与-ConfigurationProperties获取比较" class="headerlink" title="@Value获取数据与@ConfigurationProperties获取比较"></a>@Value获取数据与@ConfigurationProperties获取比较</h3></li>
</ul>
<table>
<thead>
<tr>
<th>对比</th>
<th align="center">@ConfigurationProperties</th>
<th align="right">@Value</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td align="center">批量注入配置文件中的属性</td>
<td align="right">单一指定</td>
</tr>
<tr>
<td>松散绑定</td>
<td align="center">支持lastName对应last-name</td>
<td align="right">不支持</td>
</tr>
<tr>
<td>SpEl</td>
<td align="center">不支持</td>
<td align="right">支持</td>
</tr>
<tr>
<td>JSPR303数据效验</td>
<td align="center">支持如@Email，@NotNull</td>
<td align="right">不支持</td>
</tr>
<tr>
<td>复杂类型数据(map)</td>
<td align="center">支持</td>
<td align="right">不支持(基本数据类型)</td>
</tr>
</tbody></table>
<ul>
<li>注意：在业务逻辑中获取配置文件中某项值，使用@Value<br>JavaBean和配置文件映射使用@ConfigurationProperties</li>
</ul>
<h3 id="PropertySource-只能用于perperties文件-和-ImportResource读取外部配置文件"><a href="#PropertySource-只能用于perperties文件-和-ImportResource读取外部配置文件" class="headerlink" title="@PropertySource(只能用于perperties文件)和@ImportResource读取外部配置文件"></a>@PropertySource(只能用于perperties文件)和@ImportResource读取外部配置文件</h3><ul>
<li><p>@PropertySource 加载指定路径下的文件</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">PropertySource</span>(<span class="keyword">value</span> = &#123;"<span class="selector-tag">classpath</span><span class="selector-pseudo">:person.properties"</span>&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>@ImportResource: 导入Spring的配置文件，让Spring的配置文件生效</p>
</li>
<li><p>Spring 配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">class</span>=<span class="string">"com.example.service.helloService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注意：在启动类上加入@ImportResource(locations = {“classpath:beans.xml”})注解</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@ImportResource</span>(locations = &#123;<span class="string">"classpath:beans.xml"</span>&#125;)</span><br><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line">public class DemoTest02Application &#123;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">	<span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(DemoTest02Application.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot推荐该容器中添加组建的方式：全注解"><a href="#SpringBoot推荐该容器中添加组建的方式：全注解" class="headerlink" title="SpringBoot推荐该容器中添加组建的方式：全注解"></a>SpringBoot推荐该容器中添加组建的方式：全注解</h3></li>
<li><p>配置类 config(使用@Bean给容器添加组件)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//配置类</span></span><br><span class="line"> <span class="meta">@Configuration</span>   <span class="comment">//指明当前类是一个配置类，就是来代替之前的Spring配置文件</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAppconfig</span> </span>&#123;</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Bean</span></span><br><span class="line"><span class="comment"> * 相当于</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;/bean&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中，容器中默认组件的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> helloService <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> helloService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置文件占位符"><a href="#配置文件占位符" class="headerlink" title="配置文件占位符"></a>配置文件占位符</h3></li>
<li><p>RandomValuepropertySource:配置文件中可以使用随机数<br>${random.value},${random.int},${random.long}<br>${random.int(10)},${random.int[1024,65536]}</p>
</li>
<li><p>属性配置占位符</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">app.name</span>=MyApp</span><br><span class="line"><span class="attr">app.description</span>=<span class="variable">$&#123;app.name&#125;</span>_lili</span><br></pre></td></tr></table></figure></li>
<li><p>可以在配置文件中应用之前那个配置过的属性(优先级前面配置过的这里都能使用)。<br>${app.name:默认值}来指定找不到属性时的默认值</p>
</li>
</ul>
<h3 id="Profile多文件配置（默认使用application-properties）"><a href="#Profile多文件配置（默认使用application-properties）" class="headerlink" title="Profile多文件配置（默认使用application.properties）"></a>Profile多文件配置（默认使用application.properties）</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 激活使用那个配置文件 --&gt;</span></span><br><span class="line">spring.profiles.active=test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如以下文件 --&gt;</span></span><br><span class="line">application-dev.properties //开发配置</span><br><span class="line">application-test.properties //测试配置</span><br><span class="line">application-online.properties //上线配置</span><br></pre></td></tr></table></figure>
<h3 id="yml多文档块模式"><a href="#yml多文档块模式" class="headerlink" title=".yml多文档块模式"></a>.yml多文档块模式</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">profiles:</span> </span><br><span class="line">   <span class="attr">active:</span> <span class="string">dev</span>   <span class="comment">#激活</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"> <span class="attr">server:</span></span><br><span class="line">   <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">profiles:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure>
<h3 id="命令行激活"><a href="#命令行激活" class="headerlink" title="命令行激活"></a>命令行激活</h3><ul>
<li>Run–》Edit–&gt;program arguments: –spring.profiles.active=dev<br>  打包 执行 Java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar –spring.profiles.active=dev;</li>
<li>虚拟机参数：<pre><code>-Dspring.properties.active=dev4m</code></pre></li>
</ul>
<h3 id="配置文件加载位置"><a href="#配置文件加载位置" class="headerlink" title="配置文件加载位置"></a>配置文件加载位置</h3><ul>
<li>springBoot启动会扫描已下位置的application.properties/.yml文件作为Springboot的默认文件</li>
</ul>
<ul>
<li>file: ./config/</li>
<li>file: ./</li>
<li>classpath:/config/</li>
<li>classpath：/</li>
</ul>
<ul>
<li>注意：优先级由高到低，高优先级配置会覆盖低优先级的配置</li>
<li>SpringBoot会从这四个位置全部加载主配置文件：互补配置<h5 id="我们还可以通过spring-config-location-G-application-properties来改变默认的配置文件位置（外部部配置加载）"><a href="#我们还可以通过spring-config-location-G-application-properties来改变默认的配置文件位置（外部部配置加载）" class="headerlink" title="我们还可以通过spring.config.location=G:/application.properties来改变默认的配置文件位置（外部部配置加载）"></a>我们还可以通过spring.config.location=G:/application.properties来改变默认的配置文件位置（外部部配置加载）</h5></li>
<li>项目打包后，我们可使用命令行参数的模式，启动项目的时候来指定配置文件的新位置；指定配置文件和默认加载的这些配置文件共同起作用的形式互补配置；<h4 id="SpringBoot自动配置原理"><a href="#SpringBoot自动配置原理" class="headerlink" title="SpringBoot自动配置原理"></a>SpringBoot自动配置原理</h4></li>
<li>配置文件能写什么？怎么写？自动配原理？<h5 id="自动配置原理："><a href="#自动配置原理：" class="headerlink" title="自动配置原理："></a>自动配置原理：</h5></li>
</ul>
<ol>
<li>Spring启动的时候加载主配置类，开启自动配置功能@EnableAutoConfiguration</li>
<li>@EnableAutoConfiguration的作用：<ul>
<li>利用EnableAutoConfigurationImportSelector该容器中导入一些组件？</li>
<li>可以查看selectImports()方法的内容：</li>
<li>List<String> configurations = getCandidateConfigurations(annotationMetadata,attributes);<br>获取候选的配置<ul>
<li>SpringFactoriesLoader.loadFactorynames()扫描所有jar包下类路径的META-INF/Spring.factories</li>
<li>把扫描到的文件内容包装成properties对象</li>
<li>从properties文件中获取到EnableAutoConfiguration.class类(类名)对应的值然后把它们添加到容器中；</li>
<li>将类路径下META-INF/Spring.factories里面的配置的所用EnableAutoConfiguration的值加入到容器中；</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>META-INF/Spring.factories配置文件(位置：spring-boot-autocongfigure)      <figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">org.springframework.context.ApplicationListener=\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.BackgroundPreinitializer</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># </span>Auto Configuration Import Listeners</span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># </span>Auto Configuration Import Filters</span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.OnBeanCondition,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.OnClassCondition,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># </span>Auto Configure</span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.cloud.CloudServiceConnectorsAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveRestClientAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.elasticsearch.rest.RestClientAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration,\</span></span><br><span class="line"><span class="keyword">org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration</span></span><br></pre></td></tr></table></figure></li>
<li>注意：上面每一个这样的 xxxAutoConfiguration类都是容器中的一个组件，都加入到容器中；用他们做自动配置；</li>
</ul>
<ol start="3">
<li>每一个自动配置类进行自动配置功能：<ul>
<li>已HttpEncodingAutoConfiguration(Http编码自动配置<br>)为例解释自动配置原理；<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">   proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span>   <span class="comment">//表示这是一个配置类，以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;HttpProperties.class&#125;)</span>  <span class="comment">//启用指定类(&#123;HttpProperties.class&#125;)configurationProperties功能,</span></span><br><span class="line">将配置文件这种对应的值和HttpEncodingProperties绑定起来；并把HttpEncodingProperties加入到IOC容器中</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">   type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span>      <span class="comment">//Spring底层 @Conditional注解，根据不同的条件，如果满足指定条件，整个配置类里面的配置就会立即生效； 判断当前应用是否Web应用，如果是当前配置内生效</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;CharacterEncodingFilter.class&#125;)</span>  <span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter：SpringMVC中经行乱码解决的过滤器</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">   prefix = <span class="meta-string">"spring.http.encoding"</span>,</span></span><br><span class="line"><span class="meta">   value = &#123;<span class="meta-string">"enabled"</span>&#125;,</span></span><br><span class="line"><span class="meta">   matchIfMissing = true</span></span><br><span class="line"><span class="meta">)</span>   <span class="comment">//判断配置文件中是否存在某个配置 spring.http.encoding.enabled; 如果不存在判断也是成立的</span></span><br><span class="line"><span class="comment">//相当于，即使我们配置文件中不配置spring.http.encoding.enabled=true;，也是默认生效的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">//它已经和SpringBoot配置文件映射了</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Encoding properties;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//只有一个有参构造器的情况，参数的值就会从容器中拿</span></span><br><span class="line">   <span class="keyword">public</span> HttpEncodingAutoConfiguration(HttpProperties properties) &#123;</span><br><span class="line">       <span class="keyword">this</span>.properties = properties.getEncoding();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span>  <span class="comment">//给容器中添加一个组件，这个组件中的某些值要从properties文件中获取</span></span><br><span class="line">   <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">   <span class="keyword">public</span> CharacterEncodingFilter characterEncodingFilter() &#123;</span><br><span class="line">       CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter();</span><br><span class="line">       filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">       filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.REQUEST));</span><br><span class="line">       filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.RESPONSE));</span><br><span class="line">       <span class="keyword">return</span> filter;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<ul>
<li>注意：根据当前文件中不同条件判断，决定这个配置是否生效？<br>  一旦这个配置内生效：这个配置类就会该容器中添加各种组件：这些组件的属性是从对应的properties类中获取的，这些组件中的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和properties文件绑定的</li>
<li>配置properties<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 我们能配置的属性都类源于这个功能的properties类</span></span><br><span class="line"><span class="attr">spring.http.encoding.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.http.encoding.charset</span>= utf-<span class="number">8</span></span><br><span class="line"><span class="attr">spring.http.encoding.force</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot的精髓："><a href="#SpringBoot的精髓：" class="headerlink" title="SpringBoot的精髓："></a>SpringBoot的精髓：</h3></li>
</ul>
<ol>
<li>SpringBoot启动会加载大量的自动配置类</li>
<li>我们要看到我们需要的功能有没有SpringBoot默认配置写好的自动配置类，</li>
<li>这个自动配置类中到底有哪些组件;(如果我们配置的组件有，我们就不需要配置)</li>
<li>给容器中自动配置添加组件的时候，会从properties类中获取某些属性，我们就可以在配置文件中指定这些属性的的值；</li>
</ol>
<ul>
<li>xxxAutoConfiguration:自动配置类；<br>给容器中添加组件<br>xxxProperties:封装配置文件中相关属性；<h4 id="IDEA快捷键，快捷搜索ctrl-N（如输入”-AutoConfiguration”）"><a href="#IDEA快捷键，快捷搜索ctrl-N（如输入”-AutoConfiguration”）" class="headerlink" title="IDEA快捷键，快捷搜索ctrl+N（如输入”*AutoConfiguration”）"></a>IDEA快捷键，快捷搜索ctrl+N（如输入”*AutoConfiguration”）</h4></li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Boot 微服务框架(一)</title>
    <url>/2019/12/17/Spring-Boot-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="SpringBoot框架-Maven包管理工具"><a href="#SpringBoot框架-Maven包管理工具" class="headerlink" title="SpringBoot框架+Maven包管理工具"></a>SpringBoot框架+Maven包管理工具</h3><h3 id="创建Maven项目"><a href="#创建Maven项目" class="headerlink" title="创建Maven项目"></a>创建Maven项目</h3><h3 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhao<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot01<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--父项目--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--这个插件，可以将应用打包成一个可执行的jar包--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--&lt;build&gt;</span></span><br><span class="line"><span class="comment">       &lt;plugins&gt;</span></span><br><span class="line"><span class="comment">           &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">               &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">               &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                   &lt;source&gt;1.8&lt;/source&gt;</span></span><br><span class="line"><span class="comment">                   &lt;target&gt;1.8&lt;/target&gt;</span></span><br><span class="line"><span class="comment">               &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">       &lt;/plugins&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   &lt;/build&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>注意添加插件时加入以下代码，否则会报错 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="SpringBoot启动类"><a href="#SpringBoot启动类" class="headerlink" title="SpringBoot启动类"></a>SpringBoot启动类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao;</span><br><span class="line"><span class="keyword">import</span> com.sun.deploy.uitoolkit.impl.fx.AppletStageManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span>      org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @SpringBootApplication</span></span><br><span class="line"><span class="comment">* 标注主程序类，说明SpringBoot 应用</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWordmainApplication</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//spring应用启动</span></span><br><span class="line">       SpringApplication.run(HelloWordmainApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package com.zhao.controller;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.<span class="keyword">annotation</span>.<span class="title">RequestMapping</span>;</span><br><span class="line">import org.springframework.web.bind.<span class="keyword">annotation</span>.<span class="title">ResponseBody</span>;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   @ResponseBody</span><br><span class="line">   @RequestMapping(<span class="string">"/hello"</span>)</span><br><span class="line">   public String hello()&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"helloWord"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>运行项目 浏览器输入“localhost：8080/hello”即可<h3 id="项目打jar包，"><a href="#项目打jar包，" class="headerlink" title="项目打jar包，"></a>项目打jar包，</h3></li>
<li>在Maven项目管理中 Lifecycle–》单击package在项目中其打包到target文件中如：springboot01-1.0-SNAPSHOT.jar</li>
<li>cmd进入管理员命令行执行:java -jar springboot01-1.0-SNAPSHOT.jar 启动项目</li>
<li>在浏览器端查看localhost：8080/hello</li>
</ul>
<h3 id="pom-xml详解"><a href="#pom-xml详解" class="headerlink" title="pom.xml详解"></a>pom.xml详解</h3><ul>
<li>父项目<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="comment">&lt;!--父项目--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- tadefu他的父项目 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 他来真正管理Spring Boot应用里的的所有的依赖版本； --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Boot Dependencies<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Spring boot 的版本仲裁中心（以及我们导入的默认的是不需要写版本）；没有在Dependencies里面管理的自然需要声明版本号 --&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>导入的依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>spring-boot-starter-web ：springBoot场景启动器：帮我们导入了web模块正常运行所依赖的组件</li>
</ul>
<h3 id="主程序类详解"><a href="#主程序类详解" class="headerlink" title="主程序类详解"></a>主程序类详解</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @SpringBootApplication</span></span><br><span class="line"><span class="comment"> * 标注主程序类，说明SpringBoot 应用</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"> <span class="meta">@SpringBootApplication</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWordmainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//spring应用启动</span></span><br><span class="line">        SpringApplication.run(HelloWordmainApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> &lt;!-- run方法必须加载<span class="meta">@SpringBootController</span>标注的类 --&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>@SpringBootApplication：springBoot标注在某个类上说明这个类是SpringBoot的主配置类，springboot就应该运行这个类的main方法来启动SpringBoot应用；</li>
<li>组合注解<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line"><span class="variable">@Inherited</span></span><br><span class="line"><span class="variable">@SpringBootConfiguration</span></span><br><span class="line"><span class="variable">@EnableAutoConfiguration</span></span><br><span class="line"><span class="variable">@ComponentScan</span>(</span><br><span class="line">   excludeFilters = &#123;<span class="variable">@Filter</span>(</span><br><span class="line">   type = FilterType.CUSTOM,</span><br><span class="line">   classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="line">), <span class="variable">@Filter</span>(</span><br><span class="line">   type = FilterType.CUSTOM,</span><br><span class="line">   classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="line">)&#125;</span><br><span class="line">)</span><br><span class="line">public <span class="variable">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure></li>
<li>@SpringBootConfiguration：Spring Boot配置类<br>标注在某个类上，表示这是一个SpringBoot的配置类；</li>
<li>@EnableAutoConfiguration：开启自动配置功能<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">   String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">   Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@AutoConfigurationPackage:自动配包<br>@Import({Registrar.class})<br>Spring底层注解@import，给容器中导入一个组件；导入的组件由Registrar.class；<br>将主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器；<br>@Import({AutoConfigurationImportSelector.class})<br>该容器中导入组件<br>AutoConfigurationImportSelector：导入那些组件的选择器；<br>将所有需要导入的组件已全类名的方式返回；这些组件就会被添加到容器中；<br>会该容器中导入非常多的自动配置类（xxxAutoConfiguration）;就是给容器中导入这个场景需要的所有组件；并配置好这些组件；</li>
<li>J2EE的整体整合解决方案和自动配置都在   <pre><code>E:\Maven\repository\org\springframework\boot\spring-boot-autoconfigure\2.2.2.RELEASE\spring-boot-autoconfigure-2.2.2.RELEASE.jar</code></pre><h3 id="使用Spring-Initializer快速创建SpringBoot项目"><a href="#使用Spring-Initializer快速创建SpringBoot项目" class="headerlink" title="使用Spring Initializer快速创建SpringBoot项目"></a>使用Spring Initializer快速创建SpringBoot项目</h3></li>
<li>IDEA都支持使用Spring的项目创建向导快速创建一个项目；</li>
<li>File –》New project–》Spring Initializr<br>![项目结构](images/批注 2019-12-16 225236.png,”项目结构”)<ul>
<li>默认生成的Spring Boot项目<ul>
<li>主程序生成好，我们只需要我们自己的逻辑</li>
<li>resources文件夹中的目录：<ul>
<li>static：保存所有的静态资源：js css html</li>
<li>templates：保存所有的模板页面：（SpringBoot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker，thymeleaf）</li>
<li>application.properties:Spring Boot应用的配置为文件；（如配置端口 server.port=8081）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatis框架(一)</title>
    <url>/2019/12/16/mybatis%E6%A1%86%E6%9E%B6-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="官网地址：https-mybatis-org-mybatis-3-zh-index-html"><a href="#官网地址：https-mybatis-org-mybatis-3-zh-index-html" class="headerlink" title="官网地址：https://mybatis.org/mybatis-3/zh/index.html"></a>官网地址：<a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/zh/index.html</a></h3><h3 id="mybatis结构图"><a href="#mybatis结构图" class="headerlink" title="mybatis结构图"></a>mybatis结构图</h3><p><img src="https://static.oschina.net/uploads/space/2017/1008/165811_hvXz_1400519.png" alt="mybatis"></p>
<h3 id="配置文件介绍…"><a href="#配置文件介绍…" class="headerlink" title="配置文件介绍…."></a>配置文件介绍….</h3><ol>
<li>mybatis配置<br>SqlMapConfig.xml，此文件作为mybatis的全局配置文件，配置了mybatis的运行环境等信息。<br>mapper.xml文件即sql映射文件，文件中配置了操作数据库的sql语句。此文件需要在SqlMapConfig.xml中加载。<br>SqlMapConfig.xml是mybatis的核心文件。mybatis将dao层与sql语句分离开来，虽然写的时候分离开来了，但是执行的时候还是要依靠sql语句，所以我们的sql语句写在Mapper.xml中。我们在加载核心的时候，会加载他下面的Mapper.xml，所以sql语句便会加载进去了。我们只需要在SqlMapConfig.xml中引入Mapper.xml就可以了，所以最后只需要加载SqlMapConfig.xml这一个核心配置文件。</li>
</ol>
<ul>
<li>实例 SqlMapConfig.xml配置文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">       PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.direct.cleanking.backstage.entity"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/direct/cleanking/backstage/dao/AdminMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/direct/cleanking/backstage/dao/TypeMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/direct/cleanking/backstage/dao/UserMapper.xml"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>实例 mapper.xml映射文件<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper</span></span></span><br><span class="line"><span class="xml"> PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="xml"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.direct.cleanking.backstage.dao.AdminDao"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.direct.cleanking.backstage.entity.Admin"</span> <span class="attr">id</span>=<span class="string">"adminMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"nickname"</span> <span class="attr">property</span>=<span class="string">"nickname"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"head_icon"</span> <span class="attr">property</span>=<span class="string">"headIcon"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"login"</span> <span class="attr">resultMap</span>=<span class="string">"adminMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	select  id,username,nickname,description,head_icon  from admin </span></span><br><span class="line"><span class="xml">	where username = #</span><span class="template-variable">&#123;username&#125;</span></span><br><span class="line"><span class="xml">	and password =  #</span><span class="template-variable">&#123;password&#125;</span><span class="xml">   </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultMap</span>=<span class="string">"adminMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	select  *  from  admin </span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username!=null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			username like #</span><span class="template-variable">&#123;username&#125;</span><span class="xml"> </span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname!=null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			and nickname like #</span><span class="template-variable">&#123;nickname&#125;</span><span class="xml"> </span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"description!=null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			and description like #</span><span class="template-variable">&#123;description&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml">	limit #</span><span class="template-variable">&#123;pageNum&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;pageSize&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"count"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	select count(id) from admin</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultMap</span>=<span class="string">"adminMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	select * from  admin where id=#</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"com.direct.cleanking.backstage.entity.Admin"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	update admin  </span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			username = #</span><span class="template-variable">&#123;username&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			,nickname = #</span><span class="template-variable">&#123;nickname&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			,password = #</span><span class="template-variable">&#123;password&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"headIcon != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			,head_icon = #</span><span class="template-variable">&#123;headIcon&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"description != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			,description = #</span><span class="template-variable">&#123;description&#125;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span></span><br><span class="line"><span class="xml">		where id=#</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml">			</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">parameterType</span>=<span class="string">"admin"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	insert into `admin`(`username`,nickname,password,description,head_icon) </span></span><br><span class="line"><span class="xml">	value(#</span><span class="template-variable">&#123;username&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;nickname&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;password&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;description&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;headIcon&#125;</span><span class="xml">);</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delOne"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	delete from admin where id=#</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><p>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂。工厂能帮我们去加载核心配置文件。加载了核心配置文件后就创建session,通过session可以对数据库进行操作。</p>
</li>
<li><p>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行。</p>
</li>
<li><p>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。Executor是执行者，我们不需要管，因为mybatis已经为我们封装好了。mybatis直接执行sql语句。</p>
</li>
<li><p>Mapped Statement也是mybatis一个底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。</p>
</li>
<li><p>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。</p>
</li>
<li><p>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</p>
</li>
<li><p>Mapped Statement是输入与输出中间过程中产生的一些对象，通过这些对象去访问数据库。</p>
<h3 id="结构图"><a href="#结构图" class="headerlink" title="结构图"></a>结构图</h3><p><img src="https://images2018.cnblogs.com/blog/1268854/201803/1268854-20180301135834041-259560906.png" alt=""></p>
</li>
</ol>
<ul>
<li>数据处理层四大对象：<ol>
<li>SQL执行： executor、</li>
<li>参数映射：parameterHandler、</li>
<li>结果处理和映射：ResultSetHandler /      StatementHandler</li>
<li>SQL解析：SqlSource<br><img src="https://img-blog.csdn.net/20180722095805935?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21hMTU3MzI2MjUyNjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></li>
</ol>
</li>
</ul>
<h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><h4 id="导入jar包"><a href="#导入jar包" class="headerlink" title="导入jar包"></a>导入jar包</h4><ul>
<li>MyBatis的核心包和依赖包<br>mybatis-3.2.7.jar(核心包)<br>asm-3.3.1.jar(依赖包)<br>cglib-2.2.2.jar(依赖包)<br>commons-logging-1.1.1.jar(依赖包)<br>javassist-3.17.1-GA.jar(依赖包)<br>log4j-1.2.17.jar(依赖包)<br>log4j-api-2.0-rc1.jar(依赖包)<br>log4j-core-2.0-rc1.jar(依赖包)<br>slf4j-api-1.7.5.jar(依赖包)<br>slf4j-log4j12-1.7.5.jar(依赖包)</li>
<li>MyBatis和Spring的整合包<br>mybatis-spring-1.2.2.jar<h3 id="实例-增删改查"><a href="#实例-增删改查" class="headerlink" title="实例 增删改查"></a>实例 增删改查</h3></li>
<li>mybatis全局配置文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta"> PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta"> "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 环境列表，并指定环境 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 定义环境，并指定名称  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 指定事物处理管理 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 设置数据源参数  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span><span class="comment">&lt;!--设置驱动管理器  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://127.0.0.1:3306/mybatis"</span>/&gt;</span><span class="comment">&lt;!--设置数据库地址  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span><span class="comment">&lt;!--设置数据库账号--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span><span class="comment">&lt;!--设置数据库密码  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!-- 映射文件列表  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 引入映射文件  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/direct/mybatis/entity/ClassesMapper.xml"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/direct/mybatis/entity/StudentMapper.xml"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>实体类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.direct.mybatis.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Classes</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> className;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> desc;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Classes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Classes</span><span class="params">(Integer id, <span class="keyword">String</span> className, <span class="keyword">String</span> desc)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">	<span class="keyword">this</span>.className = className;</span><br><span class="line">	<span class="keyword">this</span>.desc = desc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getClassName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> className;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClassName</span><span class="params">(<span class="keyword">String</span> className)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.className = className;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> desc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(<span class="keyword">String</span> desc)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.desc = desc;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Classes [id="</span> + id + <span class="string">", className="</span> + className + <span class="string">", desc="</span> + desc + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>映射文件<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper</span></span></span><br><span class="line"><span class="xml"> PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="xml"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- namespace 名称空间 ,名称空间不能重复，代理模式名称名称必须设置标准,和对应的dao类的全限名称相同--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.direct.mybatis.dao.ClassesDao"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 select c_id id,c_name className,c_desc `desc` from Classes; </span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签定义的是查询语句  --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签中的属性，parameterType：指定传入的参数类型 </span></span></span><br><span class="line"><span class="xml"> 					    resultType:指定返回值的类型</span></span><br><span class="line"><span class="xml"> 		sql语句中，指定参数，使用 #</span><span class="template-variable">&#123;任意的字符&#125;</span><span class="xml">			    </span></span><br><span class="line"><span class="xml">  --&gt;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>  <span class="attr">resultType</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml"> 	 select c_id id,c_name className,c_desc `desc` from Classes where c_id=#</span><span class="template-variable">&#123;qq&#125;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper</span></span></span><br><span class="line"><span class="xml"> PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="xml"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- namespace 名称空间 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签定义的是查询语句  --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签中的属性，parameterType：指定传入的参数类型 </span></span></span><br><span class="line"><span class="xml"> 					    resultType:指定返回值的类型</span></span><br><span class="line"><span class="xml"> 		sql语句中，指定参数，使用 #</span><span class="template-variable">&#123;任意的字符&#125;</span><span class="xml">			    </span></span><br><span class="line"><span class="xml">  --&gt;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>  <span class="attr">resultType</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">//更新的</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper</span></span></span><br><span class="line"><span class="xml"> PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="xml"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- namespace 名称空间 ,名称空间不能重复，代理模式名称名称必须设置标准,和对应的dao类的全限定名称相同--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.direct.mybatis.dao.ClassesDao"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- #</span></span><span class="template-variable">&#123;id&#125;</span><span class="xml"><span class="comment">指定参数，使用#</span></span><span class="template-variable">&#123;任意字符&#125;</span><span class="xml"><span class="comment">   --&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="comment">&lt;!-- 实体类和表名字段要对应</span></span></span><br><span class="line"><span class="xml">若不对应解决方法：</span></span><br><span class="line"><span class="xml">	1.sql语句加别名   select c_id id。。。。。</span></span><br><span class="line"><span class="xml"> 	2.如下添加<span class="tag">&lt;<span class="name">resultMap</span>&gt;</span>标签</span></span><br><span class="line"><span class="xml"> --&gt;</span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 对象属性和结果集的列名映射  --&gt;</span>	</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"classesMap"</span> <span class="attr">type</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"c_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"className"</span> <span class="attr">column</span>=<span class="string">"c_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"desc"</span> <span class="attr">column</span>=<span class="string">"c_desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!--  条件查询 --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultMap</span>=<span class="string">"classesMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 select * from Classes </span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 条件标签，根据条件拼sql  --&gt;</span></span></span><br><span class="line"><span class="xml">	 <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 <span class="comment">&lt;!-- if判断标签  --&gt;</span></span></span><br><span class="line"><span class="xml">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"cName != null "</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 		c_name like #</span><span class="template-variable">&#123;cName&#125;</span></span><br><span class="line"><span class="xml">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		 <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"desc != null "</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 		and c_desc like #</span><span class="template-variable">&#123;desc&#125;</span><span class="xml"> </span></span><br><span class="line"><span class="xml">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml">	 limit #</span><span class="template-variable">&#123;pageNum&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;pageSize&#125;</span><span class="xml">; </span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签定义的是查询语句  --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- select标签中的属性，parameterType：指定传入的参数类型 </span></span></span><br><span class="line"><span class="xml"> 					    resultType:指定返回值的类型</span></span><br><span class="line"><span class="xml"> 		sql语句中，指定参数，使用 #</span><span class="template-variable">&#123;任意的字符&#125;</span><span class="xml">			    </span></span><br><span class="line"><span class="xml">  --&gt;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOneById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>  <span class="attr">resultType</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml"> 	 select c_id id,c_name className,c_desc `desc` from Classes where c_id=#</span><span class="template-variable">&#123;qq&#125;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- delete标签定义的是删除语句  --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteOneById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> &gt;</span></span></span><br><span class="line"><span class="xml"> 	 delete from classes where c_id=#</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addOne"</span> <span class="attr">parameterType</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml"> 	insert into classes(c_name,c_desc) value(#</span><span class="template-variable">&#123;className&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;desc&#125;</span><span class="xml">);</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!-- parameterType:设置需要传入的对象的类型  --&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateOne"</span> <span class="attr">parameterType</span>=<span class="string">"com.direct.mybatis.entity.Classes"</span>&gt;</span></span></span><br><span class="line"><span class="xml"> 	update classes set c_name=#</span><span class="template-variable">&#123;className&#125;</span><span class="xml">,c_desc=#</span><span class="template-variable">&#123;desc&#125;</span><span class="xml"> where c_id=#</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br><span class="line"><span class="xml"> </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>数据持久层Dao<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.direct.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.direct.mybatis.entity.Classes;</span><br><span class="line"><span class="keyword">import</span> com.mysql.jdbc.Connection;</span><br><span class="line">   <span class="comment">//	注意：增删改需要提交事务否则回滚事务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassesDao</span> &#123;</span></span><br><span class="line"><span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">	<span class="comment">//获取配置文件输入流</span></span><br><span class="line">	InputStream inputStream=null;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		inputStream = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建会话工厂构造者</span></span><br><span class="line">	SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">	<span class="comment">//通过工厂会话构造者根据配置文件构造会话工厂</span></span><br><span class="line">	  sqlSessionFactory =  sqlSessionFactoryBuilder.build(inputStream);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//条件查询</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Classes&gt; findAll(Map <span class="built_in">map</span>)&#123;</span><br><span class="line">	List&lt;Classes&gt; cList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过会话工厂获取会话</span></span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">	<span class="comment">//查询数据,根据sql语句的id值指定调用的sql语句</span></span><br><span class="line">	cList = sqlSession.selectList(<span class="string">"findAll"</span>,<span class="built_in">map</span>);</span><br><span class="line">	<span class="comment">//释放资源,关闭会话</span></span><br><span class="line">	sqlSession.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> cList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据id查询班级</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Classes <span class="title">selectOneById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过会话工厂获取会话</span></span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">	<span class="comment">//查询数据,根据sql语句的id值指定调用的sql语句,并传入指定的参数</span></span><br><span class="line">	Classes classes = sqlSession.selectOne(<span class="string">"selectOneById"</span>, id);</span><br><span class="line">	<span class="comment">//释放资源,关闭会话</span></span><br><span class="line">	sqlSession.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> classes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据id删除班级</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delOneById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">	<span class="comment">//获取会话</span></span><br><span class="line">	SqlSession sqlSession =  sqlSessionFactory.openSession();</span><br><span class="line">	<span class="comment">//执行删除</span></span><br><span class="line">	<span class="keyword">int</span> num =  sqlSession.<span class="keyword">delete</span>(<span class="string">"deleteOneById"</span>,id);</span><br><span class="line">	<span class="comment">//事物提交,所有的数据更新操作都需要提交事物</span></span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	<span class="comment">//关闭回话</span></span><br><span class="line">	sqlSession.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加班级</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addOne</span><span class="params">(Classes classes)</span></span>&#123;</span><br><span class="line">	<span class="comment">//获取会话</span></span><br><span class="line">	SqlSession sqlSession =  sqlSessionFactory.openSession();</span><br><span class="line">	<span class="comment">//执行删除</span></span><br><span class="line">	<span class="keyword">int</span> num =  sqlSession.<span class="keyword">delete</span>(<span class="string">"addOne"</span>,classes);</span><br><span class="line">	<span class="comment">//事物提交,所有的数据更新操作都需要提交事物</span></span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	<span class="comment">//关闭回话</span></span><br><span class="line">	sqlSession.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//修改班级</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateOne</span><span class="params">(Classes classes)</span></span>&#123;</span><br><span class="line">	<span class="comment">//获取会话</span></span><br><span class="line">	SqlSession sqlSession =  sqlSessionFactory.openSession();</span><br><span class="line">	<span class="comment">//执行删除</span></span><br><span class="line">	<span class="keyword">int</span> num =  sqlSession.<span class="keyword">delete</span>(<span class="string">"updateOne"</span>,classes);</span><br><span class="line">	<span class="comment">//事物提交,所有的数据更新操作都需要提交事物</span></span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	<span class="comment">//关闭回话</span></span><br><span class="line">	sqlSession.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.direct.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.direct.mybatis.dao.ClassesDao;</span><br><span class="line"><span class="keyword">import</span> com.direct.mybatis.entity.Classes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisDaoTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	ClassesDao classDao = <span class="keyword">new</span> ClassesDao();</span><br><span class="line">	<span class="comment">//参数集合Map,设置模糊查询条件</span></span><br><span class="line">	Map&lt;<span class="keyword">String</span>, Object&gt; <span class="built_in">map</span> = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	<span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"desc"</span>, <span class="string">"%哈%"</span>);</span><br><span class="line">	<span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"pageNum"</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"pageSize"</span>, <span class="number">2</span>);</span><br><span class="line">	</span><br><span class="line">	List&lt;Classes&gt; cList = classDao.findAll(<span class="built_in">map</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.<span class="built_in">println</span>(cList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectOneTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	ClassesDao classDao = <span class="keyword">new</span> ClassesDao();</span><br><span class="line">	</span><br><span class="line">	Classes classes = classDao.selectOneById(<span class="number">4</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.<span class="built_in">println</span>(classes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delOneTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	ClassesDao classDao = <span class="keyword">new</span> ClassesDao();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> num = classDao.delOneById(<span class="number">5</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.<span class="built_in">println</span>(<span class="string">"删除了"</span>+num+<span class="string">"条数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOneTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	ClassesDao classDao = <span class="keyword">new</span> ClassesDao();</span><br><span class="line">	</span><br><span class="line">	Classes classes = <span class="keyword">new</span> Classes(<span class="string">"a1802"</span>,null);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> num = classDao.addOne(classes);</span><br><span class="line">	</span><br><span class="line">	System.out.<span class="built_in">println</span>(<span class="string">"添加了"</span>+num+<span class="string">"条数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateOneTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	ClassesDao classDao = <span class="keyword">new</span> ClassesDao();</span><br><span class="line">	</span><br><span class="line">	Classes classes = <span class="keyword">new</span> Classes(<span class="number">9</span>,<span class="string">"a1802"</span>,<span class="string">"哈哈哈"</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> num = classDao.updateOne(classes);</span><br><span class="line">	</span><br><span class="line">	System.out.<span class="built_in">println</span>(<span class="string">"修改了"</span>+num+<span class="string">"条数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
————————————————<br>本文参考：CSDN博主「shuaibi.1」<br>原文链接：<a href="https://blog.csdn.net/sinat_37064286/article/details/86768268" target="_blank" rel="noopener">https://blog.csdn.net/sinat_37064286/article/details/86768268</a></li>
</ul>
]]></content>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>java 反射机制详解</title>
    <url>/2019/12/02/java-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="反射：框架设计的灵魂"><a href="#反射：框架设计的灵魂" class="headerlink" title="反射：框架设计的灵魂"></a>反射：框架设计的灵魂</h3><pre><code>* 框架：半成品软件，可以在框架的基础上进行软件开发，简化编码
* 反射：将类的各个组成部分封装为其他对象，这就是反射机制；
    * 好处：
          1. 可以在程序运行过程中，操作这些对象。
          2. 可以解耦，提高程序的可扩展性 </code></pre><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><ul>
<li><p>定义：JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。</p>
</li>
<li><p>用途：在日常的第三方应用开发过程中，经常会遇到某个类的某个成员变量、方法或是属性是私有的或是只对系统应用开放，这时候就可以利用Java的反射机制通过反射来获取所需的私有成员或是方法。</p>
<h4 id="反射机制的相关类"><a href="#反射机制的相关类" class="headerlink" title="反射机制的相关类"></a>反射机制的相关类</h4></li>
<li><p>获取Class(字节码文件)对象的方式：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>方法</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td>Class.forName(“全类名”)</td>
<td align="center">将字节码文件加载进内存，返回class对象(一般用于：配置文件，将类名定义在配置文件中。读取文件，加载类)</td>
</tr>
<tr>
<td>类名.class</td>
<td align="center">通过类名属性class属性获取(一般用于：参数的传递)</td>
</tr>
<tr>
<td>对象.getClass()</td>
<td align="center">getClass()方法在Object类中定义的(一般用于：对象获取字节码方式)</td>
</tr>
<tr>
<td>- 注意：同一个字节码文件(*.class)在一次程序运行过程中，只被加载一次，不论那种方式获取的class对象都是同一个。</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>与Java反射相关的类如下：<br>类名|用途<br>–|:–:<br>Class类|代表类的实体，在运行的Java应用程序中表示类和接口<br>Field类|代表类的成员变量（成员变量也称为类的属性）<br>Method类|代表类的方法<br>Constructor类|代表类的构造方法</p>
<h4 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h4><ul>
<li>Class代表类的实体，在运行的Java应用程序中表示类和接口。在这个类中提供了很多有用的方法，这里对他们简单的分类介绍。<h5 id="获得类相关的方法"><a href="#获得类相关的方法" class="headerlink" title="获得类相关的方法"></a>获得类相关的方法</h5></li>
</ul>
<table>
<thead>
<tr>
<th>方法</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody><tr>
<td>asSubclass(Class<U> clazz)</td>
<td align="center">把传递的类的对象转换成代表其子类的对象</td>
</tr>
<tr>
<td>Cast</td>
<td align="center">把对象转换成代表类或是接口的对象</td>
</tr>
<tr>
<td>getClassLoader()</td>
<td align="center">获得类的加载器</td>
</tr>
<tr>
<td>getClasses()</td>
<td align="center">返回一个数组，数组中包含该类中所有公共类和接口类的对象</td>
</tr>
<tr>
<td>getDeclaredClasses()</td>
<td align="center">返回一个数组，数组中包含该类中所有类和接口类的对象</td>
</tr>
<tr>
<td>forName(String className)</td>
<td align="center">根据类名返回类的对象</td>
</tr>
<tr>
<td>getName()</td>
<td align="center">获得类的完整路径名字</td>
</tr>
<tr>
<td>newInstance()</td>
<td align="center">创建类的实例</td>
</tr>
<tr>
<td>getPackage()</td>
<td align="center">获得类的包</td>
</tr>
<tr>
<td>getSimpleName()</td>
<td align="center">获得类的名字</td>
</tr>
<tr>
<td>getSuperclass()</td>
<td align="center">获得当前类继承的父类的名字</td>
</tr>
<tr>
<td>getInterfaces()</td>
<td align="center">获得当前类实现的类或是接口</td>
</tr>
</tbody></table>
<h5 id="获得类中属性相关的方法"><a href="#获得类中属性相关的方法" class="headerlink" title="获得类中属性相关的方法"></a>获得类中属性相关的方法</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>Field[] getField(String name)</td>
<td align="left">获得某个公有的属性对象</td>
</tr>
<tr>
<td>Field[] getFields()</td>
<td align="left">获得所有公有的属性对象</td>
</tr>
<tr>
<td>Field[] getDeclaredField(String name)</td>
<td align="left">获得某个属性对象</td>
</tr>
<tr>
<td>Field[] getDeclaredFields()</td>
<td align="left">获得所有属性对象</td>
</tr>
</tbody></table>
<h5 id="获得类中注解相关的方法"><a href="#获得类中注解相关的方法" class="headerlink" title="获得类中注解相关的方法"></a>获得类中注解相关的方法</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>Field[] getAnnotation(Class<A> annotationClass)</td>
<td align="left">返回该类中与参数类型匹配的公有注解对象</td>
</tr>
<tr>
<td>Field[] getAnnotations()</td>
<td align="left">返回该类所有的公有注解对象</td>
</tr>
<tr>
<td>Field[] getDeclaredAnnotation(Class<A> annotationClass)</td>
<td align="left">返回该类中与参数类型匹配的所有注解对象</td>
</tr>
<tr>
<td>Field[] getDeclaredAnnotations()</td>
<td align="left">返回该类所有的注解对象</td>
</tr>
</tbody></table>
<h5 id="获得类中构造器相关的方法"><a href="#获得类中构造器相关的方法" class="headerlink" title="获得类中构造器相关的方法"></a>获得类中构造器相关的方法</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>Constructor<?>[] getConstructor(Class...<?> Constructor&lt;?&gt;[] parameterTypes)</td>
<td align="left">获得该类中与参数类型匹配的公有构造方法</td>
</tr>
<tr>
<td>Constructor&lt;?&gt;[] getConstructors()</td>
<td align="left">获得该类的所有公有构造方法</td>
</tr>
<tr>
<td>Constructor<?>[] getDeclaredConstructor(Class...<?> parameterTypes)</td>
<td align="left">获得该类中与参数类型匹配的构造方法</td>
</tr>
<tr>
<td>Constructor&lt;?&gt;[] getDeclaredConstructors()</td>
<td align="left">获得该类所有构造方法</td>
</tr>
</tbody></table>
<h5 id="获得类中方法相关的方法"><a href="#获得类中方法相关的方法" class="headerlink" title="获得类中方法相关的方法"></a>获得类中方法相关的方法</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>Method[] getMethod(String name, Class…&lt;?&gt; parameterTypes)</td>
<td align="left">获得该类某个公有的方法</td>
</tr>
<tr>
<td>Method[] getMethods()</td>
<td align="left">获得该类所有公有的方法</td>
</tr>
<tr>
<td>Method[] getDeclaredMethod(String name, Class…&lt;?&gt; parameterTypes)</td>
<td align="left">获得该类某个方法</td>
</tr>
<tr>
<td>Method[] getDeclaredMethods()</td>
<td align="left">获得该类所有方法</td>
</tr>
</tbody></table>
<h5 id="类中其他重要的方法"><a href="#类中其他重要的方法" class="headerlink" title="类中其他重要的方法"></a>类中其他重要的方法</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>isAnnotation()</td>
<td align="left">如果是注解类型则返回true</td>
</tr>
<tr>
<td>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</td>
<td align="left">如果是指定类型注解类型则返回true</td>
</tr>
<tr>
<td>isAnonymousClass()</td>
<td align="left">如果是匿名类则返回true</td>
</tr>
<tr>
<td>isArray()</td>
<td align="left">如果是一个数组类则返回true</td>
</tr>
<tr>
<td>isEnum()</td>
<td align="left">如果是枚举类则返回true</td>
</tr>
<tr>
<td>isInstance(Object obj)</td>
<td align="left">如果obj是该类的实例则返回true</td>
</tr>
<tr>
<td>isInterface()</td>
<td align="left">如果是接口类则返回true</td>
</tr>
<tr>
<td>isLocalClass()</td>
<td align="left">如果是局部类则返回true</td>
</tr>
<tr>
<td>isMemberClass()</td>
<td align="left">如果是内部类则返回true</td>
</tr>
</tbody></table>
<h5 id="Field类-Field代表类的成员变量（成员变量也称为类的属性）。"><a href="#Field类-Field代表类的成员变量（成员变量也称为类的属性）。" class="headerlink" title="Field类|Field代表类的成员变量（成员变量也称为类的属性）。"></a>Field类|Field代表类的成员变量（成员变量也称为类的属性）。</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>equals(Object obj)</td>
<td align="left">属性与obj相等则返回true</td>
</tr>
<tr>
<td>get(Object obj)</td>
<td align="left">获得obj中对应的属性值</td>
</tr>
<tr>
<td>set(Object obj, Object value)</td>
<td align="left">设置obj中对应属性值</td>
</tr>
</tbody></table>
<h5 id="Method类-Method代表类的方法。"><a href="#Method类-Method代表类的方法。" class="headerlink" title="Method类|Method代表类的方法。"></a>Method类|Method代表类的方法。</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>invoke(Object obj, Object… args)</td>
<td align="left">传递object对象及参数调用该对象对应的方法</td>
</tr>
</tbody></table>
<h5 id="Constructor类-Constructor代表类的构造方法。"><a href="#Constructor类-Constructor代表类的构造方法。" class="headerlink" title="Constructor类|Constructor代表类的构造方法。"></a>Constructor类|Constructor代表类的构造方法。</h5><table>
<thead>
<tr>
<th>方法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td>newInstance(Object… initargs)</td>
<td align="left">根据传递的参数创建类的对象</td>
</tr>
</tbody></table>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><ul>
<li><p>获取成员变量</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/*1. 获取成员变量们</span></span><br><span class="line"><span class="comment">  * Field[] getFields();  获取public修饰的成员变量</span></span><br><span class="line"><span class="comment">  * Field[] getField(String name); 获取指定的public修饰的成员变量</span></span><br><span class="line"><span class="comment">  * Field[] getDeclaredFields();</span></span><br><span class="line"><span class="comment">  * Field[] getDeclaredField(String name);</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> test &#123;</span><br><span class="line">   <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) throws NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">       //<span class="number">0.</span>获取Person的<span class="keyword">class</span>对象</span><br><span class="line">       <span class="keyword">Class</span> personClass = Person.<span class="keyword">class</span>;</span><br><span class="line">       //<span class="number">1.</span>Field[] getFields() 获取所有<span class="built_in">public</span>修饰的成员变量</span><br><span class="line">       Field[] fields = personClass.getFields();</span><br><span class="line">       <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(field);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println("---------");</span><br><span class="line">       //<span class="number">1.</span>Field[] getFields(String <span class="type">name</span>) 获取指定<span class="built_in">public</span>修饰的成员变量</span><br><span class="line">       Field mimi = personClass.getField("mimi");</span><br><span class="line">       //操作<span class="keyword">get</span>|<span class="keyword">set</span></span><br><span class="line">       Person p = <span class="built_in">new</span> Person();</span><br><span class="line">       <span class="keyword">Object</span> <span class="keyword">value</span> = mimi.<span class="keyword">get</span>(p);</span><br><span class="line">       //mimi.<span class="keyword">set</span>("咪咪");</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">value</span>);</span><br><span class="line">       mimi.<span class="keyword">set</span>(p, "咪咪");</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(p);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println("-----------");</span><br><span class="line">       //<span class="number">3.</span>Field[] getDeclareFields() 获取所有的成员变量,不考虑修饰符</span><br><span class="line">       Field[] declaredFields = personClass.getDeclaredFields();</span><br><span class="line">       <span class="keyword">for</span> (Field field : declaredFields) &#123;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(field);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println("-----------");</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       *4.Field[] getDeclareFields(String name)</span></span><br><span class="line"><span class="comment">       * 获取指定的成员变量,注意设置私有的属性是汇报错</span></span><br><span class="line"><span class="comment">       * 解决方法：暴力反射</span></span><br><span class="line"><span class="comment">       * 忽略访问修饰符的安全检查</span></span><br><span class="line"><span class="comment">       * 对象.setAccessible()</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">       Field <span class="type">name</span> = personClass.getDeclaredField("name");</span><br><span class="line">       //忽略访问修饰符的安全检查</span><br><span class="line">       <span class="type">name</span>.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">Object</span> value2 = <span class="type">name</span>.<span class="keyword">get</span>(p);</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(value2);</span><br><span class="line">       <span class="type">name</span>.<span class="keyword">set</span>(p, "赵明");</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(p);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>获取构造器</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public static void main(String<span class="literal">[]</span> args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">      <span class="comment">//0.获取Person的class对象</span></span><br><span class="line">      Class personClass = <span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*2. 获取构造方法们</span></span><br><span class="line"><span class="comment">      * Constructor&lt;?&gt;[] getConstructors();</span></span><br><span class="line"><span class="comment">      * Constructor&lt;T&gt;[] getConstructor(类&lt;?&gt;... parameterTypes);</span></span><br><span class="line"><span class="comment">      * Constructor&lt;?&gt;[] getDeclaredConstructors();</span></span><br><span class="line"><span class="comment">      * Constructor&lt;T&gt;[] getDeclaredConstructor(类&lt;?&gt;... parameterTypes);</span></span><br><span class="line"><span class="comment">      **/</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取构造器Constructor&lt;T&gt; getConstructor（类&lt;?&gt;.... parameterTypes）  创建对象的</span></span><br><span class="line">      Constructor constructor = personClass.get<span class="constructor">Constructor(String.<span class="params">class</span>,<span class="params">int</span>.<span class="params">class</span>)</span>;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(constructor);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建对象.newInstance("莉莉",23);</span></span><br><span class="line">      Object person  = constructor.<span class="keyword">new</span><span class="constructor">Instance(<span class="string">"莉莉"</span>,23)</span>;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(person);</span><br><span class="line"></span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"======================="</span>);</span><br><span class="line">      <span class="comment">//空参的构造方法</span></span><br><span class="line">      Constructor constructor1 = personClass.get<span class="constructor">Constructor()</span>;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(constructor1);</span><br><span class="line">      <span class="comment">//创建对象</span></span><br><span class="line">      Object person1  = constructor1.<span class="keyword">new</span><span class="constructor">Instance()</span>;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(person1);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Class类创建对象方法,一般使用此方法比较简单</span></span><br><span class="line">      Object o = personClass.<span class="keyword">new</span><span class="constructor">Instance()</span>;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(o);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取成员方法</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public static void main(String<span class="literal">[]</span> args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">        <span class="comment">//0.获取Person的class对象</span></span><br><span class="line">        Class personClass = <span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*3. 获取成员方法们</span></span><br><span class="line"><span class="comment">         * Method[] getMethod()</span></span><br><span class="line"><span class="comment">         * Method getMethod(String name,类&lt;?&gt;... parameterTypes)</span></span><br><span class="line"><span class="comment">         * Method[] getDeclaredMethod()</span></span><br><span class="line"><span class="comment">         * Method getDeclaredMethod(String name,类&lt;?&gt;... parameterTypes)</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        <span class="comment">//获取指定名称的方法  无参</span></span><br><span class="line">        Method eat = personClass.get<span class="constructor">Method(<span class="string">"eat"</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行方法 Object invoke(Object);</span></span><br><span class="line">        Person person = <span class="keyword">new</span> <span class="constructor">Person()</span>;</span><br><span class="line">        eat.invoke(person);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取指定名称的方法  有参</span></span><br><span class="line">        Method eat_method = personClass.get<span class="constructor">Method(<span class="string">"eat"</span>,String.<span class="params">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行方法 Object invoke(Object);</span></span><br><span class="line">        Person person1 = <span class="keyword">new</span> <span class="constructor">Person()</span>;</span><br><span class="line">        eat_method.invoke(person1,<span class="string">"好吃的"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"+++++++++++++++++++++++++++++++++++++"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取所有public修饰的方法</span></span><br><span class="line">        Method<span class="literal">[]</span> methods = personClass.get<span class="constructor">Methods()</span>;</span><br><span class="line">        for (Method <span class="keyword">method</span> : methods)&#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="keyword">method</span>);</span><br><span class="line">            <span class="comment">//获取方法名称</span></span><br><span class="line">            String name = <span class="keyword">method</span>.get<span class="constructor">Name()</span>;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(name);</span><br><span class="line">            <span class="comment">//method.setAccessible(true);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取全限定类名 4. 获取类名 String getName()</span></span><br><span class="line">        String classname = personClass.get<span class="constructor">Name()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(classname);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h3></li>
<li><p>需求：写一个”框架”,可以帮我们 创建任意类的对象，并且执行其中任意方法</p>
</li>
<li><p>不改变类的任何代码，可以创建任意类的对象，可以执行任意方法</p>
</li>
<li><p>pro.properties配置文件</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全部限定类名</span></span><br><span class="line"><span class="attr">className</span> = Test.Person</span><br><span class="line"><span class="comment">#方法名</span></span><br><span class="line"><span class="attr">methodName</span> = eat</span><br><span class="line"></span><br><span class="line"><span class="comment">#className = Test.Student</span></span><br><span class="line"><span class="comment">#methodName = sleep</span></span><br></pre></td></tr></table></figure></li>
<li><p>测试类</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public static void main(String<span class="literal">[]</span> args) throws IOException, ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException &#123;</span><br><span class="line">      <span class="comment">//可以执行创建任意类的对象，可以执行任意方法</span></span><br><span class="line">      <span class="comment">//不改变类的任何代码，可以创建任意类的对象，可以执行任意方法</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//Person person = new Person();</span></span><br><span class="line">      <span class="comment">//person.eat();</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//加载配置文件</span></span><br><span class="line">      <span class="comment">//1.创建properties对象</span></span><br><span class="line">      Properties pro = <span class="keyword">new</span> <span class="constructor">Properties()</span>;</span><br><span class="line">      <span class="comment">//2.加载配置文件，转换为一个集合</span></span><br><span class="line">      <span class="comment">//2.1获取Class目录下的配置文件</span></span><br><span class="line">      ClassLoader classLoader = <span class="module-access"><span class="module"><span class="identifier">Refleat</span>.</span></span><span class="keyword">class</span>.get<span class="constructor">ClassLoader()</span>;</span><br><span class="line">      InputStream is = classLoader.get<span class="constructor">ResourceAsStream(<span class="string">"pro.properties"</span>)</span>;</span><br><span class="line">      pro.load(is);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//3.获取配置文件中定义的数据</span></span><br><span class="line">      String classname = pro.get<span class="constructor">Property(<span class="string">"className"</span>)</span>;</span><br><span class="line">      String <span class="keyword">method</span> = pro.get<span class="constructor">Property(<span class="string">"methodName"</span>)</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//4.加载该类进内存</span></span><br><span class="line">      Class cls = <span class="module-access"><span class="module"><span class="identifier">Class</span>.</span></span>for<span class="constructor">Name(<span class="params">classname</span>)</span>;</span><br><span class="line">      <span class="comment">//5.创建对象</span></span><br><span class="line">      Object obj = cls.<span class="keyword">new</span><span class="constructor">Instance()</span>;</span><br><span class="line">      <span class="comment">//6.获取方法对象</span></span><br><span class="line">      Method method1 = cls.get<span class="constructor">Method(<span class="params">method</span>)</span>;</span><br><span class="line">      <span class="comment">//7.执行方法</span></span><br><span class="line">      method1.invoke(obj);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2 框架(三)</title>
    <url>/2019/11/30/Struts2-%E6%A1%86%E6%9E%B6-%E4%B8%89/</url>
    <content><![CDATA[<h4 id="OGNL表达式"><a href="#OGNL表达式" class="headerlink" title="OGNL表达式"></a>OGNL表达式</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span></span><br><span class="line"><span class="xml">    pageEncoding="UTF-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>ognl表达式<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- ognl表达式</span></span></span><br><span class="line"><span class="xml">	1.s:property表示从作用域取值 有‘’号表示字符串 </span></span><br><span class="line"><span class="xml">	2.可调用方法</span></span><br><span class="line"><span class="xml">	3.访问静态属性</span></span><br><span class="line"><span class="xml">	默认情况下，struts2把静态属性访问禁止，如果使用需要打开</span></span><br><span class="line"><span class="xml">	4.封装list数据，数组  Map集合#</span><span class="template-variable">&#123;key:value&#125;</span><span class="xml">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">" 'java struts' "</span>/&gt;</span>的长度</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">" 'java struts'.length() "</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">int的最大值<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"@java.lang.Integer@MAX_VALUE"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">随机数：<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"@java.lang.Math@random()*10"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">数组：<span class="tag">&lt;<span class="name">s:radio</span> <span class="attr">list</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;'男','女'&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">name</span>=<span class="string">"Sex"</span> <span class="attr">label</span>=<span class="string">"性别"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:radio</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">Map集合:<span class="tag">&lt;<span class="name">s:radio</span> <span class="attr">list</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;'nan':'男','nv':'女'&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">name</span>=<span class="string">"Sex"</span> <span class="attr">label</span>=<span class="string">"性别"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:radio</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="ActionContext"><a href="#ActionContext" class="headerlink" title="ActionContext"></a>ActionContext</h3><ul>
<li><p>ActionContext它是action上下文，strtus2框架它使用actionContext来保存Action在执行过程中所需要的一些对象，例如 session, application…</p>
</li>
<li><p>意思就是:<br>Struts2会根据每一次的http请求来创建对应的ActionContext,它是与当前线程绑定的。</p>
</li>
<li><p>每一次请求，就是一个线程，对应着一个request,每一次请求，会创建一个Action,每一个action对应一个ActionContext.每一次请求也对应着一个valueStack.</p>
</li>
<li><p>request—ActionContext—-Action—–ValueStack它们都对应着一次请求(一个线程).</p>
</li>
<li><p>只有存在了action才会存在action上下文(也就是ActionContext)</p>
</li>
<li><p>在ActionContext中持有valuestack中context的引用,而在context中持有root的引用</p>
</li>
<li><p>ValueStack存储数据:<br>如果通过valueStack.set(name,value)存储的,可以在页面是使用&lt;s:property value=”name”&gt;获取<br>如果通过valuestack.push(value)存储的,可以根据它在root中的序号来获取.例如<br>&lt;s:property value=”[1].top”&gt;</p>
</li>
<li><p>ActionContext就是ValueStack中的context,(就是一个容器)属于Map集合,存储session,request,response等对象,只有有了action才会有  ActionContext;所在它持有对root的引用,也就是持有对valuestack中compoundRoot(对象栈)的引用,里面主要存储action的相关数据;</p>
<h4 id="valueStack内部结构"><a href="#valueStack内部结构" class="headerlink" title="valueStack内部结构"></a>valueStack内部结构</h4></li>
<li><p>ValueStack的组成:<br>它就是一个ArrayList 和 context<br>在struts2框架中我们通过ognl表达式来获取valueStack中数据，没有使用#就会从CompoundRoot中获取数据，<br>如果使用#来获取，这时就会从context中来获取<br>CompoundRoot主要存储的是action的相关数据;其实就是一个ArrayList<br>context 其实就是一个Map集合</p>
</li>
<li><p>主要存储了一些引用，这个引用主要是关于web开发中相关信息<br>pameters :请求 参数<br>request:请求对象中所有属性<br>session:会话对象中所有属性<br>application:application对象中的所有发展<br>其中的context对象是OGNLContext，它实现了map接口，在valueStack的默认实现类中，OgnlValueStack中调用OGNL方法，返回一个OgnlContext对象。</p>
</li>
<li><p>往ActionContext中存数据</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">TextAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	public <span class="type">String</span> execute()&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//往ActionContext中存数据</span></span><br><span class="line">	    <span class="type">ActionContext</span> contextMap = <span class="type">ActionContext</span>.getContext();</span><br><span class="line">	    contextMap.put(<span class="string">"username"</span>, <span class="string">"zhao2"</span>);</span><br><span class="line">	    contextMap.put(<span class="string">"password"</span>, <span class="string">"zhao1256"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>struts.xml 核心配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置常量  struts.action.extension表示后缀--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--&lt;constant name="struts.action.extension" value="php"&gt;&lt;/constant&gt;--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.ognl.allowStaticMethodAccess"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- abstract="true"抽象 用于继承 若包有abstract="true"属性  有包继承此包即可是有所有功能</span></span><br><span class="line"><span class="comment">	          一般抽象包不声明Action --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- namespace="/" 命名空间， 访问路径，默认为空字符串</span></span><br><span class="line"><span class="comment">	      可有用于模块划分--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;package name="p1" extends="struts-default" namespace="/" abstract="true"&gt; --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.TextAction"</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>取值</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="ruby">    pageEncoding=<span class="string">"UTF-8"</span></span><span class="xml">%&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@ taglib uri=<span class="string">"/struts-tags"</span> prefix=<span class="string">"s"</span> </span><span class="xml"><span class="tag">%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 取值&lt;s:property value=""/&gt; </span></span></span><br><span class="line"><span class="xml">	value写ONGL表达式</span></span><br><span class="line"><span class="xml">	取contextMap，写 #+key</span></span><br><span class="line"><span class="xml">	取valueStack，写key</span></span><br><span class="line"><span class="xml">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="comment">&lt;!--  valueStack：&lt;s:property value="zhao"/&gt;--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!--&lt;%</span></span><span class="ruby">session.setAttribute(<span class="string">"github"</span>, <span class="string">"outstanding99"</span>); </span><span class="xml"><span class="comment">%&gt;--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="往值栈（ValueStack）存数据"><a href="#往值栈（ValueStack）存数据" class="headerlink" title="往值栈（ValueStack）存数据"></a>往值栈（ValueStack）存数据</h3><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Domo1Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">public <span class="type">String</span> execute() <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	<span class="comment">//往值栈（ValueStack）存数据</span></span><br><span class="line">	<span class="type">ValueStack</span> vs = <span class="type">ActionContext</span>.getContext().getValueStack();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//put方法</span></span><br><span class="line">	vs.push(<span class="keyword">new</span> <span class="type">User</span>(<span class="string">"zhao"</span>,<span class="string">"123456"</span>));</span><br><span class="line">	vs.push(<span class="keyword">new</span> <span class="type">User</span>(<span class="string">"ji"</span>,<span class="string">"789456"</span>));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//setvalue</span></span><br><span class="line">	</span><br><span class="line">	vs.setValue(<span class="string">"iiik"</span>, <span class="string">"rgsdg"</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//contextMap里存值</span></span><br><span class="line">	vs.setValue(<span class="string">"#iiik"</span>, <span class="string">"rgsdg"</span>);</span><br><span class="line">	<span class="comment">//valueStack存map类型的值</span></span><br><span class="line">	vs.set(<span class="string">"user"</span>,<span class="keyword">new</span> <span class="type">User</span>(<span class="string">"120"</span>,<span class="string">"130"</span>));</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>取值</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&lt;s:property/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	ValueStack vs = ActionContext.getContext().getValueStack();</span><br><span class="line">	String <span class="keyword">value</span> =(String)vs.findValue("user");</span><br><span class="line">    //<span class="keyword">out</span>.<span class="keyword">write</span>(<span class="keyword">value</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;s:<span class="keyword">debug</span>&gt;&lt;/s:<span class="keyword">debug</span>&gt;</span><br></pre></td></tr></table></figure>
<h4 id="iterator-迭代"><a href="#iterator-迭代" class="headerlink" title="iterator 迭代"></a>iterator 迭代</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">import</span>=<span class="string">"com.opensymphony.xwork2.util.ValueStack"</span>%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">import</span>=<span class="string">"com.opensymphony.xwork2.ActionContext"</span>%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span></span><br><span class="line"><span class="xml">    pageEncoding="UTF-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">1</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">th</span>&gt;</span>城市<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- value 值栈变量名</span></span></span><br><span class="line"><span class="xml">		var:遍历的变量名 存到contextMap中 </span></span><br><span class="line"><span class="xml">		status 遍历状态--&gt;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">value</span>=<span class="string">"user"</span> <span class="attr">var</span>=<span class="string">"u"</span> <span class="attr">status</span>=<span class="string">"st"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#u.name"</span>/&gt;</span>-$</span><span class="template-variable">&#123;u.name&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#u.age"</span>/&gt;</span>-$</span><span class="template-variable">&#123;u.age&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#u.city"</span>/&gt;</span>-$</span><span class="template-variable">&#123;u.city&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$</span><span class="template-variable">&#123;st.odd&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span>	</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 往作用域存数据</span></span></span><br><span class="line"><span class="xml">	value：值</span></span><br><span class="line"><span class="xml">	var：变量名</span></span><br><span class="line"><span class="xml">	scope：作用域 可写类型 application session request page action</span></span><br><span class="line"><span class="xml">	不写就是action</span></span><br><span class="line"><span class="xml"> --&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">value</span>=<span class="string">"'阿尔提尔'"</span>  <span class="attr">var</span>=<span class="string">"username"</span> <span class="attr">scope</span>=<span class="string">"application"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:set</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">value</span>=<span class="string">"'阿尔提尔1'"</span>  <span class="attr">var</span>=<span class="string">"username1"</span> <span class="attr">scope</span>=<span class="string">"session"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:set</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">value</span>=<span class="string">"'阿尔提尔2'"</span>  <span class="attr">var</span>=<span class="string">"username2"</span> <span class="attr">scope</span>=<span class="string">"request"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:set</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">value</span>=<span class="string">"'阿尔提尔3'"</span>  <span class="attr">var</span>=<span class="string">"username3"</span> <span class="attr">scope</span>=<span class="string">"action"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:set</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 取值 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#application.username"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#session.username1"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#request.username2"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#action.username3"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 表单提交 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:form</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 下拉框 --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:select</span> <span class="attr">list</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;'重庆','甘肃','哈密','陇西','通渭县'&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">label</span>=<span class="string">"城市"</span> <span class="attr">name</span>=<span class="string">"city"</span> <span class="attr">headerkey</span>=<span class="string">""</span> <span class="attr">headerValue</span>=<span class="string">"-请选择城市-"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:select</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:select</span> <span class="attr">list</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;'-请选择城市-','重庆','甘肃','哈密','陇西','通渭县'&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">label</span>=<span class="string">"城市"</span> <span class="attr">name</span>=<span class="string">"city"</span> &gt;</span><span class="tag">&lt;/<span class="name">s:select</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 文本域 --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:textarea</span> <span class="attr">label</span>=<span class="string">"备注"</span> <span class="attr">rows</span>=<span class="string">'10'</span> <span class="attr">clos</span>=<span class="string">'50'</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textarea</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:reset</span> <span class="attr">value</span>=<span class="string">'重置'</span>&gt;</span><span class="tag">&lt;/<span class="name">s:reset</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:submit</span> <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">theme</span>=<span class="string">'simple'</span>&gt;</span><span class="tag">&lt;/<span class="name">s:submit</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">s:form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">action</span>=<span class="string">"domo1"</span> <span class="attr">var</span>=<span class="string">"myurl"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>jojo<span class="tag">&lt;/<span class="name">s:param</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span>228<span class="tag">&lt;/<span class="name">s:param</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"city"</span>&gt;</span>重庆<span class="tag">&lt;/<span class="name">s:param</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;s:property value='#myurl'/&gt;"</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="token令牌（表单重复提交）"><a href="#token令牌（表单重复提交）" class="headerlink" title="token令牌（表单重复提交）"></a>token令牌（表单重复提交）</h3></li>
<li><p>Struts 2标签中的token标签，可以用来生成一个独一无二的标记。</p>
</li>
<li><p>这个标记必须嵌套在form标签中使用，它会在表单里插入一个隐藏字段并把标记保存到HttpSession对象里。</p>
</li>
<li><p>toke标签必须与Token或Token Session拦截器配合使用，两个拦截器都能对token标签进行处理。</p>
</li>
<li><p>Token拦截器遇到重复提交表单的情况，会返回一个”invalid.token”结果并加上一个动作级别的错误。</p>
</li>
<li><p>Token Session拦截器扩展了Token拦截器并提供了一种更复杂的服务，它采取的做法与Token拦截器不同，它只是阻断了后续的提交，这样用户不提交多少次，就好像只是提交了一次。 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"Login"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.acton.LoginAction"</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/scccess.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"token"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"invalid.token"</span>&gt;</span>/invalidtoken.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:form</span> <span class="attr">action</span>=<span class="string">"avoid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:token</span>&gt;</span><span class="tag">&lt;/<span class="name">s:token</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">label</span>=<span class="string">"Enter your name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textfield</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">label</span>=<span class="string">"Enter your birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textfield</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:submit</span> <span class="attr">value</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:submit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <tags>
        <tag>Struts2框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2 框架(二)</title>
    <url>/2019/11/30/Struts2-%E6%A1%86%E6%9E%B6-%E4%BA%8C/</url>
    <content><![CDATA[<h3 id="struts2表单验证"><a href="#struts2表单验证" class="headerlink" title="struts2表单验证"></a>struts2表单验证</h3><h4 id="JSP页面"><a href="#JSP页面" class="headerlink" title="JSP页面"></a>JSP页面</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span></span><br><span class="line"><span class="xml">    pageEncoding="UTF-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:head</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:fielderror</span>&gt;</span><span class="tag">&lt;/<span class="name">s:fielderror</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;pageContext.request.contextPath &#125;</span><span class="xml"><span class="tag"><span class="string">/regirster.action"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	密&amp;emsp;码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	生&amp;emsp;日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"brithday"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	爱&amp;emsp;好：</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"hobby"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"写代码"</span>/&gt;</span>写代码</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"hobby"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"泡妞"</span>/&gt;</span>泡妞</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"hobby"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"运动"</span>/&gt;</span>运动</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	是否已婚：</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"married"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>未婚</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"married"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span>已婚</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="properties文件"><a href="#properties文件" class="headerlink" title="properties文件"></a>properties文件</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#连接设置</span></span><br><span class="line"><span class="attr">driverClassName</span>=com.mysql.jdbc.Driver</span><br><span class="line"><span class="attr">url</span>=jdbc:mysql://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span>/struts2?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">username</span>=root</span><br><span class="line"><span class="attr">password</span>=</span><br><span class="line"><span class="comment">#初始化连接</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="number">5</span></span><br><span class="line"><span class="comment">#最大连接数量</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="number">10</span></span><br><span class="line"><span class="comment">#最大空闲连接</span></span><br><span class="line"><span class="attr">maxIdle</span>=<span class="number">10</span></span><br></pre></td></tr></table></figure>
<h4 id="dbcp连接数据库工具类"><a href="#dbcp连接数据库工具类" class="headerlink" title="dbcp连接数据库工具类"></a>dbcp连接数据库工具类</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">package com.zhao.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp2.BasicDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBCPUtils</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">DataSource</span> ds = null;</span><br><span class="line">	<span class="keyword">static</span>&#123;</span><br><span class="line">		<span class="type">Properties</span> prop = new <span class="type">Properties</span>();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="type">InputStream</span> <span class="keyword">in</span> =new <span class="type">DBCPUtils</span>().getClass().getClassLoader().getResourceAsStream(<span class="string">"dbcp.properties"</span>);</span><br><span class="line">			prop.load(<span class="keyword">in</span>);</span><br><span class="line">			ds = <span class="type">BasicDataSourceFactory</span>.createDataSource(prop);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(<span class="type">Exception</span> e)&#123;</span><br><span class="line">			<span class="keyword">throw</span> new <span class="type">ExceptionInInitializerError</span>(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//	提供一个数据源的方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">DataSource</span> getDataSource()&#123;</span><br><span class="line">		<span class="keyword">return</span> ds;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//	提供一个获取连接的方法，注意以后获取链接，必须使用该方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> getConnection() <span class="keyword">throws</span> <span class="type">SQLException</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ds.getConnection();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//	 public static void release(Connection conn,Statement stmt,ResultSet rs)&#123;</span></span><br><span class="line"><span class="comment">//	         if(rs!=null)&#123;</span></span><br><span class="line"><span class="comment">//		            try&#123;</span></span><br><span class="line"><span class="comment">//		                  //关闭存储查询结果的ResultSet对象</span></span><br><span class="line"><span class="comment">//		                 rs.close();</span></span><br><span class="line"><span class="comment">//		            &#125;catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//		                 e.printStackTrace();</span></span><br><span class="line"><span class="comment">//		             &#125;</span></span><br><span class="line"><span class="comment">//		            rs = null;</span></span><br><span class="line"><span class="comment">//		        &#125;</span></span><br><span class="line"><span class="comment">//		         if(stmt!=null)&#123;</span></span><br><span class="line"><span class="comment">//		             try&#123;</span></span><br><span class="line"><span class="comment">//		                  //关闭负责执行SQL命令的Statement对象</span></span><br><span class="line"><span class="comment">//		                 stmt.close();</span></span><br><span class="line"><span class="comment">//		             &#125;catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//		                  e.printStackTrace();</span></span><br><span class="line"><span class="comment">//		            &#125;</span></span><br><span class="line"><span class="comment">//		          &#125;</span></span><br><span class="line"><span class="comment">//		         </span></span><br><span class="line"><span class="comment">//		         if(conn!=null)&#123;</span></span><br><span class="line"><span class="comment">//		             try&#123;</span></span><br><span class="line"><span class="comment">//		                 //将Connection连接对象还给数据库连接池</span></span><br><span class="line"><span class="comment">//		                 conn.close();</span></span><br><span class="line"><span class="comment">//		              &#125;catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//		                  e.printStackTrace();</span></span><br><span class="line"><span class="comment">//		              &#125;</span></span><br><span class="line"><span class="comment">//		          &#125;</span></span><br><span class="line"><span class="comment">//		     &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h4><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> username;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> password;</span><br><span class="line">	<span class="keyword">private</span> Date brithday;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> hobby;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> married;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password + <span class="string">", brithday="</span> + brithday + <span class="string">", hobby="</span> + hobby</span><br><span class="line">				+ <span class="string">", married="</span> + married + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(<span class="keyword">String</span> username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(<span class="keyword">String</span> password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBrithday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> brithday;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrithday</span><span class="params">(Date brithday)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.brithday = brithday;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getHobby</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hobby;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobby</span><span class="params">(<span class="keyword">String</span> hobby)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMarried</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> married;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMarried</span><span class="params">(<span class="keyword">boolean</span> married)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.married = married;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据持久层"><a href="#创建数据持久层" class="headerlink" title="创建数据持久层"></a>创建数据持久层</h3><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package com.zhao.dao.impl;</span><br><span class="line"><span class="keyword">import</span> java.<span class="keyword">sql</span>.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhao.dao1.IUserDao;</span><br><span class="line"><span class="keyword">import</span> com.zhao.model.<span class="keyword">User</span>;</span><br><span class="line"><span class="keyword">import</span> com.zhao.util.DBCPUtils;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> UserDaoImpl implements IUserDao&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">public</span> <span class="type">int</span> addUser(<span class="keyword">User</span> <span class="keyword">user</span>) throws SQLException&#123;</span><br><span class="line">		</span><br><span class="line">		QueryRunner runner = <span class="built_in">new</span> QueryRunner(DBCPUtils.getDataSource());</span><br><span class="line">		String <span class="keyword">sql</span> ="insert into user values(?,?,?,?,?)";</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> runner.<span class="keyword">update</span>(<span class="keyword">sql</span>, <span class="keyword">user</span>.getUsername(),<span class="keyword">user</span>.getPassword(),<span class="keyword">user</span>.getBrithday(),<span class="keyword">user</span>.getHobby(),<span class="keyword">user</span>.isMarried());	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建业务层"><a href="#创建业务层" class="headerlink" title="创建业务层"></a>创建业务层</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	IUserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">regirster</span><span class="params">(User user)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		userDao.addUser(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建控制层（struts2-Action）"><a href="#创建控制层（struts2-Action）" class="headerlink" title="创建控制层（struts2 Action）"></a>创建控制层（struts2 Action）</h4><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> UserAction extends ActionSupport implements ModelDriven&lt;<span class="keyword">User</span>&gt;&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 采用模型注入</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	private static final long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	<span class="keyword">User</span> <span class="keyword">user</span> = <span class="built_in">new</span> <span class="keyword">User</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * struts2自带表单验证</span></span><br><span class="line"><span class="comment">	 * 第一种： 重写validate方法</span></span><br><span class="line"><span class="comment">	 * org.apache.commons.lang3.StringUtils;</span></span><br><span class="line"><span class="comment">	 * @return</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">//	@Override</span><br><span class="line">//	<span class="built_in">public</span> <span class="type">void</span> <span class="keyword">validate</span>() &#123;</span><br><span class="line">//		// TODO Auto-<span class="keyword">generated</span> <span class="keyword">method</span> stub</span><br><span class="line">////		判断用户名是否为空</span><br><span class="line">////		<span class="keyword">if</span>(StringUtils.isEmpty(<span class="keyword">user</span>.getUsername()))相当于<span class="keyword">if</span>(username == <span class="keyword">null</span> &amp;&amp; "".equals(username));</span><br><span class="line">//		<span class="keyword">if</span>(StringUtils.isEmpty(<span class="keyword">user</span>.getUsername()))&#123;</span><br><span class="line">//			addFieldError("username", "用户名不能为空！");</span><br><span class="line">//		&#125;</span><br><span class="line">//	&#125;</span><br><span class="line">	<span class="built_in">public</span> String regirster() throws SQLException&#123;</span><br><span class="line">		<span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line">		IUserService us = <span class="built_in">new</span> UserServiceImpl();</span><br><span class="line">		us.regirster(<span class="keyword">user</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">NONE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	<span class="built_in">public</span> <span class="keyword">User</span> getModel() &#123;</span><br><span class="line">		// TODO Auto-<span class="keyword">generated</span> <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">user</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="struts-xml核心配置文件"><a href="#struts-xml核心配置文件" class="headerlink" title="struts.xml核心配置文件"></a>struts.xml核心配置文件</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Action --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"regirster"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"regirster"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/regirster.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="I18n国际化资源-resources里的properties文件"><a href="#I18n国际化资源-resources里的properties文件" class="headerlink" title="I18n国际化资源(resources里的properties文件)"></a>I18n国际化资源(resources里的properties文件)</h3><h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> I18nTest &#123;</span><br><span class="line">	@Test</span><br><span class="line">	public void test1<span class="literal">()</span>&#123;</span><br><span class="line">		<span class="comment">//要读取国际化资源resources里的properties文件</span></span><br><span class="line">		<span class="comment">//baseName = 包名+文件名</span></span><br><span class="line">		ResourceBundle rb =<span class="module-access"><span class="module"><span class="identifier">ResourceBundle</span>.</span></span>get<span class="constructor">Bundle(<span class="string">"resources.message"</span>,Locale.US)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(rb.get<span class="constructor">String(<span class="string">"login.username"</span>)</span>);</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(rb.get<span class="constructor">String(<span class="string">"login.passord"</span>)</span>);</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(rb.get<span class="constructor">String(<span class="string">"login.Submit"</span>)</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="国际化资源properties文件"><a href="#国际化资源properties文件" class="headerlink" title="国际化资源properties文件"></a>国际化资源properties文件</h4><ul>
<li>文件名(必须)：message_en_US.properties<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">login.username</span>=USERNAME</span><br><span class="line"><span class="attr">login.password</span>=PASSWORD</span><br><span class="line"><span class="attr">login.Submit</span>=SUBMIT</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>文件名(必须)：message_zh_CN.properties<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">login.username</span>=用户名</span><br><span class="line"><span class="attr">login.password</span>=密码</span><br><span class="line"><span class="attr">login.Submit</span>=注册</span><br></pre></td></tr></table></figure>
<h3 id="拦截器-登录表单拦截"><a href="#拦截器-登录表单拦截" class="headerlink" title="拦截器(登录表单拦截)"></a>拦截器(登录表单拦截)</h3><h4 id="登陆页面JSP"><a href="#登陆页面JSP" class="headerlink" title="登陆页面JSP"></a>登陆页面JSP</h4><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;pageContext.request.contextPath &#125;</span><span class="xml"><span class="tag"><span class="string">/login.action"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	密&amp;emsp;码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;pageContext.request.contextPath &#125;</span><span class="xml"><span class="tag"><span class="string">/studentlist"</span>&gt;</span>学生列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;pageContext.request.contextPath &#125;</span><span class="xml"><span class="tag"><span class="string">/teacherlist"</span>&gt;</span>老师列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> User user = <span class="keyword">new</span> User();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//		1.接收参数</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">//		2.判断登录成功与否</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"zhao"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123"</span>.equals(user.getPassword()))&#123;</span><br><span class="line"><span class="comment">//			登录成功后，把user保存到session中</span></span><br><span class="line">			ServletActionContext.getRequest().getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> NONE;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="拦截器-继承-MethodFilterInterceptor类"><a href="#拦截器-继承-MethodFilterInterceptor类" class="headerlink" title="拦截器 继承 MethodFilterInterceptor类"></a>拦截器 继承 MethodFilterInterceptor类</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CheckLoginInterceptor</span> <span class="keyword">extends</span> <span class="title">MethodFilterInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="type">String</span> doIntercept(<span class="type">ActionInvocation</span> invocation) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">		<span class="comment">//		获取session域对象user</span></span><br><span class="line">		<span class="type">User</span> user =(<span class="type">User</span>)<span class="type">ServletActionContext</span>.getRequest().getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line"><span class="comment">//		判断</span></span><br><span class="line">		<span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> invocation.invoke();</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">//		如果没有登陆，回到登录页面</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"tologinPage"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="struts2核心配置-（拦截器局部配置）"><a href="#struts2核心配置-（拦截器局部配置）" class="headerlink" title="struts2核心配置 （拦截器局部配置）"></a>struts2核心配置 （拦截器局部配置）</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 声明登录校验 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.zhao.interceptor.CheckLoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"tologinPage"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/main.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"studentlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.StudentAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/student.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"teacherlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.TeacherAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/teacher.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"> <span class="comment">&lt;!--	&lt;package name="p2" extends="struts-default" namespace="/student"&gt;</span></span><br><span class="line"><span class="comment">		&lt;action name="list" class="com.zhao.web.action.StudentAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result name="success"&gt;/WEB-INF/student.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;</span></span><br><span class="line"><span class="comment">	&lt;/package&gt;</span></span><br><span class="line"><span class="comment">	&lt;package name="p3" extends="struts-default" namespace="/teacher"&gt;</span></span><br><span class="line"><span class="comment">		&lt;action name="list" class="com.zhao.web.action.TeacherAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result name="success"&gt;/WEB-INF/teacher.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;</span></span><br><span class="line"><span class="comment">	&lt;/package&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="struts2核心配置-（拦截器全局配置）"><a href="#struts2核心配置-（拦截器全局配置）" class="headerlink" title="struts2核心配置 （拦截器全局配置）"></a>struts2核心配置 （拦截器全局配置）</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 声明登录校验 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.zhao.interceptor.CheckLoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 拦截器分组 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"mydefaultStack"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"tologinPage"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/main.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"studentlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.StudentAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mydefaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/student.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"teacherlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.TeacherAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mydefaultStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/teacher.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"> <span class="comment">&lt;!--	&lt;package name="p2" extends="struts-default" namespace="/student"&gt;</span></span><br><span class="line"><span class="comment">		&lt;action name="list" class="com.zhao.web.action.StudentAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result name="success"&gt;/WEB-INF/student.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;</span></span><br><span class="line"><span class="comment">	&lt;/package&gt;</span></span><br><span class="line"><span class="comment">	&lt;package name="p3" extends="struts-default" namespace="/teacher"&gt;</span></span><br><span class="line"><span class="comment">		&lt;action name="list" class="com.zhao.web.action.TeacherAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result name="success"&gt;/WEB-INF/teacher.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;</span></span><br><span class="line"><span class="comment">	&lt;/package&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="配置不要拦截其方法"><a href="#配置不要拦截其方法" class="headerlink" title="配置不要拦截其方法"></a>配置不要拦截其方法</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明登录校验 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.zhao.interceptor.CheckLoginInterceptor"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 不要拦截login方法</span></span><br><span class="line"><span class="comment">			      excludeMethods排除方法，写方法名 </span></span><br><span class="line"><span class="comment">			            多个方法拦截用（，）号连接--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">" excludeMethods"</span>&gt;</span>login<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器分组 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"mydefaultStack"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器引用 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"CheckLoginInterceptor"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 修改默认拦截器 使用拦截器分组 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mydefaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"tologinPage"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/main.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"studentlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.StudentAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/student.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"teacherlist"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.TeacherAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/teacher.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--	&lt;package name="p2" extends="struts-default" namespace="/student"&gt;</span></span><br><span class="line"><span class="comment">	&lt;action name="list" class="com.zhao.web.action.StudentAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">		&lt;result name="success"&gt;/WEB-INF/student.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">	&lt;/action&gt;</span></span><br><span class="line"><span class="comment">&lt;/package&gt;</span></span><br><span class="line"><span class="comment">&lt;package name="p3" extends="struts-default" namespace="/teacher"&gt;</span></span><br><span class="line"><span class="comment">	&lt;action name="list" class="com.zhao.web.action.TeacherAction" method="list"&gt;</span></span><br><span class="line"><span class="comment">		&lt;result name="success"&gt;/WEB-INF/teacher.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">	&lt;/action&gt;</span></span><br><span class="line"><span class="comment">&lt;/package&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Action-1"><a href="#Action-1" class="headerlink" title="Action"></a>Action</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.web.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.<span class="type">ServletActionContext</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.<span class="type">ActionSupport</span>;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.<span class="type">ModelDriven</span>;</span><br><span class="line"><span class="keyword">import</span> com.zhao.model.<span class="type">User</span>;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="title">implements</span> <span class="title">ModelDriven&lt;User&gt;</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">User</span> user = <span class="keyword">new</span> <span class="type">User</span>();</span><br><span class="line">	public <span class="type">String</span> login()&#123;</span><br><span class="line"><span class="comment">//		1.接收参数</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">//		2.判断登录成功与否</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"zhao"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123"</span>.equals(user.getPassword()))&#123;</span><br><span class="line"><span class="comment">//			登录成功后，把user保存到session中</span></span><br><span class="line">			<span class="type">ServletActionContext</span>.getRequest().getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="type">NONE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	public <span class="type">User</span> getModel() &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> public <span class="class"><span class="keyword">class</span> <span class="title">TeacherAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	</span><br><span class="line">	public <span class="type">String</span> list()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> public <span class="class"><span class="keyword">class</span> <span class="title">StudentAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	</span><br><span class="line">	public <span class="type">String</span> list()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="struts2表单标签"><a href="#struts2表单标签" class="headerlink" title="struts2表单标签"></a>struts2表单标签</h3><figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="ruby">   pageEncoding=<span class="string">"UTF-8"</span></span><span class="xml">%&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@taglib uri=<span class="string">"/struts-tags"</span> prefix=<span class="string">"s"</span> </span><span class="xml"><span class="tag">%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:form</span> <span class="attr">action</span>=<span class="string">"/upload"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">lable</span>=<span class="string">"用户名"</span> <span class="attr">name</span>=<span class="string">"username"</span> &gt;</span><span class="tag">&lt;/<span class="name">s:textfield</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:password</span> <span class="attr">lable</span>=<span class="string">"密码"</span> <span class="attr">name</span>=<span class="string">"password"</span> &gt;</span><span class="tag">&lt;/<span class="name">s:password</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:file</span> <span class="attr">label</span>=<span class="string">"图片"</span> <span class="attr">name</span>=<span class="string">"photo"</span> &gt;</span><span class="tag">&lt;/<span class="name">s:file</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">s:submit</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:submit</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">s:form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="文件上传Struts2-xml核心配置"><a href="#文件上传Struts2-xml核心配置" class="headerlink" title="文件上传Struts2.xml核心配置"></a>文件上传Struts2.xml核心配置</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置国际化 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"fileUploadmessage"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置最大的文件上传大小为20M --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.multipart.maxSize"</span> <span class="attr">value</span>=<span class="string">"20971520"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UploadAction"</span> <span class="attr">method</span>=<span class="string">"upload"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 默认拦截器defaultStack下有其子类fileUpload类</span></span><br><span class="line"><span class="comment">				其有属性allowedTypes及MIME类型【文件类型-image/png,image/jpeg,image/bmp】 </span></span><br><span class="line"><span class="comment">				其有属性allowedExtensions及MIME可扩展名【文件扩展名.png,.jpeg,.bmp】 </span></span><br><span class="line"><span class="comment">				下面方法为依赖注入--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedTypes"</span>&gt;</span>image/png,image/jpeg,image/bmp<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedExtensions"</span>&gt;</span>.jpeg,jpg,png<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="文件上传properties文件"><a href="#文件上传properties文件" class="headerlink" title="文件上传properties文件"></a>文件上传properties文件</h4><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">struts<span class="selector-class">.messages</span><span class="selector-class">.error</span>.uploading=Error uploading: &#123;<span class="number">0</span>&#125;</span><br><span class="line">struts<span class="selector-class">.messages</span><span class="selector-class">.error</span><span class="selector-class">.file</span><span class="selector-class">.too</span>.large=The file is to large to be uploaded: &#123;<span class="number">0</span>&#125; <span class="string">"&#123;1&#125;"</span> <span class="string">"&#123;2&#125;"</span> &#123;<span class="number">3</span>&#125;</span><br><span class="line">struts<span class="selector-class">.messages</span><span class="selector-class">.error</span><span class="selector-class">.content</span><span class="selector-class">.type</span><span class="selector-class">.not</span>.allowed=&#123;<span class="number">3</span>&#125;\u6587\u4EF6\u7C7B\u578B\u4E0D\u6B63\u786E\uFF1: &#123;<span class="number">0</span>&#125; <span class="string">"&#123;1&#125;"</span> <span class="string">"&#123;2&#125;"</span> </span><br><span class="line">struts<span class="selector-class">.messages</span><span class="selector-class">.error</span><span class="selector-class">.file</span><span class="selector-class">.extension</span><span class="selector-class">.not</span>.allowed=\u6587\u4EF6\u6269\u5C55\u540D\u4E0D\u6B63\u786E: &#123;<span class="number">0</span>&#125; <span class="string">"&#123;1&#125;"</span> <span class="string">"&#123;2&#125;"</span> &#123;<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="文件下载Action"><a href="#文件下载Action" class="headerlink" title="文件下载Action"></a>文件下载Action</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">package com.zhao.web.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.interceptor.ServletRequestAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadAction</span> <span class="title">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 步骤：</span></span><br><span class="line"><span class="comment">	 * 1.写个Action</span></span><br><span class="line"><span class="comment">	 * 2.在action中写个输入流属性，提供get方法</span></span><br><span class="line"><span class="comment">	 * 3.在Action中写Download方法给inputStream赋值</span></span><br><span class="line"><span class="comment">	 * 4.添加struts配置文件</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> long serialVersionUID = 1L;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">InputStream</span> inputStream;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">InputStream</span> getInputStream() &#123;</span><br><span class="line">		<span class="keyword">return</span> inputStream;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">String</span> <span class="type">Download</span>() <span class="keyword">throws</span> <span class="type">FileNotFoundException</span>&#123;</span><br><span class="line">		<span class="comment">//1.路径</span></span><br><span class="line">		<span class="type">String</span> path = <span class="string">"F:/1.jpg"</span>;</span><br><span class="line">		<span class="comment">//2.给输入流赋值</span></span><br><span class="line">		inputStream = new <span class="type">FileInputStream</span>(path);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.struts中不需要自己写数据返回给客户端  以前通过outputstream返回客户端数据</span></span><br><span class="line">		<span class="keyword">return</span> <span class="type">SUCCESS</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="文件下载Struts-xml核心配置文件"><a href="#文件下载Struts-xml核心配置文件" class="headerlink" title="文件下载Struts.xml核心配置文件"></a>文件下载Struts.xml核心配置文件</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.DownloadAction"</span> <span class="attr">method</span>=<span class="string">"Download"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- stream表示已流的方式返回给客户端 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 读取输入流 --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>inputStream<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 响应头 --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>attachment;filename=1.jpg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 响应头类型 --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>application/octet-stream<span class="tag">&lt;/<span class="name">param</span>&gt;</span>	</span><br><span class="line">				<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>Struts2框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2 框架(一)</title>
    <url>/2019/11/30/Struts2-%E6%A1%86%E6%9E%B6-%E4%B8%80/</url>
    <content><![CDATA[<h4 id="struts2框架执行流程图"><a href="#struts2框架执行流程图" class="headerlink" title="struts2框架执行流程图"></a>struts2框架执行流程图</h4><p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1573586858256&di=9a6128e13e4f09150bf63d78bed0bc09&imgtype=0&src=http%3A%2F%2Fstatic.zybuluo.com%2FYano%2F84bw9li87dg4p3ytl00uhq6x%2FStruts2%25E5%258E%259F%25E7%2590%2586.png" alt="流程图"></p>
<ul>
<li><p>应用流程注解</p>
<ol>
<li><p>当Web容器收到请求（HttpServletRequest）它将请求传递给一个标准的的过滤链包括（ActionContextCleanUp）过滤器。经过Other filters(SiteMesh ,etc)，需要调用FilterDispatcher核心控制器，然后它调用ActionMapper确定请求哪个Action，ActionMapper返回一个收集Action详细信息的ActionMaping对象。</p>
</li>
<li><p>FilterDispatcher将控制权委派给ActionProxy,ActionProxy调用配置管理器(ConfigurationManager) 从配置文件中读取配置信息(struts.xml)，然后创建ActionInvocation对象。</p>
</li>
<li><p>ActionInvocation在调用Action之前会依次的调用所用配置拦截器（Interceptor N）一旦执行结果返回结果字符串ActionInvocation负责查找结果字符串对应的(Result）然后执行这个Result Result会调用一些模版（JSP）来呈现页面。</p>
</li>
<li><p>拦截器(Interceptor N)会再被执行（顺序和Action执行之前相反）最后响应(HttpServletResponse)被返回在web.xml中配置的那些过滤器和核心控制器（FilterDispatcher）。</p>
</li>
</ol>
</li>
</ul>
<ol>
<li><p>导包（基本包）<br>asm-5.2、asm-commons-5.2、asm-tree-5.2：反射的替代方案。asm是小巧便捷的java字节码操控框架，它能方便的动态生成和改造java代码<br>commons-fileupload-1.3.3：上传文件<br>commons-io-2.5：对本地文件、流进行操作<br>commons-lang3-3.6：基础文件包<br>commons-logging-1.1.3：日志包<br>freemarker-2.3.23：生成各种文本：html、xml、rtf、java源代码等<br>javassist-3.20.0-GA：使java字节码操控更加简便，是一个编译java字节码的类库，提高效率<br>log4j-api-2.8.2：日志<br>ognl-3.1.15：struts2独有的标签库<br>struts2-core-2.5.13：struts2的核心包</p>
</li>
<li><p>配置Struts2核心过滤器<br>在web.xml文件中进行如下配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/   XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	 <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">	 <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="tag"><span class="string">	 http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts2-domo2<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>注意：Struts的核心控制器默认拦截以下请求<br> .action为后缀的请求<br> 没有任何后缀的请求</li>
</ul>
</li>
<li><p>编写Action</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="title">extends</span> <span class="title">ActionSupport</span> &#123;</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *Action中处理请求的方法(动作方法)一般有以下特点</span></span><br><span class="line"><span class="comment">     *访问修饰符均为public</span></span><br><span class="line"><span class="comment">     *方法的返回值一般为String(可以为void)</span></span><br><span class="line"><span class="comment">    *方法均没有参数 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> final <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">find</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>在src目录下创建核心配置文件struts.xml文件<br>动作访问之通配符<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"> <span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span></span><br><span class="line"><span class="xml">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="xml">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- &lt;package name="p1" extends="struts-default" namespace="/user"&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"add"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"add"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/add.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"remove"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"remove"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/remove.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"update"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"update"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/update.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"find"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"find"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/find.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span>--&gt;</span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 动作访问之通配符‘*’ 简化上面重复操作 --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/user"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;1&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/</span><span class="template-variable">&#123;1&#125;</span><span class="xml">.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 两个*的通配符 --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p2"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/stu"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="comment">&lt;!--&lt;action name="addStu" class="com.zhao.web.action.StuAction" method="addStu"&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/addStu.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"findStu"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.StuAction"</span> <span class="attr">method</span>=<span class="string">"findStu"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/findStu.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span>--&gt;</span></span><br><span class="line"><span class="xml">		<span class="comment">&lt;!-- 下面方法访问不到 --&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*_*"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.StuAction"</span> <span class="attr">method</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;1&#125;</span><span class="xml"><span class="tag"><span class="string"></span></span></span><span class="template-variable">&#123;2&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/</span><span class="template-variable">&#123;2&#125;</span><span class="xml">/</span><span class="template-variable">&#123;1&#125;</span><span class="xml">.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span> </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="struts2加载文件顺序"><a href="#struts2加载文件顺序" class="headerlink" title="struts2加载文件顺序"></a>struts2加载文件顺序</h3></li>
</ol>
</li>
</ol>
<ul>
<li>struts2框架要能执行，必须先加载StrutsPrepareAndExecuteFilter.<br>在StrutsPrepareAndExecuteFilter的init方法中对Dispatcher进行了初始化.<br>在Dispatcher类中定义的init方法内就描述了struts2配置文件加载的顺序</li>
</ul>
<ol>
<li><p>default.properties文件<br> 作用:定义了struts2框架中所有常量<br> 位置: org/apache/struts2/default.properties </p>
</li>
<li><p>struts-default.xml<br> 作用:配置了bean,interceptor,result等。<br> 位置:在struts的core核心jar包. </p>
</li>
<li><p>struts-plugin.xml<br> 它是struts2框架中所使用的插件的配置文件。 </p>
</li>
<li><p>struts.xml<br> 我们使struts2所使用的配置文件。</p>
</li>
<li><p>struts.properties<br> 就是可以自定义常量。</p>
</li>
<li><p>web.xml   </p>
</li>
</ol>
<ul>
<li>在Struts.xml中配置常量(后缀)<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置开发模式 可以显示跟详细的错误信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置常量  struts.action.extension表示后缀--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"php"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- abstract="true"抽象 用于继承 若包有abstract="true"属性  有包继承此包即可是有所有功能</span></span><br><span class="line"><span class="comment">	          一般抽象包不声明Action --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- namespace="/" 命名空间， 访问路径，默认为空字符串</span></span><br><span class="line"><span class="comment">	      可有用于模块划分--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;package name="p1" extends="struts-default" namespace="/" abstract="true"&gt; --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"p1"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.zhao.web.action.HelloAction"</span> <span class="attr">method</span>=<span class="string">"sayHello"</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在struts.properties中配置常量<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">struts.action.extension</span>=asp</span><br></pre></td></tr></table></figure>
<ul>
<li>log4j.xml文件<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Configuration</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d %-5p [%t] %C</span></span></span><span class="template-variable">&#123;2&#125;</span><span class="xml"><span class="tag"><span class="string"> (%F:%L) - %m%n"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFile"</span> <span class="attr">fileName</span>=<span class="string">"logs/strutslog1.log"</span></span></span></span><br><span class="line"><span class="xml">                    filePattern="logs/$$</span><span class="template-variable">&#123;date:yyyy-MM&#125;</span><span class="xml">/app-%d</span><span class="template-variable">&#123;MM-dd-yyyy&#125;</span><span class="xml">-%i.log.gz"&gt;</span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d</span><span class="template-variable">&#123;MM-dd-yyyy&#125;</span><span class="xml"> %p %c</span><span class="template-variable">&#123;1.&#125;</span><span class="xml"> [%t] -%M-%L- %m%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"1 KB"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">fileIndex</span>=<span class="string">"max"</span> <span class="attr">max</span>=<span class="string">"2"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">"com.opensymphony.xwork2"</span> <span class="attr">level</span>=<span class="string">"WAN"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">"org.apache.struts2"</span> <span class="attr">level</span>=<span class="string">"WAN"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"warn"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="结果集"><a href="#结果集" class="headerlink" title="结果集"></a>结果集</h3></li>
</ul>
</li>
<li>自定义结果集  继承 StrutsResultSupport<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义结果集</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Cqudate</span> <span class="keyword">extends</span> <span class="title">StrutsResultSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> void doExecute(<span class="type">String</span> arg0, <span class="type">ActionInvocation</span> arg1) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">```              </span><br><span class="line">* struts.xml文件</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
  "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
  "http://struts.apache.org/dtds/struts-2.3.dtd">

</li>
</ul>
<struts>
<!-- 配置开发模式 可以显示跟详细的错误信息-->
    <constant name="struts.devMode" value="true"></constant>
    <!-- 全局结果集视图 继承 声明抽象类属性-->
    <package name="MyResult" extends="struts-default" abstract="true">
            <result-types>
                    <result-type name="captche" class="/Struts2-domo3/src/com/zhao/web/result/Cqudate">
                    </result-type>
            </result-types>
    </package>


</struts>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">### 获取servlet 的api方式</span><br><span class="line">* 通过SrevletActionContext</span><br></pre></td></tr></table></figure>
public class TestAction extends ActionSupport {


<pre><code>/**
 * 
 */
private static final long serialVersionUID = 1L;

public String text() {
    // 获取servlet 的api方式</code></pre><p> //        第一种方式：通过SrevletActionContext<br> //        1.response<br>        HttpServletResponse  response = ServletActionContext.getResponse();<br> //        2.request<br>        HttpServletRequest request = ServletActionContext.getRequest();<br> //        3.session<br>        HttpSession session =request.getSession();</p>
<p> //        4.application(sercletContext)<br>        ServletContext context = ServletActionContext.getServletContext();<br> //        NONE不跳转，不去找result标签<br>        System.out.println(response);<br>        System.out.println(request);<br>        System.out.println(session);<br>        System.out.println(context);</p>
<p> //        org.apache.struts2.dispatcher.StrutsRequestWrapper@34374916 ruquest 属于<br> //        org.apache.catalina.session.StandardSessionFacade@40e7fb20  属于Tomcat<br> //        org.apache.catalina.core.ApplicationContextFacade@20dc66ff 属于Tomcat<br> //        org.apache.catalina.connector.ResponseFacade@5973cd44 属于Tomcat</p>
<pre><code>    return NONE;
}</code></pre><p>}</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>通过实现ServletRequestAware接口，让Struts自动注入</span><br></pre></td></tr></table></figure>
<p> public class Test2Action extends ActionSupport implements ServletRequestAware{</p>
<pre><code>private static final long serialVersionUID = 1L;
HttpServletResponse  response;
HttpServletRequest request;
public String text() {
    // 获取servlet 的api方式</code></pre><p> //        第二种方式：通过实现接口，让Struts自动注入<br> //        Aware :注入，调用方法，注入参数<br> //        1.response<br>        HttpServletResponse  response = ServletActionContext.getResponse();<br> //        request<br>        HttpServletRequest request = ServletActionContext.getRequest();<br> //        session</p>
<p> //        application(sercletContext)</p>
<pre><code>System.out.println(response);
System.out.println(request);

return NONE;</code></pre><p> //        NONE不跳转，不去找result标签<br>    }<br>    @Override<br>    public void setServletRequest(HttpServletRequest request) {<br>        // TODO Auto-generated method stub<br>        this.request = request;<br>    }</p>
<p>}</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>struts.xml</span><br></pre></td></tr></table></figure>
 <?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
    "http://struts.apache.org/dtds/struts-2.3.dtd">

 <struts>
 <!-- 配置开发模式 可以显示跟详细的错误信息-->
    <constant name="struts.devMode" value="true"></constant>

<pre><code>&lt;package name=&quot;p1&quot; extends=&quot;struts-default&quot; namespace=&quot;/&quot;&gt;
        &lt;action name=&quot;test&quot; class=&quot;com.zhao.web.action.TestAction&quot; method=&quot;text&quot;&gt;
        &lt;/action&gt;
        &lt;action name=&quot;test2&quot; class=&quot;com.zhao.web.action.Test2Action&quot; method=&quot;text&quot;&gt;
        &lt;/action&gt;
&lt;/package&gt;</code></pre> </struts>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">### 获取请求参数</span><br><span class="line">* 实体类</span><br></pre></td></tr></table></figure>
 public class User {
    private String username;
    private String password;
    public String getUsername() {
        return username;
    }
    public void setUsername(String username) {
        this.username = username;
    }
    public String getPassword() {
        return password;
    }
    public void setPassword(String password) {
        this.password = password;
    }
    @Override
    public String toString() {
        return "User [username=" + username + ", password=" + password + "]";
    }

<p> }</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">* <span class="number">1.</span> Action获取请求参数两种方式：ServletActionContext</span><br></pre></td></tr></table></figure>
<pre><code> public class LoginAction extends ActionSupport {

    private String username;
    private String password;
    public void setUsername(String username) {
        System.out.println(&quot;setUsername&quot;);
        this.username = username;
    }

    public void setPassword(String password) {
        System.out.println(&quot;SetPassword&quot;);
        this.password = password;
    }


    public String login() throws Exception {
 //        获取求参数
 //        第一种方式：ServletActionContext
 //        HttpServletRequest request = ServletActionContext.getRequest();
 //        String username = request.getParameter(&quot;username&quot;);
 //        String password = request.getParameter(&quot;password&quot;);


 //        第二种方式：通过属性的Set注入

        System.out.println(username);
        System.out.println(password);
        HttpServletResponse response = ServletActionContext.getResponse();

        return NONE;
    }

}</code></pre><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>前端页面login.jsp</span><br></pre></td></tr></table></figure>
<pre><code>&lt;form action=&quot;${pageContext.request.contextPath }/login.action&quot;&gt;
    用户名：&lt;input name=&quot;username&quot; type=&quot;text&quot;/&gt;&lt;br&gt;
    密&amp;emsp;码：&lt;input name=&quot;password&quot; type=&quot;password&quot;/&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; value=&quot;登录&quot;/&gt;
&lt;/form&gt;</code></pre> <figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">* 第三种方式：<span class="keyword">set</span>模型属性注入</span><br></pre></td></tr></table></figure>
<pre><code>public class LoginSetModelAction extends ActionSupport {
//    获取请求参数
//    第三种方式：set模型属性注入
   private User user;
   public User getUser() {
       System.out.println(&quot;getUser&quot;);
       return user;
   }

   public void setUser(User user) {
       System.out.println(&quot;setUser&quot;);
       this.user = user;
   }

   public String login(){
       System.out.println(user);
       return NONE;
   }
}</code></pre><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">* 前端页面<span class="module-access"><span class="module"><span class="identifier">LoginSetModel</span>.</span></span>jsp</span><br></pre></td></tr></table></figure>
 <form action="${pageContext.request.contextPath }/LoginSetModel.action">
    用户名：<input name="user.username" type="text"/><br>
    密&emsp;码：<input name="user.password" type="user.password"/><br>
    <input type="submit" value="登录"/>
 </form>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">* 第四种方式：通过模型注入，在action里实现一个模型驱动接口ModelDriven<span class="tag">&lt;<span class="name">User</span>&gt;</span></span><br></pre></td></tr></table></figure>
    public class LoginModelAction extends ActionSupport implements ModelDriven<User>{
        /** 第四种方式：通过模型注入，在action里实现一个模型驱动接口
         *  提供一个模型属性，并一定要赋值
         *  通过这种方式，不用在jsp页面写user.
         *  
         */
        private User user = new User();
        @Override
        public User getModel() {
            // TODO Auto-generated method stub
            return user;
        }
        public String login(){
            System.out.println(user);
            return NONE;
        }

<pre><code>}</code></pre><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>前端页面modellogin.jsp</span><br></pre></td></tr></table></figure>
 <form action="${pageContext.request.contextPath }/Model.action">
    用户名：<input name="username" type="text"/><br>
    密&emsp;码：<input name="password" type="password"/><br>
    <input type="submit" value="登录"/>
 </form>
```]]></content>
      <tags>
        <tag>Struts2框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Servlect+Jsp实现账户管理</title>
    <url>/2019/11/26/Servlect-Jsp%E5%AE%9E%E7%8E%B0%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h3 id="Servlet-jsp增删改查-分页"><a href="#Servlet-jsp增删改查-分页" class="headerlink" title="Servlet+jsp增删改查+分页"></a>Servlet+jsp增删改查+分页</h3><h3 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h3><h4 id="1-创建JavaBean实体类"><a href="#1-创建JavaBean实体类" class="headerlink" title="1. 创建JavaBean实体类"></a>1. 创建JavaBean实体类</h4><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> pwd;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">String</span> name, <span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">String</span> name, <span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> pwd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(<span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"User [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", pwd="</span> + pwd + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-创建JDBC工具类"><a href="#2-创建JDBC工具类" class="headerlink" title="2. 创建JDBC工具类"></a>2. 创建JDBC工具类</h4><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JDBCUtils</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">	Connection conn = <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		conn = DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/t_user?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai"</span>,</span><br><span class="line">				<span class="string">"root"</span>,<span class="string">"zhao1314520"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;<span class="keyword">catch</span>(SQLException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span>(<span class="params">Connection conn, PreparedStatement pstm,ResultSet rs</span>)</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(rs!=<span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			rs.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(pstm!=<span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				pstm.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span>(<span class="params">Connection conn, PreparedStatement pstm</span>)</span> &#123;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(pstm!=<span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				pstm.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-创建数据持久层Dao"><a href="#3-创建数据持久层Dao" class="headerlink" title="3. 创建数据持久层Dao"></a>3. 创建数据持久层Dao</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package com.zhao.dao;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import com.zhao.entity.User;</span><br><span class="line">import com.zhao.util.JDBCUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public <span class="keyword">class</span> UserDao &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//登录</span></span><br><span class="line">	public User login(User u) &#123;</span><br><span class="line">		User user =null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">	</span><br><span class="line">		String sql = <span class="string">"select * from user where name=? &amp;&amp; pwd=?"</span>;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">		</span><br><span class="line">			pstm.set<span class="constructor">String(1,<span class="params">u</span>.<span class="params">getName</span>()</span>);</span><br><span class="line">			pstm.set<span class="constructor">String(2,<span class="params">u</span>.<span class="params">getPwd</span>()</span>);</span><br><span class="line">			rs = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">		</span><br><span class="line">			<span class="keyword">if</span>(rs.next<span class="literal">()</span>) &#123;</span><br><span class="line">				user = <span class="keyword">new</span> <span class="constructor">User(<span class="params">rs</span>.<span class="params">getInt</span>(1)</span>,rs.get<span class="constructor">String(2)</span>,rs.get<span class="constructor">String(3)</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; catch (SQLException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">	&#125;finally &#123;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm,rs);</span><br><span class="line">	&#125;</span><br><span class="line">	return user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//注册</span></span><br><span class="line">	public <span class="built_in">int</span> add<span class="constructor">User(User <span class="params">u</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//User user =null;</span></span><br><span class="line">		<span class="built_in">int</span> num =<span class="number">0</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">	</span><br><span class="line">		String sql = <span class="string">"insert into user(name,pwd)value(?,?)"</span>;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">		</span><br><span class="line">			pstm.set<span class="constructor">String(1,<span class="params">u</span>.<span class="params">getName</span>()</span>);</span><br><span class="line">			pstm.set<span class="constructor">String(2,<span class="params">u</span>.<span class="params">getPwd</span>()</span>);</span><br><span class="line">			num = pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//if(num == 1) &#123;</span></span><br><span class="line">				<span class="comment">//user = new User(num.getInt(1),num.getString(2),num.getString(3));</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">	&#125; catch (SQLException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">	&#125;finally &#123;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm);</span><br><span class="line">	&#125;</span><br><span class="line">		return num;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查询User列表</span></span><br><span class="line">	public List&lt;User&gt; find<span class="constructor">All()</span>&#123;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		<span class="comment">//创建集合</span></span><br><span class="line">		List&lt;User&gt; userlist = <span class="keyword">new</span> ArrayList&lt;User&gt;<span class="literal">()</span>;</span><br><span class="line">		String sql=<span class="string">"select * from user"</span>;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">      		rs = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">      		</span><br><span class="line">      		<span class="keyword">while</span>(rs.next<span class="literal">()</span>) &#123;</span><br><span class="line">      			<span class="built_in">int</span> id = rs.get<span class="constructor">Int(1)</span>;</span><br><span class="line">      			String name = rs.get<span class="constructor">String(2)</span>;</span><br><span class="line">      			String pwd = rs.get<span class="constructor">String(3)</span>;</span><br><span class="line">      			userlist.add(<span class="keyword">new</span> <span class="constructor">User(<span class="params">id</span>,<span class="params">name</span>,<span class="params">pwd</span>)</span>);</span><br><span class="line">      		&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;</span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm,rs);</span><br><span class="line">		&#125;</span><br><span class="line">		return userlist;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">	public <span class="built_in">int</span> del<span class="constructor">ById(<span class="params">int</span> <span class="params">id</span>)</span> &#123;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		<span class="built_in">int</span> num = <span class="number">0</span> ;</span><br><span class="line">		String sql=<span class="string">"delete from user where id=?"</span>;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			pstm.set<span class="constructor">Int(1,<span class="params">id</span>)</span>;</span><br><span class="line">      		num  = pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;</span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm);</span><br><span class="line">		&#125;</span><br><span class="line">		return num ;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//更新</span></span><br><span class="line">	public <span class="built_in">int</span> user<span class="constructor">Update(User <span class="params">user</span>)</span> &#123;</span><br><span class="line">		<span class="built_in">int</span> num = <span class="number">0</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		String sql=<span class="string">"update user set name=?,pwd=? where id=?"</span>;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			<span class="comment">// 这里的1,2..必须要按上面的新增的顺序来定义</span></span><br><span class="line">			pstm.set<span class="constructor">String(1,<span class="params">user</span>.<span class="params">getName</span>()</span>);</span><br><span class="line">			pstm.set<span class="constructor">String(2, <span class="params">user</span>.<span class="params">getPwd</span>()</span>);</span><br><span class="line">			pstm.set<span class="constructor">Int(3,<span class="params">user</span>.<span class="params">getId</span>()</span>);</span><br><span class="line">			</span><br><span class="line">      		num = pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">      	</span><br><span class="line">      		</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;</span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm);</span><br><span class="line">		&#125;</span><br><span class="line">		return num;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//根据条件查询列表页面检索</span></span><br><span class="line">	public List&lt;User&gt; select<span class="constructor">All(User <span class="params">user</span>,<span class="params">int</span> <span class="params">pageNum</span>,<span class="params">int</span> <span class="params">pageSize</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">//创建集合</span></span><br><span class="line">		List&lt;User&gt; userlist = <span class="keyword">new</span> ArrayList&lt;User&gt;<span class="literal">()</span>;</span><br><span class="line">		List&lt;Object&gt; parList = <span class="keyword">new</span> ArrayList&lt;Object&gt;<span class="literal">()</span>;</span><br><span class="line">		</span><br><span class="line">		String sql=<span class="string">"select id,name,pwd from user where 1=1"</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(user.get<span class="constructor">Id()</span> != <span class="number">0</span>) &#123;</span><br><span class="line">			sql = sql + <span class="string">" and id=?"</span>;</span><br><span class="line">			parList.add(user.get<span class="constructor">Id()</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(user.get<span class="constructor">Name()</span> != null<span class="operator"> &amp;&amp; </span>!<span class="string">""</span>.equals(user.get<span class="constructor">Name()</span>)) &#123;</span><br><span class="line">			sql = sql + <span class="string">" and name like ?"</span>;</span><br><span class="line">			parList.add(user.get<span class="constructor">Name()</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		sql = sql + <span class="string">" limit "</span>+(pageNum-<span class="number">1</span>)*pageSize+<span class="string">","</span>+pageSize;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(sql);</span><br><span class="line">		</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			for(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt; parList.size<span class="literal">()</span>;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span>(i==<span class="number">0</span><span class="operator"> &amp;&amp; </span>user.get<span class="constructor">Id()</span>!=<span class="number">0</span>) &#123;</span><br><span class="line">					pstm.set<span class="constructor">Int(1, <span class="params">user</span>.<span class="params">getId</span>()</span>);</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//不懂请教老师</span></span><br><span class="line">					pstm.set<span class="constructor">String(<span class="params">i</span>+1, <span class="string">"%"</span>+(String)</span>parList.get(i)+<span class="string">"%"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">      		rs = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">      		</span><br><span class="line">      		<span class="keyword">while</span>(rs.next<span class="literal">()</span>) &#123;</span><br><span class="line">      			<span class="built_in">int</span> id = rs.get<span class="constructor">Int(1)</span>;</span><br><span class="line">      			String name = rs.get<span class="constructor">String(2)</span>;</span><br><span class="line">      			String pwd =rs.get<span class="constructor">String(3)</span>;</span><br><span class="line">      		<span class="comment">// 将当前行的数据封装到user对象中，然后将user对象保存到userList集合中</span></span><br><span class="line">      			userlist.add(<span class="keyword">new</span> <span class="constructor">User(<span class="params">id</span>,<span class="params">name</span>,<span class="params">pwd</span>)</span>);</span><br><span class="line">      		&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;</span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn,pstm,rs);</span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(userlist);</span><br><span class="line">		return userlist;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//单条记录详情</span></span><br><span class="line">	public User find<span class="constructor">ById(<span class="params">int</span> <span class="params">id</span>)</span> &#123;</span><br><span class="line">		User user = null;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		ResultSet rs = null;</span><br><span class="line">		Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line">		String sql = <span class="string">"select id,name,pwd  from user where id=?"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			pstm.set<span class="constructor">Int(1,<span class="params">id</span>)</span>;</span><br><span class="line">			rs = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">			<span class="keyword">while</span>(rs.next<span class="literal">()</span>) &#123;</span><br><span class="line">				<span class="comment">//此处int uid = rs.getInt(1); 用SQL语句索引也行</span></span><br><span class="line">				<span class="comment">//但是若用字段名称必须是String型</span></span><br><span class="line">				<span class="comment">//若是变量会报异常SQLExecption  column Index</span></span><br><span class="line">				<span class="built_in">int</span> uid = rs.get<span class="constructor">Int(<span class="string">"id"</span>)</span>;</span><br><span class="line">				String name = rs.get<span class="constructor">String(2)</span>;</span><br><span class="line">				String pwd = rs.get<span class="constructor">String(3)</span>;</span><br><span class="line">				</span><br><span class="line">				user = <span class="keyword">new</span> <span class="constructor">User(<span class="params">uid</span>,<span class="params">name</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		return user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 查询记录总数</span></span><br><span class="line">	public <span class="built_in">int</span> total<span class="constructor">Count(User <span class="params">user</span>)</span> &#123;</span><br><span class="line">			<span class="built_in">int</span> total = <span class="number">0</span>;</span><br><span class="line">			List&lt;Object&gt; parList = <span class="keyword">new</span> ArrayList&lt;Object&gt;<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 声明变量</span></span><br><span class="line">			String sql = <span class="string">"select count(id) from user where 1=1"</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 判断条件是否为空</span></span><br><span class="line">			<span class="keyword">if</span> (user.get<span class="constructor">Id()</span> != <span class="number">0</span>) &#123;</span><br><span class="line">				sql = sql+<span class="string">" and id=?"</span>;</span><br><span class="line">				parList.add(user.get<span class="constructor">Id()</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(user.get<span class="constructor">Name()</span> != null<span class="operator"> &amp;&amp; </span>!<span class="string">""</span>.equals(user.get<span class="constructor">Name()</span>)) &#123;</span><br><span class="line">				sql=sql+<span class="string">" and name like ?"</span>;</span><br><span class="line">				parList.add(user.get<span class="constructor">Name()</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			PreparedStatement stm = null;</span><br><span class="line">			ResultSet rs = null;</span><br><span class="line">			<span class="comment">// 获取连接</span></span><br><span class="line">			Connection conn = <span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>get<span class="constructor">Connection()</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// 预编译sql</span></span><br><span class="line">				stm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">				<span class="comment">//设置参数</span></span><br><span class="line">				for (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; parList.size<span class="literal">()</span>; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span>(i==<span class="number">0</span> &amp; user.get<span class="constructor">Id()</span>!=<span class="number">0</span>) &#123;</span><br><span class="line">						stm.set<span class="constructor">Int(1, <span class="params">user</span>.<span class="params">getId</span>()</span>);</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						stm.set<span class="constructor">String(<span class="params">i</span>+1, <span class="string">"%"</span>+(String)</span>parList.get(i)+<span class="string">"%"</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// 执行sql,返回结果集</span></span><br><span class="line">				rs = stm.execute<span class="constructor">Query()</span>;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 获取结果集中的数据</span></span><br><span class="line">				<span class="keyword">while</span> (rs.next<span class="literal">()</span>) &#123;</span><br><span class="line">					<span class="comment">// 获取当前行的数据</span></span><br><span class="line">					total = rs.get<span class="constructor">Int(1)</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125; catch (SQLException e) &#123;</span><br><span class="line">				e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">			&#125; finally &#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">JDBCUtils</span>.</span></span>close(conn, stm, rs);</span><br><span class="line">			&#125;</span><br><span class="line">			return total;</span><br><span class="line">		&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-创建业务层Service"><a href="#4-创建业务层Service" class="headerlink" title="4. 创建业务层Service"></a>4. 创建业务层Service</h4><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhao.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.zhao.entity.<span class="keyword">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> UserService &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">public</span> UserDao userDao = <span class="built_in">new</span> UserDao();</span><br><span class="line">	</span><br><span class="line">	//登录</span><br><span class="line">	<span class="built_in">public</span> <span class="keyword">User</span> <span class="keyword">login</span>(<span class="keyword">User</span> <span class="keyword">user</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> userDao.<span class="keyword">login</span>(<span class="keyword">user</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	//添加/注册</span><br><span class="line">	<span class="built_in">public</span> <span class="type">int</span> addUser(<span class="keyword">User</span> <span class="keyword">user</span>) &#123;</span><br><span class="line">		// TODO Auto-<span class="keyword">generated</span> <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.addUser(<span class="keyword">user</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	//查询</span><br><span class="line">	<span class="built_in">public</span> List&lt;<span class="keyword">User</span>&gt; findAll()&#123;</span><br><span class="line">		<span class="keyword">return</span> userDao.findAll();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	//删除</span><br><span class="line">	<span class="built_in">public</span> <span class="type">int</span> delById(<span class="type">int</span> id) &#123;</span><br><span class="line">		<span class="keyword">return</span> userDao.delById(id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	//更新</span><br><span class="line">	<span class="built_in">public</span> <span class="type">int</span> userUpdate(<span class="keyword">User</span> <span class="keyword">user</span>) &#123;</span><br><span class="line">		// TODO Auto-<span class="keyword">generated</span> <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.userUpdate(<span class="keyword">user</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	//详情记录</span><br><span class="line">	<span class="built_in">public</span> <span class="keyword">User</span> findById(<span class="type">int</span> id) &#123;</span><br><span class="line">		<span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	//<span class="keyword">user</span>列表检索</span><br><span class="line">	<span class="built_in">public</span> List&lt;<span class="keyword">User</span>&gt; selectAll(<span class="keyword">User</span> <span class="keyword">user</span>,<span class="type">int</span> pageNum,<span class="type">int</span> pageSize)&#123;</span><br><span class="line">		<span class="keyword">return</span> userDao.selectAll(<span class="keyword">user</span>,pageNum,pageSize);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">public</span> <span class="type">int</span> totalCount(<span class="keyword">User</span> <span class="keyword">user</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> userDao.totalCount(<span class="keyword">user</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-创建控制层Controller"><a href="#5-创建控制层Controller" class="headerlink" title="5. 创建控制层Controller"></a>5. 创建控制层Controller</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package com.zhao.controller;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import com.zhao.entity.User;</span><br><span class="line">import com.zhao.service.UserService;</span><br><span class="line"></span><br><span class="line">@<span class="constructor">WebServlet(<span class="string">"/UserController"</span>)</span></span><br><span class="line">public <span class="keyword">class</span> UserController extends HttpServlet &#123;</span><br><span class="line">	<span class="keyword">private</span> static final long serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">    public <span class="constructor">UserController()</span> &#123;</span><br><span class="line">        super<span class="literal">()</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public UserService userService = <span class="keyword">new</span> <span class="constructor">UserService()</span>;</span><br><span class="line">	protected void <span class="keyword">do</span><span class="constructor">Get(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span> throws ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//设置编码</span></span><br><span class="line">		request.set<span class="constructor">CharacterEncoding(<span class="string">"utf-8"</span>)</span>;</span><br><span class="line">		response.set<span class="constructor">CharacterEncoding(<span class="string">"utf-8"</span>)</span>;</span><br><span class="line">		<span class="comment">//获取请求方法参数</span></span><br><span class="line">		String <span class="keyword">method</span> = request.get<span class="constructor">Parameter(<span class="string">"method"</span>)</span>;</span><br><span class="line">		<span class="comment">//判断登录方法</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"login"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			</span><br><span class="line">			login(request,response);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"addUser"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			</span><br><span class="line">			add<span class="constructor">User(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"findAll"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			<span class="comment">//alt+shift+l以及alt+shift+m：提取本地变量及方法</span></span><br><span class="line">			find<span class="constructor">All(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"delById"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			</span><br><span class="line">			del<span class="constructor">ById(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"userUpdate"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			user<span class="constructor">Update(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"findById"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			find<span class="constructor">ById(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"selectAll"</span>.equals(<span class="keyword">method</span>))&#123;</span><br><span class="line">			select<span class="constructor">All(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			response.get<span class="constructor">Writer()</span>.append(<span class="string">"error"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//user列表检索</span></span><br><span class="line">	<span class="keyword">private</span> void select<span class="constructor">All(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span></span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		String id = request.get<span class="constructor">Parameter(<span class="string">"id"</span>)</span>;</span><br><span class="line">		String name = request.get<span class="constructor">Parameter(<span class="string">"name"</span>)</span>;</span><br><span class="line">		String pwd = request.get<span class="constructor">Parameter(<span class="string">"pwd"</span>)</span>;</span><br><span class="line">		String pageNum = request.get<span class="constructor">Parameter(<span class="string">"pageNum"</span>)</span>;</span><br><span class="line">		String pageSize = request.get<span class="constructor">Parameter(<span class="string">"pageSize"</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">int</span> num = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">int</span> size = <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(pageNum!=null<span class="operator"> &amp;&amp; </span>!<span class="string">""</span>.equals(pageNum)) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">			num = <span class="module-access"><span class="module"><span class="identifier">Integer</span>.</span></span>parse<span class="constructor">Int(<span class="params">pageNum</span>)</span>;</span><br><span class="line">			&#125;catch (Exception e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">			num=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(pageSize !=null<span class="operator"> &amp;&amp; </span>!<span class="string">""</span>.equals(pageSize)) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">			size = <span class="module-access"><span class="module"><span class="identifier">Integer</span>.</span></span>parse<span class="constructor">Int(<span class="params">pageSize</span>)</span>;</span><br><span class="line">			&#125;catch (Exception e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">			size=<span class="number">2</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(num+<span class="string">","</span>+size);</span><br><span class="line">		<span class="comment">//int num = Integer.parseInt(pageNum);</span></span><br><span class="line">		<span class="comment">//int size = Integer.parseInt(pageSize);</span></span><br><span class="line">		<span class="built_in">int</span> uid = <span class="number">0</span>;  </span><br><span class="line">		<span class="keyword">if</span>(id!=null<span class="operator"> &amp;&amp; </span>!<span class="string">""</span>.equals(id)) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">			uid = <span class="module-access"><span class="module"><span class="identifier">Integer</span>.</span></span>parse<span class="constructor">Int(<span class="params">id</span>)</span>;</span><br><span class="line">			&#125;catch (Exception e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">			uid=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		User user  = <span class="keyword">new</span> <span class="constructor">User(<span class="params">uid</span>,<span class="params">name</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用service层</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//查询记录总数</span></span><br><span class="line">		<span class="built_in">int</span> total =  userService.total<span class="constructor">Count(<span class="params">user</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//计算总页数</span></span><br><span class="line">		 <span class="built_in">int</span> pageCount =  total%size==<span class="number">0</span>? total/size:total/size+<span class="number">1</span>;</span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">if</span>(num&lt;<span class="number">1</span>) &#123;<span class="comment">//页码超过最小值</span></span><br><span class="line">			 num=<span class="number">1</span>;</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">if</span>(num&gt;pageCount) &#123;<span class="comment">//页码超过最大值</span></span><br><span class="line">			 num=pageCount;</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(size);</span><br><span class="line">		 </span><br><span class="line">		<span class="comment">//返回数据列表selectAll(user,num,size)参数传值要与Dao层相呼应</span></span><br><span class="line">		List&lt;User&gt;  userList =  userService.select<span class="constructor">All(<span class="params">user</span>,<span class="params">num</span>,<span class="params">size</span>)</span>;</span><br><span class="line">		<span class="comment">//将查询到的userList集合转发到userList.jsp页面上</span></span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"userlist"</span>, <span class="params">userList</span>)</span>;</span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"condition"</span>, <span class="params">user</span>)</span>;</span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"pageNum"</span>, <span class="params">num</span>)</span>;</span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"pageSize"</span>, <span class="params">size</span>)</span>;</span><br><span class="line">		request.get<span class="constructor">RequestDispatcher(<span class="string">"userList.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//详情查询</span></span><br><span class="line">	<span class="keyword">private</span> void find<span class="constructor">ById(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span></span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//获取请求参数</span></span><br><span class="line">		String id = request.get<span class="constructor">Parameter(<span class="string">"id"</span>)</span>;</span><br><span class="line">		<span class="comment">//调用service层方法</span></span><br><span class="line">		User user = userService.find<span class="constructor">ById(Integer.<span class="params">parseInt</span>(<span class="params">id</span>)</span>);</span><br><span class="line">		<span class="keyword">if</span>(user != null) &#123;</span><br><span class="line">			<span class="comment">//把user对象放到request域</span></span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">user</span>)</span>;</span><br><span class="line">			<span class="comment">//转发到addUpdate页面</span></span><br><span class="line">			request.get<span class="constructor">RequestDispatcher(<span class="string">"addUpdate.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"msg"</span>, <span class="string">"没得详情记录！"</span>)</span>;</span><br><span class="line">			find<span class="constructor">All(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">	<span class="keyword">private</span> void del<span class="constructor">ById(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span> </span><br><span class="line">		throws ServletException, IOException&#123;</span><br><span class="line">		<span class="comment">//获取传入的id值</span></span><br><span class="line">				String id = request.get<span class="constructor">Parameter(<span class="string">"id"</span>)</span>; </span><br><span class="line">				<span class="comment">//强制转换id为int类型</span></span><br><span class="line">				<span class="built_in">int</span> i = <span class="module-access"><span class="module"><span class="identifier">Integer</span>.</span></span>parse<span class="constructor">Int(<span class="params">id</span>)</span>;</span><br><span class="line">				<span class="comment">//调用service层</span></span><br><span class="line">				<span class="built_in">int</span> num = userService.del<span class="constructor">ById(<span class="params">i</span>)</span>;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(num<span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">					request.set<span class="constructor">Attribute(<span class="string">"msg"</span>, <span class="string">"删除失败"</span>)</span>;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					request.set<span class="constructor">Attribute(<span class="string">"msg"</span>, <span class="string">"删除成功"</span>)</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//跳转到user列表</span></span><br><span class="line">				find<span class="constructor">All(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//更新</span></span><br><span class="line">	<span class="keyword">private</span> void user<span class="constructor">Update(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span></span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//获取id</span></span><br><span class="line">		String id =  request.get<span class="constructor">Parameter(<span class="string">"id"</span>)</span>;</span><br><span class="line">		String name = request.get<span class="constructor">Parameter(<span class="string">"name"</span>)</span>;</span><br><span class="line">		String pwd = request.get<span class="constructor">Parameter(<span class="string">"pwd"</span>)</span>;</span><br><span class="line">		<span class="built_in">int</span> uid = <span class="module-access"><span class="module"><span class="identifier">Integer</span>.</span></span>parse<span class="constructor">Int(<span class="params">id</span>)</span>;</span><br><span class="line">		User user = <span class="keyword">new</span> <span class="constructor">User(<span class="params">uid</span>,<span class="params">pwd</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">		 <span class="built_in">int</span> num = userService.user<span class="constructor">Update(<span class="params">user</span>)</span>;</span><br><span class="line">		<span class="comment">//判断user是否为空</span></span><br><span class="line">		<span class="keyword">if</span>(num != <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//将查询到的user对象转发到详情页面</span></span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">user</span>)</span>;</span><br><span class="line">			request.get<span class="constructor">RequestDispatcher(<span class="string">"addUser.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"msg"</span>, <span class="string">"没有详情"</span>)</span>;</span><br><span class="line">			find<span class="constructor">All(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//编码的时候出现了java.lang.NumberFormatException: null，at java.lang.Integer.parseInt(Integer.java:415)at java.lang.Integer.valueOf(Integer.java:553)。刚开始还一直以为我类型转换错误呢。</span></span><br><span class="line">		<span class="comment">//原来，不够细心，在传递url值的时候忘了传递参数，或者传递错误，这样当然获取到的值为null。</span></span><br><span class="line">		<span class="comment">//比如：本来url为http://……&amp;state=1,那么传递的一个参数为state=1，获取这个参数的时候应为int state = Integer.parseInt(request.getParameter("state")).这样就不会报错，但是如果忘了在地址栏传递参数state=1,那么，也会出现java.lang.NumberFormatException: null…………的错误。</span></span><br><span class="line">        <span class="comment">//所以java.lang.NumberFormatException错误不一定是类型转换错误，也有可能是因为获取不到参数而产生的错误</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//添加|注册</span></span><br><span class="line">	<span class="comment">//alt+shift+l以及alt+shift+m：提取本地变量及方法</span></span><br><span class="line">	<span class="keyword">private</span> void add<span class="constructor">User(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span></span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		String name = request.get<span class="constructor">Parameter(<span class="string">"name"</span>)</span>;</span><br><span class="line">		String pwd = request.get<span class="constructor">Parameter(<span class="string">"pwd"</span>)</span>;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(name);</span><br><span class="line">		<span class="comment">//编码解码先获取iso8859-1字节，后编码utf-8格式</span></span><br><span class="line">		<span class="comment">//String name1 = new String(name.getBytes("iso8859-1"),"utf-8");</span></span><br><span class="line">		<span class="comment">//封装数据</span></span><br><span class="line">		User user = <span class="keyword">new</span> <span class="constructor">User(<span class="params">name</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">		<span class="built_in">int</span> num = userService.add<span class="constructor">User(<span class="params">user</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(num<span class="operator"> == </span><span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">//添加</span></span><br><span class="line">			find<span class="constructor">All(<span class="params">request</span>,<span class="params">response</span>)</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			request.get<span class="constructor">RequestDispatcher(<span class="string">"index.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查看账户信息</span></span><br><span class="line">	<span class="keyword">private</span> void find<span class="constructor">All(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span></span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//调用service层方法</span></span><br><span class="line">		List&lt;User&gt; userlist = userService.find<span class="constructor">All()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将查询的数据userlist集合转发到userList.jsp</span></span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"userlist"</span>, <span class="params">userlist</span>)</span>;</span><br><span class="line">		request.get<span class="constructor">RequestDispatcher(<span class="string">"userList.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//登录</span></span><br><span class="line">	<span class="keyword">private</span> void login(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//获取请求参数</span></span><br><span class="line">		String name = request.get<span class="constructor">Parameter(<span class="string">"name"</span>)</span>;</span><br><span class="line">		String pwd = request.get<span class="constructor">Parameter(<span class="string">"pwd"</span>)</span>;</span><br><span class="line">		<span class="comment">//收集用户登录信息</span></span><br><span class="line">		User user = <span class="keyword">new</span> <span class="constructor">User(<span class="params">name</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">		<span class="comment">//调用业务层方法</span></span><br><span class="line">		User user1 = userService.login(user);</span><br><span class="line">		<span class="comment">//判断用户是否为空</span></span><br><span class="line">		<span class="keyword">if</span>(user1 != null) &#123;</span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">user1</span>)</span>;</span><br><span class="line">			request.get<span class="constructor">RequestDispatcher(<span class="string">"index.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//设置提示消息</span></span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"error"</span>,<span class="string">"账户或密码错误！"</span>)</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//设置参数到request对象中</span></span><br><span class="line">			request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">user</span>)</span>;</span><br><span class="line">			<span class="comment">//转发到登陆页面</span></span><br><span class="line">			request.get<span class="constructor">RequestDispatcher(<span class="string">"login.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	protected void <span class="keyword">do</span><span class="constructor">Post(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span> throws ServletException, IOException &#123;</span><br><span class="line">		<span class="keyword">do</span><span class="constructor">Get(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="jsp页面"><a href="#jsp页面" class="headerlink" title="jsp页面"></a>jsp页面</h3><ol>
<li>登录<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"UserController?method=login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">		账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;error &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">		密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"register.jsp"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>注册<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"UserController?method=addUser"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">	账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">	密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>账号管理页面<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span> %&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>表EL表达式<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 页面检索 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"UserController?method=selectAll"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		ID:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&lt;c:if test="</span>$</span></span><span class="template-variable">&#123;condition.id != 0&#125;</span><span class="xml"><span class="tag">"&gt;</span>$</span><span class="template-variable">&#123;condition.id&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>"&gt;</span></span><br><span class="line"><span class="xml">		账号:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;condition.name &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"搜索"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"register.jsp"</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1px"</span><span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;userlist&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">var</span>=<span class="string">"user"</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>$</span><span class="template-variable">&#123;user.id&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>$</span><span class="template-variable">&#123;user.name&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>$</span><span class="template-variable">&#123;user.pwd&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">					<span class="comment">&lt;!-- 注意：详情和删除都是id属性进行操作的必须加条件&amp;id=$</span></span><span class="template-variable">&#123;user.id&#125;</span><span class="xml"><span class="comment"></span></span></span><br><span class="line"><span class="xml">					不然会报异常：java.lang.NumberFormatException: null </span></span><br><span class="line"><span class="xml">					显示为null --&gt;</span></span><br><span class="line"><span class="xml">					<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"UserController?method=findById&amp;id=$</span></span></span><span class="template-variable">&#123;user.id&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>详情<span class="tag">&lt;/<span class="name">a</span>&gt;</span> | <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"UserController?method=delById&amp;id=$</span></span></span><span class="template-variable">&#123;user.id&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span>	</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span> </span></span><br><span class="line"><span class="xml">	<span class="comment">&lt;!-- 分页 --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"UserController?method=selectAll&amp;pageNum=$</span></span></span><span class="template-variable">&#123;pageNum-1&#125;</span><span class="xml"><span class="tag"><span class="string">&amp;pageSize=2"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>当前页$</span><span class="template-variable">&#123;pageNum&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"UserController?method=selectAll&amp;pageNum=$</span></span></span><span class="template-variable">&#123;pageNum+1&#125;</span><span class="xml"><span class="tag"><span class="string">&amp;pageSize=2"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>更新<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span> %&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="comment">&lt;!--判断user为空添加，user不为空更新  --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">form</span>  &lt;<span class="attr">c:if</span> <span class="attr">test</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;empty user &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>action="UserController?method=addUser"<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		   <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;not empty user &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>action="UserController?method=userUpdate"<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span></span><br><span class="line"><span class="xml">		   method="post"&gt;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;user.id&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">style</span>=<span class="string">"display:none"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;user.name &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">		密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;user.pwd &#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"更新"</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>Java web</tag>
      </tags>
  </entry>
  <entry>
    <title>Hibernate框架(五)</title>
    <url>/2019/11/21/Hibernate%E6%A1%86%E6%9E%B6-%E4%BA%94/</url>
    <content><![CDATA[<h3 id="一对一关系映射详解"><a href="#一对一关系映射详解" class="headerlink" title="一对一关系映射详解"></a>一对一关系映射详解</h3><ol>
<li>方式一：一对一关系外键配置</li>
</ol>
<ul>
<li>实体类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Company</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id;<span class="comment">//公司Id</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> name;<span class="comment">//公司名称</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Adderss adderss;<span class="comment">//公司属于某个地址</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Adderss <span class="title">getAdderss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> adderss;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdderss</span><span class="params">(Adderss adderss)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.adderss = adderss;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package com.zhao.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adderss</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id; <span class="comment">//地址id</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> name; <span class="comment">//地址名称</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Company company;<span class="comment">//地址属于某个公司</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Company <span class="title">getCompany</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> company;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompany</span><span class="params">(Company company)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.company = company;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>映射文件 .hbm.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zhao.domain.Company"</span> <span class="attr">table</span>=<span class="string">"t_company"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--一个公司对应一个地址，一对一关系 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"adderss"</span> <span class="attr">class</span>=<span class="string">"com.zhao.domain.Adderss"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-one</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhao.domain"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Adderss"</span> <span class="attr">table</span>=<span class="string">"t_adderss"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--一个地址只属于一个公司，一对一关系</span></span><br><span class="line"><span class="comment">       这是一种特殊的多对一关系</span></span><br><span class="line"><span class="comment">       column="company_id" 外键名称</span></span><br><span class="line"><span class="comment">       unique="true" 外键唯一 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"company"</span> <span class="attr">class</span>=<span class="string">"Company"</span> <span class="attr">column</span>=<span class="string">"company_id"</span> <span class="attr">unique</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>核心配置类<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库JDBC驱动 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">           com.mysql.cj.jdbc.Driver</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库连接URL --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">           jdbc:mysql://localhost:3306/hibernate_user?serverTimezone=Asia/Shanghai</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库用户名 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库密码 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>zhao1314520<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 输出运行时生成的SQL语句 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--显示SQL语句--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--	是否自动提交事务	--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.autocommit"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--		配置映射文件与数据库表关系</span></span><br><span class="line"><span class="comment">                   update：有表则更新，无则创建</span></span><br><span class="line"><span class="comment">                   create：每次启动hibernate都创建，（注意：以前数据没得了）</span></span><br><span class="line"><span class="comment">                   create-drop：每次启动hibernate都创建，执行完后删除表--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 开启二级缓存 &amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--		&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 设置二级缓存插件EHCache的Provider类&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--		&lt;property name="hibernate.cache.region.factory_class"&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--			org.hibernate.cache.ehcache.EhCacheRegionFactory--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--		&lt;/property&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--开启与当前线程绑定session功能--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库方言 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">           org.hibernate.dialect.MySQL5Dialect</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 列出所有的映射文件 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/domain/Address.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/domain/Company.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>提取工具类<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.hibernate_utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">util</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory factory;</span><br><span class="line">   <span class="keyword">static</span>&#123;</span><br><span class="line">       <span class="comment">//1.获取核心配置文件对象</span></span><br><span class="line">       Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">       <span class="comment">//2.创建会话工厂</span></span><br><span class="line">       factory = configuration.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//监听程序关闭</span></span><br><span class="line">       Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread()&#123;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               System.out.println(<span class="string">"程序关闭。。。！"</span>);</span><br><span class="line">               <span class="comment">//关闭会话工厂</span></span><br><span class="line">               factory.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Session <span class="title">openSession</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//返回会话工厂获取到的session对象</span></span><br><span class="line">       <span class="function"><span class="keyword">return</span> factory.<span class="title">openSession</span><span class="params">()</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Session <span class="title">getCurrentSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">return</span> factory.<span class="title">getCurrentSession</span><span class="params">()</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.hibernate.<span class="keyword">Session</span>;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> lession &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> test()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> =util.openSession();</span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       Company company = <span class="built_in">new</span> Company();</span><br><span class="line">       company.setName("埃尔");</span><br><span class="line"></span><br><span class="line">       Adderss adderss = <span class="built_in">new</span> Adderss();</span><br><span class="line">       adderss.setName("匹尔科斯101街道");</span><br><span class="line"></span><br><span class="line">       adderss.setCompany(company);</span><br><span class="line">       //保存</span><br><span class="line">       <span class="keyword">session</span>.save(company);</span><br><span class="line">       <span class="keyword">session</span>.save(adderss);</span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>方式二：一对一关系主键又是外键配置</li>
</ol>
<ul>
<li><p>修改外键映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhao.domain"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Adderss"</span> <span class="attr">table</span>=<span class="string">"t_adderss"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 指定使用哪个主键生成主键 使用外键的方式生成主键 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"foreign"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- property属性指定使用当前持久化类的哪一个属性的主键作为外键 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--property属性执行使用当前哪个持久化的类的哪个属性作为外键 指定当前持久化类的哪个属性作为主键 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"property"</span>&gt;</span><span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--一个地址只属于一个公司，一对一关系</span></span><br><span class="line"><span class="comment">       这是一种特殊的多对一关系</span></span><br><span class="line"><span class="comment">       constrained="true" --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"company"</span> <span class="attr">class</span>=<span class="string">"Company"</span> <span class="attr">constrained</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-one</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>constrained=”true”</p>
<ol>
<li><p>表示：constrained属性在hibernate一对一关系中会用到，hibernate文档中是这么写的，constrained（约束）,只能在one-to-one的映射中使用，一般在主表映射中，有外键的那个表，如果constrained=true，则表明存在外键与关联表对应，并且关联表中肯定存在对应的键与其对应，另外，改选项最关键的是影响save和deleted先后顺序，如果是增加的时候，如果constrained=true则会增加关联表，然后增加本表，删除的时候是先伸出本表然后删除关联的表</p>
</li>
<li><p>one-to-one的单向关联中，如果constrained=false则会在查询的时候全部取出来，用left outer join的方式 如果constrained=true，hibernate会延迟加载sql，只会把主表查询出来，等有用到关联表的时候再发出sql语句去取出来</p>
</li>
<li><p>one-to-one的双向关联，必须设置constrained=true 要不然会出现重复读数据，</p>
</li>
<li><p>如果2个表中Company，Adderss在false时候的sql语句如下</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> Company </span><br><span class="line">c left outer join </span><br><span class="line">Adderss a <span class="keyword">on</span> c.<span class="built_in">id</span>=a.<span class="built_in">id</span> </span><br><span class="line">left outer join <span class="keyword">on</span> Company</span><br><span class="line">com <span class="keyword">on</span> c.<span class="built_in">id</span>=com.<span class="built_in">id</span> <span class="keyword">where</span> c.<span class="built_in">id</span>=?</span><br></pre></td></tr></table></figure>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3></li>
</ol>
<ul>
<li>缓存(Cache)</li>
<li>概念什么是缓存？<ol>
<li>☞缓存就是数据交换的缓冲区（称作：Cache），当某一硬件要读取数据时，会首先从缓存汇总查询数据，有则直接执行，不存在时从内存中获取。由于缓存的数据比内存快的多，所以缓存的作用就是帮助硬件更快的运行。</li>
<li>☞ 缓存往往使用的是RAM（断电既掉的非永久存储），所以在用完后还是会把文件送到硬盘等存储器中永久存储。电脑中最大缓存就是内存条，硬盘上也有16M或者32M的缓存。</li>
<li>☞ 高速缓存是用来协调CPU与主存之间存取速度的差异而设置的。一般CPU工作速度高，但内存的工作速度相对较低，为了解决这个问题，通常使用高速缓存，高速缓存的存取速度介于CPU与主存之间。系统将一些CPU在最近几个时间段经常访问的内容存在高速缓存，这样就在一定程度上缓解了由于主存速度低造成的CPU“停工待料”的情况。</li>
<li>☞ 缓存就是把一些外存上的数据保存在内存上而已，为什么保存在内存上，我们运行的所有程序里面的变量都是存放在内存中的，所以如果想将值放入内存上，可以通过变量的方式存储。在JAVA中一些缓存一般都是通过Map集合来实现的。<br>▁▂▃▅▆ ：缓存在不同的场景下，作用是不一样的具体举例说明：<br>✔  操作系统磁盘缓存 ——&gt; 减少磁盘机械操作。<br>✔  数据库缓存——&gt;减少文件系统IO。<br>✔  应用程序缓存——&gt;减少对数据库的查询。<br>✔  Web服务器缓存——&gt;减少应用服务器请求。<br>✔  客户端浏览器缓存——&gt;减少对网站的访问。</li>
</ol>
</li>
</ul>
</li>
<li><p>总结：</p>
<ol>
<li>作用：降低应用程序直接读写硬盘的频率,提高其运行性能;</li>
<li>缓存中的数据是数据存储源中的拷贝，其物理介质一般是内存；</li>
<li>程序《– （内存） –》 硬盘<h3 id="hibernate-二级缓存（PO-persist-object-持久化对象）"><a href="#hibernate-二级缓存（PO-persist-object-持久化对象）" class="headerlink" title="hibernate 二级缓存（PO persist object 持久化对象）"></a>hibernate 二级缓存（PO persist object 持久化对象）</h3>▁▂▃▅▆：hibernate 提供两种缓存机制：一级缓存 二级缓存<br>✔ 一级缓存：session缓存，在一次请求中共享数据<br>✔ 二级缓存：sessionFactory级别缓存，整个应用程序共享一个会话工厂，共享一个二级缓存。</li>
</ol>
</li>
<li><p>sessionFactory 的缓存由两部分：<br>内置缓存：使用一个Map集合，用于存放配置信息，预定义HQL语句等，提供给hibernate框架自己使用，对外只读的，不能操作。<br>外置缓存：使用另一个map集合，用于存放用户自定义数据。默认不开启。外置缓存hibernate只提供规范(接口)，需要第三方实现类。 </p>
</li>
<li><p>缓存结构图<br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1574273471066&di=21b666797a9206bf4946ffef55da20dc&imgtype=jpg&src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D253178479%2C3342375082%26fm%3D214%26gp%3D0.jpg" alt="结构图"><br>▁▂▃▅▆详解：<br>First-level Cache 一级缓存(存放持久态数据)-PO<br>Second -level Cache 二级缓存<br>Cache-level Strategy  缓存并发策略<br>Query Cache 查询缓存<br>Cache Provider 二级缓存的实现类提供者<br>Class Cache Region  类缓存<br>Collection Cache Region  集合缓存<br>Query Cache Region 查询缓存<br>Update Timestamps  时间戳</p>
</li>
</ul>
<h3 id="并发访问策略-Cache-level-Strategy-缓存并发策略"><a href="#并发访问策略-Cache-level-Strategy-缓存并发策略" class="headerlink" title="并发访问策略(Cache-level Strategy  缓存并发策略)"></a>并发访问策略(Cache-level Strategy  缓存并发策略)</h3><ol>
<li>transactional 事务型(性能低)<ul>
<li>仅在手管理的环境中使用</li>
<li>提供Repeatable Read 事务隔离级别</li>
<li>适用经常被读，很少修改数据</li>
<li>可以防止脏读和不可重复读的并发问题</li>
<li>缓存支持事务，发生异常的时候，缓存也能够回滚</li>
</ul>
</li>
<li>read-write 读写型<ul>
<li>提供Read committed 事务隔离级别</li>
<li>在非集群的环境中适用</li>
<li>适用经常被读，很少修改数据</li>
<li>可以防止脏读</li>
<li>更新缓存的时候会锁定缓存中的数据</li>
</ul>
</li>
<li>nonstrict-read-write 非严格读写型<ul>
<li>适用极少修改，偶尔允许脏读数据(两个事务同时修改数据的情况很少见)</li>
<li>不保证缓存和数据库的一致性</li>
<li>不锁定缓存中的数据</li>
</ul>
</li>
<li>read-only 只读<ul>
<li>适用从来不会修改的数据</li>
<li>在此模式下如果对数据进行更新操作，会有异常</li>
<li>事务隔离级别低，并发性能高</li>
<li>在集群环境中也能完美运行</li>
</ul>
</li>
</ol>
<ul>
<li>注意：<br>  ▁▂▃▅▆ 适合放入二级缓存数据：(国家，地区等)<ul>
<li>很少被修改数据</li>
<li>不是很重要的数据，允许偶尔的并发问题<br>▁▂▃▅▆ 不适合放入二级缓存的数据：</li>
<li>经常被修改</li>
<li>财务数据，绝不允许出现并发问题</li>
<li>与其他应用共享数据</li>
</ul>
</li>
<li>二级缓存供应商<ul>
<li>Hibernate中定义二级缓存接口，实现需要自己选择的供应商</li>
<li>EHCache：对Hibernate查询提供了支持，支持集群，不支持并发访问策略transactional(事务型) <h3 id="二级缓存整合EHCache（二级缓存提供商）"><a href="#二级缓存整合EHCache（二级缓存提供商）" class="headerlink" title="二级缓存整合EHCache（二级缓存提供商）"></a>二级缓存整合EHCache（二级缓存提供商）</h3><ol>
<li>导包：</li>
</ol>
</li>
<li>backport-util-concurrent.jar</li>
<li>commons-logging.jar</li>
<li>ehcache-1.5.0.jar</li>
<li>ehcache-failsafe.xml</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>配置hibernate.cfg.xml</p>
<ul>
<li>从hibernate.properties查看二级缓存设置<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">### 开启二级缓存</span><br><span class="line"><span class="selector-id">#hibernate</span><span class="selector-class">.cache</span><span class="selector-class">.use_second_level_cache</span>  <span class="selector-tag">false</span></span><br><span class="line">### 二级缓存提供商</span><br><span class="line"><span class="selector-id">#hibernate</span><span class="selector-class">.cache</span><span class="selector-class">.region</span><span class="selector-class">.factory_class</span>  <span class="selector-tag">org</span><span class="selector-class">.hibernate</span><span class="selector-class">.cache</span><span class="selector-class">.internal</span><span class="selector-class">.EhCacheRegionFactory</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hibernate.cfg.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库JDBC驱动 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">           com.mysql.cj.jdbc.Driver</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库连接URL --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">           jdbc:mysql://localhost:3306/hibernate_user?serverTimezone=Asia/Shanghai</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库用户名 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库密码 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>zhao1314520<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 输出运行时生成的SQL语句 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--显示SQL语句--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--	是否自动提交事务	--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.autocommit"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--		配置映射文件与数据库表关系</span></span><br><span class="line"><span class="comment">                   update：有表则更新，无则创建</span></span><br><span class="line"><span class="comment">                   create：每次启动hibernate都创建，（注意：以前数据没得了）</span></span><br><span class="line"><span class="comment">                   create-drop：每次启动hibernate都创建，执行完后删除表--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--	 开启二级缓存 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--	 设置二级缓存插件EHCache的Provider类 提供商--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.cache.region.factory_class"</span>&gt;</span></span><br><span class="line">       			org.hibernate.cache.ehcache.EhCacheRegionFactory</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--开启与当前线程绑定session功能--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据库方言 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">           org.hibernate.dialect.MySQL5Dialect</span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.provider_class"</span>&gt;</span>org.hibernate.connection.C3P0ConnectionProvider<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.min_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.timeout"</span>&gt;</span>5000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_statements"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.idle_test_period"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.acquire_increment"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.validate"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 列出所有的映射文件 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/domain/Address.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/domain/Company.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- class=""全限定类名</span></span><br><span class="line"><span class="comment">      usage=""缓存并发策略 read-only 只读--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">class-cache</span> <span class="attr">class</span>=<span class="string">"com.zhao.domain.Company"</span> <span class="attr">usage</span>=<span class="string">"read-only"</span>&gt;</span><span class="tag">&lt;/<span class="name">class-cache</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">class-cache</span> <span class="attr">class</span>=<span class="string">"com.zhao.domain.Adderss"</span> <span class="attr">usage</span>=<span class="string">"read-only"</span>&gt;</span><span class="tag">&lt;/<span class="name">class-cache</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置集合缓存--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">collection-cache</span> <span class="attr">collection</span>=<span class="string">"com.zhao.domain.Company.adderss"</span> <span class="attr">usage</span>=<span class="string">"read-only"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection-cache</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>配置类和集合缓存</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置类缓存</span></span><br><span class="line"><span class="comment">   注意：类缓存的路径是在mapping下，是dtd约束的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class-cache</span> <span class="attr">usage</span>=<span class="string">"read-only"</span> <span class="attr">class</span>=<span class="string">"全限定类名"</span>&gt;</span><span class="tag">&lt;/<span class="name">class-cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置集合缓存--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">collection-cache</span> <span class="attr">usage</span>=<span class="string">"read-only"</span> <span class="attr">collection</span>=<span class="string">"全限定类名"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置</p>
<ul>
<li>把jar包中ehcache-failsafe.xml文件复制到项目的src目录，然后改名为ehcahe.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"../config/ehcache.xsd"</span>&gt;</span></span><br><span class="line">   //diskStore 硬盘存储  设置临时文件存储位置</span><br><span class="line">   <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       磁盘存储:将缓存中暂时不使用的对象,转移到硬盘,类似于Windows系统的虚拟内存</span></span><br><span class="line"><span class="comment">       path:指定在硬盘上存储对象的路径</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"java.io.tmpdir"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       defaultCache:默认的缓存配置信息,如果不加特殊说明,则所有对象按照此配置项处理</span></span><br><span class="line"><span class="comment">       maxElementsInMemory:设置了缓存的上限,最多存储多少个记录对象</span></span><br><span class="line"><span class="comment">       eternal:代表对象是否永不过期</span></span><br><span class="line"><span class="comment">       timeToIdleSeconds:最大的发呆时间</span></span><br><span class="line"><span class="comment">       timeToLiveSeconds:最大的存活时间</span></span><br><span class="line"><span class="comment">       overflowToDisk:是否允许对象被写入到磁盘</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">defaultCache</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span> <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span> <span class="attr">overflowToDisk</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       cache:为指定名称的对象进行缓存的特殊配置</span></span><br><span class="line"><span class="comment">       name:指定对象的完整名</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"com.zbaccp.entity.Person"</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span> <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">timeToIdleSeconds</span>=<span class="string">"300"</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">"600"</span> <span class="attr">overflowToDisk</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ehcahe-xml属性文件详解"><a href="#ehcahe-xml属性文件详解" class="headerlink" title="ehcahe.xml属性文件详解"></a>ehcahe.xml属性文件详解</h3></li>
</ul>
</li>
<li><p>diskStore ：指定数据(.data and .index)存储位置，可指定磁盘中的文件夹位置期 The diskStore element is optional. It must be configured if you have overflowToDisk or diskPersistent enabled    for any cache. If it is not configured, a warning will be issues and java.io.tmpdir will be used.</p>
</li>
<li><p>defaultCache ： 默认的管理策略</p>
</li>
</ol>
<ul>
<li>一、以下属性是必须的：<ol>
<li>name： Cache的名称，必须是唯一的(ehcache会把这个cache放到HashMap里)。</li>
<li>maxElementsInMemory：在内存中缓存的element的最大数目。 </li>
<li>maxElementsOnDisk：在磁盘上缓存的element的最大数目，默认值为0，表示不限制。 </li>
<li>eternal：设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断。 </li>
<li>overflowToDisk： 如果内存中数据超过内存限制，是否要缓存到磁盘上。 </li>
</ol>
</li>
<li>二、以下属性是可选的：<ol>
<li>timeToIdleSeconds： 对象空闲时间，指对象在多长时间没有被访问就会失效。只对eternal为false的有效。默认值0，表示一直可以访问。</li>
<li>timeToLiveSeconds： 对象存活时间，指对象从创建到失效所需要的时间。只对eternal为false的有效。默认值0，表示一直可以访问。</li>
<li>diskPersistent： 是否在磁盘上持久化。指重启jvm后，数据是否有效。默认为false。 </li>
<li>diskExpiryThreadIntervalSeconds： 对象检测线程运行时间间隔。标识对象状态的线程多长时间运行一次。</li>
<li>diskSpoolBufferSizeMB： DiskStore使用的磁盘大小，默认值30MB。每个cache使用各自的DiskStore。</li>
<li>memoryStoreEvictionPolicy： 如果内存中数据超过内存限制，向磁盘缓存时的策略。默认值LRU，可选FIFO、LFU。 </li>
</ol>
</li>
<li>三、缓存的3 种清空策略 ：<ol>
<li>FIFO ，first in first out (先进先出).</li>
<li>LFU ， Less Frequently Used (最少使用).意思是一直以来最少被使用的。缓存的元素有一个hit 属性，hit 值最小的将会被清出缓存。</li>
<li>LRU ，Least Recently Used(最近最少使用). (ehcache 默认值).缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。</li>
</ol>
</li>
</ul>
<h3 id="查询缓存-又称三级缓存"><a href="#查询缓存-又称三级缓存" class="headerlink" title="查询缓存(又称三级缓存)"></a>查询缓存(又称三级缓存)</h3><ol>
<li>开启查询缓存<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启查询缓存--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.cache.use_query_cache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>测试<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 查询，执行sql语句，将结果进行缓存 针对HQL的</span></span><br><span class="line">Query query = session.create<span class="constructor">Query(<span class="string">"from Customer"</span>)</span>;</span><br><span class="line">query.set<span class="constructor">Cacheable(<span class="params">yrue</span>)</span>;<span class="comment">//设置允许缓存</span></span><br><span class="line">List&lt;Customer&gt; <span class="built_in">list</span> = query.<span class="built_in">list</span><span class="literal">()</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="built_in">list</span>);</span><br><span class="line"></span><br><span class="line">session.close<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">Session session1 = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line"><span class="comment">//2.查找，从查询缓存中获取数据</span></span><br><span class="line">query = session1.create<span class="constructor">Query(<span class="string">"from Customer"</span>)</span>;</span><br><span class="line">query.set<span class="constructor">Cacheable(<span class="params">true</span>)</span>;<span class="comment">//不设置，就不会在缓存中找</span></span><br><span class="line">List&lt;Customer&gt; <span class="built_in">list</span> = query.<span class="built_in">list</span><span class="literal">()</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="built_in">list</span>);<span class="comment">//不执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.从二级缓存中找</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<ul>
<li>时间戳缓存<ul>
<li>任何操作都在时间戳中记录操作时间</li>
<li>底层select update select 对比如果第三次和第二次sql语句一就执行，反之执行<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//时间戳缓存</span></span><br><span class="line">Session session = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line">session.get<span class="constructor">Transaction()</span>.<span class="keyword">begin</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">   Customer c = session.get(<span class="module-access"><span class="module"><span class="identifier">Customer</span>.</span></span><span class="keyword">class</span>,<span class="number">1</span>);</span><br><span class="line">   <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(c);</span><br><span class="line">   <span class="comment">//c.setName("iserjhg");//报错不执行</span></span><br><span class="line">   Query query = session.create<span class="constructor">Query(<span class="string">"update Customer set name=:name where id=:id"</span>)</span>;</span><br><span class="line">   query.set<span class="constructor">Parameter(<span class="string">"name"</span>,<span class="string">"kgj"</span>)</span>;</span><br><span class="line">   query.set<span class="constructor">Parameter(<span class="string">"id"</span>,1)</span>;</span><br><span class="line">   query.execute<span class="constructor">Update()</span>;<span class="comment">//执行update语句</span></span><br><span class="line"></span><br><span class="line">session.get<span class="constructor">Transaction()</span>.commit<span class="literal">()</span>;</span><br><span class="line">session.close<span class="literal">()</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>Hibernate框架</tag>
      </tags>
  </entry>
  <entry>
    <title>jave web复习(一)</title>
    <url>/2019/11/20/jave-web%E5%A4%8D%E4%B9%A0-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="servlet相关配置"><a href="#servlet相关配置" class="headerlink" title="servlet相关配置"></a>servlet相关配置</h3><ul>
<li>web.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>java_web<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 配置servlet程序 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>TestServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!-- servlet全限定类名 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zhao.domain.TestServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- url-servlet映射 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 已定义名称 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>TestServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"> 		<span class="comment">&lt;!-- 浏览url地址 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/test<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="servlet模拟登录get请求"><a href="#servlet模拟登录get请求" class="headerlink" title="servlet模拟登录get请求"></a>servlet模拟登录get请求</h3><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">import</span> java.io.<span class="type">IOException</span>;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.<span class="type">ServletException</span>;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.annotation.<span class="type">WebServlet</span>;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.<span class="type">HttpServlet</span>;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.<span class="type">HttpServletRequest</span>;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.<span class="type">HttpServletResponse</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class GetParam</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@WebServlet</span>(<span class="string">"/GetParam"</span>)</span><br><span class="line"> public <span class="class"><span class="keyword">class</span> <span class="title">GetParam</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">       </span><br><span class="line">	<span class="keyword">protected</span> void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">		<span class="comment">//请求地址：localhost:8080/java_web/GetParam?name=lisi&amp;pwd=123456</span></span><br><span class="line">		response.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		<span class="comment">//通过参数名获取值</span></span><br><span class="line">		<span class="type">String</span> name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">		<span class="type">String</span> pwd = request.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line">		<span class="type">System</span>.out.println(<span class="string">"姓名："</span>+name+<span class="string">"密码："</span>+pwd);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"lisi"</span>.equals(name) &amp;&amp; <span class="string">"123456"</span>.equals(pwd) )&#123;</span><br><span class="line">			response.getWriter().append(<span class="string">"ok!"</span>);</span><br><span class="line">			<span class="comment">//请求转发</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"index.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="comment">//重定向</span></span><br><span class="line">			<span class="comment">//response.sendRedirect("index.jsp");</span></span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			response.getWriter().append(<span class="string">"error!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置参数到request对象中setAttribute("参数名", 参数值)</span></span><br><span class="line">		<span class="comment">//jsp页面el表达式取值$&#123;参数名&#125;</span></span><br><span class="line">	  <span class="comment">//request.setAttribute("name", name);</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> void doPost(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="servlet模拟登录post表单请求"><a href="#servlet模拟登录post表单请求" class="headerlink" title="servlet模拟登录post表单请求"></a>servlet模拟登录post表单请求</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取命令参数</span></span><br><span class="line">	String command =  request.getParameter(<span class="string">"command"</span>);</span><br><span class="line">	<span class="comment">//判断命令</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="string">"login"</span>.equals(command))&#123;</span><br><span class="line">		login(request, response);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		response.getWriter().append(<span class="string">"无效命令"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//获取表单内容，request.getParameter("表单项的name属性值");</span></span><br><span class="line">	String username = request.getParameter(<span class="string">"username"</span>); </span><br><span class="line">	String pwd  = 	request.getParameter(<span class="string">"pwd"</span>);	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//设置参数到request对象中</span></span><br><span class="line">	request.setAttribute(<span class="string">"name"</span>, username);</span><br><span class="line">	<span class="comment">//判断账号密码</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="string">"zhangsan"</span>.equals(username) &amp;&amp; <span class="string">"123456"</span>.equals(pwd))&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//转发数据到index.jsp页面</span></span><br><span class="line">		request.getRequestDispatcher(<span class="string">"index.jsp"</span>).forward(request, response);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//设置提示</span></span><br><span class="line">		request.setAttribute(<span class="string">"error"</span>, <span class="string">"error"</span>);</span><br><span class="line">		<span class="comment">//登录失败跳转到登录页面</span></span><br><span class="line">		request.getRequestDispatcher(<span class="string">"login.jsp"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	doGet(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>jsp页面<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span></span><br><span class="line"><span class="xml">   pageEncoding="UTF-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>$</span><span class="template-variable">&#123;error&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"UserController?command=login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;name&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="java-web-三层架构详解"><a href="#java-web-三层架构详解" class="headerlink" title="java web 三层架构详解"></a>java web 三层架构详解</h3></li>
</ul>
</li>
</ul>
<ol>
<li>创建实体类（javabean）<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.zhao.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">String</span> pwd;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> pwd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(<span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承父类构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">String</span> name, <span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">String</span> name, <span class="keyword">String</span> pwd)</span> </span>&#123;</span><br><span class="line">	super();</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"User [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", pwd="</span> + pwd + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建连接数据库工具类（JDBCUtil）<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhao.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="comment">//加载驱动</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">		Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Connection conn  = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		conn = DriverManager.getConnection(<span class="string">"jdbc:mysql://127.0.0.1:3306/day2"</span>,<span class="string">"root"</span>,<span class="string">"ROOT"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn,Statement stm,ResultSet rest)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(rest!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			rest.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(stm!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			stm.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(conn!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>创建持久层DAO<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> UserDao &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public User user<span class="constructor">Login(User <span class="params">u</span>)</span> &#123;</span><br><span class="line">	User user =  null;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取连接对象</span></span><br><span class="line">	Connection conn =  <span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>get<span class="constructor">Conn()</span>;</span><br><span class="line">	PreparedStatement  pstm = null;</span><br><span class="line">	ResultSet rest =  null;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//预编译sql语句</span></span><br><span class="line">	String sql  =  <span class="string">"select * from user where username =  ?  and password = ?"</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		pstm =  conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">		<span class="comment">//设置参数</span></span><br><span class="line">		pstm.set<span class="constructor">String(1, <span class="params">u</span>.<span class="params">getUsername</span>()</span>);</span><br><span class="line">		pstm.set<span class="constructor">String(2, <span class="params">u</span>.<span class="params">getPwd</span>()</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行sql,返回结果集</span></span><br><span class="line">		rest = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">		<span class="comment">//判断是否有结果返回</span></span><br><span class="line">		<span class="keyword">if</span>(rest.next<span class="literal">()</span>) &#123;</span><br><span class="line">			<span class="comment">//创建user对象，并设置查询到的属性</span></span><br><span class="line">			user =  <span class="keyword">new</span> <span class="constructor">User(<span class="params">rest</span>.<span class="params">getInt</span>(1)</span>,rest.get<span class="constructor">String(2)</span>,rest.get<span class="constructor">String(3)</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125; catch (SQLException e) &#123;</span><br><span class="line">		e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">	&#125;finally &#123;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>close(conn, pstm, rest);</span><br><span class="line">	&#125;</span><br><span class="line">	return user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建业务层service层<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">public class UserService &#123;</span><br><span class="line"></span><br><span class="line">public UserDao userDao =  new UserDao();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public<span class="built_in"> User </span>userLogin(User u) &#123;</span><br><span class="line">	return userDao.userLogin(u);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建控制层controller<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@<span class="constructor">WebServlet(<span class="string">"/UserServlet"</span>)</span></span><br><span class="line">public <span class="keyword">class</span> UserServlet extends HttpServlet &#123;</span><br><span class="line"><span class="keyword">private</span> static final long serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">public UserService userService =  <span class="keyword">new</span> <span class="constructor">UserService()</span>;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">protected void <span class="keyword">do</span><span class="constructor">Get(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span> throws ServletException, IOException &#123;</span><br><span class="line">	<span class="comment">//获取命令参数</span></span><br><span class="line">			String command =  request.get<span class="constructor">Parameter(<span class="string">"command"</span>)</span>;</span><br><span class="line">			<span class="comment">//判断命令</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"login"</span>.equals(command))&#123;</span><br><span class="line">				login(request, response);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				response.get<span class="constructor">Writer()</span>.append(<span class="string">"无效命令"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户登录</span></span><br><span class="line"><span class="keyword">private</span> void login(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">	<span class="comment">//获取表单内容，request.getParameter("表单项的name属性值");</span></span><br><span class="line">	String name = request.get<span class="constructor">Parameter(<span class="string">"name"</span>)</span>; </span><br><span class="line">	String pwd  = 	request.get<span class="constructor">Parameter(<span class="string">"pwd"</span>)</span>;	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//收集用户的登录信息</span></span><br><span class="line">	User u =  <span class="keyword">new</span> <span class="constructor">User(<span class="params">name</span>,<span class="params">pwd</span>)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//调用service层的登录方法，返回登录的结果</span></span><br><span class="line">	User  user = userService.user<span class="constructor">Login(<span class="params">u</span>)</span>;  </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//判断账号密码</span></span><br><span class="line">	<span class="keyword">if</span>(user!= null)&#123;<span class="comment">//返回user不为空，代表数据库中有对应的信息</span></span><br><span class="line">		<span class="comment">//设置参数到request对象中</span></span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">user</span>)</span>;</span><br><span class="line">		<span class="comment">//转发数据到index.jsp页面</span></span><br><span class="line">		request.get<span class="constructor">RequestDispatcher(<span class="string">"index.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//设置提示</span></span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"error"</span>, <span class="string">"账号或密码错误"</span>)</span>;</span><br><span class="line">		<span class="comment">//设置参数到request对象中</span></span><br><span class="line">		request.set<span class="constructor">Attribute(<span class="string">"user"</span>, <span class="params">u</span>)</span>;</span><br><span class="line">		<span class="comment">//登录失败跳转到登录页面</span></span><br><span class="line">		request.get<span class="constructor">RequestDispatcher(<span class="string">"login.jsp"</span>)</span>.forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">protected void <span class="keyword">do</span><span class="constructor">Post(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span> throws ServletException, IOException &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	<span class="keyword">do</span><span class="constructor">Get(<span class="params">request</span>, <span class="params">response</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>jsp页面</li>
</ul>
<ol>
<li>index.jsp<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span></span></span></span><br><span class="line"><span class="xml">   pageEncoding="utf-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">欢迎<span class="tag">&lt;<span class="name">h1</span>&gt;</span>$</span><span class="template-variable">&#123;user.username&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>login.jsp<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span></span><br><span class="line"><span class="xml">   pageEncoding="UTF-8"%&gt;</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>$</span><span class="template-variable">&#123;error&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"UserController?command=login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">	账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;name&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>Java web</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 复习(一)</title>
    <url>/2019/11/19/Java-%E5%A4%8D%E4%B9%A0-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="Jdk（java开发工具包）"><a href="#Jdk（java开发工具包）" class="headerlink" title="Jdk（java开发工具包）"></a>Jdk（java开发工具包）</h3><ul>
<li>安装目录：<ol>
<li>bin（java的可执行程序）</li>
<li>DB (内置小型数据库)</li>
<li>Jre(java运行环境)</li>
<li>Lib(java的类库)</li>
</ol>
</li>
</ul>
<h3 id="安装完成需要配置环境变量（都是目录，控制台执行时需要引用）："><a href="#安装完成需要配置环境变量（都是目录，控制台执行时需要引用）：" class="headerlink" title="安装完成需要配置环境变量（都是目录，控制台执行时需要引用）："></a>安装完成需要配置环境变量（都是目录，控制台执行时需要引用）：</h3><ol>
<li>JAVA_HOME:    C:\Program Files\Java\jdk1.8.0_162(JDK安装的主目录)        </li>
<li>Path：C:\Program Files\Java\jdk1.8.0_162\bin（可执行程序的目录，在控制台任意目录下启动）</li>
<li>CLASSPATH: C:\Program Files\Java\jdk1.8.0_162\lib;.（需要调用的类的目录）</li>
</ol>
<ul>
<li><p>可能提示的问题：<br>  找不到或无法加载主类：查看classpath变量是否配置正确</p>
</li>
<li><p>Eclipse安装：注意jdk版本和eclipse版本相同（都是32位或64位）</p>
<pre><code>常用快捷键：alt+/
代码注释：ctrl+/
删除行：ctrl+d        
代码切换行:alt+”↑/↓”
代码上下行复制:ctrl+alt+”↑/↓”    </code></pre><h3 id="jdbc连接mysql数据库"><a href="#jdbc连接mysql数据库" class="headerlink" title="jdbc连接mysql数据库"></a>jdbc连接mysql数据库</h3><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.direct.day1.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJDBC</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//jdbc链接mysql数据库</span></span><br><span class="line"><span class="comment">//1、准备链接驱动</span></span><br><span class="line"><span class="comment">//2、加载驱动</span></span><br><span class="line"><span class="comment">//3、获取数据库链接</span></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//加载驱动</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">String</span> url = <span class="string">"jdbc:mysql://localhost:3306/demo1?characterEncoding=utf-8"</span>;</span><br><span class="line"><span class="keyword">String</span> user = <span class="string">"root"</span>;</span><br><span class="line"><span class="keyword">String</span> pwd = <span class="string">"123456"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">//通过驱动管理器获取数据库链接对象，需要传入参数(链接地址，账号，密码)</span></span><br><span class="line">	Connection conn = DriverManager.getConnection(url,user, pwd);</span><br><span class="line">	System.out.<span class="built_in">println</span>(conn);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//创建sql语句执行对象</span></span><br><span class="line">	Statement stm = conn.createStatement();</span><br><span class="line">	<span class="keyword">String</span>  sql =  <span class="string">"select * from user"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//执行查询语句，返回ResultSet结果集</span></span><br><span class="line">	ResultSet rest = stm.executeQuery(sql);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取结果集中的数据,通过next()方法移动指针,如果执行所指位置没有数据，则返回false</span></span><br><span class="line">	<span class="keyword">while</span>(rest.next())&#123;</span><br><span class="line">		<span class="comment">//从结果集中获取数据的方法 getInt("字段名称/或字段的下标位置")，getString("字段名称/或字段的下标位置")</span></span><br><span class="line">		<span class="comment">//通过传递数据表的字段名称，获取int类型的数据</span></span><br><span class="line">		<span class="keyword">int</span> id  = rest.getInt(<span class="string">"id"</span>);</span><br><span class="line">		<span class="comment">//通过传递数据表的字段下标，获取String类型的数据</span></span><br><span class="line">		<span class="keyword">String</span> username =  rest.getString(<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">String</span> password =  rest.getString(<span class="string">"password"</span>);</span><br><span class="line">		System.out.<span class="built_in">println</span>(id+<span class="string">" "</span>+username+<span class="string">" "</span>+password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//释放资源</span></span><br><span class="line">	rest.<span class="built_in">close</span>();</span><br><span class="line">	stm.<span class="built_in">close</span>();</span><br><span class="line">	conn.<span class="built_in">close</span>();</span><br><span class="line">	</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模仿用户登录实现"><a href="#模仿用户登录实现" class="headerlink" title="模仿用户登录实现"></a>模仿用户登录实现</h3><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> package com.direct.day1.demo1;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"> <span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"> <span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"> <span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"> <span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"> <span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLogin</span> &#123;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//jdbc链接mysql数据库</span></span><br><span class="line">	<span class="comment">//1、准备链接驱动</span></span><br><span class="line">	<span class="comment">//2、加载驱动</span></span><br><span class="line">	<span class="comment">//3、获取数据库链接</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @param u 账号</span></span><br><span class="line"><span class="comment">	 * @param p 密码</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">login</span><span class="params">(<span class="keyword">String</span> u,<span class="keyword">String</span> p)</span></span>&#123;</span><br><span class="line">		<span class="comment">//加载驱动</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">String</span> url = <span class="string">"jdbc:mysql://localhost:3306/demo1?characterEncoding=utf-8"</span>;</span><br><span class="line">		<span class="keyword">String</span> user = <span class="string">"root"</span>;</span><br><span class="line">		<span class="keyword">String</span> pwd = <span class="string">"123456"</span>;</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//通过驱动管理器获取数据库链接对象，需要传入参数(链接地址，账号，密码)</span></span><br><span class="line">			Connection conn = DriverManager.getConnection(url,user, pwd);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//创建sql语句执行对象</span></span><br><span class="line">			Statement stm = conn.createStatement();</span><br><span class="line">			<span class="keyword">String</span>  sql =  <span class="string">"select * from user where username='"</span>+u+<span class="string">"' and password='"</span>+p+<span class="string">"';"</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//执行查询语句，返回ResultSet结果集</span></span><br><span class="line">			ResultSet rest = stm.executeQuery(sql);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">boolean</span> flag = <span class="literal">false</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获取结果集中的数据,通过next()方法移动指针,如果执行所指位置没有数据，则返回false</span></span><br><span class="line">			<span class="keyword">while</span>(rest.next())&#123;</span><br><span class="line">				<span class="comment">//从结果集中获取数据的方法 getInt("字段名称/或字段的下标位置")，getString("字段名称/或字段的下标位置")</span></span><br><span class="line">				<span class="comment">//通过传递数据表的字段名称，获取int类型的数据</span></span><br><span class="line">				<span class="keyword">int</span> id  = rest.getInt(<span class="string">"id"</span>);</span><br><span class="line">				<span class="comment">//通过传递数据表的字段下标，获取String类型的数据</span></span><br><span class="line">				<span class="keyword">String</span> username =  rest.getString(<span class="number">2</span>);</span><br><span class="line">				<span class="keyword">String</span> password =  rest.getString(<span class="string">"password"</span>);</span><br><span class="line">				System.out.<span class="built_in">println</span>(id+<span class="string">" "</span>+username+<span class="string">" "</span>+password);</span><br><span class="line">				flag = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(flag)System.out.<span class="built_in">println</span>(<span class="string">"登录成功"</span>);</span><br><span class="line">			<span class="keyword">else</span> System.out.<span class="built_in">println</span>(<span class="string">"登录失败"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			rest.<span class="built_in">close</span>();</span><br><span class="line">			stm.<span class="built_in">close</span>();</span><br><span class="line">			conn.<span class="built_in">close</span>();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Test	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//sql语句注入</span></span><br><span class="line">		login(<span class="string">"6f4asdfasdf"</span>,<span class="string">"3213' or '1'='1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="预编译执行对象详解"><a href="#预编译执行对象详解" class="headerlink" title="预编译执行对象详解"></a>预编译执行对象详解</h3> <figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> package com.direct.day1.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLogin2</span> &#123;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//jdbc链接mysql数据库</span></span><br><span class="line">	<span class="comment">//1、准备链接驱动</span></span><br><span class="line">	<span class="comment">//2、加载驱动</span></span><br><span class="line">	<span class="comment">//3、获取数据库链接</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @param u 账号</span></span><br><span class="line"><span class="comment">	 * @param p 密码</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">login</span><span class="params">(<span class="keyword">String</span> u,<span class="keyword">String</span> p)</span></span>&#123;</span><br><span class="line">		<span class="comment">//加载驱动</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">String</span> url = <span class="string">"jdbc:mysql://localhost:3306/demo1?characterEncoding=utf-8"</span>;</span><br><span class="line">		<span class="keyword">String</span> user = <span class="string">"root"</span>;</span><br><span class="line">		<span class="keyword">String</span> pwd = <span class="string">"123456"</span>;</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//通过驱动管理器获取数据库链接对象，需要传入参数(链接地址，账号，密码)</span></span><br><span class="line">			Connection conn = DriverManager.getConnection(url,user, pwd);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//“？”代表需要设置的参数</span></span><br><span class="line">			<span class="keyword">String</span>  sql =  <span class="string">"select * from user where username= ? and password= ? "</span>;</span><br><span class="line">			<span class="comment">//创建sql语句 预编译执行对象</span></span><br><span class="line">			PreparedStatement pstm = conn.prepareStatement(sql);</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			pstm.setString(<span class="number">1</span>, u);</span><br><span class="line">			pstm.setString(<span class="number">2</span>, p);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//执行查询语句，返回ResultSet结果集</span></span><br><span class="line">			ResultSet rest = pstm.executeQuery();</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">boolean</span> flag = <span class="literal">false</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获取结果集中的数据,通过next()方法移动指针,如果执行所指位置没有数据，则返回false</span></span><br><span class="line">			<span class="keyword">while</span>(rest.next())&#123;</span><br><span class="line">				<span class="comment">//从结果集中获取数据的方法 getInt("字段名称/或字段的下标位置")，getString("字段名称/或字段的下标位置")</span></span><br><span class="line">				<span class="comment">//通过传递数据表的字段名称，获取int类型的数据</span></span><br><span class="line">				<span class="keyword">int</span> id  = rest.getInt(<span class="string">"id"</span>);</span><br><span class="line">				<span class="comment">//通过传递数据表的字段下标，获取String类型的数据</span></span><br><span class="line">				<span class="keyword">String</span> username =  rest.getString(<span class="number">2</span>);</span><br><span class="line">				<span class="keyword">String</span> password =  rest.getString(<span class="string">"password"</span>);</span><br><span class="line">				System.out.<span class="built_in">println</span>(id+<span class="string">" "</span>+username+<span class="string">" "</span>+password);</span><br><span class="line">				flag = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(flag)System.out.<span class="built_in">println</span>(<span class="string">"登录成功"</span>);</span><br><span class="line">			<span class="keyword">else</span> System.out.<span class="built_in">println</span>(<span class="string">"登录失败"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			rest.<span class="built_in">close</span>();</span><br><span class="line">			pstm.<span class="built_in">close</span>();</span><br><span class="line">			conn.<span class="built_in">close</span>();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Test	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//sql语句注入</span></span><br><span class="line">		login(<span class="string">"6f4asdfasdf"</span>,<span class="string">"3213' or '1'='1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="增删改查操作"><a href="#增删改查操作" class="headerlink" title="增删改查操作"></a>增删改查操作</h3><ul>
<li>操作类<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"> package com.direct.day1.demo1;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.Statement;</span><br><span class="line"></span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> TestCRUD &#123;</span><br><span class="line">	@Test	</span><br><span class="line">	public void <span class="constructor">TestFindById()</span> &#123;</span><br><span class="line">		<span class="built_in">int</span> id = <span class="number">2</span>;</span><br><span class="line">		</span><br><span class="line">		Connection conn =  <span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>get<span class="constructor">Conn()</span>;</span><br><span class="line">		String sql = <span class="string">"select * from  user where id = ?"</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		ResultSet rest = null;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建预编译sql语句对象</span></span><br><span class="line">			 pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			pstm.set<span class="constructor">Int(1, <span class="params">id</span>)</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//执行查询sql</span></span><br><span class="line">			rest =  pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">while</span>(rest.next<span class="literal">()</span>)&#123;</span><br><span class="line">				<span class="comment">//根据字段名称获取数据</span></span><br><span class="line">				<span class="built_in">int</span> uid = rest.get<span class="constructor">Int(<span class="string">"id"</span>)</span>;</span><br><span class="line">				String username = rest.get<span class="constructor">String(<span class="string">"username"</span>)</span>;</span><br><span class="line">				String pwd =  rest.get<span class="constructor">String(3)</span>;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(uid+<span class="string">" "</span>+username+<span class="string">" "</span>+pwd);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;<span class="comment">//一定会执行的代码</span></span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>close(conn,pstm,rest);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	@Test	</span><br><span class="line">	public void <span class="constructor">TestDelById()</span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">int</span> id = <span class="number">3</span>;</span><br><span class="line">		</span><br><span class="line">		Connection conn =  <span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>get<span class="constructor">Conn()</span>;</span><br><span class="line">		String sql = <span class="string">"delete from  user where id = ?"</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建预编译sql语句对象</span></span><br><span class="line">			 pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			pstm.set<span class="constructor">Int(1, <span class="params">id</span>)</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//执行更新sql,返回受影响的行</span></span><br><span class="line">			<span class="built_in">int</span> num  =  pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(num==<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"没有数据被删除"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"删除了"</span>+num+<span class="string">"条"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;<span class="comment">//一定会执行的代码</span></span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>close(conn,pstm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	@Test	</span><br><span class="line">	public void <span class="constructor">TestSave()</span> &#123;</span><br><span class="line">		String username  = <span class="string">"wangwu"</span>;</span><br><span class="line">		String password  = <span class="string">"123456"</span>;</span><br><span class="line">		</span><br><span class="line">		Connection conn =  <span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>get<span class="constructor">Conn()</span>;</span><br><span class="line">		String sql = <span class="string">"insert into user(username,password) value(?,?)"</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建预编译sql语句对象</span></span><br><span class="line">			 pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			 pstm.set<span class="constructor">String(1, <span class="params">username</span>)</span>;</span><br><span class="line">			 pstm.set<span class="constructor">String(2, <span class="params">password</span>)</span>;</span><br><span class="line">			 </span><br><span class="line">			<span class="comment">//执行更新sql,返回受影响的行</span></span><br><span class="line">			<span class="built_in">int</span> num  =  pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(num==<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"没有数据添加"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"添加了"</span>+num+<span class="string">"条"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;<span class="comment">//一定会执行的代码</span></span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>close(conn,pstm);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	@Test	</span><br><span class="line">	public void <span class="constructor">TestUpdate()</span> &#123;</span><br><span class="line">		<span class="built_in">int</span> id = <span class="number">4</span>;</span><br><span class="line">		String username  = <span class="string">"狗蛋"</span>;</span><br><span class="line">		String password  = <span class="string">"123456"</span>;</span><br><span class="line">		</span><br><span class="line">		Connection conn =  <span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>get<span class="constructor">Conn()</span>;</span><br><span class="line">		String sql = <span class="string">"update user  set  username = ?, password = ? where id= ? "</span>;</span><br><span class="line">		PreparedStatement pstm = null;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建预编译sql语句对象</span></span><br><span class="line">			 pstm = conn.prepare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line">			<span class="comment">//设置参数</span></span><br><span class="line">			 pstm.set<span class="constructor">String(1, <span class="params">username</span>)</span>;</span><br><span class="line">			 pstm.set<span class="constructor">String(2, <span class="params">password</span>)</span>;</span><br><span class="line">			 pstm.set<span class="constructor">Int(3, <span class="params">id</span>)</span>;</span><br><span class="line">			 </span><br><span class="line">			<span class="comment">//执行更新sql,返回受影响的行</span></span><br><span class="line">			<span class="built_in">int</span> num  =  pstm.execute<span class="constructor">Update()</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(num==<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"没有数据修改"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"修改了"</span>+num+<span class="string">"条"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; catch (SQLException e) &#123;</span><br><span class="line">			e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">		&#125;finally &#123;<span class="comment">//一定会执行的代码</span></span><br><span class="line">			<span class="comment">//释放资源</span></span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">JDBCUtil</span>.</span></span>close(conn,pstm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>驱动类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> package com.direct.day1.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtil</span> &#123;</span></span><br><span class="line">	<span class="comment">//静态代码块，在类加载的时候就会执行</span></span><br><span class="line">	<span class="keyword">static</span>&#123;</span><br><span class="line">		<span class="comment">//加载驱动</span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Connection  <span class="title">getConn</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">String</span> url = <span class="string">"jdbc:mysql://localhost:3306/demo1?characterEncoding=utf-8"</span>;</span><br><span class="line">		<span class="keyword">String</span> user = <span class="string">"root"</span>;</span><br><span class="line">		<span class="keyword">String</span> pwd = <span class="string">"123456"</span>;</span><br><span class="line">		Connection conn = null;</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//通过驱动管理器获取数据库链接对象，需要传入参数(链接地址，账号，密码)</span></span><br><span class="line">			conn = DriverManager.getConnection(url,user, pwd);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		 <span class="comment">//返回链接</span></span><br><span class="line">		 <span class="keyword">return</span>  conn;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放资源的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn,PreparedStatement pstm,ResultSet rest)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(rest!=null)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				rest.<span class="built_in">close</span>();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(pstm!=null)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				pstm.<span class="built_in">close</span>();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(conn!=null)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.<span class="built_in">close</span>();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn,PreparedStatement pstm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(pstm!=null)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				pstm.<span class="built_in">close</span>();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(conn!=null)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.<span class="built_in">close</span>();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Hibernate框架(四)</title>
    <url>/2019/11/19/Hibernate%E6%A1%86%E6%9E%B6-%E5%9B%9B/</url>
    <content><![CDATA[<h3 id="HQL查询"><a href="#HQL查询" class="headerlink" title="HQL查询"></a>HQL查询</h3><ul>
<li>HQL的语法与SQL语法基本一致，不同的是HQL是指向面向对象查询的，查询的是对象和对象中的属性</li>
<li>HQL关键支部区分大小写，但类名和属性区分大小写<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">select 别名/属性名/表达式</span><br><span class="line"><span class="keyword">from</span> 实体 as 别名 </span><br><span class="line">where 过滤条件</span><br><span class="line">group by 分组条件</span><br><span class="line">having 分组后的结果的过滤条件</span><br><span class="line">orday by 排序条件</span><br></pre></td></tr></table></figure>
<ul>
<li>查询所有客户<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Lesson8 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void save<span class="literal">()</span>&#123;</span><br><span class="line"></span><br><span class="line">       Session session = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.<span class="keyword">begin</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询所有客户，查询是所有表的字段</span></span><br><span class="line">       Query query = session.create<span class="constructor">Query(<span class="string">"from Customer"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询结果会封装到一个list集合中</span></span><br><span class="line">       List&lt;Customer&gt; <span class="built_in">list</span> = query.<span class="built_in">list</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//遍历</span></span><br><span class="line">       for(Customer c : <span class="built_in">list</span>)&#123;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(c.get<span class="constructor">Name()</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.commit<span class="literal">()</span>;</span><br><span class="line">       session.close<span class="literal">()</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>选择查询<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Lesson10 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void save<span class="literal">()</span>&#123;</span><br><span class="line"></span><br><span class="line">       Session session = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.<span class="keyword">begin</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//1.带条件</span></span><br><span class="line">       <span class="comment">//Query query = session.createQuery("from Customer where id=2");</span></span><br><span class="line">       <span class="comment">//Query query = session.createQuery("from Customer where id=?");</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//2.别名</span></span><br><span class="line">       <span class="comment">//Query query = session.createQuery("from Customer c where c.id=?");</span></span><br><span class="line">       Query query = session.create<span class="constructor">Query(<span class="string">"select c from Customer c where c.id=?"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3.设置参数</span></span><br><span class="line">       query.set<span class="constructor">Integer(0,2)</span>;</span><br><span class="line">       <span class="comment">//query.setParameter(1,2);</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//4.查询结果会封装到一个list集合中</span></span><br><span class="line">       List&lt;Customer&gt; <span class="built_in">list</span> = query.<span class="built_in">list</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//遍历</span></span><br><span class="line">       for(Customer c : <span class="built_in">list</span>)&#123;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(c.get<span class="constructor">Name()</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询只获取一条数据</span></span><br><span class="line">       Customer c = (Customer)query.unique<span class="constructor">Result()</span>;</span><br><span class="line">       <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out,println(c);</span><br><span class="line"></span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.commit<span class="literal">()</span>;</span><br><span class="line">       session.close<span class="literal">()</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>投影查询(其不会把结果封装成对象，封装的是数组)<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson11 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       //查询所有客户</span><br><span class="line">       Query query = <span class="keyword">session</span>.createQuery("select c.id,c.name from Customer c ");</span><br><span class="line"></span><br><span class="line">       //查询结果会封装到一个list集合中</span><br><span class="line">       List&lt;<span class="keyword">Object</span>[]&gt; list = query.list();</span><br><span class="line"></span><br><span class="line">       //注意：封装的是数组</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">Object</span>[] obj : list)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">Object</span> c : obj)&#123;</span><br><span class="line">               <span class="keyword">System</span>.<span class="keyword">out</span>.peintln(c);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println("--------------")</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="排序-order-by-desc降序-asc升序"><a href="#排序-order-by-desc降序-asc升序" class="headerlink" title="排序 order by desc降序  asc升序"></a>排序 order by desc降序  asc升序</h3> <figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Session session = util.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有客户结果会封装到一个list集合中</span></span><br><span class="line">    List&lt;Customer&gt; <span class="built_in">list</span> = session.createQuery(<span class="string">"from Customer c order by c.id desc"</span>).<span class="built_in">list</span>();</span><br><span class="line"></span><br><span class="line">   <span class="comment">//遍历</span></span><br><span class="line">    <span class="keyword">for</span>(Customer c : <span class="built_in">list</span>)&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(c)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    session.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3> <figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Query</span> <span class="keyword">query</span> = session.createQuery(<span class="string">"from Customer"</span>);</span><br><span class="line"><span class="comment">//pageNum 当前页（之前的 pageCode）</span></span><br><span class="line"><span class="keyword">query</span>.setFirstResult(0);</span><br><span class="line"> <span class="comment">//每页显示个数，pageSize</span></span><br><span class="line"> <span class="keyword">query</span>.setMaxResults(5);</span><br></pre></td></tr></table></figure>
<h3 id="聚合函数和分组查询"><a href="#聚合函数和分组查询" class="headerlink" title="聚合函数和分组查询"></a>聚合函数和分组查询</h3> <figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line"> <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line"></span><br><span class="line">     //查询所有客户结果会封装到一个list集合中</span><br><span class="line">     Query query = <span class="keyword">session</span>.createQuery("select count（*）from Customer c ");</span><br><span class="line"></span><br><span class="line">     Long count = (Long)query.uniqueResult();</span><br><span class="line">     <span class="keyword">System</span>.<span class="keyword">out</span>.println("客户表的总记录：+count")</span><br><span class="line"></span><br><span class="line">     //HQL分组<span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">     //<span class="keyword">SQL</span>语句 <span class="keyword">select</span> o.customer_id,count(o.customer_id) <span class="keyword">from</span>  t_order o <span class="keyword">group</span> <span class="keyword">by</span> o.customer_id;</span><br><span class="line"></span><br><span class="line">     List&lt;<span class="keyword">object</span>[]&gt; list = <span class="keyword">session</span>.createQuery("select o.customer, count(o) from Order o group by o.customer").list();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">Object</span>[] obj : list))&#123;</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">object</span> o : obj)&#123;</span><br><span class="line">             <span class="keyword">System</span>.<span class="keyword">out</span>.println(o);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">System</span>.<span class="keyword">out</span>.println("----------");</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><ul>
<li><p>inner join 内连接</p>
</li>
<li><p>left outer join 左外连接</p>
</li>
<li><p>right outer join 右外连接</p>
</li>
<li><p>HQL中：<br>内连接  inner join | join </p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       //内连接【<span class="keyword">inner</span> <span class="keyword">join</span>】返回结果数组List&lt;<span class="keyword">Object</span>[]&gt;</span><br><span class="line">       //<span class="keyword">From</span> Customer <span class="keyword">inner</span> <span class="keyword">join</span> c.orders 相当于 <span class="keyword">select</span> * form t_customer tc <span class="keyword">inner</span> <span class="keyword">join</span> t_order <span class="keyword">to</span> <span class="keyword">on</span> tc.id = <span class="keyword">to</span>.customer.id</span><br><span class="line">       List&lt;<span class="keyword">Object</span>[]&gt; list = <span class="keyword">session</span>.createQuery("From Customer c inner join c.orders").list();</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">Object</span>[] obj : list)&#123;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(obj[<span class="number">0</span>]+":"+obj[<span class="number">1</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>迫切内连接  inner join feath | join fetch</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       // 迫切内连接  <span class="keyword">inner</span> <span class="keyword">join</span> feath | <span class="keyword">join</span> <span class="keyword">fetch</span> 返回数据List&lt;Customer&gt;;</span><br><span class="line">       List&lt;Customer&gt; list = <span class="keyword">session</span>.createQuery("From Customer c inner join fetch c.orders").list();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(Customer c : list)&#123;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(c.getName());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>隐式内连接【join】 </p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">  <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">      <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">      //隐式内连接 == 笛卡尔集过滤条件</span><br><span class="line">      List&lt;<span class="keyword">Object</span>[]&gt; list = <span class="keyword">session</span>.createQuery("From Customer c, Order o where c = o.customer").list();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">Object</span>[] obj : list)&#123;</span><br><span class="line">          <span class="keyword">System</span>.<span class="keyword">out</span>.println(obj[<span class="number">0</span>]+":"+obj[<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">      <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>左外连接   left outer join | left join 左表中如果没有右表的匹配数据，左表记录也会显示<br>迫切左外连接  left outer join fetch | left join fetch<br>右外连接  right outer join | outer join<br>交叉连接  ClassA ClassB</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">  <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">      <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">      //HQL交叉连接相当于 == <span class="keyword">SQL</span>笛卡尔集</span><br><span class="line">      List&lt;<span class="keyword">Object</span>[]&gt; list = <span class="keyword">session</span>.createQuery("From Customer c, Order o").list();</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">Object</span>[] obj : list)&#123;</span><br><span class="line">          <span class="keyword">System</span>.<span class="keyword">out</span>.println(obj[<span class="number">0</span>]+":"+obj[<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">      <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="命名查询"><a href="#命名查询" class="headerlink" title="命名查询"></a>命名查询</h3><ul>
<li>命名查询:hql写在映射文件,通过session的getNameQuery()来返回一个Query对象<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">  <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">      <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">      //命名查询,把hql写在映射文件中比较灵活</span><br><span class="line">      <span class="comment">/*hql写入映射文件2种方式：</span></span><br><span class="line"><span class="comment">      *1.写在类class标签里面，hql是局部的</span></span><br><span class="line"><span class="comment">      *2.写在hibernate-mapping标签里面，hql是全局的</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      * */</span></span><br><span class="line">      //String hql = "from Customer";</span><br><span class="line">      //Query query = <span class="keyword">session</span>.createQuery(hql);</span><br><span class="line">      //<span class="keyword">System</span>.<span class="keyword">out</span>.println(query.list());</span><br><span class="line"></span><br><span class="line">      //获取<span class="keyword">Class</span>里的局部hql语句(方法参数 包名+类名);</span><br><span class="line">      Query query = <span class="keyword">session</span>.getNameQuery("zhao/hibernate/domain/Customer.hql1");</span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println(query.list());</span><br><span class="line"></span><br><span class="line">      //获取hibernate-<span class="keyword">mapping</span>中全局的hql(方法参数 类名);</span><br><span class="line">      Query query = <span class="keyword">session</span>.getNameQuery("hql2");</span><br><span class="line">      query.setParames(<span class="number">0</span>,"沐沐");</span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println(query.uniqueResult());</span><br><span class="line">      <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">      <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>映射文件<!--第一种hql的位置-->
<query name="hql1">hql语句</query><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"zhao.hibernate.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"customer"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        描述一对多关系</span></span><br><span class="line"><span class="comment">       key中Colum写的是外键名称</span></span><br><span class="line"><span class="comment">       one-to-many 一对多，其class属性表示外键表实体类名--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">cascade</span>=<span class="string">"delete-orphan"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"customer_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"zhao.hibernate.domain.Order"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--第一种hql的位置--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">query</span> <span class="attr">name</span>=<span class="string">"hql1"</span>&gt;</span>from Customer<span class="tag">&lt;/<span class="name">query</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--第二种hql的位置--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">query</span> <span class="attr">name</span>=<span class="string">"hql2"</span>&gt;</span>from Customer where name=?<span class="tag">&lt;/<span class="name">query</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置C3P0"><a href="#配置C3P0" class="headerlink" title="配置C3P0"></a>配置C3P0</h3></li>
<li>找到Hibernate\hibernate-release-5.4.8.Final\project\etc\hibernate.properties文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--		配置C3P0连接池--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		#hibernate.connection.provider_class org.hibernate.connection.C3P0ConnectionProvider--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.provider_class"</span>&gt;</span>org.hibernate.connection.C3P0ConnectionProvider<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		#hibernate.c3p0.max_size 2</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.min_size 2</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.timeout 5000</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.max_statements 100</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.idle_test_period 3000</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.acquire_incre</span></span><br><span class="line"><span class="comment">           ment 2</span></span><br><span class="line"><span class="comment">		#hibernate.c3p0.validate false--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.min_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.timeout"</span>&gt;</span>5000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_statements"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.idle_test_period"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.acquire_increment"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.validate"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="悲观锁，乐观锁"><a href="#悲观锁，乐观锁" class="headerlink" title="悲观锁，乐观锁"></a>悲观锁，乐观锁</h3><ul>
<li><p>悲观锁分为两种：</p>
<ol>
<li>读锁/共享锁【比较少用】</li>
</ol>
<ul>
<li>读锁可被其他线程所共享，如果是读取的话大家都可以用这把锁读到数据。<br>select * from table lock in share mode（读锁/共享锁）<br>start transaction; 开启事务<br>commit;  提交事务</li>
</ul>
<ol start="2">
<li>写锁/排他锁【用的多】</li>
</ol>
<ul>
<li><p>写锁不能共享，只要有人为数据加入了写锁，其他人就不能为数据加入任何锁<br>select * from table for update;【锁表，不推荐使用】<br>select * from table  where id= 1 for update;【锁行，常用】   </p>
<h3 id="Hibernate添加写锁"><a href="#Hibernate添加写锁" class="headerlink" title="Hibernate添加写锁"></a>Hibernate添加写锁</h3><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">        <span class="keyword">session</span>.getTransaction.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">        //hibernate 的写锁/陪他锁实现</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 演示</span></span><br><span class="line"><span class="comment">         * A线程【命令行】，开启事务--》读取一行数据加锁</span></span><br><span class="line"><span class="comment">         * B 线程【应用程序】，开启事务--》读取一行数据加锁</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">         //方式一执行<span class="keyword">Sql</span>语句进行写锁</span><br><span class="line">         Customer customer = <span class="keyword">session</span>.<span class="keyword">get</span>(Customer.<span class="keyword">class</span>,<span class="number">1</span>,LockOptions.<span class="keyword">UPDATE</span>);//写锁</span><br><span class="line">         <span class="keyword">System</span>,<span class="keyword">out</span>.println(customer);</span><br><span class="line"></span><br><span class="line">         //方式<span class="number">2</span></span><br><span class="line">         //Query query = <span class="keyword">session</span>.createQuery("from Customer where id=?");</span><br><span class="line">         query.setLockOpties(LockOptions.<span class="keyword">UPDATE</span>);</span><br><span class="line">         query.setParamer(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">         Customer customer = (Customer)query.uniqueResult();</span><br><span class="line">         //query.executeUpdate();</span><br><span class="line">         <span class="keyword">System</span>,<span class="keyword">out</span>.println(customer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">        <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"> ```    </span><br><span class="line">* 乐观锁</span><br><span class="line"> 乐观锁就是添加一个<span class="keyword">version</span>字段来控制数据的不一致性</span><br><span class="line"> <span class="number">1.</span> 实体类</span><br></pre></td></tr></table></figure>
<p>public class Customer {</p>
<p>private Integer id;  //客户Id<br>private String name; //客户名称</p>
<p>//加个乐观锁：加个版本控制字段，字段用Integer<br>private Integer version;</p>
<p>public Integer getVersion() {<br>   return version;<br>}</p>
<p>public void setVersion(Integer version) {<br>   this.version = version;<br>}</p>
<p>//一对多属性描述，一个客户对应有多个订单<br>private Set<Order> orders = new HashSet<Order>();</p>
<p>public Integer getId() {<br>   return id;<br>}</p>
<p>public void setId(Integer id) {<br>   this.id = id;<br>}</p>
<p>public String getName() {<br>   return name;<br>}</p>
<p>public void setName(String name) {<br>   this.name = name;<br>}</p>
<p>public Set<Order> getOrders() {<br>   return orders;<br>}</p>
<p>public void setOrders(Set<Order> orders) {<br>   this.orders = orders;<br>}</p>
<p>@Override<br>public String toString() {<br>   return “Customer{“ +</p>
<pre><code>&quot;id=&quot; + id +
&quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
&apos;}&apos;;</code></pre><p>}<br>}</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">2.映射文件<span class="selector-tag">customer</span><span class="selector-class">.hbm</span><span class="selector-class">.xml</span></span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
     "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
     "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

 <class name="zhao.hibernate.domain.Customer" table="customer">
     <id name="id" column="id">
         <generator class="native"></generator>
     </id>
    <!--乐观锁 位置有dtd约束 放在 id和property和id中间-->
     <version name="version"></version>

<pre><code>&lt;property name=&quot;name&quot; column=&quot;name&quot;&gt;&lt;/property&gt;</code></pre></li>
</ul>
 <!--        描述一对多关系
        key中Colum写的是外键名称
        one-to-many 一对多，其class属性表示外键表实体类名-->
<pre><code>    &lt;set name=&quot;orders&quot; cascade=&quot;delete-orphan&quot;&gt;
        &lt;key column=&quot;customer_id&quot;&gt;&lt;/key&gt;
        &lt;one-to-many class=&quot;zhao.hibernate.domain.Order&quot;&gt;&lt;/one-to-many&gt;
    &lt;/set&gt;
&lt;/class&gt;</code></pre> </hibernate-mapping>
  <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">3.</span> 测试类</span><br></pre></td></tr></table></figure>
 /*
 *乐观锁
 * */
 public class Lesson12 {

<pre><code>@Test
public void save(){

    Session session = util.openSession();
    session.getTransaction().begin();

    //乐观锁：每次更新，版本都会加1
    /*
    * 如果当前的版本【2】比数据库【3】中的低，就不更新，报错
    * Row was uodated or deleted by another transaction;
    * 乐观锁是hibernate自己实现的
    * for update 是Mysql 实现的
    * */
    Customer customer = session.get(Customer.class,1);
    customer.setName(&quot;阿尔提尔&quot;);

    session.getTransaction().commit();
    session.close();
}</code></pre><p> }<br>  <figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">### log4j日志配置</span><br><span class="line"><span class="comment">* 配置文件内容：</span></span><br><span class="line">    1. 记录器</span><br><span class="line">    2. 输出源</span><br><span class="line">    3. 布局</span><br><span class="line"><span class="comment">* 记录器</span></span><br><span class="line"> 例如：log4j.rootLogger=info,stdout,<span class="keyword">file</span></span><br><span class="line"> 格式： log4j.rootLogger=日志级别，输出源1，输出源2，...</span><br><span class="line"> log4j 日志级别： fatal致命错误 <span class="keyword">error</span>错误 warm警告 info信息 debug调试  trace堆栈信息（由高到低顺序）</span><br><span class="line"><span class="comment"> * stdout控制台输出源</span></span><br><span class="line"><span class="comment">* 输出源</span></span><br><span class="line">   例如：log4j.appender.<span class="keyword">file</span>=org.apaphe.log4j.FileAppender</span><br><span class="line">   格式：log4j.appender.输出源的名称=输出源的实现类</span><br><span class="line">   名称：自定义</span><br><span class="line">   实现类：log4j提供</span><br><span class="line">   输出源属性例如：log4j.appender.<span class="keyword">file</span>.<span class="keyword">File</span>=<span class="keyword">d</span>:/mylong.<span class="keyword">log</span></span><br><span class="line">   输出源属性格式：log4j.appender.名称.属性=值</span><br></pre></td></tr></table></figure></p>
<h3 id="direct-log-messages-to-stdout"><a href="#direct-log-messages-to-stdout" class="headerlink" title="direct log messages to stdout"></a>direct log messages to stdout</h3><p> log4j.appender.stdout=org.apache.log4j.ConsoleAppender<br> log4j.appender.stdout.Target=System.out<br> log4j.appender.stdout.layout=org.apache.log4j.PatternLayout<br> log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %c{1}:%L - %m%n</p>
<h3 id="direct-messages-to-file-hibernate-log"><a href="#direct-messages-to-file-hibernate-log" class="headerlink" title="direct messages to file hibernate.log"></a>direct messages to file hibernate.log</h3><p> #log4j.appender.file=org.apache.log4j.FileAppender</p>
<h1 id="文件输出路径"><a href="#文件输出路径" class="headerlink" title="文件输出路径"></a>文件输出路径</h1><p> #log4j.appender.file.File=hibernate.log<br> #log4j.appender.file.layout=org.apache.log4j. PatternLayout<br> #log4j.appender.file.layout.ConversionPattern=%d  {ABSOLUTE} %5p %c{1}:%L - %m%n</p>
<h3 id="set-log-levels-for-more-verbose-logging-change-‘info’-to-‘debug’"><a href="#set-log-levels-for-more-verbose-logging-change-‘info’-to-‘debug’" class="headerlink" title="set log levels - for more verbose logging change   ‘info’ to ‘debug’"></a>set log levels - for more verbose logging change   ‘info’ to ‘debug’</h3><h3 id="log4j-rootLogger-warn-stdout"><a href="#log4j-rootLogger-warn-stdout" class="headerlink" title="log4j.rootLogger=warn, stdout"></a>log4j.rootLogger=warn, stdout</h3><h1 id="ware-：日志级别"><a href="#ware-：日志级别" class="headerlink" title="ware ：日志级别"></a>ware ：日志级别</h1>  <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">* 代码里使用日志。</span><br><span class="line"> step1:创建日志对象</span><br><span class="line"> step2：调用日志对象的方法</span><br><span class="line"></span><br><span class="line"> Logger（org.slf4j）</span><br><span class="line"> Logger logger = <span class="module-access"><span class="module"><span class="identifier">LoggerFactory</span>.</span></span>get<span class="constructor">Logger()</span></span><br></pre></td></tr></table></figure>
<p>  public class Lesson12 {<br>    //Logger（org.slf4j）<br>    Logger logger = LoggerFactory.getLogger(Lesson12.class);<br>    @Test<br>    public void save(){</p>
<pre><code>    Session session = util.openSession();
    session.getTransaction().begin();


   logger.error(&quot;error....&quot;);//错误
   ligger.ware(&quot;ware....&quot;);//警告
   logger.info(&quot;info.....&quot;);//信息 


    session.getTransaction().commit();
    session.close();
}</code></pre><p> }<br>   ```</p>
]]></content>
      <tags>
        <tag>Hibernate框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Hibernate框架(三)</title>
    <url>/2019/11/16/Hibernate%E6%A1%86%E6%9E%B6-%E4%B8%89/</url>
    <content><![CDATA[<h3 id="查询一对多和删除"><a href="#查询一对多和删除" class="headerlink" title="查询一对多和删除"></a>查询一对多和删除</h3> <figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson8 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       //查询一对多</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * 默认情况下，只有使用Customer的orders数据，会执行SQL查询</span></span><br><span class="line"><span class="comment">       * */</span></span><br><span class="line">       //查询<span class="number">2</span>的客户</span><br><span class="line">       Customer customer = <span class="keyword">session</span>.<span class="keyword">get</span>(Customer.<span class="keyword">class</span>,<span class="number">2</span>);</span><br><span class="line">       </span><br><span class="line">       //删除客户要开启事务，查询不需要</span><br><span class="line">       //<span class="keyword">session</span>.<span class="keyword">delete</span>(customer);</span><br><span class="line">       </span><br><span class="line">       //获取名字</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println("客户名字："+customer.getName());</span><br><span class="line"></span><br><span class="line">       //获取客户所有订单</span><br><span class="line">       <span class="keyword">Set</span>&lt;<span class="keyword">Order</span>&gt; orders = customer.getOrders();</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">Order</span> o : orders)&#123;</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println("购买订单名称："+o.getName());</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println("-------------");</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="cascade级联"><a href="#cascade级联" class="headerlink" title="cascade级联"></a>cascade级联</h3><ul>
<li>save-update：级联保存，级联修改，保存A（客户)时,同时保存B(订单)</li>
<li>delete ：级联删除，删除A，同时删除B<br>底层先查，后删（先删除从表，在删除主表）</li>
<li>delete-orphan：孤儿删除<br>  孤儿删除，解除关系，同时将B删除，A存在</li>
<li>如果配置多项，使用逗号隔开<set cascade="save-update,delete"><br>  all:相当于save-delete和delete整合<br>  all-delete-orphan：相当于【save-update,delete，delete-orphan】三个整合</li>
</ul>
<ol>
<li>.hbm.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 主表映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">inverse</span>=<span class="string">"true"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"custimer_id"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Order"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*一对多数据保存方式</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">public <span class="keyword">class</span> Lesson7 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void save<span class="literal">()</span>&#123;</span><br><span class="line"></span><br><span class="line">       Session session = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.<span class="keyword">begin</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//保存数据</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1.创建客户对象</span></span><br><span class="line">       Customer customer = <span class="keyword">new</span> <span class="constructor">Customer()</span>;</span><br><span class="line">       customer.set<span class="constructor">Name(<span class="string">"沐沐1"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2.创建两个订单</span></span><br><span class="line">       Order order1 = <span class="keyword">new</span> <span class="constructor">Order()</span>;</span><br><span class="line">       order1.set<span class="constructor">Name(<span class="string">"手机"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       Order order2 = <span class="keyword">new</span> <span class="constructor">Order()</span>;</span><br><span class="line">       order2.set<span class="constructor">Name(<span class="string">"衣服"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3.维护订单与客户的关系</span></span><br><span class="line">       order1.set<span class="constructor">Customer(<span class="params">customer</span>)</span>;</span><br><span class="line">       order2.set<span class="constructor">Customer(<span class="params">customer</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4.客户拥有订单</span></span><br><span class="line">       customer.get<span class="constructor">Orders()</span>.add(order1);</span><br><span class="line">       customer.get<span class="constructor">Orders()</span>.add(order2);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//5.保存</span></span><br><span class="line">       session.save(customer);<span class="comment">//保存完，客户有Id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//注意：cascade级联配置了就不需要保存从表数据</span></span><br><span class="line">       <span class="comment">//session.save(order1);</span></span><br><span class="line">       <span class="comment">//session.save(order2);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.commit<span class="literal">()</span>;</span><br><span class="line">       session.close<span class="literal">()</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>delete-orphan：孤儿删除</li>
</ul>
<ol>
<li>.hbm.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        描述一对多关系</span></span><br><span class="line"><span class="comment">       key中Colum写的是外键名称</span></span><br><span class="line"><span class="comment">       one-to-many 一对多，其class属性表示外键表实体类名--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">cascade</span>=<span class="string">"delete-orphan"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"customer_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"zhao.hibernate.domain.Order"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson9 &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">        <span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">        //查询一对多</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 级联孤儿删除 delete-orphan</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        //查询<span class="number">2</span>的客户</span><br><span class="line">        Customer customer = <span class="keyword">session</span>.<span class="keyword">get</span>(Customer.<span class="keyword">class</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        //孤儿删除（把客户里所有订单删除）</span><br><span class="line">        //将订单从Customer中的<span class="keyword">set</span>集合中删除</span><br><span class="line">        <span class="keyword">Set</span>&lt;<span class="keyword">Order</span>&gt; <span class="keyword">set</span> = customer.getOrders();</span><br><span class="line">        Iterator&lt;<span class="keyword">Order</span>&gt; iterator = <span class="keyword">set</span>.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            iterator.next();//取出下一个元素</span><br><span class="line">            iterator.remove();//移除当前元素</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">        <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Hibernate表多对多-中间表id关联"><a href="#Hibernate表多对多-中间表id关联" class="headerlink" title="Hibernate表多对多(中间表id关联)"></a>Hibernate表多对多(中间表id关联)</h3></li>
</ol>
<ul>
<li>1.创建实体类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer sid;<span class="comment">//学生Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;<span class="comment">//学生姓名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Course&gt; courses = <span class="keyword">new</span> HashSet&lt;Course&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getSid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSid</span><span class="params">(Integer sid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sid = sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Course&gt; getCourses() &#123;</span><br><span class="line">        <span class="keyword">return</span> courses;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(Set&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.courses = courses;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer cid;<span class="comment">//课程Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;<span class="comment">//课程姓名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Student&gt; students = <span class="keyword">new</span> HashSet&lt;Student&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCid</span><span class="params">(Integer cid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cid = cid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Student&gt; getStudents() &#123;</span><br><span class="line">        <span class="keyword">return</span> students;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudents</span><span class="params">(Set&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.students = students;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><p>.hbm.xml映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zhao.Dao.Student"</span> <span class="attr">table</span>=<span class="string">"t_student"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"sid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--        描述多对多关系</span></span><br><span class="line"><span class="comment">               set中table="t_Student_Course" 中间表名字</span></span><br><span class="line"><span class="comment">               key中Colum写的是当前实体类外键名称</span></span><br><span class="line"><span class="comment">               many-to-many 多对多，其class属性表示外键表实体类名--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"courses"</span> <span class="attr">table</span>=<span class="string">"t_student_course"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"sid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.zhao.Dao.Course"</span> <span class="attr">column</span>=<span class="string">"cid"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zhao.Dao.Course"</span> <span class="attr">table</span>=<span class="string">"t_course"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--        描述多对多关系</span></span><br><span class="line"><span class="comment">            set中table="t_Student_Course" 中间表名字</span></span><br><span class="line"><span class="comment">            key中Colum写的是当前实体类外键名称</span></span><br><span class="line"><span class="comment">            many-to-many 多对多，其class属性表示外键表实体类名--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"students"</span> <span class="attr">table</span>=<span class="string">"t_student_course"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.zhao.Dao.Student"</span> <span class="attr">column</span>=<span class="string">"sid"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>hibernate.cfg.xml核心配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库JDBC驱动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">		com.mysql.cj.jdbc.Driver</span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库连接URL --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">		jdbc:mysql://localhost:3306/hibernate_user?serverTimezone=Asia/Shanghai</span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库用户名 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库密码 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>zhao1314520<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 输出运行时生成的SQL语句 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--显示SQL语句--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--	是否自动提交事务	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.autocommit"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--		配置映射文件与数据库表关系</span></span><br><span class="line"><span class="comment">		update：有表则更新，无则创建</span></span><br><span class="line"><span class="comment">		create：每次启动hibernate都创建，（注意：以前数据没得了）</span></span><br><span class="line"><span class="comment">		create-drop：每次启动hibernate都创建，执行完后删除表--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 开启二级缓存 &amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 设置二级缓存插件EHCache的Provider类&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;property name="hibernate.cache.region.factory_class"&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--			org.hibernate.cache.ehcache.EhCacheRegionFactory--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;/property&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启与当前线程绑定session功能--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库方言 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">		org.hibernate.dialect.MySQL5Dialect</span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 列出所有的映射文件 --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/Dao/Student.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/Dao/Course.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试类</p>
<ul>
<li>提取工具类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">util</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory factory;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">//1.获取核心配置文件对象</span></span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">        <span class="comment">//2.创建会话工厂</span></span><br><span class="line">        factory = configuration.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//监听程序关闭</span></span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>() &#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(<span class="string">"程序关闭。。。！"</span>);</span><br><span class="line">                <span class="comment">//关闭会话工厂</span></span><br><span class="line">                factory.<span class="built_in">close</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回会话工厂获取到的session对象</span></span><br><span class="line">        <span class="keyword">return</span> factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> factory.getCurrentSession();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ul>
<li>保存数据<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> text()&#123;</span><br><span class="line"></span><br><span class="line">       //保存多对多数据</span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       //<span class="number">1.</span>创建两个学生</span><br><span class="line">       Student student =<span class="built_in">new</span> Student("赵云");</span><br><span class="line">       Student student2 =<span class="built_in">new</span> Student("洛克");</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //<span class="number">2.</span>创建<span class="number">2</span>个课程</span><br><span class="line">       Course  c1 = <span class="built_in">new</span> Course("java");</span><br><span class="line">       Course  c2 = <span class="built_in">new</span> Course("c#");</span><br><span class="line"></span><br><span class="line">       //<span class="number">3.</span>绑定课程到到学生对象</span><br><span class="line">       student.getCourses().<span class="keyword">add</span>(c1);</span><br><span class="line">       student.getCourses().<span class="keyword">add</span>(c2);</span><br><span class="line"></span><br><span class="line">       student2.getCourses().<span class="keyword">add</span>(c1);</span><br><span class="line">       student2.getCourses().<span class="keyword">add</span>(c2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //<span class="number">4.</span>保存</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * 注意：配置级联，只保存学生对象</span></span><br><span class="line"><span class="comment">       * 1.如果在student中配置inverse="true",由Course来维护外键关系，中间表没数据</span></span><br><span class="line"><span class="comment">       * 2.默认student配置inveerse="false",由Student来维护外键关系,中间表有数据</span></span><br><span class="line"><span class="comment">       * 3.多对多，inverse不能两边都为true；不管保存那个数据中间表都没数据</span></span><br><span class="line"><span class="comment">       * */</span></span><br><span class="line">       <span class="keyword">session</span>.save(student);</span><br><span class="line">       <span class="keyword">session</span>.save(student2);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加载策略"><a href="#加载策略" class="headerlink" title="加载策略"></a>加载策略</h3></li>
</ul>
<ul>
<li><p>类级别的加载策略<br>get方法即时加载数据，执行sql语句<br>load方法是懒加载数据，只有用到里面数据数据时，才执行Sql语句<br>load方法 如果只是取id，也不会执行sql语句<br>如果在.hbm.xml映射文件中的<class>lazy属性默认是懒加载’lazy=”true”‘,配置成’lazy=”false”‘这时load方法就是即时加载</p>
</li>
<li><p>关联级别</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">  <span class="built_in">public</span> <span class="type">void</span> text()&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * 关联级别的加载策略</span></span><br><span class="line"><span class="comment">      * 1.默认Student下的course也是懒加载,只有访问的时候才会执行sql语句</span></span><br><span class="line"><span class="comment">      * 2.在映射文件set中配置lazy="false",不用访问course属性，也会执行sql查询数据</span></span><br><span class="line"><span class="comment">      * */</span></span><br><span class="line">      <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line"></span><br><span class="line">      //<span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">      //查询学生</span><br><span class="line">      Student stu1 = (Student) <span class="keyword">session</span>.<span class="keyword">load</span>(Student.<span class="keyword">class</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println(stu1);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println("------------");</span><br><span class="line">      //<span class="number">1.</span> Student下的course也是懒加载,只有访问的时候才会执行<span class="keyword">sql</span>语句</span><br><span class="line">      <span class="comment">/*Set&lt;Course&gt; courses = stu1.getCourses();//sql 语句 inner join（内连接查询）</span></span><br><span class="line"><span class="comment">      System.out.println(courses);*/</span></span><br><span class="line"></span><br><span class="line">      //<span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">      <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<ul>
<li>映射文件<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">set</span> <span class="type">name</span>="courses" table="t_student_course" <span class="keyword">cascade</span>="save-update" lazy="false"&gt;</span><br><span class="line">          &lt;key column="sid"&gt;&lt;/key&gt;</span><br><span class="line">          &lt;many-<span class="keyword">to</span>-many <span class="keyword">class</span>="com.zhao.Dao.Course" column="cid"&gt;&lt;/many-<span class="keyword">to</span>-many&gt;</span><br><span class="line">      &lt;/<span class="keyword">set</span>&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Mysql语句关联查询回顾"><a href="#Mysql语句关联查询回顾" class="headerlink" title="Mysql语句关联查询回顾"></a>Mysql语句关联查询回顾</h3><ul>
<li>查询每个学生对应课程<ul>
<li>内连接chaxun<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student ts</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> t_student_course tsc</span><br><span class="line"><span class="keyword">on</span> ts.id = tsc.sid</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> course tc</span><br><span class="line"><span class="keyword">on</span> tsc.cid = tc.id</span><br><span class="line"><span class="keyword">where</span> ts.id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li>左外连接查询:左边没有匹配到右边的数据也会显示<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">from</span> student ts</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> t_student_course tsc</span><br><span class="line"><span class="keyword">on</span> ts.id = tsc.sid</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> course tc</span><br><span class="line"><span class="keyword">on</span> tsc.cid = tc.id</span><br><span class="line"><span class="keyword">where</span> ts.id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="fetch-拿取，获取数据"><a href="#fetch-拿取，获取数据" class="headerlink" title="fetch(拿取，获取数据)"></a>fetch(拿取，获取数据)</h3></li>
</ul>
<ul>
<li><p>fetch:是指查询集合的SQL方式</p>
<ol>
<li>select：默认的，普通select查询语句</li>
<li>join：表连接查询</li>
<li>subselect：使用子查询<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> text()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 在映射文件set中配置'fatch="join"'属性</span></span><br><span class="line"><span class="comment">    * fetch:是指查询集合的SQL方式</span></span><br><span class="line"><span class="comment">    * 1.select：默认的，普通select查询语句</span></span><br><span class="line"><span class="comment">    * 2. join：查询数据时，使用一条语句搞定,使用左外连接</span></span><br><span class="line"><span class="comment">    * 3. subselect：使用子查询，在条件里有select语句</span></span><br><span class="line"><span class="comment">    *              子查询只能用于多对多，一对多中</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line"></span><br><span class="line">    //<span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">    //查询</span><br><span class="line">    Student student =<span class="keyword">session</span>.<span class="keyword">load</span>(Student.<span class="keyword">class</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(student);</span><br><span class="line">    //<span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">    <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>多对一加载策略</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">   多对一加载策略：</span><br><span class="line">   lazy：有三个选项</span><br><span class="line">   <span class="literal">false</span>：【即时加载数据】</span><br><span class="line">   proxy：使用代理，根据类级别的加载策略来决定，还要依赖fetch</span><br><span class="line">   no-proxy：无代理</span><br><span class="line"></span><br><span class="line">   多种情况： </span><br><span class="line">   class:lazy   mony：lazy    mony:fetch</span><br><span class="line">   =======================================</span><br><span class="line">   <span class="literal">false</span>          <span class="built_in"> proxy </span>          join        即时加载数据，一条SQL语句</span><br><span class="line">   <span class="literal">false</span>          <span class="built_in"> proxy </span>          select      Order是及时加载，Customer是懒加载</span><br><span class="line">   <span class="literal">true</span>           <span class="built_in"> proxy </span>          join        Order是懒加载，Customer是及时加载</span><br><span class="line">   <span class="literal">true</span>           <span class="built_in"> proxy </span>          select      Order是懒加载，Customer是懒加载 </span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line">&lt;many-to-one <span class="attribute">name</span>=<span class="string">"customer"</span> <span class="attribute">class</span>=<span class="string">"Customer"</span>  <span class="attribute">column</span>=<span class="string">"customer_id"</span> <span class="attribute">lazy</span>=<span class="string">"proxy"</span> <span class="attribute">fecth</span>=<span class="string">"join"</span>/&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="批量加载"><a href="#批量加载" class="headerlink" title="批量加载"></a>批量加载</h3><ul>
<li>set标签中可以配置一个batch-size=”2”,表示每次加载两条数据</li>
<li>映射文件<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">set</span> <span class="type">name</span>="orders" <span class="keyword">cascade</span>="delete-orphan" batch-size="2"&gt;</span><br><span class="line">          &lt;key column="customer_id"&gt;&lt;/key&gt;</span><br><span class="line">          &lt;one-<span class="keyword">to</span>-many <span class="keyword">class</span>="zhao.hibernate.domain.Order"&gt;&lt;/one-<span class="keyword">to</span>-many&gt;</span><br><span class="line">      &lt;/<span class="keyword">set</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*批量加载数据</span></span><br><span class="line"><span class="comment">*set中添加属性batch-size</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lesson10</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       Session session = util.openSession();</span><br><span class="line">       <span class="comment">//session.getTransaction().begin();</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//查询所有与客户</span></span><br><span class="line">       List&lt;Customer&gt; <span class="built_in">list</span> = session.createQuery(<span class="string">"From Customer"</span>).<span class="built_in">list</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//遍历客户，查看这个客户有多少订单</span></span><br><span class="line">       <span class="keyword">for</span>(Customer customer : <span class="built_in">list</span>)&#123;</span><br><span class="line">           System.out.<span class="built_in">println</span>(<span class="string">"客户名称："</span>+customer.getName()+<span class="string">"订单数量："</span>+customer.getOrders().<span class="built_in">size</span>());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//session.getTransaction().commit();</span></span><br><span class="line">       session.<span class="built_in">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>Hibernate框架</tag>
      </tags>
  </entry>
  <entry>
    <title>hibernate异常(一)</title>
    <url>/2019/11/13/hibernate%E5%BC%82%E5%B8%B8-%E4%B8%80/</url>
    <content><![CDATA[<h4 id="异常：Error-executing-DDL"><a href="#异常：Error-executing-DDL" class="headerlink" title="异常：Error executing DDL"></a>异常：Error executing DDL</h4><ul>
<li><p>hibernate支持使用旧的方言，而在新版本中就要求使用新的方言了<br>报错：</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">hibernate.cfg.xml配置自动创建表：</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;update&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"></span><br><span class="line">会通过映射文件生成一个sql语句来创建表，</span><br><span class="line"></span><br><span class="line">如果配置了下面方言的语句：</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"hibernate.dialect"</span>&gt;org.hibernate.dialect.MySQLDialect&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"></span><br><span class="line">而且你使用的mysql是<span class="number">5.</span>x,那么会报错： type=MyISAM</span><br><span class="line"></span><br><span class="line">解决方法是：</span><br><span class="line"></span><br><span class="line">配置改成：</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"hibernate.dialect"</span>&gt;org.hibernate.dialect.MySQL5Dialect&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"></span><br><span class="line">MySQL5Dialect： An SQL dialect <span class="keyword">for</span> MySQL <span class="number">5.</span>x specific features.</span><br></pre></td></tr></table></figure></li>
<li><p>异常：Caused by: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘type=MyISAM’ at line 5<br>大概意思执行SQL语句第5行”type=MyISAM”产生异常</p>
</li>
<li><p>异常：Caused by: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘order (</p>
<pre><code>id integer not null auto_increment,</code></pre><p>‘ at line 1<br>解决方法：<br>注意：这种一般情况下是语法问题，说明mysql的各种语句还是不够熟练，<br>（1）看表名是不是使用了Mysql的关键字，如果是，请立马改掉；<br>（2）语句给出哪里错误，如我的题目中给出“near”,说明在那附近有问题，我的错误是，使用了Mysql的关键字order<br>改掉就好了。</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>hibernate异常</tag>
      </tags>
  </entry>
  <entry>
    <title>Hibernate框架(二)</title>
    <url>/2019/11/13/Hibernate%E6%A1%86%E6%9E%B6-%E4%BA%8C/</url>
    <content><![CDATA[<h3 id="实体类（entity）"><a href="#实体类（entity）" class="headerlink" title="实体类（entity）"></a>实体类（entity）</h3><ul>
<li><p>编写规则：</p>
<pre><code>1. 必须提供无参构造方法，获取数据封装模型会调用无参的构造方法
2. 提供一个表示属性，映射数据表主键字段，提供Id（映射文件）
3. 所有属性提供public访问修饰符的 set get 方法（JavaBean）
4.标识属性应尽量使用基本数据类型的包装类型（int integer  bibernate面向对象）
5.不要用final修饰实体，（将无法生成代理对象进行优化）</code></pre></li>
<li><p>持久化对象的唯一标识OID（对象的Id）</p>
<pre><code>1. Java按地址去区分同一个类的不同对象
2. 关系数据库用主键区分同一条数据
3. Hibernate使用OID来建立内存中的对象和数据库中记录的对应关系结论：对象的OID和数据库的表的主键对应。
4. 为保证OID的唯一性，应该让Hibernate来为OID赋值</code></pre></li>
<li><p>区分自然主键和代理主键</p>
<pre><code>1. 主键需要具备：不为空、不能重复、不能改变
2. 自然主键： 在业务中，某个属性符合主键的三个要求，那么该属性可以作为主键列，【登录名可以是自然主键】
3. 代理主键： 在业务中，不符合以上3个属性，那么就增加一个没有意义的列，那么就增加一个没有意义的的列，作为主键</code></pre></li>
<li><p>基本数据类型和包装数据类型</p>
<pre><code>1. 基本数据类型和包装数据类型都对应Hibernate的映射数据类型相同
2. 基本数据类型无法表示为空（null），数字类型默认为0
3. 包装数据类型默认值为空（null），但对于默认值有业务意义时需要使用包装类</code></pre></li>
<li><p>主键生成策略.hbm.xml(映射文件)</p>
<pre><code>&lt;generator calss=&quot;&quot;&gt;&lt;/generator&gt;
1. native 【经常使用】
        如果是Mysql，id会自动增长
        如果是oracle数据库，也会自动增长，与sequence相关
2. increment也会自动增长，但是其由Hibernate实现增长(表中Id的最大值)，
   执行select MAX(id)查询，会有线程并发问题
3. sequence 一般在oracle数据库才用
4. uuid 【经常使用】一个长字符串需要把实体类的id改成字符串
保存的时候自己不用设置Id，hibernate会自动生成
5. assigned 【经常使用】要手动设置Id
保存时设置：
    user.setId(UUID.rendomUUID().toString().replace(&quot;-&quot;,&quot;&quot;));</code></pre><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="built_in">id</span> <span class="built_in">name</span>=<span class="string">"id"</span> column=<span class="string">"id"</span>&gt;</span><br><span class="line">       &lt;generator <span class="built_in">class</span>=<span class="string">"native"</span>&gt;&lt;/generator&gt;</span><br><span class="line">&lt;/<span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>动态更新及插入<br>在映射文件<class name="全限定类名" table="表名" dynamic-insert="true" dynamic-update="true" />中添加属性</p>
<pre><code>dynamic-insert=&quot;true&quot; 动态插入
dynamic-update=&quot;true&quot; 动态更新</code></pre></li>
<li><p>type<br><property name="username" column="username" type="java.lang.String" length="16"></property></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--       Date 类型 在property中默认为 datetime</span></span><br><span class="line"><span class="comment">            可用属性 type="Date" 声明格式 数据库为  Date</span></span><br><span class="line"><span class="comment">            type="time" 数据库为 time --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">type</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>状态的转换过程</p>
</li>
<li><p>实体entity有三种状态：<br> 瞬时状态，持久状态，托管状态<br> 瞬时状态：Transaction，session没有缓存，数据库也没有记录<br> ，Oid没值<br> 持久状态：persist ，save有缓存，数据库也有记录，oid有值<br> 托管状态：detached，session没有缓存，数据库有记录，oid有值</p>
<ol>
<li>查询操作：get、load、createQuery、createCriteria 等 获得都是持久态</li>
<li>瞬时状态：执行save、update、saveOrUpdate之后变成持久状态</li>
<li>持久态转托管态<br>session.close();关闭<br>session.clear();清除所有<br>session.evict(object) 清除指定的po对象</li>
</ol>
</li>
</ul>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><ul>
<li>一级缓存： session级别缓存，当获得一次会话（session），bibernate在seaaion中创建多个集合（map），用于存放操作数据的PO对象，位程序优化服务，如果之前需要相应的数据，hibernate优先从session中获取，如果有就使用，如果没有就查询数据库。当session关闭时，一级缓存销毁。<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">*证明一级缓存存在</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson3 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">User</span> <span class="keyword">user</span> = (<span class="keyword">User</span>) <span class="keyword">session</span>.<span class="keyword">get</span>(<span class="keyword">User</span>.<span class="keyword">class</span>,<span class="number">5</span>);//执行<span class="keyword">select</span></span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">session</span>.clear();//清除所有缓存</span><br><span class="line">       <span class="keyword">session</span>.fulsh();//刷新</span><br><span class="line">       <span class="keyword">User</span> user1 = (<span class="keyword">User</span>) <span class="keyword">session</span>.<span class="keyword">get</span>(<span class="keyword">User</span>.<span class="keyword">class</span>,<span class="number">5</span>);//不执行selecct</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line"></span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>一级缓存的细节<ul>
<li>HQL的结果会进行一级缓存，SQL的结果不会添加到一级缓存<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson4 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //查询所有数据</span><br><span class="line">       //<span class="number">1.</span>HQL会对数据进行一级缓存</span><br><span class="line">       Query query = <span class="keyword">session</span>.createQuery("From User");</span><br><span class="line">       List&lt;<span class="keyword">User</span>&gt; list = query.list();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">User</span> <span class="keyword">user</span> = <span class="keyword">session</span>.<span class="keyword">get</span>(<span class="keyword">User</span>.<span class="keyword">class</span>,<span class="number">3</span>);</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //<span class="keyword">SQL</span>不会对数据进行一级缓存</span><br><span class="line">       SQLQuery query1 = <span class="keyword">session</span>.createSQLQuery("select * from hibernate_user");</span><br><span class="line">       List&lt;<span class="keyword">User</span>&gt; list2 = query.list();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">User</span> user2 = <span class="keyword">session</span>.<span class="keyword">get</span>(<span class="keyword">User</span>.<span class="keyword">class</span>,<span class="number">3</span>);</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(user2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //<span class="number">3.</span>Criteria会对数据进行一级缓存</span><br><span class="line">       Criteria criteria = <span class="keyword">session</span>.createCriteria(<span class="keyword">User</span>.<span class="keyword">class</span>);</span><br><span class="line">       List list1 = criteria.list();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">User</span> user3 = <span class="keyword">session</span>.<span class="keyword">get</span>(<span class="keyword">User</span>.<span class="keyword">class</span>,<span class="number">3</span>);</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(user3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       //<span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">       <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="save和persist方法区别（保存数据）"><a href="#save和persist方法区别（保存数据）" class="headerlink" title="save和persist方法区别（保存数据）"></a>save和persist方法区别（保存数据）</h3></li>
</ul>
</li>
</ul>
<ol>
<li>save方法:瞬时态 转换 持久态会初始化OID</li>
</ol>
</li>
<li>执行save方法，立即触发insert语句，从数据库获得主键值（OID值）</li>
<li>执行save方法前，设置OID将忽略</li>
<li>如果执行查询，session缓存清除了，在执行save方法，将执行insert<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"> <span class="built_in">public</span> <span class="keyword">class</span> Lesson5 &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Session</span> <span class="keyword">session</span> = util.openSession();</span><br><span class="line">        <span class="keyword">session</span>.getTransaction().<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *  1. save方法:瞬时态 转换 持久态会初始化OID</span></span><br><span class="line"><span class="comment">        * 执行save方法，立即触发insert语句，从数据库获得主键值（OID值）</span></span><br><span class="line"><span class="comment">        * 执行save方法前，设置OID将忽略</span></span><br><span class="line"><span class="comment">        * 如果执行查询，session缓存清除了，在执行save方法，将执行insert</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="keyword">User</span> <span class="keyword">user</span> =  <span class="built_in">new</span> <span class="keyword">User</span>();//瞬时态</span><br><span class="line">        <span class="keyword">user</span>.setUid(<span class="number">12</span>);</span><br><span class="line">        <span class="keyword">user</span>.setUsername("黎明");</span><br><span class="line">        <span class="keyword">user</span>.setPassword("123");</span><br><span class="line">        <span class="keyword">user</span>.setBirthday(<span class="built_in">new</span> <span class="type">Date</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">session</span>.save(<span class="keyword">user</span>);//持久态</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">session</span>.clear();//<span class="keyword">user</span>托管状态</span><br><span class="line">        <span class="keyword">session</span>.save(<span class="keyword">user</span>);</span><br><span class="line">        <span class="keyword">session</span>.getTransaction().<span class="keyword">commit</span>();</span><br><span class="line">        <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>persist方法：瞬时态 转换 持久态</li>
</ol>
<ul>
<li>persist保存的对象，再保存前，不能设置Id，否则会报错</li>
<li>save和persist都有持久化对象的作用</li>
<li>save 应为需要返回一个主键值，因此会立即执行insert语句<br>而persiet 在事务外部调用时则不会立即执行insert语句，<br>在事务内调用还是会立即执行 insert 语句</li>
</ul>
</li>
</ul>
<h3 id="表关系创建模型（一对多，多对多，一对一）"><a href="#表关系创建模型（一对多，多对多，一对一）" class="headerlink" title="表关系创建模型（一对多，多对多，一对一）"></a>表关系创建模型（一对多，多对多，一对一）</h3><ul>
<li>实体类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//主表实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id;  <span class="comment">//客户Id</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> name; <span class="comment">//客户名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//一对多属性描述，一个客户对应有多个订单</span></span><br><span class="line">   <span class="keyword">private</span> Set&lt;Order&gt; orders = <span class="keyword">new</span> HashSet&lt;Order&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> Set&lt;Order&gt; getOrders() &#123;</span><br><span class="line">       <span class="keyword">return</span> orders;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(Set&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.orders = orders;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//从表实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id; <span class="comment">//订单ID，以后工作中订单Id一般用UUID字符串类型</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">String</span> name; <span class="comment">//订单名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Customer customer;<span class="comment">//订单属性只属于某个客户</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> customer;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.customer = customer;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>映射文件 .hbm.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 主表映射文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"zhao.hibernate.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"customer"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        描述一对多关系</span></span><br><span class="line"><span class="comment">       key中Colum写的是外键名称</span></span><br><span class="line"><span class="comment">       one-to-many 一对多，其class属性表示外键表实体类名--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"customer_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"zhao.hibernate.domain.Order"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--从表映射文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"zhao.hibernate.domain.Order"</span> <span class="attr">table</span>=<span class="string">"t_order"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  描述Customer的关系</span></span><br><span class="line"><span class="comment">       many-to-many:多对一</span></span><br><span class="line"><span class="comment">       class：主键的实体类</span></span><br><span class="line"><span class="comment">       coulmn:写外键--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"zhao.hibernate.domain.Customer"</span> <span class="attr">column</span>=<span class="string">"customer_id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>核心配置文件 hibernate.cfg.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库JDBC驱动 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">			com.mysql.cj.jdbc.Driver</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库连接URL --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">			jdbc:mysql://localhost:3306/hibernate_user?serverTimezone=Asia/Shanghai</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库用户名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库密码 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>zhao1314520<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 输出运行时生成的SQL语句 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--显示SQL语句--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--	是否自动提交事务	--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.autocommit"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--		配置映射文件与数据库表关系</span></span><br><span class="line"><span class="comment">			update：有表则更新，无则创建</span></span><br><span class="line"><span class="comment">			create：每次启动hibernate都创建，（注意：以前数据没得了）</span></span><br><span class="line"><span class="comment">			create-drop：每次启动hibernate都创建，执行完后删除表--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 开启二级缓存 &amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--		&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 设置二级缓存插件EHCache的Provider类&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&lt;property name="hibernate.cache.region.factory_class"&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--			org.hibernate.cache.ehcache.EhCacheRegionFactory--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&lt;/property&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--开启与当前线程绑定session功能--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库方言 此处注意MySQL版本--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">			org.hibernate.dialect.MySQL5Dialect</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 列出所有的映射文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"zhao/hibernate/domain/hibernate.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"zhao/hibernate/domain/Customer.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"zhao/hibernate/domain/order.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*一对多数据保存方式</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">public <span class="keyword">class</span> Lesson7 &#123;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void save<span class="literal">()</span>&#123;</span><br><span class="line"></span><br><span class="line">       Session session = util.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.<span class="keyword">begin</span><span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//保存数据</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1.创建客户对象</span></span><br><span class="line">       Customer customer = <span class="keyword">new</span> <span class="constructor">Customer()</span>;</span><br><span class="line">       customer.set<span class="constructor">Name(<span class="string">"沐沐"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2.创建两个订单</span></span><br><span class="line">       Order order1 = <span class="keyword">new</span> <span class="constructor">Order()</span>;</span><br><span class="line">       order1.set<span class="constructor">Name(<span class="string">"手机"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       Order order2 = <span class="keyword">new</span> <span class="constructor">Order()</span>;</span><br><span class="line">       order2.set<span class="constructor">Name(<span class="string">"衣服"</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3.维护订单与客户的关系</span></span><br><span class="line">       order1.set<span class="constructor">Customer(<span class="params">customer</span>)</span>;</span><br><span class="line">       order2.set<span class="constructor">Customer(<span class="params">customer</span>)</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4.客户拥有订单</span></span><br><span class="line">       customer.get<span class="constructor">Orders()</span>.add(order1);</span><br><span class="line">       customer.get<span class="constructor">Orders()</span>.add(order2);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//5.保存</span></span><br><span class="line">       session.save(customer);<span class="comment">//保存完，客户有Id</span></span><br><span class="line">       session.save(order1);</span><br><span class="line">       session.save(order2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       session.get<span class="constructor">Transaction()</span>.commit<span class="literal">()</span>;</span><br><span class="line">       session.close<span class="literal">()</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="设置外键维护关系"><a href="#设置外键维护关系" class="headerlink" title="设置外键维护关系"></a>设置外键维护关系</h3></li>
<li>修改Customer的映射文件，在set中添加inverse属性</li>
<li>inverse 是hibernate 双向关系中的基本概念。inverse的真正作用是指定出有那一方面来维护之间的关联关系。<br>当一方中指定了”inverse=false(默认)”,那么哪一方就有责任负责之间的关联关系。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- inverse:反转 true 表示为另一方来维护外键关系 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"customer_Id"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"从表实体类全限定名名"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Hibernate框架</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql笔记</title>
    <url>/2019/11/06/Mysql%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="关联mysql"><a href="#关联mysql" class="headerlink" title="关联mysql"></a>关联mysql</h3><ul>
<li><p>报错：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezon’</p>
</li>
<li><p>时区错误，MySQL默认的时区是UTC时区，比北京时间晚8个小时。</p>
</li>
<li><p>所以要修改mysql的时长</p>
</li>
<li><p>方式一：在mysql的命令模式下，输入：</p>
<p>  set global time_zone=’+8:00’;</p>
<p>  再次连接成功</p>
</li>
<li><p>方式二：</p>
<p>spring.datasource.url=jdbc:mysql://localhost:3306/secondskill?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Hibernate框架（一）</title>
    <url>/2019/11/06/Hibernate%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<h3 id="Web内容回顾"><a href="#Web内容回顾" class="headerlink" title="Web内容回顾"></a>Web内容回顾</h3><ul>
<li>javaEE 三层架构</li>
</ul>
<ol>
<li>web层 ：struts2框架，SpringMVC框架</li>
<li>service层： spring框架 </li>
<li>Dao层： Hibernate框架 MyBites框架<pre><code>对数据库进行CRUD操作</code></pre></li>
</ol>
<h3 id="MVC思想"><a href="#MVC思想" class="headerlink" title="MVC思想"></a>MVC思想</h3><ol>
<li>m：模型</li>
<li>v：视图</li>
<li>c：控制器<h3 id="Hibernate概述"><a href="#Hibernate概述" class="headerlink" title="Hibernate概述"></a>Hibernate概述</h3></li>
</ol>
<ul>
<li><p>框架：半成品项目</p>
</li>
<li><p>Hibernate框架：</p>
<ol>
<li>Dao层框架2.</li>
<li>底层是对jdbc的封装</li>
<li>开源轻量级框架<br><img src="https://gss3.bdstatic.com/7Po3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=9f95e02a03f3d7ca18fb37249376d56c/d009b3de9c82d158cb08fea58f0a19d8bc3e421f.jpg" alt="bibernate"></li>
</ol>
</li>
<li><p>ORM思想</p>
<ol>
<li>hibarnate使用orm思想对数据库进行crud操作</li>
<li>在web阶段学习的JavaBean，更正确叫法实体类</li>
<li>orm：object ，relational（关系）mapping  对象关系映射<br>让实体类和数据库表进行一一对应关系<br>让数据库表里的字段 和 实体类的属性对应<br>不需要直接操作数据库表，而操作表对应实体类对象<br>案例：<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">jdbc代码</span><br><span class="line"><span class="comment">//加载驱动</span></span><br><span class="line"><span class="keyword">class</span>.forname(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"><span class="comment">//创建链接</span></span><br><span class="line">Connection conn = <span class="module-access"><span class="module"><span class="identifier">DriverManager</span>.</span></span>get<span class="constructor">Connection(<span class="params">url</span>,<span class="params">user</span>,<span class="params">password</span>)</span>;</span><br><span class="line"><span class="comment">//对Sql语句进行预编译效果</span></span><br><span class="line">String sql = <span class="string">"select * from user"</span>;</span><br><span class="line">PrepareStatement psmt = conn.perpare<span class="constructor">Statement(<span class="params">sql</span>)</span>;</span><br><span class="line"><span class="comment">//执行Sql语句</span></span><br><span class="line">ResultSet rs = pstm.execute<span class="constructor">Query()</span>;</span><br><span class="line"><span class="comment">//遍历结果集</span></span><br><span class="line">.....</span><br><span class="line"><span class="comment">//释放资源(关闭连接)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Hibarnate 实体类<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">user</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    pribvate String password;</span><br><span class="line">    <span class="comment">//set get 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在配置文件中实现表与实体类的一一对应<br>不需要操作表，而是表对应的实体类</li>
<li>hibarnate封装的对象session<br>//创建对象<br>User user = new User();<br>user.setUserName(“eratg”);<br>session.save(user);</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="Hibarnate入门"><a href="#Hibarnate入门" class="headerlink" title="Hibarnate入门"></a>Hibarnate入门</h3><ol>
<li><p>导包：<br>包的作用:<br>net.sf.hibernate.*<br>该包的类基本上都是接口类和异常类<br>net.sf.hibernate.cache.*<br>JCS的实现类<br>net.sf.hibernate.cfg.*<br>配置文件读取类<br>net.sf.hibernate.collection.*<br>Hibernate集合接口实现类，例如List，Set，Bag等等，Hibernate之所以要自行编写集合接口实现类是为了支持lazy loading<br>net.sf.hibernate.connection.*<br>几个数据库连接池的Provider<br>net.sf.hibernate.dialect.*<br>支持多种数据库特性，每个Dialect实现类代表一种数据库，描述了该数据库支持的数据类型和其它特点，例如是否有AutoIncrement，是否有Sequence，是否有分页sql等等<br>net.sf.hibernate. eg.*<br>Hibernate文档中用到的例子<br>net.sf.hibernate.engine.*<br>这个包的类作用比较散<br>net.sf.hibernate.expression.*<br>HQL支持的表达式<br>net.sf.hibernate.hq.*<br>HQL实现<br>net.sf.hibernate. id.*<br>ID生成器<br>net.sf.hibernate.impl.*<br>最核心的包，一些重要接口的实现类，如Session，SessionFactory，Query等<br>net.sf.hibernate.jca.*<br>JCA支持，把Session包装为支持JCA的接口实现类<br>net.sf.hibernate.jmx.*<br>JMX是用来编写App Server的管理程序的，大概是JMX部分接口的实现，使得App Server可以通过JMX接口管理Hibernate<br>net.sf.hibernate.loader.*<br>也是很核心的包，主要是生成sql语句。<br>net.sf.hibernate.lob.*<br>Blob和Clob支持<br>net.sf.hibernate.mapping.*<br>hbm文件的属性实现<br>net.sf.hibernate.metadata.*<br>PO的Meta实现<br>net.sf.hibernate.odmg.*<br>ODMG是一个ORM标准，这个包是ODMG标准的实现类<br>net.sf.hibernate.persister.*<br>核心包，实现持久对象和表之间的映射<br>net.sf.hibernate.proxy.*<br>Proxy和Lazy Loading支持<br>net.sf.hibernate. ps.*<br>该包是PreparedStatment Cache<br>net.sf.hibernate.sql.*<br>生成JDBC sql语句的包<br>net.sf.hibernate.test.*<br>测试类，你可以用junit来测试Hibernate<br>net.sf.hibernate.tool.hbm2ddl.*<br>用hbm配置文件生成DDL<br>net.sf.hibernate.transaction.*<br>Hibernate Transaction实现类<br>net.sf.hibernate.type.*<br>Hibernate中定义的持久对象的属性的数据类型<br>net.sf.hibernate.util.*<br>一些工具类，作用比较散<br>net.sf.hibernate.xml.*<br>XML数据绑定</p>
</li>
<li><p>创建实体类<br>使用hibarnate 时候，不需要自己手动创建表，hibarnate会创建表</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(<span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(<span class="keyword">String</span> username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(<span class="keyword">String</span> password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"uid="</span> + uid +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据库表和实体类一一对应关系(映射)</p>
<ul>
<li>创建XML格式的配置文件<br>建议：在实体类所在包中创建，实体类名.hbm.xml;<br>在配置文件中引入xml约束 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibarnate-mpping PUBLC</span></span><br><span class="line"><span class="meta">   "-//Hibernate/Hibaernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h4 id="hibernate映射的配置文件XML"><a href="#hibernate映射的配置文件XML" class="headerlink" title="hibernate映射的配置文件XML"></a>hibernate映射的配置文件XML</h4><p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1573040111707&di=3810b046e0a99ebe7445132675534d50&imgtype=0&src=http%3A%2F%2Faliyunzixunbucket.oss-cn-beijing.aliyuncs.com%2Fpng%2Fda0a0d956df111683450e7d4d1a805c7.png%3Fx-oss-process%3Dimage%2Fresize%2Cp_100%2Fauto-orient%2C1%2Fquality%2Cq_90%2Fformat%2Cjpg%2Fwatermark%2Cimage_eXVuY2VzaGk%3D%2Ct_100" alt="class,属性详解"></p>
<ul>
<li>hibernate.hbm.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibarnate-mpping PUBLC</span></span><br><span class="line"><span class="meta">       "-//Hibernate/Hibaernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibarnate-mpping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置类和表的对应</span></span><br><span class="line"><span class="comment">       name:实体类全路径</span></span><br><span class="line"><span class="comment">       table=;数据库表名称--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zhao.Dao.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        配置实体类和表中id对应</span></span><br><span class="line"><span class="comment">           hiberna要求实体类有一个属性唯一值</span></span><br><span class="line"><span class="comment">           hibernate要求表的字段作为唯一值--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        id标签 name：实体类里面id属性名称</span></span><br><span class="line"><span class="comment">                   column：生成表字段名称--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt; !<span class="attr">--</span>            设置数据库<span class="attr">id</span>增长的策略<span class="attr">--</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">           <span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name；是实体类中属性 column：是与之对应的数据库表中字段  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"adderss"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibarnate-mpping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建Hibernate的核心配置文件<br>注意：核心XML文件，其文件名和位置是固定的；<br>位置：必须src下<br>名称: 必须hibernate.cfg.xml</li>
</ul>
<ol>
<li>引入dtd约束<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>hibernate操作过程中，只会加载核心配置文件，其他配置文件不会加载</li>
</ol>
<ul>
<li>配置数据库信息</li>
<li>配置hibernate信息</li>
<li>映射文件放入核心文件</li>
</ul>
</li>
</ol>
</li>
</ul>
<ul>
<li>hibernate.cfg.xml配置文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库JDBC驱动 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">			com.mysql.cj.jdbc.Driver</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库连接URL --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">			jdbc:mysql://localhost:3306/hibernate_user</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库用户名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库密码 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>zhao1314520<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 输出运行时生成的SQL语句 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--显示SQL语句--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--是否格式化sql语句--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--	是否自动提交事务	--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.autocommit"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 开启二级缓存 &amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&amp;lt;!&amp;ndash; 设置二级缓存插件EHCache的Provider类&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&lt;property name="hibernate.cache.region.factory_class"&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--			org.hibernate.cache.ehcache.EhCacheRegionFactory--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--		&lt;/property&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 配置数据库方言 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">			org.hibernate.dialect.MySQLDialect</span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 列出所有的映射文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhao/hibernate/domain/hibernate.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="SessionFactory工厂"><a href="#SessionFactory工厂" class="headerlink" title="SessionFactory工厂"></a>SessionFactory工厂</h3><ul>
<li>sessionFactory 工厂用于管理所有的所有的session</li>
<li>获得SessionFactory方式：config.bulidSessionFactory();</li>
<li>sessionFactory线程安全：多个线程同时访问数据时，不会出现线程并发问题<h3 id="Session会话获取"><a href="#Session会话获取" class="headerlink" title="Session会话获取"></a>Session会话获取</h3></li>
<li>sessionFarctory提供两个方法获取两个方法获取session</li>
<li>factory.openSession() 获取一个全新的session</li>
<li>factory.getCurrentSession() 获取一个与当前线程绑定的session</li>
</ul>
<ul>
<li>注意：<ul>
<li>要使用getCurrentSession()必须在hibernate.cfg.hbm.xml中配置<br><property name="hibernate.current_session_context_class">thread</property><ul>
<li>hibernate支持，将创建的session绑定到本地线程池中，底层使用ThreadLocal，<br>在线程之间共享session</li>
<li>如果提交或者回滚事务，底层自动关闭事务  所以session不需要自动动关闭</li>
</ul>
</li>
</ul>
</li>
<li>测试类<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">//保存用户数据</span><br><span class="line">        //<span class="number">1.</span>获取核心配置文件，默认加载src的hiber.cfg.xml文件</span><br><span class="line">        <span class="keyword">Configuration</span> <span class="keyword">configuration</span> = <span class="built_in">new</span> <span class="keyword">Configuration</span>().configure();</span><br><span class="line">        //代码方式加载映射文件</span><br><span class="line">        //方式一</span><br><span class="line">        //<span class="keyword">configuration</span>.addResource("com/zhao/hibernate/domain/hibernate.hbm.xml");</span><br><span class="line">        //方式二</span><br><span class="line">        //<span class="keyword">configuration</span>.addClass(<span class="keyword">User</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">        //<span class="number">2.</span>创建会话工厂</span><br><span class="line">        SessionFactory factory = <span class="keyword">configuration</span>.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">        //<span class="number">3.</span>创建会话【会话相当于连接Coonnection】</span><br><span class="line">        <span class="keyword">Session</span> <span class="keyword">session</span> = factory.openSession();</span><br><span class="line"></span><br><span class="line">        //<span class="number">4.</span> 开启事务</span><br><span class="line">        <span class="keyword">Transaction</span> <span class="keyword">transaction</span> = <span class="keyword">session</span>.getTransaction();</span><br><span class="line">        <span class="keyword">transaction</span>.<span class="keyword">begin</span>();</span><br><span class="line"></span><br><span class="line">        //<span class="number">5.</span>保存【直接把对象保存到数据库】</span><br><span class="line">        <span class="keyword">User</span> <span class="keyword">user</span> = <span class="built_in">new</span> <span class="keyword">User</span>();</span><br><span class="line">        <span class="keyword">user</span>.setUsername("阿尔提尔");</span><br><span class="line">        <span class="keyword">user</span>.setPassword("123");</span><br><span class="line">        <span class="keyword">session</span>.save(<span class="keyword">user</span>);</span><br><span class="line"></span><br><span class="line">        //<span class="number">6.</span>关闭会话</span><br><span class="line">        <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">        //<span class="number">7.</span>关闭工厂，释放资源</span><br><span class="line">        factory.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加载映射文件"><a href="#加载映射文件" class="headerlink" title="加载映射文件"></a>加载映射文件</h3>  代码方式加载映射文件<ul>
<li>方式一<br>//configuration.addResource(“com/zhao/hibernate/domain/hibernate.hbm.xml”);</li>
<li>方式二<br>//configuration.addClass(User.class);</li>
<li>方式三：配置<br><mapping name="全限定名"></mapping></li>
</ul>
</li>
</ul>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><ol>
<li><p>session.save()  保存   </p>
</li>
<li><p>session.get(user.class,4)|session.load(user.class,5);通过Id查找<br> 区别：</p>
<ul>
<li>无数据时get方法显示为空，而load报错</li>
<li>get方法直接加载数据</li>
<li>load方法设计是懒加载，用到的时候才会加载数据</li>
<li>load方法返回的数据是一个代理</li>
</ul>
</li>
<li><p>delete，删除数据两种方式</p>
<ul>
<li><p>第一种方式：先获取要删除的对象，然后在调用delete方法<br>   User user =(User)session.get(User.class,5);<br>   session.delete(user);</p>
</li>
<li><p>第二种方式：创建一个user对象，设置Id，然后在调用delete方法；<br>   User user = new User();<br>   user.setId(8);<br>   session.delete(user);</p>
</li>
</ul>
</li>
</ol>
<ul>
<li>事务：<br>  开启事务：session.getTransaction().begin();<br>  提交事务：session.getTransaction().commit();</li>
</ul>
<ol start="4">
<li>update 更新数据<ul>
<li>获取数据，调用set方法，事务提交<br>User user = (User)session.get(User.class,5);<br>user.setUsername(“哒哒”);<br>session.Update(user);<br>//session.saveOrUpdate(user);判断user有没有id，有则更新数据，无则插入数据<br>注意：插入数据事物自动提交</li>
</ul>
</li>
</ol>
<h3 id="Query对象（分页查询）"><a href="#Query对象（分页查询）" class="headerlink" title="Query对象（分页查询）"></a>Query对象（分页查询）</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Lesson1 &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">Test</span></span><br><span class="line">    public void <span class="keyword">save</span>()&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存用户数据</span></span><br><span class="line">        <span class="comment">//1.获取核心配置文件，默认加载src的hiber.cfg.xml文件</span></span><br><span class="line">        Configuration configuration = new Configuration().configure();</span><br><span class="line">        <span class="comment">//代码方式加载映射文件</span></span><br><span class="line">        <span class="comment">//方式一</span></span><br><span class="line">        <span class="comment">//configuration.addResource("com/zhao/hibernate/domain/hibernate.hbm.xml");</span></span><br><span class="line">        <span class="comment">//方式二</span></span><br><span class="line">        <span class="comment">//configuration.addClass(User.class);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建会话工厂</span></span><br><span class="line">        SessionFactory factory = configuration.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话【会话相当于连接Coonnection】</span></span><br><span class="line">        Session session = factory.openSession();</span><br><span class="line">        <span class="comment">//查询对象</span></span><br><span class="line">        <span class="keyword">Query</span>&lt;User&gt;  <span class="keyword">query</span> = session.createQuery(<span class="string">"from User"</span>);</span><br><span class="line">                ;</span><br><span class="line">        <span class="comment">//分页查询limit?,?</span></span><br><span class="line">        <span class="keyword">query</span>.setFirstResult(0); <span class="comment">//起始位置</span></span><br><span class="line">        <span class="keyword">query</span>.setMaxResults(3);  <span class="comment">//查询条数</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//返回一行数据  query.uniqueResult();</span></span><br><span class="line">        <span class="comment">//返回多行数据</span></span><br><span class="line">        <span class="keyword">List</span> <span class="keyword">list</span> = <span class="keyword">query</span>.<span class="keyword">list</span>();</span><br><span class="line">        <span class="keyword">for</span> (Object  obj : <span class="keyword">list</span>)&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.关闭会话</span></span><br><span class="line">        session.<span class="keyword">close</span>();</span><br><span class="line">        <span class="comment">//7.关闭工厂，释放资源</span></span><br><span class="line">        factory.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Criteria对象"><a href="#Criteria对象" class="headerlink" title="Criteria对象"></a>Criteria对象</h3><ul>
<li>hibernate提供的纯面向对象语言，提供直接使用PO对象进行操作<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Lesson3 &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void save<span class="literal">()</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存用户数据</span></span><br><span class="line">        <span class="comment">//1.获取核心配置文件，默认加载src的hiber.cfg.xml文件</span></span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> <span class="constructor">Configuration()</span>.configure<span class="literal">()</span>;</span><br><span class="line">        <span class="comment">//代码方式加载映射文件</span></span><br><span class="line">        <span class="comment">//方式一</span></span><br><span class="line">        <span class="comment">//configuration.addResource("com/zhao/hibernate/domain/hibernate.hbm.xml");</span></span><br><span class="line">        <span class="comment">//方式二</span></span><br><span class="line">        <span class="comment">//configuration.addClass(User.class);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建会话工厂</span></span><br><span class="line">        SessionFactory factory = configuration.build<span class="constructor">SessionFactory()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话【会话相当于连接Coonnection】</span></span><br><span class="line">        Session session = factory.<span class="keyword">open</span><span class="constructor">Session()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建Criteria 查询对象</span></span><br><span class="line">        Criteria criteria = session.create<span class="constructor">Criteria(User.<span class="params">class</span>)</span>;</span><br><span class="line">        <span class="comment">//eq=</span></span><br><span class="line">        criteria.add(<span class="module-access"><span class="module"><span class="identifier">Restrictions</span>.</span></span>eq(<span class="string">"username"</span>,<span class="string">"阿尔提尔"</span>));</span><br><span class="line">        criteria.add(<span class="module-access"><span class="module"><span class="identifier">Restrictions</span>.</span></span>eq(<span class="string">"password"</span>,<span class="string">"123"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(criteria.<span class="built_in">list</span><span class="literal">()</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 【gt &gt;   ge &gt;= 】【lt &lt;   le &lt;= 】</span></span><br><span class="line">        criteria.add(<span class="module-access"><span class="module"><span class="identifier">Restrictions</span>.</span></span>gt(<span class="string">"uid"</span>,<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模糊查询</span></span><br><span class="line">        criteria.add(<span class="module-access"><span class="module"><span class="identifier">Restrictions</span>.</span></span>like(<span class="string">"username"</span>,<span class="string">"%提%"</span>));</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(criteria.<span class="built_in">list</span><span class="literal">()</span>);</span><br><span class="line">        <span class="comment">//6.关闭会话</span></span><br><span class="line">        session.close<span class="literal">()</span>;</span><br><span class="line">        <span class="comment">//7.关闭工厂，释放资源</span></span><br><span class="line">        factory.close<span class="literal">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="SQLQuery-原生sql语句"><a href="#SQLQuery-原生sql语句" class="headerlink" title="SQLQuery 原生sql语句"></a>SQLQuery 原生sql语句</h3><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Lesson4 &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> save()&#123;</span><br><span class="line"></span><br><span class="line">//保存用户数据</span><br><span class="line">        //<span class="number">1.</span>获取核心配置文件，默认加载src的hiber.cfg.xml文件</span><br><span class="line">        <span class="keyword">Configuration</span> <span class="keyword">configuration</span> = <span class="built_in">new</span> <span class="keyword">Configuration</span>().configure();</span><br><span class="line">    </span><br><span class="line">        //<span class="number">2.</span>创建会话工厂</span><br><span class="line">        SessionFactory factory = <span class="keyword">configuration</span>.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">        //<span class="number">3.</span>创建会话【会话相当于连接Coonnection】</span><br><span class="line">        <span class="keyword">Session</span> <span class="keyword">session</span> = factory.openSession();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //创建Sqlquery对象</span><br><span class="line">        SQLQuery query = <span class="keyword">session</span>.createSQLQuery("select * from user ");</span><br><span class="line">        List&lt;<span class="keyword">Object</span>[]&gt; list = query.list();</span><br><span class="line">        // 此处返回结果为集合   多维数组</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">Object</span>[] obj : list)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">Object</span> o : obj)&#123;</span><br><span class="line">                <span class="keyword">System</span>.<span class="keyword">out</span>.println(o);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println("-----------------");</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //<span class="number">6.</span>关闭会话</span><br><span class="line">        <span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">        //<span class="number">7.</span>关闭工厂，释放资源</span><br><span class="line">        factory.<span class="keyword">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="提取工具类"><a href="#提取工具类" class="headerlink" title="提取工具类"></a>提取工具类</h3><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">util</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory factory;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">//1.获取核心配置文件对象</span></span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">        <span class="comment">//2.创建会话工厂</span></span><br><span class="line">        factory = configuration.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//监听程序关闭</span></span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>() &#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(<span class="string">"程序关闭。。。！"</span>);</span><br><span class="line">                <span class="comment">//关闭会话工厂</span></span><br><span class="line">                factory.<span class="built_in">close</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回会话工厂获取到的session对象</span></span><br><span class="line">        <span class="keyword">return</span> factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> factory.getCurrentSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lesson5</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存用户数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建会话【会话相当于连接Coonnection】</span></span><br><span class="line"></span><br><span class="line">        Session session = util.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建Sqlquery对象</span></span><br><span class="line">        SQLQuery query = session.createSQLQuery(<span class="string">"select * from user "</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Object[]&gt; <span class="built_in">list</span> = query.<span class="built_in">list</span>();</span><br><span class="line">        <span class="comment">// 此处返回结果为集合   多维数组</span></span><br><span class="line">        <span class="keyword">for</span> (Object[] obj : <span class="built_in">list</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Object o : obj)&#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(o);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"-----------------"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.关闭会话</span></span><br><span class="line">        session.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Hibernate框架</tag>
      </tags>
  </entry>
  <entry>
    <title>spring框架事务管理(三)</title>
    <url>/2019/11/04/spring%E6%A1%86%E6%9E%B6%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86(%E4%B8%89)/</url>
    <content><![CDATA[<h3 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h3><ul>
<li>事务：一组业务操作，要不全部成功，要不全部失败</li>
<li>特性：ACID<br>  原子性：整体<br>  一致性：完成<br>  隔离性：并发<br>  持久性：结果</li>
<li>隔离问题：<br>  脏读：一个事务读到另一个事务没有提交的数据<br>  不可重复读：一个事务读到另一个事务已提交的数据（update）<br>  虚读（幻读）：一个事务读到另一个事务已提交的数据（insert）</li>
<li>隔离级别：<br>  read uncommitted:读未提交；存在3个问题<br>  read committed:  读已提交；解决，脏读：存在2个问题<br>  repeatable read:  可重复读；解决，脏读，不可重复读，存在一个问题<br>  serializable：    串行化；都解决，单事务。</li>
<li>MySQL事务操作</li>
</ul>
<ol>
<li>获取连接</li>
<li>开启事务 conn.setAutoCommit(false);</li>
<li>提交事务 conn.committed();</li>
<li>catch()中回滚事务 conn.roolback();</li>
</ol>
<ul>
<li>Savepoint 保存点，记录用户操作的当前位置，之后可以回滚到指定的位置</li>
</ul>
<h3 id="spring事务管理（transaction）"><a href="#spring事务管理（transaction）" class="headerlink" title="spring事务管理（transaction）"></a>spring事务管理（transaction）</h3><p>导包：spring-tx<br>三个顶级接口</p>
<ul>
<li>PlatformTransactionManager    平台事务管理器   spring要管理事务，必须使用事务管理器<br> 进行事务配置时，必须配置事务管理器</li>
<li>TransactionDefinition         事务详情（事务定义，事务属性），spring用于确定事物具体详情<br> 例如：隔离级别，是否只读（readonly），超时时间（timeout）<br> 进行事务配置时，必须配置事务详情，spring将配置项封装到给对象的实例。</li>
<li>TransactionStatus             事务状态，spring用于记录当前的事务运行状态，例如:是否有保存点，事务是否完成<br> spring底层根据状态进行相应操作</li>
</ul>
<h4 id="详解："><a href="#详解：" class="headerlink" title="详解："></a>详解：</h4><ul>
<li>PlatformTransactionManager 平台事务管理器<br>导包：spring-jdbc（jdbc开发） ，spring—orm（整合Hibernate）</li>
</ul>
<ol>
<li>常见事务管理器(及PlatformTransactionManager的实现类)<br>DatesourceTransactionManager    jdbc包下其开发时的事务管理器，采用JdbcTemplate<br>HibernateTransactionManager   Hibernate包下其开发时的事务管理器，整合hibernate<ul>
<li>api详解<br>TransactionStatus getTransaction(TransationDefinition definition),<br>事务管理器 通过’事务详情’，获得’事务状态’，从而管理事务<br>void commit(TransactionStatus status)    根据状态提交<br>void rollback(TransactionStatus status)  根据状态回滚</li>
</ul>
</li>
</ol>
<ul>
<li><p>TransactionDefinition  事务详情<br>  String getName()  配置事务详情名称，一般方法名称。例如：save add<br>  boolean isReadOnly() 是否只读(增删改 读写；查询：只读)<br>  int  getTime()  超时时间<br>  int  Isolationlevel() 隔离级别<br>  int  getPropagationBehavior()  传播行为</p>
</li>
<li><p>传播行为：在两个业务之间如何共享事务<br>7种常量<br>PROPAGATLON_REQUIRED , required 必须<br>  支持当前事务，A如果创建事务，B必须使用该事务<br>  如果A没有事务，B将创建一个新事务<br>PROPAGATLON_SUPPORTS ， supports 支持<br>  支持当前事务，A如果创建事务，B必须使用该事务<br>  如果A没有事务，B将已非事务<br>PROPAGATLON_MANDATORY ，mandatory 强制<br>  支持当前事务，A如果创建事务，B必须使用该事务<br>  如果A没有事务，B将抛出异常<br>PROPAGATLON_REQUIRES_NEW  requires_new 必须新的<br>  如果A有事务，将A事务挂提，B将创建一个新的事务<br>  如果A没有事务，B将创建一个新的事务<br>PROPAGATLON_NOT_SUPPORTED , not_supported  不支持<br>  如果A有事务，将A事务挂提，B将已非事务执行<br>  如果A没有事务，B将已非事务执行<br>PROPAGATLON_NEVER ， never  从不<br>  如果A有事务，B将抛出异常<br>  如果A没有事务，B将已非事务执行<br>PROPAGATLON_NESTED ，nested 嵌套<br>  A和B底层采用保存点机制，形成嵌套事务</p>
</li>
<li><p>TransactionStatus      事务状态</p>
<h3 id="事务案例"><a href="#事务案例" class="headerlink" title="事务案例"></a>事务案例</h3></li>
</ul>
<ol>
<li>转账1<br>导包：![图片alt](图片地址 ‘’图片title’’)<br><img src="E:/VScode-data/1.png" alt="jar"></li>
</ol>
<ul>
<li>Dao层<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> AccountDaoImpl extends JdbcDaoSupport implements AccountDao &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">out</span>(String ounter, <span class="type">Integer</span> <span class="type">money</span>) &#123;</span><br><span class="line">        getJdbcTemplate().<span class="keyword">update</span>("update account set money = money - ? where username = ?",<span class="type">money</span>,ounter);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">in</span>(String <span class="keyword">inner</span>, <span class="type">Integer</span> <span class="type">money</span>) &#123;</span><br><span class="line">        getJdbcTemplate().<span class="keyword">update</span>("update account set money = money + ? where username = ?",<span class="type">money</span>,<span class="keyword">inner</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Service层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * service层调用Dao</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * spring注入提供set方法</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transation</span><span class="params">(String ounter, String inner, Integer money)</span> </span>&#123;</span><br><span class="line">        accountDao.out(ounter,money);</span><br><span class="line">        accountDao.in(inner,money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>XML配置<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    datasource数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Dirver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/transation?serverTimezone=Asia/Shanghai"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"zhao1314520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    Dao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Dao.Impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--service层--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Service.Impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApp</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"></span><br><span class="line">        AccountServiceImpl accountService = applicationContext.getBean(<span class="string">"accountService"</span>, AccountServiceImpl<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        accountService.transation(<span class="string">"jack"</span>,<span class="string">"ross"</span> ,<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>手动管理事务（了解）</li>
</ol>
<ul>
<li>spring底层使用 TransactuinTemplate 事务模板进行操作</li>
<li>操作：<pre><code>1. service 需要获得 TransactionTemplate 事务模板
2. spring 配置模板，并注入给service
3. 模板需要注入事务管理器
4. 配置事务管理器 DateSourceTranctionManager 需要注入DataSource数据源</code></pre></li>
</ul>
<ul>
<li>修改Service<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * service层调用Dao</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * spring注入提供set方法</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 创建事务模板</span></span><br><span class="line"><span class="comment">    * spring注入</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * setter方法注入模板</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transation</span><span class="params">(<span class="keyword">final</span> String ounter, <span class="keyword">final</span> String inner, <span class="keyword">final</span> Integer money)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line">                accountDao.out(ounter,money);</span><br><span class="line">                accountDao.in(inner,money);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>修改XML配置<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    datasource数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Dirver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/transation?serverTimezone=Asia/Shanghai"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"zhao1314520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    Dao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Dao.Impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--service层--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Service.Impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 修改（添加）的是以下代码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemolate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--    创建模板--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"txmanager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--    配置事务管理器 管理需要事务，事务从Connection获得，连接从连接池DataSource获得--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txmanager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="工厂Bean-生成代理：半自动"><a href="#工厂Bean-生成代理：半自动" class="headerlink" title="工厂Bean 生成代理：半自动"></a>工厂Bean 生成代理：半自动</h3><ul>
<li>Spring提供 管理事务的代理工厂bean： TransactionProxyFactoryBean<ol>
<li>getBean() 获得代理对象</li>
<li>Spring 配置一个代理</li>
</ol>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>修改XML配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    datasource数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Dirver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/transation?serverTimezone=Asia/Shanghai"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"zhao1314520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    Dao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zhao3.Dao.Impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--service层--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zhao3.Service.Impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--    service代理对象</span></span><br><span class="line"><span class="comment">        1.proxyInterfaces接口</span></span><br><span class="line"><span class="comment">        2.target目标类</span></span><br><span class="line"><span class="comment">        3.transactionManager 事务管理器</span></span><br><span class="line"><span class="comment">        4.transactionAttributes 事务属性（事务详情）</span></span><br><span class="line"><span class="comment">        5.prop key:确定哪些方法使用当前事务配置</span></span><br><span class="line"><span class="comment">        6.&lt;prop&gt;标签体中（prop text）：配置事务详情</span></span><br><span class="line"><span class="comment">            格式：PROPAGATION,传播行为</span></span><br><span class="line"><span class="comment">             ISOLATION,隔离级别</span></span><br><span class="line"><span class="comment">             readonly,是否只读</span></span><br><span class="line"><span class="comment">             -Exception,异常回滚</span></span><br><span class="line"><span class="comment">             +Exception，异常提交</span></span><br><span class="line"><span class="comment">         eg:数字1和-1</span></span><br><span class="line"><span class="comment">         &lt;prop key="transation"&gt;PROPAGATION_REQUIRED,ISOLATION_AEFAULT&lt;/prop&gt; 数字1和-1也可默认传播行为和隔离级别</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyAccountService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterfaces"</span> <span class="attr">value</span>=<span class="string">"com.zhao3.Service.AccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"accountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"txManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionAttributes"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"transation"</span>&gt;</span>PROPAGATION_REQUIRED,ISOLATION_DEFAULT<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"> ``` </span><br><span class="line">- 测试类</span><br></pre></td></tr></table></figure>
<p>public class TestApp {</p>
<p>  @Test<br>  public void save(){</p>
<pre><code>ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;com/zhao3/applicationContext.xml&quot;);

AccountService accountService = applicationContext.getBean(&quot;proxyAccountService&quot;, AccountService.class);

accountService.transation(&quot;jack&quot;,&quot;ross&quot; ,1000);</code></pre><p>  }<br>}</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">* 注意：</span><br><span class="line">    有异常：org.springframework.beans.factory.BeanNotOfRequiredTypeException: Bean named <span class="string">'proxyAccountService'</span> is expected <span class="keyword">to</span> be of<span class="built_in"> type </span><span class="string">'com.zhao3.Service.Impl.AccountServiceImpl'</span> but was actually of<span class="built_in"> type </span><span class="string">'com.sun.proxy.$Proxy9'</span></span><br><span class="line">    解决方法：</span><br><span class="line">    AccountService accountService = applicationContext.getBean(<span class="string">"proxyAccountService"</span>, AccountService.class);</span><br><span class="line">    此处要用接口，用实现类会报上面异常</span><br><span class="line"></span><br><span class="line"><span class="comment">### AOP配置基于XML</span></span><br><span class="line">* spring XML配置aop 自动生成代理，进行事务管理</span><br><span class="line">1. 配置事务管理器</span><br><span class="line">2. 配置事务详情</span><br><span class="line">3. 配置aop</span><br><span class="line">* XML配置文件</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans&quot;" target="_blank" rel="noopener">http://www.springframework.org/schema/beans&quot;</a></p>
<pre><code>xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</code></pre></li>
</ul>
<!--    datasource数据源-->
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
    &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Dirver&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/transation?serverTimezone=Asia/Shanghai&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;zhao1314520&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre><!--    Dao-->
<pre><code>&lt;bean id=&quot;accountDao&quot; class=&quot;com.zhao3.Dao.Impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre><!--service层-->
<pre><code>&lt;bean id=&quot;accountService&quot; class=&quot;com.zhao3.Service.Impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre><!--    service代理对象
        1.proxyInterfaces接口
        2.target目标类
        3.transactionManager 事务管理器
        4.transactionAttributes 事务属性（事务详情）
        5.prop key:确定哪些方法使用当前事务配置
        6.<prop>标签体中（prop text）：配置事务详情
            格式：PROPAGATION,传播行为
             ISOLATION,隔离级别
             readonly,是否只读
             -Exception,异常回滚
             +Exception，异常提交
         eg:数字1和-1
         <prop key="transation">PROPAGATION_REQUIRED,ISOLATION_AEFAULT</prop> 数字1和-1也可默认传播行为和隔离级别
        -->
<pre><code>&lt;bean id=&quot;proxyAccountService&quot; class=&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;&gt;
    &lt;property name=&quot;proxyInterfaces&quot; value=&quot;com.zhao3.Service.AccountService&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;target&quot; ref=&quot;accountService&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;transactionManager&quot; ref=&quot;txManager&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;transactionAttributes&quot;&gt;
        &lt;props&gt;
            &lt;prop key=&quot;transation&quot;&gt;PROPAGATION_REQUIRED,ISOLATION_DEFAULT&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre><!--    事务管理器-->
<pre><code>&lt;bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre></beans>
 <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>测试类</span><br></pre></td></tr></table></figure>
public class TestApp {

<pre><code>@Test
public void save(){

    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;com/zhao3/applicationContext.xml&quot;);

    AccountService accountService = applicationContext.getBean(&quot;proxyAccountService&quot;, AccountService.class);

    accountService.transation(&quot;jack&quot;,&quot;ross&quot; ,1000);
}</code></pre><p>}<br> <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">### AOP配置基于注解</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>配置事务管理器，并将事务管理器交予spring</span><br><span class="line"><span class="bullet">* </span>在目标类或目标方法添加注解即可 @Transactional</span><br><span class="line"><span class="bullet">* </span>XML配置</span><br></pre></td></tr></table></figure><br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
"></p>
 <!--    datasource数据源-->
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
    &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Dirver&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/transation?serverTimezone=Asia/Shanghai&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;zhao1314520&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <!--    Dao-->
<pre><code>&lt;bean id=&quot;accountDao&quot; class=&quot;com.zhao4.Dao.Impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <!--service层-->
<pre><code>&lt;bean id=&quot;accountService&quot; class=&quot;com.zhao4.Service.Impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre><!--    事务管理
        1. 事务管理器
        -->
<pre><code>&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <!--将事务管理器交予Spring
    transaction-manager="transactionManager" 配置事务管理器
    proxy-target-class="false" 值为true表示底层强制使用cglib代理
    -->
<pre><code>&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;</code></pre></beans>
 <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>service层</span><br></pre></td></tr></table></figure>
 @Transactional
 public class AccountServiceImpl implements AccountService {
    /*
    * service层调用Dao
    * */
    private AccountDao accountDao;
    /*
    * spring注入提供set方法
    * */
    public void setAccountDao(AccountDao accountDao) {
        this.accountDao = accountDao;
    }

<pre><code>@Override
public void transation(String ounter, String inner, Integer money) {
    accountDao.out(ounter,money);
    accountDao.in(inner,money);
}</code></pre><p> }<br>  <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>注解事务详情配置</span><br></pre></td></tr></table></figure><br>    @Transactional(propagation = Propagation.REQUIRED,isolation = Isolation.DEFAULT )<br> <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">### 整合Junit</span><br><span class="line"><span class="number">1</span>. 导包：spring-test</span><br><span class="line"><span class="number">2</span>. 让Junit通知Spring加载配置文件 </span><br><span class="line">   加注解:</span><br><span class="line">   <span class="meta">@RunWith(SpringIunit4ClassRunner.class)</span></span><br><span class="line">   <span class="meta">@ContextConfiguration(locations=<span class="meta-string">"classpath:applicationContext.xml"</span>)</span></span><br><span class="line">   <span class="meta">@Autowried</span> <span class="comment">//与junit整合，不需要在spring Xml中配置扫描</span></span><br><span class="line"><span class="number">3</span>. 让 spring容器自动注入</span><br><span class="line">* 案例：</span><br></pre></td></tr></table></figure><br> @RunWith(SpringJUnit4ClassRunner.class)<br> @ContextConfiguration(locations = “classpath:applicationContext.xml”)<br> public class TestApp {</p>
<pre><code>@Autowired //与Junit整合，不需要Spring xml 配置扫描
private AccountService accountService;

@Test
public void save(){</code></pre><p> //        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(“com/zhao4/applicationContext.xml”);<br> //<br> //        AccountService accountService = applicationContext.getBean(“accountService”, AccountService.class);</p>
<pre><code>    accountService.transation(&quot;jack&quot;,&quot;ross&quot; ,1000);
}</code></pre><p> }<br> <figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"> <span class="comment">### 整合Web</span></span><br><span class="line"> 导入jar包：spring-web</span><br><span class="line"> <span class="number">1</span>. tomcat启动加载配置文件</span><br><span class="line">    servlet  init(ServletConfig)  <span class="tag">&lt;load-on-start&gt;</span><span class="number">2</span></span><br><span class="line">    filter    init(FilterConfig)  web.<span class="keyword">xml</span> <span class="title">注册过滤器自动调用初始化</span></span><br><span class="line"><span class="title">    listener</span>(监听器)  ServletContextListener  ServletContext对象的监听【Spring】</span><br><span class="line">    Spring 提供监听器 ContextLoaderListener   web.<span class="keyword">xml</span>  <span class="title">&lt;listener</span>&gt;<span class="tag">&lt;listener-class&gt;</span>....  </span><br><span class="line">        如果只配置监听器，默认加载xml位置，WEB<span class="literal">-INF</span>/applicationContext.xml</span><br><span class="line"> <span class="number">2</span>. 确定配置文件，通过系统初始化参数</span><br><span class="line">    servletContext 初始化参数 web.<span class="keyword">xml</span> <span class="title"></span></span><br><span class="line"><span class="title">    &lt;context-param</span>&gt;</span><br><span class="line">        <span class="tag">&lt;param-name&gt;</span>contextConfigLocation</span><br><span class="line">        <span class="tag">&lt;param-value&gt;</span>classpath:applicationContext.xml</span><br><span class="line">* web.xml</span><br></pre></td></tr></table></figure><br> <?xml version="1.0" encoding="UTF-8"?><br> <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0"></p>
 <!--    确定配置文件的位置-->
<pre><code>&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre> <!--    配置Spring的监听器 用来加载Xml配置-->
<pre><code>&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;</code></pre> </web-app>
  ```
* 从ServletContext作用域 获得spring容器（了解）
]]></content>
  </entry>
  <entry>
    <title>Sprig框架AOP(二)</title>
    <url>/2019/11/04/Sprig%E6%A1%86%E6%9E%B6AOP(%E4%BA%8C)/</url>
    <content><![CDATA[<h3 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a>AOP术语</h3><ol>
<li>traget :目标类，需要被代理的类 eg：UserService</li>
<li>Jionpoint(连接点) ：指那些可能被拦截的方法 eg：所有方法</li>
<li>pointCut：切入点，已经被增强的连接点 eg：addUser（）</li>
<li>advice：通知增强，增强的代码 eg：after（）</li>
<li>Weaving（织入）:是指把增强的advice应用到目标对象，target来创建新的对象proxy的过程</li>
<li>proxy：代理</li>
<li>Aspect（切面）： 是切入点和通知advice的结合</li>
</ol>
<h3 id="手动方式："><a href="#手动方式：" class="headerlink" title="手动方式："></a>手动方式：</h3><ul>
<li>JDK动态代理 对“装饰者”设计模式简化，使用前提，必须有接口</li>
</ul>
<ol>
<li>目标类：接口 + 实现类</li>
<li>切面类：用于存通知 myAspect</li>
<li>工厂类：编写工厂生成代理</li>
<li>测试</li>
</ol>
<ul>
<li>目标类<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>切面类<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Myaspect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">before</span>()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("前方法");</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">after</span>()&#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("后方法");</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>工厂类<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">UserService <span class="title">createService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//匿名内部类必须加final</span></span><br><span class="line">        <span class="comment">//目标类</span></span><br><span class="line">        <span class="keyword">final</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">//切面类</span></span><br><span class="line">        <span class="keyword">final</span> Myaspect myaspect = <span class="keyword">new</span> Myaspect();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *生成代理类</span></span><br><span class="line"><span class="comment">        *将目标类（切入点）和切面类（通知）结合 --》切面</span></span><br><span class="line"><span class="comment">        *  Proxy.newProxyInstance()</span></span><br><span class="line"><span class="comment">        * 参数1：loader 类加载器 动态代理类，运行时加载，任何类都需要类加载器将其加载到内存</span></span><br><span class="line"><span class="comment">        *       一般情况：当前类.class.getClassLoader();</span></span><br><span class="line"><span class="comment">        *          目标类实例.getClass().getClassloader();</span></span><br><span class="line"><span class="comment">        *  参数2：Class&lt;?&gt;(Class类型的数组)interfaces 代理类需要实现的所有接口</span></span><br><span class="line"><span class="comment">        *       方式一：目标实例.getClass().getInterfaces(); 注意：只能获得自己接口，不能获得父元素的接口；</span></span><br><span class="line"><span class="comment">        *       方式二：new Class[]&#123;userService.class&#125;;</span></span><br><span class="line"><span class="comment">        *       例如：jdbc 驱动 DriverManager  获得接口Connection</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * 参数3：InvocationHandler  处理类，接口，必须进行实现类，一般采用匿名内部类</span></span><br><span class="line"><span class="comment">        *       提供invoke方法，代理类的每一个方法执行时，都将调用一次invoke</span></span><br><span class="line"><span class="comment">        *           参数1：Object proxy 代理对象</span></span><br><span class="line"><span class="comment">        *           参数2：method method  代理对象当前执行方法的描述方法（反射）</span></span><br><span class="line"><span class="comment">        *                   执行方法名：method.getName();</span></span><br><span class="line"><span class="comment">        *                   执行方法：method.invoke(对象实际参数);</span></span><br><span class="line"><span class="comment">        *           参数3：Object【】 args：方法的实际参数</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        UserService proxService = (UserService) Proxy.newProxyInstance(MyBeanFactory<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>(), <span class="title">userService</span>.<span class="title">getClass</span>().<span class="title">getInterfaces</span>(), <span class="title">new</span> <span class="title">InvocationHandler</span>() </span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function">Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//前方法</span></span><br><span class="line">                myaspect.<span class="keyword">before</span>();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//执行目标类方法</span></span><br><span class="line">                Object obj = method.invoke(userService,args);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//后方法</span></span><br><span class="line"></span><br><span class="line">                myaspect.<span class="keyword">after</span>();</span><br><span class="line">                <span class="keyword">return</span> obj;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> proxService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJDK</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UserService userService = MyBeanFactory.createService();</span><br><span class="line">        userService.addUser();</span><br><span class="line">        userService.deleteUser();</span><br><span class="line">        userService.updateUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="cglib字节码增强"><a href="#cglib字节码增强" class="headerlink" title="cglib字节码增强"></a>cglib字节码增强</h3><ul>
<li>没有接口，只有实现类</li>
<li>采用字节码增强框架 cglib 运行原理：在运行时创建目标类的子类，从而对目标类进行增强</li>
<li>导jar包<br>自己导jar包【了解】<br>核心：hibernate lib\bytecord\cglib….jar<br>依赖：struts2 lib\asm…jar<br>spring 的core.jar中已经整合了以上两个内容</li>
</ul>
</li>
</ul>
<ol>
<li><p>目标类</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"添加"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"更新"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"删除"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>切面类</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Myaspect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">before</span>()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("前方法");</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">after</span>()&#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("后方法");</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>工厂类</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">UserServiceImpl <span class="title">createService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//目标类</span></span><br><span class="line">        <span class="keyword">final</span> UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">//切面类</span></span><br><span class="line">        <span class="keyword">final</span> Myaspect myaspect = <span class="keyword">new</span> Myaspect();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *3.生成代理类 采用cglib,底层创建目标类的子类</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//3.1 核心类</span></span><br><span class="line">        Enhancer enhancer =<span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">//3.2确定父类</span></span><br><span class="line">        enhancer.setSuperclass(userService.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *3.3设置回调函数 MethodInterceptor等效jdk InvoCationHandler接口</span></span><br><span class="line"><span class="comment">        * intercept() 等效于JDK invoke()</span></span><br><span class="line"><span class="comment">        *       参数1：参数2：参数3：与invoke一样的</span></span><br><span class="line"><span class="comment">        *       参数4：methodProxy 方法的代理</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function">Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//前方法</span></span><br><span class="line">                myaspect.<span class="keyword">before</span>();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//执行目标类方法</span></span><br><span class="line">               Object o1 = method.invoke(userService,objects);</span><br><span class="line">               <span class="comment">//上下效果等同  执行代理类的父类，执行目标类(目标类和代理类 父子关系);</span></span><br><span class="line">               methodProxy.invokeSuper(o,objects);</span><br><span class="line"></span><br><span class="line">               <span class="comment">//后方法</span></span><br><span class="line">                myaspect.<span class="keyword">after</span>();</span><br><span class="line">                <span class="keyword">return</span> o1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.4 创建代理</span></span><br><span class="line">        UserServiceImpl proxService = (UserServiceImpl) enhancer.create();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> proxService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCglib</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UserServiceImpl userService = MyBeanFactory.createService();</span><br><span class="line">        userService.addUser();</span><br><span class="line">        userService.deleteUser();</span><br><span class="line">        userService.updateUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="spring编写代理：半自动"><a href="#spring编写代理：半自动" class="headerlink" title="spring编写代理：半自动"></a>spring编写代理：半自动</h3></li>
</ol>
<h3 id="Spring基于XML配置（切点表达式）"><a href="#Spring基于XML配置（切点表达式）" class="headerlink" title="Spring基于XML配置（切点表达式）"></a>Spring基于XML配置（切点表达式）</h3><ul>
<li>导包AOP联盟<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li>业务类或目标类<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="title">implements</span> <span class="title">IAccountService</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 账户业务层实现类</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"保存"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"更新"</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteAcount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"删除"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>2.切面类或通知类 </p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 用于记录日志的工具类。提供公共代码</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">logger</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于打印日志，计划在其切入点方法执行之前执行（切入点方法就是目标方法及业务层方法）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Logger类中前置行方法执行记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>XML配置文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    配置Spring IOC--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    Spring基于XML的AOP配置步骤</span></span><br><span class="line"><span class="comment">        1.把通知的Bean特交给该Spring管理</span></span><br><span class="line"><span class="comment">        2.使用aop:config标签表明开始配置AOP</span></span><br><span class="line"><span class="comment">        3.使用aop：aspect表明配置切面</span></span><br><span class="line"><span class="comment">                 属性 id：表示给切面提供唯一标识</span></span><br><span class="line"><span class="comment">                        ref：表示指定通知类bean的Id</span></span><br><span class="line"><span class="comment">        4. 在aop；aspect标签中使用对引的标签来配置通知的类型</span></span><br><span class="line"><span class="comment">            aop:before 表示前置通知</span></span><br><span class="line"><span class="comment">                    属性：method用于指定logger类中那个方法是前置通知</span></span><br><span class="line"><span class="comment">            aop：after 表示后置通知</span></span><br><span class="line"><span class="comment">            pointcut属性：用于指定切入点的表达式，该表达式的含义指的是对业务层中那些方法的增强</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           切入点表达式写法：</span></span><br><span class="line"><span class="comment">                关键字;execution(表达式)</span></span><br><span class="line"><span class="comment">                表达式：</span></span><br><span class="line"><span class="comment">                        访问修饰符 返回值 包名。包名。包名...类名.方法名(参数列表)</span></span><br><span class="line"><span class="comment">            表达式标准写法：</span></span><br><span class="line"><span class="comment">                public void com.zhao.service.AccountServiceImpl.saveAccount();</span></span><br><span class="line"><span class="comment">                访问修饰符可以省略</span></span><br><span class="line"><span class="comment">                void com.zhao.Service.impl.AccountServiceImpl.saveAccount()</span></span><br><span class="line"><span class="comment">                返回值可以使用通配符，表示任意通配符</span></span><br><span class="line"><span class="comment">                * com.zhao.Service.impl.AccountServiceImpl.saveAccount()</span></span><br><span class="line"><span class="comment">                包名可以使用通配符，，表示任意包，但几级包，就要写几个*.</span></span><br><span class="line"><span class="comment">                * *.*.*.*.AccountServiceImpl.saveAccount()</span></span><br><span class="line"><span class="comment">                包名可以使用..表示当前包及其子包</span></span><br><span class="line"><span class="comment">                * *..AccountServiceImpl.saveAccount()</span></span><br><span class="line"><span class="comment">                类名和方法名可以用*实现通配</span></span><br><span class="line"><span class="comment">                * *..*.*()</span></span><br><span class="line"><span class="comment">                参数列表；</span></span><br><span class="line"><span class="comment">                    可以直接写参数类型：</span></span><br><span class="line"><span class="comment">                            基本类型：直接写名称  int</span></span><br><span class="line"><span class="comment">                            引用类型：写包名.类名的方式  eg：Java.lang.String</span></span><br><span class="line"><span class="comment">                            可以使用通配符表示任意参数，但必须有参数</span></span><br><span class="line"><span class="comment">                            可以表示..表示有无参数均可，有参数可以是任意类型</span></span><br><span class="line"><span class="comment">                全通配写法：</span></span><br><span class="line"><span class="comment">                * *..*.*(..)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                实际开发中切入点表达式的通常写法：</span></span><br><span class="line"><span class="comment">                       * com.zhao.Service.Impl.*.*(..)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logger"</span> <span class="attr">class</span>=<span class="string">"com.zhao.Service.utils.logger"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    配置AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--        配置切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"logAdvice"</span> <span class="attr">ref</span>=<span class="string">"logger"</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--            配置通知类型，并且建立通知方法和切入点方法的关联--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--            &lt;aop:before method="printLog" pointcut="execution( public void com.zhao.Service.impl.AccountServiceImpl.saveAccount())"&gt;&lt;/aop:before&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"printLog"</span> <span class="attr">pointcut</span>=<span class="string">"execution( * *..*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line">  ``` </span><br><span class="line">4. 测试类</span><br></pre></td></tr></table></figure>
/**<ul>
<li>测试Aop配置</li>
<li>*/</li>
</ul>
</li>
</ol>
<p>public class test {<br>    //快捷键psvm<br>    public static void main(String[] args) {<br>        //获得容器<br>        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(“beans.xml”);<br>        //获取对象<br>        IAccountService iAccountService = (IAccountService)applicationContext.getBean(“accountService”);</p>
<pre><code>    //执行方法
    iAccountService.saveAccount();
    iAccountService.updateAccount(1);
    iAccountService.deleteAcount();
}</code></pre><p>}</p>
 <figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"> ### 四种常用通知类型</span><br><span class="line"></span><br><span class="line">1. 目标类</span><br></pre></td></tr></table></figure>
<p>public class AccountServiceImpl implements IAccountService {</p>
<pre><code>/*
* 账户业务层实现类
* */
public void saveAccount() {
    System.out.println(&quot;保存&quot;);
}

public void updateAccount(int i) {
    System.out.println(&quot;更新&quot;+i);
}

public int deleteAcount() {
    System.out.println(&quot;删除&quot;);
    return 0;
}</code></pre><p>}</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span> XML配置</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p><beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd"></p>
 <!--    配置Spring IOC-->
<pre><code>&lt;bean id=&quot;accountService&quot; class=&quot;Service.impl.AccountServiceImpl&quot;&gt;&lt;/bean&gt;


&lt;bean id=&quot;logger&quot; class=&quot;Service.utils.logger&quot;&gt;&lt;/bean&gt;</code></pre> <!--    配置AOP-->
<pre><code>&lt;aop:config&gt;</code></pre> <!--        配置切面-->
 <!--        非局部的id="p1"唯一标识符 expression=""用于指定切入点表达式内容 位置必须在aop:aspect上面-->
<pre><code>&lt;aop:pointcut id=&quot;p1&quot; expression=&quot;execution( * *..*.*(..))&quot;/&gt;
&lt;aop:aspect id=&quot;logAdvice&quot; ref=&quot;logger&quot;&gt;</code></pre> <!--            配置通知类型，并且建立通知方法和切入点方法的关联-->
 <!--            <aop:before method="printLog" pointcut="execution( public void com.zhao.Service.impl.AccountServiceImpl.saveAccount())"></aop:before>-->
 <!--            前置通知-->
<pre><code>&lt;aop:before method=&quot;beforeLog&quot; pointcut-ref=&quot;p1&quot;&gt;&lt;/aop:before&gt;</code></pre> <!--           后置通知 -->
<pre><code>&lt;aop:after-returning method=&quot;agterLog&quot; pointcut=&quot;execution( * *..*.*(..))&quot;&gt;&lt;/aop:after-returning&gt;</code></pre> <!--        异常通知-->
<pre><code>&lt;aop:after-throwing method=&quot;executeAdvice&quot; pointcut=&quot;execution( * *..*.*(..))&quot;&gt;&lt;/aop:after-throwing&gt;</code></pre> <!--         最终通知-->
<pre><code>&lt;aop:after method=&quot;findalyAdvice&quot; pointcut=&quot;execution( * *..*.*(..))&quot;&gt;&lt;/aop:after&gt;</code></pre> <!--            局部的-->
 <!--            <aop:pointcut id="p1" expression="execution( * *..*.*(..))"/>-->

<pre><code>    &lt;/aop:aspect&gt;

&lt;/aop:config&gt;</code></pre></beans>
 <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### Spring环绕通知</span><br><span class="line"><span class="number">1.</span> XML文件</span><br></pre></td></tr></table></figure>
 <?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd">

 <!--    配置Spring IOC-->
<pre><code>&lt;bean id=&quot;accountService&quot; class=&quot;Service.impl.AccountServiceImpl&quot;&gt;&lt;/bean&gt;


&lt;bean id=&quot;logger&quot; class=&quot;Service.utils.logger&quot;&gt;&lt;/bean&gt;</code></pre> <!--    配置AOP-->
<pre><code>&lt;aop:config&gt;</code></pre> <!--        配置切面-->
 <!--        非局部的 id="p1"唯一标识符 expression=""用于指定切入点表达式内容 位置必须在aop:aspect上面-->
<pre><code>&lt;aop:pointcut id=&quot;p1&quot; expression=&quot;execution( * *..*.*(..))&quot;/&gt;
&lt;aop:aspect id=&quot;logAdvice&quot; ref=&quot;logger&quot;&gt;</code></pre> <!--            配置环绕通知-->
<pre><code>        &lt;aop:around method=&quot;aroundLog&quot; pointcut-ref=&quot;p1&quot;&gt;&lt;/aop:around&gt;

    &lt;/aop:aspect&gt;

&lt;/aop:config&gt;</code></pre></beans>
  <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span> 切面类或通知类</span><br></pre></td></tr></table></figure>
/*
* 用于记录日志的工具类。提供公共代码
* */

<p>import org.aspectj.lang.ProceedingJoinPoint;</p>
<p>public class logger {</p>
<pre><code>//用于打印日志，计划在其切入点方法执行之前执行（切入点方法就是目标方法及业务层方法）

/*
* 环绕通知：
*   当我们配置环绕通知之后，切入点方法没有执行，而通知方法执行了
* 分析：
*       通过对比动态代理中的的环绕通知代码，发现动态代理的环绕通知有明确的切入点方法调用，而我们的代码中没得；
* 解决：
*       Spring框架为我们提供一个接口，ProceedingJoinPoint。此接口有一个方法proceed(),
*       此方法相当予明确调用切入点方法。
*       该接口可以作为环绕通知的方法参数，在程序执行时，spring框架为我们提供该接口的实现类供我们使用
*
* Spring中的环绕通知
*       他是Spring框架为我们提供的一种可以在代码中控制增强方法的何时执行的方式；
* */
public Object aroundLog(ProceedingJoinPoint pjp){
    Object rtVslue = null;
    try{

        Object[] args = pjp.getArgs();//获得执行方法的所需的参数

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志....前置&quot; );

        rtVslue = pjp.proceed(args);//明确调用业务层方法（切入点方法）

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志。。。后置&quot;);

        return rtVslue;
    }catch (Throwable t){
        System.out.println(&quot;Logger类中环绕通知方法执行记录日志。。。异常&quot;);
        throw new RuntimeException(t);
    }finally {

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志 。。。最终通知&quot;);
    }

}</code></pre><p>}</p>
 <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 注解AOP</span><br><span class="line"><span class="number">1.</span> Xml配置</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p><beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd"></p>
 <!--    配置Spring创建容器时要扫描的包-->
<pre><code>&lt;context:component-scan base-package=&quot;com.zhao.Aware.Service&quot;&gt;&lt;/context:component-scan&gt;</code></pre> <!--配置spring开启注解的功能-->
<pre><code>&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</code></pre></beans>
 <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span> 切面类</span><br></pre></td></tr></table></figure>
 @Component("logger")
@Aspect //表示当前类是一个切面类|通知类
public class logger {

<pre><code>@Pointcut(&quot;execution(* com.zhao.Aware.Service.*.*(..))&quot;)</code></pre><p>   private void p(){}</p>
<pre><code>//用于打印日志，计划在其切入点方法执行之前执行（切入点方法就是目标方法及业务层方法）
//前置执行方法
@Before(&quot;p()&quot;)
public void beforeLog(){
    System.out.println(&quot;Logger类中前置行方法执行记录日志&quot;);
}

//后置执行方法
@AfterReturning(&quot;p()&quot;)
public void agterLog(){
    System.out.println(&quot;Logger类中后置行方法执行记录日志&quot;);
}


//提成通知
@AfterThrowing(&quot;p()&quot;)
public void executeAdvice(){
    System.out.println(&quot;Logger类中异常方法执行记录日志&quot;);
}

//最终通知
@After(&quot;p()&quot;)
public void findalyAdvice(){
    System.out.println(&quot;Logger类中最终通知方法执行记录日志&quot;);
}
//环绕通知
//@Around(&quot;p()&quot;)
public Object aroundLog(ProceedingJoinPoint pjp) {
    Object rtVslue = null;
    try {

        Object[] args = pjp.getArgs();//获得执行方法的所需的参数

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志....前置&quot;);

        rtVslue = pjp.proceed(args);//明确调用业务层方法（切入点方法）

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志。。。后置&quot;);

        return rtVslue;
    } catch (Throwable t) {
        System.out.println(&quot;Logger类中环绕通知方法执行记录日志。。。异常&quot;);
        throw new RuntimeException(t);
    } finally {

        System.out.println(&quot;Logger类中环绕通知方法执行记录日志 。。。最终通知&quot;);
    }
}</code></pre><p>}</p>
 <figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="number">3</span>. 目标类<span class="string">|业务类</span></span><br></pre></td></tr></table></figure>
<p>@Service(“accountService”)<br>public class AccountServiceImpl implements IAccountService {</p>
<pre><code>/*
* 账户业务层实现类
* */

public void saveAccount() {
    System.out.println(&quot;保存&quot;);
}

public void updateAccount(int i) {
    System.out.println(&quot;更新&quot;+i);
}

public int deleteAcount() {
    System.out.println(&quot;删除&quot;);
    return 0;
}</code></pre><p>}</p>
  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">  ### JdbcTemplate模板</span><br><span class="line"><span class="bullet">  * </span>spring提供一种操作JDBC的工具类，类似DBUtils；</span><br><span class="line"><span class="bullet">  * </span>依赖 连接池DataSouce（数据源）</span><br><span class="line"><span class="bullet">  * </span></span><br><span class="line"></span><br><span class="line"><span class="bullet">  1. </span>使用API（了解）</span><br><span class="line"><span class="bullet">  * </span>原生dbcp</span><br><span class="line"><span class="bullet">- </span>目标类</span><br></pre></td></tr></table></figure>

<p>public class user {</p>
<pre><code>private int id;
private String name;
private float money;

public int getId() {
    return id;
}

public void setId(int id) {
    this.id = id;
}

public String getName() {
    return name;
}

public void setName(String name) {
    this.name = name;
}

public float getMoney() {
    return money;
}

public void setMoney(float money) {
    this.money = money;
}</code></pre><p>}</p>
   <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">测试类</span><br></pre></td></tr></table></figure>
<p>  public class TestApi {</p>
<pre><code>//jdbc模板
public static void main(String[] args) {

    //1.创建数据源dbcp
    BasicDataSource  dataSource = new BasicDataSource();

    //基本4项
    dataSource.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);
    dataSource.setUrl(&quot;jdbc:mysql://localhost:3306/eesy?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&quot;);
    dataSource.setUsername(&quot;root&quot;);
    dataSource.setPassword(&quot;zhao1314520&quot;);



    //2.创建模板
    JdbcTemplate jdbcTemplate = new JdbcTemplate();
    jdbcTemplate.setDataSource(dataSource);

    //3.通过api操作
    String sql = &quot;insert into account(name,money) values(?,?)&quot;;
    jdbcTemplate.update(&quot;sql&quot;,&quot;mmm&quot;,&quot;998&quot;);

}</code></pre><p>}<br>   <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>XML配置dbcp</span><br><span class="line"><span class="bullet">1. </span>模板注入</span><br></pre></td></tr></table></figure><br>  public class accountDao {</p>
<p>//jdbc的模板将由spring注入</p>
<pre><code>private JdbcTemplate jdbcTemplate;

public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
    this.jdbcTemplate = jdbcTemplate;
}


public void updata(user account){

    String sql= &quot;update account set name=?,money=? where id=?&quot;;
    Object[] objects = {account.getName(),account.getMoney(),account.getId()};
    jdbcTemplate.update(sql,objects);
}</code></pre><p>}</p>
   <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">beans</span><span class="selector-class">.xml</span></span><br></pre></td></tr></table></figure>
  <!--    配置DAO-->
<pre><code>&lt;bean id=&quot;account&quot; class=&quot;com.zhao.dbcp.accountDao&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre> <!--    创建模板,诸如数据源-->
<pre><code>&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <!--    创建数据源-->
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost.3306/eesy?serverTimezone=Asia/Shanghai&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;password&quot; value=&quot;zhao1314520&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre>   <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">3.</span> 测试</span><br></pre></td></tr></table></figure>
<p>   public class TestDbcp {</p>
<pre><code>@Test
public void save(){
    user account = new user();
    account.setId(1);
    account.setName(&quot;沐沐&quot;);
    account.setMoney(100000);
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);
    accountDao ac = (accountDao) applicationContext.getBean(&quot;account&quot;);

    ac.updata(account);
}</code></pre> <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>C3P0数据源</span><br><span class="line">XML配置文件</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p><beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"></p>
 <!--    配置DAO-->
<pre><code>&lt;bean id=&quot;account&quot; class=&quot;com.zhao.C3P0.accountDao&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre> <!--    创建模板,诸如数据源-->
<pre><code>&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <!--    创建数据源-->
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
    &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?serverTimezone=Asia/Shanghai&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;password&quot; value=&quot;zhao1314520&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre></beans>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">测试类</span><br></pre></td></tr></table></figure>
 public class TestC3p0 {

<pre><code>@Test
public void save(){
    user account = new user();
    account.setId(1);
    account.setName(&quot;沐沐&quot;);
    account.setMoney(100000);
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;com/zhao/C3P0/beans.xml&quot;);
    IaccountDao ac = (IaccountDao) applicationContext.getBean(&quot;account&quot;);

    ac.updata(account);

}</code></pre><p>}<br>  <figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">* <span class="keyword">properties</span>.<span class="keyword">properties</span>文件</span><br></pre></td></tr></table></figure><br>jdbc.DriverClassName=com.mysql.cj.jdbc.Driver<br>jdbc.Url=jdbc:mysql://localhost:3306/eesy?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai<br>jdbc.Username=root<br>jdbc.Password=zhao1314520<br> <figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">XML配置</span><br><span class="line">注意：</span><br><span class="line"><span class="number">1</span>. 命名空间xmlns:<span class="keyword">context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line"><span class="number">2</span>. 加载配文件classpath:</span><br><span class="line"> &lt;<span class="keyword">context</span>:<span class="keyword">property</span>-placeholder location=<span class="string">"classpath:com/zhao/properties/properties.properties"</span>&gt;&lt;/<span class="keyword">context</span>:<span class="keyword">property</span>-placeholder&gt;</span><br></pre></td></tr></table></figure><br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"></p>
 <!--    加载properties配置文件-->
<pre><code>&lt;context:property-placeholder location=&quot;classpath:com/zhao/properties/properties.properties&quot;&gt;&lt;/context:property-placeholder&gt;</code></pre> <!--    配置DAO-->
<pre><code>&lt;bean id=&quot;account&quot; class=&quot;com.zhao.dbcp.accountDao&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre> <!--    创建模板,诸如数据源-->
<pre><code>&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre><!--    创建数据源-->
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&gt;

    &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClassName}&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;

    &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;

&lt;/bean&gt;</code></pre></beans>
 <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">### JdbcTemplate模板详解(Spring数据源)</span><br><span class="line">* maven配置</span><br></pre></td></tr></table></figure>
 <packaging>jar</packaging>

<pre><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.0.2.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
        &lt;version&gt;5.0.2.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
        &lt;version&gt;5.0.2.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;8.0.18&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre> <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">#### <span class="number">1.</span> 原生spring内部数据源</span><br></pre></td></tr></table></figure>
<p>public class JdbcTemplatedomo1 {</p>
<pre><code>public static void main(String[] args) {
    //3.准备数据源，spring内部数据源
    DriverManagerDataSource ds = new DriverManagerDataSource();
    ds.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver &quot;);
    ds.setUrl(&quot;jdbc:mysql://localhost:3306/eesy?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&quot;);
    ds.setUsername(&quot;root&quot;);
    ds.setPassword(&quot;zhao1314520&quot;);

    //1.创建对象jdbcTemplate
    JdbcTemplate jdbcTemplate = new JdbcTemplate();
    //4.给jdbcTemplate设置数据源
    jdbcTemplate.setDataSource(ds);
    //2.执行操作
    jdbcTemplate.execute(&quot;insert into account(name,money)values(&apos;mmm&apos;,10000)&quot;);

}</code></pre><p>}</p>
 <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"> * 注意：MySQL8<span class="number">.0</span><span class="number">.18</span>版本中连接数据库</span><br><span class="line">    ds.setDriverClassName(<span class="string">"com.mysql.cj.jdbc.Driver "</span>);</span><br><span class="line">    ds.setUrl(<span class="string">"jdbc:mysql://localhost:3306/eesy?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####<span class="number">2.</span> 基于XML配置JdbcTemplate</span><br><span class="line">* xml配置文件</span><br></pre></td></tr></table></figure>
 <!--    配置JdbcTemplate模板-->
<pre><code>&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
&lt;!--配置Spring数据源--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?serverTimezone=Asia/Shanghai&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;zhao1314520&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;</code></pre> <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>测试类</span><br></pre></td></tr></table></figure>

<p>public class JdbcTemplatedomo2 {</p>
<pre><code>public static void main(String[] args) {
 //1.获取容器
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
    //2.获取对象
     JdbcTemplate jdbcTemplate = (JdbcTemplate) applicationContext.getBean(&quot;jdbcTemplate&quot;);
     //3.执行操作
    jdbcTemplate.execute(&quot;insert into account (name,money)values(&apos;zhao&apos;,10000)&quot;);

}</code></pre><p>}<br>  <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">#### <span class="number">3.</span> JdbcTemplate的CRUD操作</span><br><span class="line">* 注意：Spring提供的封装工具,new BeanPropertyRowMapper&lt;Account&gt;(Account.<span class="keyword">class</span>)</span><br><span class="line">自定义<span class="symbol">AccountRowmapper</span>封装工具，实现接口 <span class="symbol">RowMapper</span>&lt;<span class="symbol">Account</span>&gt;</span><br></pre></td></tr></table></figure><br>//JdbcTemplate的CRUD操作<br>public class JdbcTemplatedomo3 {</p>
<pre><code>public static void main(String[] args) {
 //1.获取容器
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
     JdbcTemplate jdbcTemplate = (JdbcTemplate) applicationContext.getBean(&quot;jdbcTemplate&quot;);
     //执行操作
    //保存
    //jdbcTemplate.update(&quot;insert into account (name,money)values(?,?)&quot;,&quot;艾尔提尔&quot;,10000f);
    //更新
    //jdbcTemplate.update(&quot;update account set name=?,money=? where id=?&quot;,&quot;阿尔提尔&quot;,8888f,5);
    //删除
   jdbcTemplate.update(&quot;delete from account where id=?&quot;,8);
    //查询所有
    //自定义
   // List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where money=?&quot;,new AccountRowmapper(),10000f);
    //spring提供,new BeanPropertyRowMapper&lt;Account&gt;(Account.class)
 List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where money=?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),10000f);
    for(Account account : accounts){
        System.out.println(account);

    }
    //查询一个
    List&lt;Account&gt; accounts1 = jdbcTemplate.query(&quot;select * from account where id=?&quot;,new AccountRowmapper(),1);
    System.out.println(accounts1.isEmpty()?&quot;没有内容&quot;:accounts1.get(0));
    //查询一行一列（使用聚合函数，但不加ground子句）
    Long count1 = jdbcTemplate.queryForObject(&quot;select count(*) from account where money&gt;?&quot;,Long.class,1000f);
    System.out.println(count1);

}</code></pre><p>}<br> /*</p>
<ul>
<li><p>自定义Account的封装工具类</p>
</li>
<li><p>*/<br>class AccountRowmapper implements RowMapper<Account>{</p>
<p>public Account mapRow(ResultSet resultSet, int i) throws SQLException {</p>
<pre><code>/*
* 把结果集中的数据封装到Account中，然后由Spring把每个Account加到集合中
* */
Account  account =new Account();
account.setId(resultSet.getInt(&quot;id&quot;));
account.setName(resultSet.getString(&quot;name&quot;));
account.setMoney(resultSet.getFloat(&quot;money&quot;));
return account;</code></pre><p>}<br>}</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">#### <span class="number">4.</span> Dao层操作</span><br><span class="line">* XML配置</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p><beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"></p>
<!--    配置Dao-->
<bean id="accountDaoId" class="com.zhao.dao.impl.AccountImpl">
   <property name="jdbcTemplate" ref="jdbcTemplate"></property> 
</bean>
<!--    配置JdbcTemplate-->
<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <property name="dataSource" ref="dataSource"></property>
</bean>
<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"></property>
    <property name="url" value="jdbc:mysql://localhost:3306/eesy?serverTimezone=Asia/Shanghai"></property>
    <property name="username" value="root"></property>
    <property name="password" value="zhao1314520"></property>
</bean>
</beans>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>实现类</span><br></pre></td></tr></table></figure>
/*
* 账户持久层实现类
* */
public class AccountImpl implements IAccountDao {

<p>private JdbcTemplate jdbcTemplate;</p>
<p>public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {</p>
<pre><code>this.jdbcTemplate = jdbcTemplate;</code></pre><p>}</p>
</li>
</ul>
<pre><code>public Account findAccountById(Integer accountId) {
    List&lt;Account&gt; accounts = getJdbcTemplate().query(&quot;select * from account where id=?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
    return accounts.isEmpty()?null:accounts.get(0);

}



public Account findAccountName(String accountName) {
    List&lt;Account&gt; accounts = getJdbcTemplate().query(&quot;select * from account where name=?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
    if(accounts.isEmpty()){
        return null;
    }
    if(accounts.size()&gt;1){
        throw new RuntimeException(&quot;结果集不唯一&quot;);
    }
    return accounts.get(0);
}




public void updateAccount(Account account) {
    String sql =&quot;update account set name=?,money=? where id=?&quot;;
    Object[] obj ={account.getName(),account.getMoney(),account.getId()};
    getJdbcTemplate().update(sql,obj);
}</code></pre><p>}<br> <figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>测试类</span><br></pre></td></tr></table></figure><br>public class JdbcTemplatedomo4 {</p>
<pre><code>public static void main(String[] args) {

    ApplicationContext applicationContext =new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
    IAccountDao iAccountDao = applicationContext.getBean(&quot;accountDaoId&quot;, IAccountDao.class);
    Account account = iAccountDao.findAccountById(1);
    System.out.println(account);

    account.setMoney(40000f);
    iAccountDao.updateAccount(account);

}</code></pre><p>}<br> <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">#### <span class="number">5.</span> 多个Dao 方式一：提取自定义代码方式</span><br><span class="line"><span class="number">1.</span> 公共类</span><br></pre></td></tr></table></figure><br>/*</p>
<ul>
<li>用于抽取Dao中的重复代码</li>
<li>注意get|set方法</li>
<li>*/</li>
</ul>
<p>public class jdbcDaoSupport {<br>    private JdbcTemplate jdbcTemplate;</p>
<pre><code>public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
    this.jdbcTemplate = jdbcTemplate;
}

public JdbcTemplate getJdbcTemplate() {
    return jdbcTemplate;
}

//private DataSource dataSource;

public void setDateSource(DataSource dataSource) {
   // this.dataSource = dataSource;
    if(jdbcTemplate == null){
        jdbcTemplate = createJdbcTemplate(dataSource);
    }
}
private JdbcTemplate createJdbcTemplate(DataSource dataSource){
    return new JdbcTemplate(dataSource);
}</code></pre><p>}<br> <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span> 实现类</span><br></pre></td></tr></table></figure><br>/*</p>
<ul>
<li><p>账户持久层实现类</p>
</li>
<li><p>继承 jdbcDaoSupport</p>
</li>
<li><p>*/<br>public class AccountImpl extends jdbcDaoSupport implements IAccountDao {</p>
<p>  public Account findAccountById(Integer accountId) {</p>
<pre><code>List&lt;Account&gt; accounts = getJdbcTemplate().query(&quot;select * from account where id=?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
return accounts.isEmpty()?null:accounts.get(0);</code></pre><p>  }</p>
</li>
</ul>
<pre><code>public Account findAccountName(String accountName) {
    List&lt;Account&gt; accounts = getJdbcTemplate().query(&quot;select * from account where name=?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
    if(accounts.isEmpty()){
        return null;
    }
    if(accounts.size()&gt;1){
        throw new RuntimeException(&quot;结果集不唯一&quot;);
    }
    return accounts.get(0);
}


public void updateAccount(Account account) {
    String sql =&quot;update account set name=?,money=? where id=?&quot;;
    Object[] obj ={account.getName(),account.getMoney(),account.getId()};
    getJdbcTemplate().update(sql,obj);
}</code></pre><p>}<br> <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">3. </span>XML配置</span><br><span class="line"><span class="bullet">* </span>公共类中含有数据源</span><br><span class="line"><span class="bullet">* </span>可取消下面代码</span><br></pre></td></tr></table></figure><br> <!--    配置JdbcTemplate--><br>    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"><br>        <property name="dataSource" ref="dataSource"></property><br>    </bean>–&gt;<br> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--    配置Dao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.dao.impl.AccountImpl"</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--        &lt;property name="jdbcTemplate" ref="jdbcTemplate"&gt;&lt;/property&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--    配置JdbcTemplate</span></span><br><span class="line"><span class="comment">    &lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;</span></span><br><span class="line"><span class="comment">        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;/bean&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/eesy?serverTimezone=Asia/Shanghai"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"zhao1314520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="6-多个Dao-方式二：继承Spring-JdbcDaoSupport类"><a href="#6-多个Dao-方式二：继承Spring-JdbcDaoSupport类" class="headerlink" title="6.  多个Dao 方式二：继承Spring  JdbcDaoSupport类"></a>6.  多个Dao 方式二：继承Spring  JdbcDaoSupport类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 账户持久层实现类</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer accountId)</span> </span>&#123;</span><br><span class="line">        List&lt;Account&gt; accounts = getJdbcTemplate().query(<span class="string">"select * from account where id=?"</span>,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account<span class="class">.<span class="keyword">class</span>),<span class="title">accountId</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> accounts.isEmpty()?<span class="keyword">null</span>:accounts.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountName</span><span class="params">(String accountName)</span> </span>&#123;</span><br><span class="line">        List&lt;Account&gt; accounts = getJdbcTemplate().query(<span class="string">"select * from account where name=?"</span>,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account<span class="class">.<span class="keyword">class</span>),<span class="title">accountName</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span>(accounts.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(accounts.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"结果集不唯一"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accounts.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        String sql =<span class="string">"update account set name=?,money=? where id=?"</span>;</span><br><span class="line">        Object[] obj =&#123;account.getName(),account.getMoney(),account.getId()&#125;;</span><br><span class="line">        getJdbcTemplate().update(sql,obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>spring框架-一</title>
    <url>/2019/11/03/spring%E6%A1%86%E6%9E%B6-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="知识点一："><a href="#知识点一：" class="headerlink" title="知识点一："></a>知识点一：</h3><ol>
<li>4+1   4个核心（beans core context expression）+1个依类（commons-logins..jar）</li>
</ol>
<p>！<a href="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1572031281077&di=19f3b40cfe98239b9a176702be5a0cd8&imgtype=0&src=http%3A%2F%2Fpic2.zhimg.com%2Fv2-07d0fdbd0f685bc90d59abe2a976eb41_b.jpg" target="_blank" rel="noopener" title="Spring的jar包">Spring</a></p>
<ol start="2">
<li>IO  控制反转 由Spring配置文件beans.xml完成创建对象的过程</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">"userService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zhao.service.UserSercice"</span>&gt;</span><br><span class="line">      </span><br><span class="line">  &lt;<span class="regexp">/bean&gt;</span></span><br></pre></td></tr></table></figure>
<p>DI Dependency Injection 依赖注入 在service写一个属性 有get、set方法 在bean.xml中配置属性<br>    其内部执行相当于 new创建对象 调用set方法</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 依赖注入调用属性的Set方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接口指向实现类（实现类也可以）实例化<br>依赖：一个类需要另一个类<br>注入：set方法设置值</p>
<h3 id="知识点二："><a href="#知识点二：" class="headerlink" title="知识点二："></a>知识点二：</h3><p>Spring加载beans.xml 的三种方式：</p>
<ol>
<li><p>方式1.？加载beans.xml配置文件（ApplicationContext 容器）<br>ClassPath：指的是classes路径</p>
<pre><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);</code></pre></li>
<li><p>方式2.文件系统路径获取配置文件</p>
<pre><code>ApplicationContext context1 = new FileSystemXmlApplicationContext(&quot;G:\\IDEA\\Spring_Domo\\spring01\\src\\beans.xml&quot;);</code></pre></li>
</ol>
<p>3.// 方式3.     使用BeanFactory（了解）<br>        String path =”G:\IDEA\Spring_Domo\spring01\src\beans.xml”;<br>        BeanFactory factory = new XmlBeanFactory(new FileSystemResource(path));</p>
<p>  //2.从spring容器中获取对象<br>        IuserSercice userSercice = (IuserSercice) context.getBean(“userService”);<br>        userSercice.add();</p>
<h3 id="知识点三："><a href="#知识点三：" class="headerlink" title="知识点三："></a>知识点三：</h3><ol>
<li>ApplicationContext和BeanFactory比较</li>
<li>BeanFactory 采用延时加载，第一次getBean时才会初始化Bean</li>
<li>ApplicationContext 及时加载</li>
</ol>
<h3 id="知识点四："><a href="#知识点四：" class="headerlink" title="知识点四："></a>知识点四：</h3><h5 id="装配Bean的三种方式"><a href="#装配Bean的三种方式" class="headerlink" title="装配Bean的三种方式"></a>装配Bean的三种方式</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--装配Bean的三种方式，--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一种   new实现类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService1"</span> <span class="attr">class</span>=<span class="string">"com.zhao.service.UserSercice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    第二种方式 通过静态工厂方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService2"</span> <span class="attr">class</span>=<span class="string">"com.zhao.service.UserServiceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"createUserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    第三种方式 通过实例工厂方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory2"</span> <span class="attr">class</span>=<span class="string">"com.zhao.service.UserServiceFactory1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService3"</span> <span class="attr">factory-bean</span>=<span class="string">"factory2"</span> <span class="attr">factory-method</span>=<span class="string">"createUserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Lensson1</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//new对象</span></span><br><span class="line">    @Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//      classPath 类路径加载</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans1.xml"</span>);</span><br><span class="line">        IuserSercice userService1 = (IuserSercice) context.getBean(<span class="string">"userService"</span>);</span><br><span class="line">        userService1.<span class="keyword">add</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        静态工厂</span></span><br><span class="line">        IuserSercice userSercice2 =UserServiceFactory.createUserService();</span><br><span class="line">        userSercice2.<span class="keyword">add</span>();</span><br><span class="line"></span><br><span class="line">        ApplicationContext context1 = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans1.xml"</span>);</span><br><span class="line">        IuserSercice userService3 = (IuserSercice) context1.getBean(<span class="string">"userService2"</span>);</span><br><span class="line">        userService3.<span class="keyword">add</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        实例工厂</span></span><br><span class="line"><span class="comment">//        1.创建工厂</span></span><br><span class="line"><span class="comment">//        UserServiceFactory1 factory2 = new UserServiceFactory1();</span></span><br><span class="line"><span class="comment">//        IuserSercice userService4 = factory2.createUserService();</span></span><br><span class="line"><span class="comment">//        userService4.add();</span></span><br><span class="line"></span><br><span class="line">        ApplicationContext context3 = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans1.xml"</span>);</span><br><span class="line"></span><br><span class="line">        IuserSercice userSercice4 = (IuserSercice) context3.getBean(<span class="string">"userService3"</span>);</span><br><span class="line">        userSercice4.<span class="keyword">add</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第二种静态工厂"><a href="#第二种静态工厂" class="headerlink" title="第二种静态工厂"></a>第二种静态工厂</h3><pre><code>public class UserServiceFactory {

    public static IuserSercice createUserService(){

        return new UserSercice();
    }
}</code></pre><h4 id="第三种工厂类"><a href="#第三种工厂类" class="headerlink" title="第三种工厂类"></a>第三种工厂类</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceFactory1</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IuserSercice <span class="title">createUserService</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserSercice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="装配Bean基于XML"><a href="#装配Bean基于XML" class="headerlink" title="装配Bean基于XML"></a>装配Bean基于XML</h4><h4 id="1-默认构造"><a href="#1-默认构造" class="headerlink" title="1. 默认构造"></a>1. 默认构造</h4><pre><code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;&lt;\bean&gt;</code></pre><h4 id="2-静态工厂（Spring整合）"><a href="#2-静态工厂（Spring整合）" class="headerlink" title="2. 静态工厂（Spring整合）"></a>2. 静态工厂（Spring整合）</h4><p>常用语Spring整合其他框架<br>静态工厂：用于生产实例，方法必须static</p>
<pre><code>&lt;bean id=&quot;&quot; class=&quot;工厂全限定名&quot; factory-method=&quot;方法名&quot;&gt;&lt;\bean&gt;</code></pre><p>Spring之前创建静态工厂的方法</p>
<ol>
<li><p>工厂类</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建工厂</span></span><br><span class="line">    <span class="comment">//    spring 之创建用工厂方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserSercice <span class="title">createService</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserSercice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用方法</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    spring 之前调用工厂方法</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">domo01</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UserSercice userSercice = MyBeanFactory.createService();</span><br><span class="line">        userSercice.add();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Spring创建静态工厂方法</p>
</li>
<li><p>beans.xml文件配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  将静态工厂创建的实例交于Spring--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.zhao.bean_static_factory.MyBeanFactory"</span> <span class="attr">factory-method</span>=<span class="string">"createService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>调用方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">domo02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Spring工厂</span></span><br><span class="line">       <span class="comment">//String xmlPath="com/zhao/bean_static_factory/beans.xml";</span></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"com/zhao/bean_static_factory/beans.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//      getBean 参数二类型，不需要强转</span></span><br><span class="line"><span class="comment">//      UserSercice userSercice1 =(UserService) applicationContext.getBean("userService");</span></span><br><span class="line">        UserSercice userSercice1 = applicationContext.getBean(<span class="string">"userService"</span>,UserSercice<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        userSercice1.add();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="实例工厂"><a href="#实例工厂" class="headerlink" title="实例工厂"></a>实例工厂</h4><p>Spring之前创建工厂的方法</p>
</li>
<li><p>工厂类</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建工厂（实例工厂）</span></span><br><span class="line">    <span class="comment">//    spring 之创建用工厂方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserSercice <span class="title">createService</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserSercice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用方法</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    spring 之前调用工厂方法</span></span><br><span class="line"><span class="comment">//    自定义工厂</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">domo01</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        1.创建工厂</span></span><br><span class="line">        MyBeanFactory myBeanFactory = <span class="keyword">new</span> MyBeanFactory();</span><br><span class="line">        <span class="comment">//2.通过工厂实例，获取对象</span></span><br><span class="line">        UserSercice userSercice = myBeanFactory.createService();</span><br><span class="line">        userSercice.add();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Spring创建工厂方法</p>
</li>
<li><p>beans.xml文件配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    将工厂创建的实例交于Spring--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myBeanFactory"</span> <span class="attr">class</span>=<span class="string">"com.zhao.bean_factory.MyBeanFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    获得UserService--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span>  <span class="attr">factory-bean</span>=<span class="string">"myBeanFactory"</span> <span class="attr">factory-method</span>=<span class="string">"createService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>调用方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">domo02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Spring工厂</span></span><br><span class="line"></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"com/zhao/bean_factory/beans.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//      getBean 参数二类型，不需要强转</span></span><br><span class="line"><span class="comment">//      UserSercice userSercice1 =(UserService) applicationContext.getBean("userService");</span></span><br><span class="line">        UserSercice userSercice1 = applicationContext.getBean(<span class="string">"userServiceId"</span>, UserSercice<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        userSercice1.add();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="bean的种类"><a href="#bean的种类" class="headerlink" title="bean的种类"></a>bean的种类</h3></li>
<li><p>普通bean： <bean id="" class="A"> spring 直接创建A实例，并返回</p>
</li>
<li><p>FactoryBean：是一个特殊的bean，具有工厂生产对象的能力，只能生产特定的对象<br>bean必须实现FactoryBean接口，此接口提供方法getObject()用于<br>获得特定的对象(bean)<br><bean id="" class="FB">先创建FB实例，使用调用getObject()方法，并返回方法的返回值<br>底层调用方法：<br> FB fb = new FB();<br> return fb,getObject();</p>
</li>
<li><p>BeanFactory 和 FactoryBean 比较</p>
<ul>
<li>BeanFactory: 工厂，用于生产任意bean</li>
<li>FactoryBean：特殊bean，用于生产特殊的bean<br>例如：ProxyFactoryBean 此工厂bean用于生产代理<br><bean id="" class="...ProxyFactoryBean"> 获取代理对象的实例，AOP使用<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3></li>
</ul>
</li>
</ol>
<ul>
<li><p>singleton： 单例 默认值；</p>
</li>
<li><p>prototype:  多例,每执行一次getBean将获得一个实例，select单例，struts2的Action为多例</p>
</li>
<li><p>配置信息</p>
</li>
</ul>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">    &lt;bean id=<span class="string">""</span> <span class="keyword">class</span>=<span class="string">""</span>&gt;</span><br><span class="line"><span class="comment">//scope="prototype" 多例</span></span><br><span class="line">    &lt;bean id=<span class="string">"userService"</span> <span class="keyword">class</span>=<span class="string">"com.zhao.scop.UserSercice"</span> scope=<span class="string">"prototype"</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="生命周期（11步）"><a href="#生命周期（11步）" class="headerlink" title="生命周期（11步）"></a>生命周期（11步）</h3><ul>
<li><p>初始化和销毁</p>
<ul>
<li>目标方法执行前和执行后，将执行初始化或销毁</li>
<li>beans.xml<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">""</span> <span class="attribute">class</span>=<span class="string">""</span> <span class="attribute">init-method</span>=<span class="string">"初始化方法"</span>      <span class="attribute">destory-method</span>=<span class="string">"销毁方法名称"</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"userService"</span> <span class="attribute">class</span>=<span class="string">"com.zhao.lifecycle.UserSercice"</span> <span class="attribute">init-method</span>=<span class="string">"myInit"</span> <span class="attribute">destroy-method</span>=<span class="string">"myDestory"</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>调用方法</p>
<pre><code>public class Testlifecycle {</code></pre></li>
</ul>
<pre><code>    @Test
    public void domo02() throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {

        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;com/zhao/lifecycle/beans.xml&quot;);
        UserSercice userSercice = applicationContext.getBean(&quot;userService&quot;,UserSercice.class);

        userSercice.add();

        //要求：1.容器必须close，执行销毁方法
        applicationContext.getClass().getMethod(&quot;close&quot;).invoke(applicationContext);
        //applicationContext.close();
    }
}</code></pre><ul>
<li>BeanPostProcessor 后处理bean<ul>
<li>Spring 提供一种机制，只要实现此接口BeanPostprocessor，并将实现类提供该Spring容器，Spring容器将自动执行，在初始化方法前执行before(),在初始化方法后执行after()</li>
<li>Spring 提供工厂钩子，用于修改实例对象，可以生成代理对象，是AOP的底层</li>
</ul>
</li>
</ul>
<p>后处理类：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> myPostProcessor implements BeanPostProcessor &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="keyword">Object</span> postProcessBeforeInitialization(<span class="keyword">Object</span> bean, String beanName) throws BeansException &#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("前处理"+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="keyword">Object</span> postProcessAfterInitialization(<span class="keyword">Object</span> bean, String beanName) throws BeansException &#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("后处理"+beanName);</span><br><span class="line">        //bean目标对象 bean.getClass().getInterfaces()</span><br><span class="line">//        生成JDK代理 Proxy JDK工具类  myPostProcessor.<span class="keyword">class</span>.getClassLoader()当前类的类加载器</span><br><span class="line">//        <span class="built_in">new</span> InvocationHandler() 处理程序</span><br><span class="line">        //<span class="keyword">return</span> bean;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(myPostProcessor.<span class="keyword">class</span>.getClassLoader(),</span><br><span class="line">                bean.getClass().getInterfaces(),</span><br><span class="line">                <span class="built_in">new</span> InvocationHandler() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    <span class="built_in">public</span> <span class="keyword">Object</span> invoke(<span class="keyword">Object</span> proxy, <span class="keyword">Method</span> <span class="keyword">method</span>, <span class="keyword">Object</span>[] args) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">System</span>.<span class="keyword">out</span>.println("开启事务处理方法");</span><br><span class="line">                        //执行目标方法</span><br><span class="line">                        <span class="keyword">Object</span> <span class="keyword">object</span> = <span class="keyword">method</span>.invoke(bean);</span><br><span class="line">                        <span class="keyword">System</span>.<span class="keyword">out</span>.println("提交事务处理方法");</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">object</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> benas.xml<br> <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">     &lt;bean id=<span class="string">"userServiceId"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zhao.lifecycle.UserSercice"</span> init-method=<span class="string">"myInit"</span> destroy-method=<span class="string">"myDestory"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line">&lt;!--    将后处理的的实现类注册给Spring--&gt;</span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zhao.lifecycle.myPostProcessor"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>测试类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Testlifecycle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">domo02</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"com/zhao/lifecycle/beans.xml"</span>);</span><br><span class="line"></span><br><span class="line">        IuserSercice  userSercice = (IuserSercice) applicationContext.getBean(<span class="string">"userServiceId"</span>);</span><br><span class="line"></span><br><span class="line">        userSercice.add();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//要求：1.容器必须close，执行销毁方法</span></span><br><span class="line">        applicationContext.getClass().getMethod(<span class="string">"close"</span>).invoke(applicationContext);</span><br><span class="line">        <span class="comment">//applicationContext.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   错误信息： org.springframework.beans.factory.BeanNotOfRequiredTypeException</p>
<p>   注入spring的bean 出现的，具体是由于spring采用代理的机制导致的<br>   解决方法：(注意此处接口指向)</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">I<span class="keyword">user</span>Sercice  <span class="keyword">user</span>Sercice = (I<span class="keyword">user</span>Sercice) applicationContext.getBean(<span class="string">"userServiceId"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="属性依赖注入"><a href="#属性依赖注入" class="headerlink" title="属性依赖注入"></a>属性依赖注入</h3><ul>
<li><p>Setter方法注入</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>普通数据：&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"pname"</span> value=<span class="string">"阿尔提尔"</span>&gt;&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"><span class="number">2.</span>字标签&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"pname"</span> &gt;</span><br><span class="line">    &lt;value&gt;v阿尔提尔&lt;/value&gt;</span><br><span class="line">&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">注意：<span class="number">1</span>和<span class="number">2</span>是等效的</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">"pesonId"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zhao.setter.peson"</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">"pname"</span> value=<span class="string">"阿尔提尔"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line">    &lt;property name=<span class="string">"age"</span> value=<span class="string">"24"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;property name=<span class="string">"coperAddrs"</span> ref=<span class="string">"coperAddrId"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line">    &lt;property name=<span class="string">"homeAddr"</span>&gt;</span><br><span class="line">        &lt;ref bean=<span class="string">"homeAddrId"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/property&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>bean&gt;</span><br><span class="line">&lt;!-- 引用数据--&gt;</span><br><span class="line">&lt;bean id=<span class="string">"homeAddrId"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zhao.setter.Address"</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">"home"</span> value=<span class="string">"重庆"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line">    &lt;property name=<span class="string">"tel"</span> value=<span class="string">"13993216246"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/bean&gt;</span></span><br><span class="line"><span class="regexp">&lt;bean id="coperAddrId" class="com.zhao.setter.Address"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;property name="home" value="城管"&gt;&lt;/</span>property&gt;</span><br><span class="line">    &lt;property name=<span class="string">"tel"</span> value=<span class="string">"18522536924"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/bean&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="P命名空间【了解】"><a href="#P命名空间【了解】" class="headerlink" title="P命名空间【了解】"></a>P命名空间【了解】</h4><ul>
<li>对setter方法注入进行简化，替换<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"属性名"</span>&gt;</span><br></pre></td></tr></table></figure>
而是在&lt;bean p:属性名=”普通值” p:属性名 -ref=”引用值”&gt;</li>
<li>P命名空间使用前提必须添加命名空间<br>xmlns:p=”<a href="http://www.springframework.org/schema/p&quot;" target="_blank" rel="noopener">http://www.springframework.org/schema/p&quot;</a></li>
</ul>
<p>beans.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!--    p命名空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pesonId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.p.peson"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:pname</span>=<span class="string">"阿尔提尔"</span> <span class="attr">p:age</span>=<span class="string">"22"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:coperAddrs-ref</span>=<span class="string">"coperAddrId"</span> <span class="attr">p:homeAddr-ref</span>=<span class="string">"homeAddrId"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"homeAddrId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.p.Address"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:home</span>=<span class="string">"重庆"</span> <span class="attr">p:tel</span>=<span class="string">"13993216246"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"coperAddrId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.p.Address"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:home</span>=<span class="string">"城管"</span> <span class="attr">p:tel</span>=<span class="string">"18522536924"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="SpEL【了解】"><a href="#SpEL【了解】" class="headerlink" title="SpEL【了解】"></a>SpEL【了解】</h3><ul>
<li>对<property>进行统一编程所有的内容都是用value<property name="" value="#{表达式}">
eg：#{123} #{"jack"}
  #{beanId}          :另一个bean的引用
  #{bean.propName}   :操作属性
  #{bean.toString()} :执行方法
  #{T(类)字段|方法}   ：静态方法或字段

</li>
</ul>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!--    </span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">peoperty</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;userId.name.toUpperCase()&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        通过另一个bean，获得属性，调用方法</span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">peoperty</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;userId.name?.toUpperCase()&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        ?.表示对象不为空，调用方法   </span></span><br><span class="line"><span class="xml">    --&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.SpEl.User"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;'阿尔提尔'&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pi"</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;T(java.lang.<span class="keyword">Math</span>).PI&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="集合注入"><a href="#集合注入" class="headerlink" title="集合注入"></a>集合注入</h3> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    集合的注入都是给&lt;peoperty&gt;添加字标签</span></span><br><span class="line"><span class="comment">    数组：&lt;array&gt;</span></span><br><span class="line"><span class="comment">    List：&lt;list&gt;</span></span><br><span class="line"><span class="comment">    Set：&lt;set&gt;</span></span><br><span class="line"><span class="comment">    Map：&lt;map&gt;  键值对&lt;entry&gt;</span></span><br><span class="line"><span class="comment">    Properties：&lt;props&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    普通数据：&lt;value&gt;</span></span><br><span class="line"><span class="comment">    引用数据：&lt;ref&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"collId"</span> <span class="attr">class</span>=<span class="string">"com.zhao.coll.CollDate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arryData"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>DS<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>DZD<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>屌丝<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>吊中吊<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"listData"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>DS<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>DZD<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>屌丝<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>吊中吊<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"setData"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>DS<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>屌丝<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>吊中吊<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapData"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"jack"</span> <span class="attr">value</span>=<span class="string">"杰克"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">key</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>kaer<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>卡尔<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"propsData"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"高富帅nao"</span>&gt;</span>嫐<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"白富美niao"</span>&gt;</span>嬲<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"男屌丝nong"</span>&gt;</span>挊<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  ``` </span><br><span class="line"></span><br><span class="line">### 装配Bean基于注解</span><br><span class="line">* 注解：就是一个类，使用@注解名称</span><br><span class="line">* 开发中:使用注解 取代XML配置文件</span><br><span class="line">1. @Component 取代 ```<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>@Component(&quot;id&quot;) 取代 ```&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;```</code></pre><ol start="2">
<li>web开发，提供3个@Component注解的衍生注解(功能一样) 取代<code>&lt;bean class=&quot;&quot;&gt;</code><br> @Repository  dao层<br> @service     service层<br> @Controller  web层</li>
<li>依赖注入  给私有字段设置 也可以给setter方法设置<br> 普通值：@value(“”)<br> 引用值：<pre><code>方式一：按照【类型】注入
        @Autowired  【自动】
方式二：按照【名称】注入1
        @Autowired 
        @Qualifier(&quot;名称&quot;)
方式三：按照【名称】注入2
        @Resource(&quot;名称&quot;)</code></pre></li>
<li>生命周期<br> 初始化：@PostConstruct<br> 销毁： @PreDestroy</li>
<li>作用域<br> @Scope(“prototype”)多例</li>
</ol>
<h5 id="注解使用前提，添加命名空间，让Spring扫描含有注解的类"><a href="#注解使用前提，添加命名空间，让Spring扫描含有注解的类" class="headerlink" title="注解使用前提，添加命名空间，让Spring扫描含有注解的类"></a>注解使用前提，添加命名空间，让Spring扫描含有注解的类</h5><p>schema命名空间</p>
<ol>
<li>默认命名空间<br> 默认 xmlns=””; &lt;标签名&gt; <bean><br> 显示：xmlns：别名=”” &lt;别名：标签名&gt; <a href="context:...." target="_blank" rel="noopener">context:....</a></li>
<li>确定schema.xsd 文件位置<br> xsl:schemaLocaltion=”名称 位置 名称2 位置2 …..”;<br> 内容都是成对的【名称 位置】</li>
</ol>
<ul>
<li>添加的分别是：</li>
</ul>
<ol>
<li>xmlns:context=”<a href="http://www.springframework.org/schema/context&quot;" target="_blank" rel="noopener">http://www.springframework.org/schema/context&quot;</a></li>
<li><a href="http://www.springframework.org/schema/context" target="_blank" rel="noopener">http://www.springframework.org/schema/context</a></li>
<li><a href="http://www.springframework.org/schema/context/spring-context.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/context/spring-context.xsd</a></li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;beans <span class="attribute">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xmlns:<span class="attribute">xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns:<span class="attribute">context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       xsi:<span class="attribute">schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>beans.xml配置组建扫描，扫描含有注解的类<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--    组建扫描，扫描含有注解的类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.zhao.annotation_IOC"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>测试类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Testweb</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"com/zhao/Web/beans.xml"</span>);</span><br><span class="line">        StudentAction studentAction =  applicationContext.getBean(<span class="string">"studentActionId"</span>,StudentAction<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        studentAction.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>web层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Controller</span>(<span class="string">"studentActionId"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">        studentService.addStudent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>service 层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentDao studentDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"studentDaoId"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentDao</span><span class="params">(StudentDao studentDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentDao = studentDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        studentDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>dao层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Repository</span>(<span class="string">"studentDaoId"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDaoImpl</span> <span class="keyword">implements</span> <span class="title">StudentDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dao"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/11/03/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
